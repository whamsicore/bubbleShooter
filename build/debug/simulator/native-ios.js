NATIVE=false;CACHE={"spritesheets/map.json":"{\"resources/images/purple.png\":{\"marginRight\":0,\"sheetSize\":[1280,400],\"w\":1280,\"x\":0,\"h\":400,\"y\":0,\"scale\":1,\"marginBottom\":0,\"sheet\":\"spritesheets/resources-images0.png\",\"marginTop\":0,\"marginLeft\":0,\"group\":\"resources-images\"},\"resources/images/green.png\":{\"marginRight\":0,\"sheetSize\":[1280,400],\"w\":1280,\"x\":0,\"h\":400,\"y\":0,\"scale\":1,\"marginBottom\":0,\"sheet\":\"spritesheets/resources-images0.png\",\"marginTop\":0,\"marginLeft\":0,\"group\":\"resources-images\"},\"resources/images/startbutton.png\":{\"marginRight\":0,\"sheetSize\":[256,256],\"w\":243,\"x\":0,\"h\":235,\"y\":0,\"scale\":1,\"marginBottom\":0,\"sheet\":\"spritesheets/resources-images1.png\",\"marginTop\":8,\"marginLeft\":0,\"group\":\"resources-images\"},\"resources/images/gold.png\":{\"marginRight\":0,\"sheetSize\":[1280,400],\"w\":1280,\"x\":0,\"h\":400,\"y\":0,\"scale\":1,\"marginBottom\":0,\"sheet\":\"spritesheets/resources-images0.png\",\"marginTop\":0,\"marginLeft\":0,\"group\":\"resources-images\"},\"resources/images/GemCollection.png\":{\"marginRight\":0,\"sheetSize\":[1280,400],\"w\":1280,\"x\":0,\"h\":400,\"y\":0,\"scale\":1,\"marginBottom\":0,\"sheet\":\"spritesheets/resources-images0.png\",\"marginTop\":0,\"marginLeft\":0,\"group\":\"resources-images\"},\"resources/images/red.png\":{\"marginRight\":0,\"sheetSize\":[1280,400],\"w\":1280,\"x\":0,\"h\":400,\"y\":0,\"scale\":1,\"marginBottom\":0,\"sheet\":\"spritesheets/resources-images0.png\",\"marginTop\":0,\"marginLeft\":0,\"group\":\"resources-images\"}}"};
jsio=(function init(cloneFrom) {
    // We expect this code to be minified before production use, so we may
    // write code slightly more verbosely than we otherwise would.

    var INITIAL_FILE = '<initial file>';
    var MODULE_NOT_FOUND = 'MODULE_NOT_FOUND';

    // Should we parse syntax errors in the browser?
    var DEBUG = true;

    // Store a reference to the slice function for converting objects of
    // type arguments to type array.
    var SLICE = Array.prototype.slice;

    // js.io supports multiple JavaScript environments such as node.js and
    // most web browsers (IE, Firefox, WebKit).  The ENV object wraps
    // any utility functions that contain environment-specific code (e.g.
    // reading a file using node's `fs` library or a browser's
    // `XMLHttpRequest`).  Running js.io in other JavaScript environments
    // is as easy as implementing an environment object that conforms to
    // the abstract interface for an environment (provided below) and
    // calling `jsio.setEnv()`.
    var ENV;

    // Checks if the last character in a string is `/`.
    var rexpEndSlash = /(\/|\\)$/;

    function getModuleDef (path) {
      path += '.js';
      return jsio.__modules[path] || new ModuleDef(path);
    }

    // Creates an object containing metadata about a module.
    function ModuleDef (path) {
      this.path = path;
      this.friendlyPath = path;

      util.splitPath(path, this);
      this.directory = util.resolve(ENV.getCwd(), this.directory);
    }

    ModuleDef.prototype.setBase = function (baseMod, basePath) {
      this.baseMod = baseMod;
      this.basePath = basePath + '/' + baseMod;
    };

    var HOST = /^([a-z][a-z0-9+\-\.]*:\/\/.*?\/)(.*)$/;
    var PROTOCOL = /^[a-z][a-z0-9+\-\.]*:/;

    // Utility functions
    var util = {
        // `util.bind` returns a function that, when called, will execute
        // the method passed in with the provided context and any additional
        // arguments passed to `util.bind`.
        //       util.bind(obj, 'f', a) -> function() { return obj.f(a); }
        //       util.bind(obj, g, a, b, c) -> function() { return g.call(g, a, b, c); }
        bind: function(context, method/*, args... */) {
          var args = SLICE.call(arguments, 2);
          return function () {
            method = (typeof method == 'string' ? context[method] : method);
            return method.apply(context, args.concat(SLICE.call(arguments, 0)));
          };
        },

        // `util.addEndSlash` accepts a string.  That string is returned with a `/`
        // appended if the string did not already end in a `/`.
        addEndSlash: function(str) {
          return rexpEndSlash.test(str) ? str : str + '/';
        },

        // `util.removeEndSlash` accepts a string.  It removes a trailing `/` if
        // one is found.
        removeEndSlash: function(str) {
          return str.replace(rexpEndSlash, '');
        },

        // `util.relative` accepts two paths (strings) and returns the second path
        // relative to the first.
        //
        //  - if `path` starts with `relativeTo`, then strip `path` off the
        //    `relativeTo` part
        //
        //         util.relative('abc/def/', 'abc') -> 'def'
        //
        //  - if `path` starts with some substring of `relativeTo`, remove
        //    this substring and add `../` for each remaining segment of
        //    `relativeTo`.
        //
        //         util.relative('abc/def/', 'abc/hij') -> '../def'
        //
        relative: function (relativeTo, path) {
          var len = relativeTo.length;
          if (path.substring(0, len) == relativeTo) {
            // if the relative path now starts with a path separator
            // either (/ or \), remove it
            /* Note: we're casting a boolean to an int by adding len to it */
            return path.slice(len + /[\/\\]/.test(path.charAt(len)));
          }

          var sA = util.removeEndSlash(path).split(ENV.pathSep),
            sB = util.removeEndSlash(relativeTo).split(ENV.pathSep),
            i = 0;

          /* Count how many segments match. */
          while(sA[i] == sB[i]) { ++i; }

          if (i) {
            /* If at least some segments matched, remove them.  The result is our new path. */
            path = sA.slice(i).join(ENV.pathSep);

            /* Prepend `../` for each segment remaining in `relativeTo`. */
            for (var j = sB.length - i; j > 0; --j) { path = '../' + path; }
          }

          return path;
        },

        // `buildPath` accepts an arbitrary number of string arguments to concatenate into a path.
        //     util.buildPath('a', 'b', 'c/', 'd/') -> 'a/b/c/d/'
        buildPath: function() {
          var pieces = [];
          for (var i = 0, n = arguments.length; i < n; ++i) {
            var piece = arguments[i];
            if (PROTOCOL.test(piece)) {
              pieces.length = 0;
            }

            if (piece != '.' && piece != './' && piece) {
              pieces.push(piece);
            }
          }

          return util.resolveRelativePath(pieces.join('/'));
        },

        // `resolveRelativePath` removes relative path indicators.  For example:
        //     util.resolveRelativePath('a/../b') -> b
        resolveRelativePath: function(path) {
          /* If the path starts with a protocol+host, store it and remove it (add it
             back later) so we don't accidently modify it. */
          var protocol = path.match(HOST);
          if (protocol) { path = protocol[2]; }

          /* Remove multiple slashes and trivial dots (`/./ -> /`). */
          path = path.replace(/\/+/g, '/').replace(/\/\.\//g, '/');

          /* Loop to collapse instances of `../` in the path by matching a previous
             path segment.  Essentially, we find substrings of the form `/abc/../`
             where abc is not `.` or `..` and replace the substrings with `/`.
             We loop until the string no longer changes since after collapsing
             possible instances once, we may have created more instances that can
             be collapsed.
          */
          var o;
          while((o = path) != (path = path.replace(/(^|\/)(?!\.?\.\/)([^\/]+)\/\.\.\//g, '$1'))) {}
          /* Don't forget to prepend any protocol we might have removed earlier. */
          return protocol ? protocol[1] + path.replace(/^\//, '') : path;
        },

        isAbsolutePath: function (path) {
          return /^\//.test(path) || PROTOCOL.test(path) || ENV.isWindowsNode && /^[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+/.test(path);
        },

        resolve: function (from, to) {
          return this.isAbsolutePath(to) ? util.resolveRelativePath(to) : util.buildPath(from, to);
        },

        resolveRelativeModule: function (modulePath, directory) {
          var result = [],
            parts = modulePath.split('.'),
            len = parts.length,
            relative = (len > 1 && !parts[0]),
            i = relative ? 0 : -1;

          while(++i < len) { result.push(parts[i] ? parts[i] : '..'); }
          return util.buildPath(relative ? directory : '', result.join('/'));
        },
        resolveModulePath: function (modulePath, directory) {
          // resolve relative paths
          if (modulePath.charAt(0) == '.') {
            return [
              getModuleDef(util.resolveRelativeModule(modulePath, directory)),
              getModuleDef(util.resolveRelativeModule(modulePath + '.index', directory))
            ];
          }

          // resolve absolute paths with respect to jsio packages/
          var pathSegments = modulePath.split('.');
          var n = pathSegments.length;
          for (var i = n; i > 0; --i) {
            var subpath = pathSegments.slice(0, i).join('.');
            var value = jsioPath.cache[subpath];
            var pathString = pathSegments.slice(i).join('/');
            if (value) {
              return [
                getModuleDef(util.buildPath(value, pathString)),
                getModuleDef(util.buildPath(value, pathString + '/index'))
              ];
            }
          }

          var baseMod = pathSegments[0];
          var pathString = pathSegments.join('/');
          var defs = [];
          var paths = jsioPath.get();
          var len = paths.length;
          for (var i = 0; i < len; ++i) {
            var base = paths[i];
            var path = util.buildPath(base, pathString);

            var moduleDef = getModuleDef(path);
            moduleDef.setBase(baseMod, base);
            defs.push(moduleDef);

            var moduleDef = getModuleDef(path + '/index');
            moduleDef.setBase(baseMod, base);
            defs.push(moduleDef);
          }
          return defs;
        },
        splitPath: function(path, result) {
          if (!result) { result = {}; }
          var i = Math.max(path.lastIndexOf('/'), path.lastIndexOf('\\')) + 1;
          result.directory = path.substring(0, i);
          result.filename = path.substring(i);
          return result;
        }
      };

    // construct the top-level jsio object
    var jsio = util.bind(this, _require, null, null, null);

    jsio.__util = util;
    jsio.__init__ = init;

    var srcCache;
    jsio.setCache = function(cache) { srcCache = jsio.__srcCache = cache; };
    jsio.setCache(cloneFrom && cloneFrom.__srcCache || {});

    jsio.setCachedSrc = function(path, src, locked) {
      if (srcCache[path] && srcCache[path].locked) {
        console.warn('Cache is ignoring (already present and locked) src ' + path);
        return;
      }
      srcCache[path] = { path: path, src: src, locked: locked };
    };
    jsio.getCachedSrc = function(path) { return srcCache[path]; };

    jsio.__filename = 'jsio.js';
    jsio.__cmds = [];
    jsio.__jsio = jsio;
    jsio.__require = _require;
    jsio.__modules = {preprocessors:{}};
    var jsioPath = {
        set: function(path) {
          this.value = [];
          (typeof path == 'string' ? [path] : path).map(this.add, this);
        },
        get: function() { return jsioPath.value.slice(0); },
        add: function (path) {
          if (arguments.length == 2) {
            var from = arguments[0];
            var to = util.resolve(ENV.getCwd(), arguments[1]);
            this.cache[from] = to;
          } else {
            path = util.resolve(ENV.getCwd(), path);
            var v = jsioPath.value, len = v.length;
            for (var i = 0; i < len; ++i) {
              if (v[i] == path) { return; }
            }
            v.push(path);
          }
        },
        remove: function(path) {
          var v = jsioPath.value, len = v.length;
          for (var i = 0; i < len; ++i) {
            if (v[i] == path) {
              v.splice(i, 1);
            }
          }
        },
        value: [],
        cache: {}
      };

    jsio.path = jsioPath;
    jsio.addPath = util.bind(jsioPath, 'add');
    jsio.addCmd = util.bind(jsio.__cmds, 'push');

    jsio.setEnv = function(envCtor) {
      if (!envCtor && cloneFrom) {
        ENV = new cloneFrom.__env.constructor(util);
      } else {
        if (typeof envCtor == 'string') {
          envCtor = ({
              node: ENV_node,
              browser: ENV_browser
            })[envCtor] || ENV_browser;
        }

        ENV = new envCtor(util);
      }

      this.__env = ENV;
      this.__dir = ENV.getCwd();

      if (!ENV.loadModule) {
        ENV.loadModule = loadModule;
      }

      jsio.path.cache['jsio'] = cloneFrom ? cloneFrom.path.cache.jsio : ENV.getPath();
      if (envCtor == ENV_browser) {
        jsio.path.set(ENV.getPath());
      }
    };

    if (cloneFrom) {
      jsio.setEnv();
    } else if (typeof JSIO_ENV_CTOR !== 'undefined') {
      jsio.setEnv(JSIO_ENV_CTOR);
    } else if (typeof process !== 'undefined' && process.version) {
      jsio.setEnv('node');
    } else if (typeof XMLHttpRequest != 'undefined' || typeof ActiveXObject != 'undefined') {
      jsio.setEnv('browser');
    }

    jsio.main = ENV && ENV.main;

    var boundJsio;
    var localJsio = function (req) {
      if (!boundJsio) {
        boundJsio = util.bind(this, _require, {}, ENV.getPath(), 'jsio.js');
      }

      return boundJsio(req, {dontExport: true, dontPreprocess: true});
    };

    /*
    function ENV_abstract() {
      this.global = null;
      this.getCwd = function() {};
      this.getPath = function() {};
      this.eval = function(code, path) {};
      this.fetch = function(path) { return contentsOfPath; };
      this.log = function(args...) {};
    }
    */

    function ENV_node() {
      var Module = module.constructor;

      var parent = module.parent;
      var req = util.bind(parent, parent && parent.require || require);

      var fs = req('fs');
      var path = req('path');
      var vm = req('vm');

      this.requireCache = require.cache;
      this.main = require.main;
      this.name = 'node';
      this.global = global;
      this.isWindowsNode = (process.platform === 'win32');

      var _cwd = process.cwd();
      this.setCwd = function (cwd) { _cwd = path.resolve(_cwd, cwd); };
      this.getCwd = function () { return _cwd; };

      this.pathSep = path.sep;

      // var parentPath = util.splitPath(module.parent.filename);
      // module.parent.require = function(request, opts) {
      //   if (!opts) { opts = {}; }
      //   opts.dontExport = true;
      //   return _require({}, parentPath.directory, parentPath.filename, request, opts);
      // };

      this.log = function() {
        var msg;
        try {
          msg = Array.prototype.map.call(arguments, function(a) {
              if ((a instanceof Error) && a.message) {
                return 'Error:' + a.message + '\nStack:' + a.stack + '\nArguments:' + a.arguments;
              }
              return (typeof a == 'string' ? a : JSON.stringify(a));
            }).join(' ') + '\n';
        } catch(e) {
          msg = Array.prototype.join.call(arguments, ' ') + '\n';
        }

        process.stderr.write(msg);
        return msg;
      };

      this.getPath = function() {
        return __dirname;
      };

      this.eval = function (code, path) {
        return vm.runInThisContext(code, path, true);
      };

      this.fetch = function (p) {
        p = util.resolve(this.getCwd(), p);

        var filename, lowercaseFilename, files;
        try {
          var dirname = path.dirname(p);
          filename = path.basename(p);
          lowercaseFilename = filename.toLowerCase();
          files = fs.readdirSync(dirname);
        } catch (e) {
          return false;
        }

        for (var i = 0, testName; testName = files[i]; ++i) {
          if (testName.toLowerCase() == lowercaseFilename && testName != filename) {
            throw "Invalid case when importing [" + p + "].  You probably meant" + testName;
          }
        }

        try {
          return fs.readFileSync(p, 'utf8');
        } catch(e) {
          return false;
        }
      };

      var stackRe = /\((?!module.js)(?:file:\/\/)?(.*?)(:\d+)(:\d+)\)/g;
      this.loadModule = function (baseLoader, fromDir, fromFile, item, opts) {
        if (fromFile == INITIAL_FILE && !opts.initialImport) {
          var stack = new Error().stack;
          var match;
          stackRe.lastIndex = 0;
          do {
            match = stackRe.exec(stack);
          } while (match && /jsio\.js$/.test(match[1]));

          if (match) {
            fromDir = path.dirname(match[1]);
            fromFile = path.basename(match[1]);
          }
        }

        try {
          return baseLoader(null, fromDir, fromFile, item, opts);
        } catch(e) {
          if (e.code == MODULE_NOT_FOUND) {
            var require = req;
            // lookup node module for relative imports
            var module;
            var filename = path.join(fromDir, fromFile);
            module = this.requireCache[filename];
            if (!module) {
              module = new Module(filename);
              module.filename = filename;
              module.paths = Module._nodeModulePaths(path.dirname(filename));
            }
            var request = item.original || item.from;
            try {
              return {
                exports: module ? module.require(request) : require(request),
                path: item.from
              };
            } catch (e2) {
              if (e2.code == MODULE_NOT_FOUND) {
                throw e;
              }

              throw e2;
            }
          } else {
            throw e;
          }
        }
      };
    }

    function ENV_browser() {
      var XHR = window.XMLHttpRequest || function() { return new ActiveXObject("Msxml2.XMLHTTP"); },
        cwd = null,
        path = null,
        JOIN = Array.prototype.join;

      this.name = 'browser';
      this.global = window;
      this.pathSep = "/";

      if (!this.global.jsio) { this.global.jsio = jsio; }

      if (window.console && console.log) {
        if (!console.log.apply || /Android|iPhone|iPad|iPod/.test(navigator.userAgent)) {
          this.log = function () {
            var args = JOIN.call(arguments, ' ');
            console.log(args);
            return args;
          };
        } else {
          this.log = function () {
            console.log.apply(console, arguments);
            return JOIN.call(arguments, ' ');
          };
        }
      } else {
        this.log = function () { return JOIN.call(arguments, ' '); };
      }

      this.getCwd = function() {
        if(!cwd) {
          var loc = window.location, path = loc.pathname;
          cwd = loc.protocol + '//' + loc.host + path.substring(0, path.lastIndexOf('/') + 1);
        }
        return cwd;
      };

      this.getPath = function() {
        if(!path) {
          try {
            var filename = new RegExp('(.*?)' + jsio.__filename + '(\\?.*)?$'),
              scripts = document.getElementsByTagName('script');

            for (var i = 0, script; script = scripts[i]; ++i) {
              var result = script.src.match(filename);
              if (result) {
                path = result[1];
                if (/^[A-Za-z]*:\/\//.test(path)) { path = util.relative(this.getCwd(), path); }
                break;
              }
            }
          } catch(e) {}

          if(!path) { path = '.'; }
        }
        return path;
      };

      var debugHost = location.protocol + '//' + location.host + '/';
      var debugPath = location.pathname;
      this.debugPath = function (path) {
        return util.buildPath(debugHost, path[0] != '/' && debugPath, path);
      };

      // IE6 won't return an anonymous function from eval, so use the function constructor instead
      var rawEval = typeof eval('(function(){})') == 'undefined'
        ? function(src, path) { return (new Function('return ' + src))(); }
        : function(src, path) { var src = src + '\n//@ sourceURL=' + path; return window.eval(src); };

      // provide an eval with reasonable debugging
      this.eval = function(code, path, origCode) {
        try {
          return rawEval(code, this.debugPath(path));
        } catch(e) {
          if(e instanceof SyntaxError) {
            if (DEBUG && this.checkSyntax) {
              this.checkSyntax(origCode, path);
            }
          }
          throw e;
        }
      };

      this.checkSyntax = function(code, path) {
        try {
          var syntax = jsio('import jsio.util.syntax', {suppressErrors: true, dontExport: true});
          syntax(code, path);
        } catch(e) {}
      };

      this.fetch = function(path) {
        var xhr = new XHR();
        try {
          xhr.open('GET', path, false);
          xhr.send(null);
        } catch(e) {
          ENV.log('e:', e);
          return false; // firefox file://
        }

        if (xhr.status == 404 || // all browsers, http://
          xhr.status == -1100 || // safari file://
          // XXX: We have no way to tell in opera if a file exists and is empty, or is 404
          // XXX: Use flash?
          //(!failed && xhr.status == 0 && !xhr.responseText && EXISTS)) // opera
          false)
        {
          return false;
        }

        return xhr.responseText;
      };
    };

    var failedFetch = {};

    function findModule(possibilities) {
      var src;
      for (var i = 0, possible; possible = possibilities[i]; ++i) {
        var path = possible.path,
          cachedVersion = srcCache[path];

        if (cachedVersion) {
          // extract a non-absolute dirname from the cache key: absolute paths
          // built into the cache are made relative during compile time since
          // absolute paths won't match between host and target device. Use
          // the cache key as the relative path so future imports can also
          // successfully lookup paths in the cache.
          var match = path.match(/^(.*\/)[^\\\/]+$/);
          possible.directory = match && match[1] || "";
          possible.src = cachedVersion.src;
          possible.pre = true;
          return possible;
        }

        /*if (/^\.\//.test(path)) {
          // remove one path segment for each dot from the cwd
          path = addEndSlash(ENV.getCwd()) + path;
        }*/

        src = ENV.fetch(path);

        if (src !== false) {
          possible.src = src;
          return possible;
        } else {
          failedFetch[path] = true;
        }
      }

      return false;
    }

    function processStack() {
      return importStack.map(function (item, index) {
        var stack = index == 0 ? new Error().stack : importStack[index - 1].stack;
        var i = stack.indexOf(item.path);
        if (i >= 0) {
          item.line = ':' + parseInt(stack.substring(i + item.path.length + 1));
        }

        return (index + 1) + ': "' + item.friendlyPath + '" ' + item.path + (item.line || '');
      });
    }

    // load a module from a file
    function loadModule (baseLoader, fromDir, fromFile, item, opts) {
      var modulePath = item.from;
      var possibilities = util.resolveModulePath(modulePath, fromDir);
      for (var i = 0, p; p = possibilities[i]; ++i) {
        var path = possibilities[i].path;
        if (!opts.reload && (path in jsio.__modules)) {
          return possibilities[i];
        }

        if (path in failedFetch) { possibilities.splice(i--, 1); }
      }

      if (!possibilities.length) {
        if (opts.suppressErrors) { return false; }
        var e = new Error('Could not import `' + item.from + '`'
            + "\tImport Stack:\n"
            + "\t\t" + processStack().join("\n\t\t"));
        e.jsioLogged = true;
        e.code = MODULE_NOT_FOUND;
        throw e;
      }

      var moduleDef = findModule(possibilities);
      if (!moduleDef) {
        if (opts.suppressErrors) { return false; }
        var paths = [];
        for (var i = 0, p; p = possibilities[i]; ++i) { paths.push(p.path); }
        var e = new Error("Could not import `" + modulePath + "`\n"
          + "\tlooked in:\n"
            + "\t\t" + paths.join('\n\t\t') + "\n"
            + "\tImport Stack:\n"
            + "\t\t" + processStack().join("\n\t\t"));
        e.code = MODULE_NOT_FOUND;
        throw e;
      }

      // a (potentially) nicer way to refer to a module -- how it was referenced in code when it was first imported
      moduleDef.friendlyPath = modulePath;

      // cache the base module's path in the path cache so we don't have to
      // try out all paths the next time we see the same base module.
      if (moduleDef.baseMod && !(moduleDef.baseMod in jsioPath.cache)) {
        jsioPath.cache[moduleDef.baseMod] = moduleDef.basePath;
      }

      // don't apply the standard preprocessors to base.js.  If we're reloading
      // the source code, always apply them.  We also don't want to run them
      // if they've been run once -- moduleDef.pre is set to true already
      // if we're reading the code from the source cache.
      if (modulePath != 'base' && (opts.reload || !opts.dontPreprocess && !moduleDef.pre)) {
        moduleDef.pre = true;

        applyPreprocessors(fromDir, moduleDef, ["import", "inlineSlice"], opts);
      }

      // any additional preprocessors?
      if (opts.preprocessors) {
        applyPreprocessors(fromDir, moduleDef, opts.preprocessors, opts);
      }

      return moduleDef;
    }

    function applyPreprocessors(path, moduleDef, names, opts) {
      for (var i = 0, len = names.length; i < len; ++i) {
        var p = getPreprocessor(names[i]);

        // if we have a recursive import and p isn't a function, just
        // skip it (handles the case where a preprocessor imports
        // other modules).
        if (p && typeof p == 'function') {
          p(path, moduleDef, opts);
        }
      }
    }

    function getPreprocessor(name) {
      var module = jsio.__modules['jsio.preprocessors.' + name];
      return typeof name == 'function'
        ? name
        : (module && module.exports
          || localJsio('import jsio.preprocessors.' + name));
    }

    function execModuleDef(context, moduleDef) {
      var src = moduleDef.src;
      delete moduleDef.src;

      var code = "(function(_){with(_){delete _;return function $$" + moduleDef.friendlyPath.replace(/[\:\\\/.-]/g, '_') + "(){" + src + "\n}}})";

      var exports = moduleDef.exports = context.exports;

      var fn = ENV.eval(code, moduleDef.path, src);
      fn = fn(context);

      fn.call(exports);

      if (exports != context.module.exports) {
        // Emulate node.js-style ability to reassign module.exports:
        //   module.exports = ...
        //
        // Note that in node.js and js.io, setting `module.exports` invalidates
        // the context's `exports` alias. See
        // http://nodejs.org/api/modules.html#modules_exports_alias for more
        moduleDef.exports = context.module.exports;
      } else {
        // js.io-style ability to override exports directly (`exports = `)
        moduleDef.exports = context.exports;
      }
    }

    function resolveImportRequest(context, request, opts) {
      var cmds = jsio.__cmds,
        imports = [],
        result = false;

      for (var i = 0, imp; imp = cmds[i]; ++i) {
        if ((result = imp(context, request, opts, imports))) { break; }
      }

      if (result !== true) {
        throw new (typeof SyntaxError != 'undefined' ? SyntaxError : Error)(String(result || 'invalid jsio command: jsio(\'' + request + '\')'));
      }

      return imports;
    }

    function makeContext(ctx, modulePath, moduleDef, dontAddBase) {
      if (!ctx) { ctx = {}; }
      if (!ctx.exports) { ctx.exports = {}; }

      ctx.jsio = util.bind(this, _require, ctx, moduleDef.directory, moduleDef.filename);
      ctx.require = function(request, opts) {
        if (!opts) { opts = {}; }
        opts.dontExport = true;
        return ctx.jsio(request, opts);
      };

      ctx.require.main = ENV.main;

      ctx.module = {id: modulePath, exports: ctx.exports};
      if (!dontAddBase && modulePath != 'jsio.base') {
        ctx.jsio('from jsio.base import *', {dontPreprocess: true});
        ctx.logging.__create(modulePath, ctx);
      }

      // TODO: FIX for "trailing ." case
      ctx.jsio.__jsio = jsio;
      ctx.jsio.__env = jsio.__env;
      ctx.jsio.__dir = moduleDef.directory;
      ctx.jsio.__filename = moduleDef.filename;
      ctx.jsio.path = jsioPath;

      ctx.__dirname = moduleDef.directory;
      ctx.__filename = util.buildPath(ctx.__dirname, moduleDef.filename);
      return ctx;
    }

    var importStack = [];
    function _require(boundContext, fromDir, fromFile, request, opts) {
      opts = opts || {};
      fromDir = fromDir || './';
      fromFile = fromFile || INITIAL_FILE;

      // require is bound to a module's (or global) context -- we can override this
      // by using opts.exportInto
      var exportInto = opts.exportInto || boundContext || ENV.global;

      // parse the import request(s)
      var imports = resolveImportRequest(exportInto, request, opts),
        numImports = imports.length,
        retVal = numImports > 1 ? {} : null;

      // import each requested item
      for (var i = 0; i < numImports; ++i) {
        var item = imports[i];
        var modulePath = item.from;
        var modules = jsio.__modules;
        var path;
        var moduleDef;
        var err;

        try {
          moduleDef = jsio.__env.loadModule(loadModule, fromDir, fromFile, item, opts);
        } catch(e) {
          err = e;
        }

        if (moduleDef) {
          path = moduleDef.path;
        } else if (moduleDef === false) {
          return false;
        }

        if (err) {
          if (opts.suppressErrors) { return false; }
          if (!err.jsioLogged) {
            ENV.log(
              '\nError loading module:\n',
              '    [[', request, ']]\n',
              '    requested by:', fromDir + fromFile, '\n',
              '    current directory:', jsio.__env.getCwd(), '\n',
              '  ' + err.stack.split('\n').join('\n  '));
            err.jsioLogged = true;
          }

          throw err;
        }

        if (moduleDef) {
          importStack.push({
            friendlyPath: moduleDef.friendlyPath,
            path: moduleDef.path,
            stack: new Error().stack
          });
        }

        // eval any packages that we don't know about already
        if (!(path in modules)) {
          modules[path] = moduleDef;
        }

        if (!moduleDef.exports) {
          var newContext = makeContext(opts.context, modulePath, moduleDef, item.dontAddBase);
          if (item.dontUseExports) {
            var src = [';(function(){'], k = 1;
            for (var j in item['import']) {
              newContext.exports[j] = undefined;
              src[k++] = 'if(typeof '+j+'!="undefined"&&exports.'+j+'==undefined)exports.'+j+'='+j+';';
            }
            src[k] = '})();';
            moduleDef.src += src.join('');
          }

          execModuleDef(newContext, moduleDef);
        }

        importStack.pop();

        var module = moduleDef.exports;

        // return the module if we're only importing one module
        if (numImports == 1) { retVal = module; }

        if (!opts.dontExport) {
          // add the module to the current context
          if (item.as) {
            // remove trailing/leading dots
            var as = item.as.match(/^\.*(.*?)\.*$/)[1],
              segments = as.split('.'),
              kMax = segments.length - 1,
              c = exportInto;

            // build the object in the context
            for(var k = 0; k < kMax; ++k) {
              var segment = segments[k];
              if (!segment) continue;
              if (!c[segment]) { c[segment] = {}; }
              c = c[segment];
            }

            c[segments[kMax]] = module;

            // there can be multiple module imports with this syntax (import foo, bar)
            if (numImports > 1) {
              retVal[as] = module;
            }
          } else if (item['import']) {
            // there can only be one module import with this syntax
            // (from foo import bar), so retVal will already be set here
            if (item['import']['*']) {
              for (var k in modules[path].exports) { exportInto[k] = module[k]; }
            } else {
              for (var k in item['import']) { exportInto[item['import'][k]] = module[k]; }
            }
          }
        }
      }

      return retVal;
    }

    // DEFINE SYNTAX FOR JSIO('cmd')

    // from myPackage import myFunc
    // external myPackage import myFunc
    jsio.addCmd(function(context, request, opts, imports) {
      var match = request.match(/^\s*(from|external)\s+([\w.\-$]+)\s+(import|grab)\s+(.*)$/);
      if(match) {
        imports.push({
          from: match[2],
          dontAddBase: match[1] == 'external',
          dontUseExports: match[3] == 'grab' || match[1] == 'external',
          'import': {}
        });

        match[4].replace(/\s*([\w.\-$*]+)(?:\s+as\s+([\w.\-$]+))?/g, function(_, item, as) {
          imports[0]['import'][item] = as || item;
        });
        return true;
      }
    });

    // import myPackage
    jsio.addCmd(function(context, request, opts, imports) {
      var match = request.match(/^\s*import\s+(.*)$/);
      if (match) {
        match[1].replace(/\s*([\w.\-$]+)(?:\s+as\s+([\w.\-$]+))?,?/g, function(_, fullPath, as) {
          imports.push(
            as ? {
              from: fullPath,
              as: as
            } : {
              from: fullPath,
              as: fullPath
            });
        });
        return true;
      }
    });

    // CommonJS syntax
    jsio.addCmd(function(context, request, opts, imports) {

      //    ./../b -> ..b
      //    ../../b -> ...b
      //    ../b -> ..b
      //    ./b -> .b

      var match = request.match(/^\s*[\w.0-9$\/\-:\\]+\s*$/);
      if (match) {

        var req = util.resolveRelativePath(match[0]),
          isRelative = req.charAt(0) == '.';

        req = req
          // .replace(/^\//, '') // remove any leading slash
          .replace(/\.\.\//g, '.') // replace relative path indicators with dots
          .replace(/\.\//g, '')
          .replace(/\/+$/g, '');

        if (ENV.pathSep === '\\' && req.match(/^[a-zA-Z]:.*/)) {
          // leave absolute windows paths (start with drive letter) alone
        } else {
          // any remaining slashes are path separators
         req = req.replace(/\//g, '.');
        }

        imports[0] = { from: (isRelative ? '.' : '') + req, original: request };
        return true;
      }
    });

    jsio.install = function() {
      jsio('from .base import *');
      GLOBAL['logger'] = logging.get('jsiocore');
    };

    jsio.eval = function (src, path) {
      path = ENV.getCwd() || '/';
      var moduleDef = new ModuleDef(path);
      moduleDef.src = src;
      applyPreprocessors(path, moduleDef, ["import", "cls"], {});
      execModuleDef(ENV.global, moduleDef);
    };

    jsio.clone = util.bind(null, init, jsio);

    // in node, defines jsio as a module that can be imported
    var moduleInfo = util.resolveModulePath('jsio')[0];
    if (moduleInfo) {
      jsio.__modules[moduleInfo.path] = new ModuleDef(moduleInfo.path);
      jsio.__modules[moduleInfo.path].exports = jsio;
    }

    return jsio;
  })();jsio.path.set(["modules/devkit-core/node_modules/jsio/packages","","lib","modules/devkit-core/src/clientapi/api","modules/devkit-core/modules/timestep/src"]);jsio.path.cache={"jsio":"modules/devkit-core/node_modules/jsio/packages","devkit-simulator-client":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/client","devkit-view-inspector":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-view-inspector/simulator","devkit":"modules/devkit-core/src/clientapi","squill":"modules/devkit-core/modules/squill","Promise":"modules/devkit-core/src/clientapi/api/Promise","lib":"modules/devkit-core/node_modules/jsio/packages/lib","device":"modules/devkit-core/modules/timestep/src/device","event":"modules/devkit-core/modules/timestep/src/event","util":"modules/devkit-core/node_modules/jsio/packages/util","ui":"modules/devkit-core/modules/timestep/src/ui","platforms":"modules/devkit-core/modules/timestep/src/platforms","math":"modules/devkit-core/node_modules/jsio/packages/math","AudioManager":"modules/devkit-core/modules/timestep/src/AudioManager","cache":"modules/devkit-core/modules/timestep/src/cache","timer":"modules/devkit-core/modules/timestep/src/timer","animate":"modules/devkit-core/modules/timestep/src/animate","std":"modules/devkit-core/node_modules/jsio/packages/std","src":"src","nextTick":"modules/devkit-core/src/clientapi/api/nextTick"};jsio.setCache({"modules/devkit-core/node_modules/jsio/packages/base.js":{"path":"modules/devkit-core/node_modules/jsio/packages/base.js","friendlyPath":"jsio.base","directory":"modules/devkit-core/node_modules/jsio/packages/","filename":"base.js","src":"/**\n * base.js\n * This file contains all global functions provided by js.io.\n */\n\nexports.log = jsio.__env.log;\nexports.GLOBAL = jsio.__env.global;\n\n/**\n * Various polyfill methods to ensure js.io implementations provide\n * a baseline of JavaScript functionality. Feature compatibility (localStorage,\n * etc.) should be provided elsewhere.\n */\n\n// Array.isArray\n// Not available before ECMAScript 5.\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/isArray\n\nif (!Array.isArray) {\n\tArray.isArray = function (arg) {\n\t\treturn Object.prototype.toString.call(arg) === '[object Array]';\n\t}\n};\n\n// Function.prototype.bind\n// Not available before ECMAScript 5.\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Function/bind\n\nif (!Function.prototype.bind) {\n  Function.prototype.bind = function (oThis) {\n    if (typeof this !== \"function\") {\n      // closest thing possible to the ECMAScript 5 internal IsCallable function\n      throw new TypeError(\"Function.prototype.bind - what is trying to be bound is not callable\");\n    }\n\n    var aArgs = Array.prototype.slice.call(arguments, 1),\n        fToBind = this,\n        fNOP = function () {},\n        fBound = function () {\n          return fToBind.apply(this instanceof fNOP\n                                 ? this\n                                 : oThis,\n                               aArgs.concat(Array.prototype.slice.call(arguments)));\n        };\n\n    fNOP.prototype = this.prototype;\n    fBound.prototype = new fNOP();\n\n    return fBound;\n  };\n}\n\n/**\n * DEPRECATED. Old js.io polyfills.\n */\n\nvar SLICE = Array.prototype.slice;\n\n/* Use native isArray if available\n */\nif (typeof Array.isArray === 'function') {\n\texports.isArray = Array.isArray;\n} else {\n\texports.isArray = function (obj) {\n\t\treturn Object.prototype.toString.call(obj) === '[object Array]';\n\t}\n}\n\nexports.bind = function(context, method /*, VARGS*/) {\n\tif(arguments.length > 2) {\n\t\tvar args = SLICE.call(arguments, 2);\n\t\treturn typeof method == 'string'\n\t\t\t? function __bound() {\n\t\t\t\tif (context[method]) {\n\t\t\t\t\treturn context[method].apply(context, args.concat(SLICE.call(arguments, 0)));\n\t\t\t\t} else {\n\t\t\t\t\tthrow logger.error('No method:', method, 'for context', context);\n\t\t\t\t}\n\t\t\t}\n\t\t\t: function __bound() { return method.apply(context, args.concat(SLICE.call(arguments, 0))); }\n\t} else {\n\t\treturn typeof method == 'string'\n\t\t\t? function __bound() {\n\t\t\t\tif (context[method]) {\n\t\t\t\t\treturn context[method].apply(context, arguments);\n\t\t\t\t} else {\n\t\t\t\t\tthrow logger.error('No method:', method, 'for context', context);\n\t\t\t\t}\n\t\t\t}\n\t\t\t: function __bound() { return method.apply(context, arguments); }\n\t}\n}\n\n/**\n * Class constructor.\n */\n\nexports.Class = function(name, parent, proto) {\n\treturn exports.__class__(function() { return this.init && this.init.apply(this, arguments); }, name, parent, proto);\n}\n\nexports.__class__ = function (cls, name, parent, proto) {\n\tvar clsProto = function () {};\n\tvar logger;\n\n\tif (typeof name != 'string') {\n\t\tproto = parent;\n\t\tparent = name;\n\t\tname = null;\n\t}\n\n\tif (name) {\n\t\tlogger = exports.logging.get(name);\n\t}\n\n\tif (!parent) { throw new Error('parent or prototype not provided'); }\n\tif (!proto) { proto = parent; parent = null; }\n\n\tif (parent) {\n\t\tif (exports.isArray(parent)) { // multiple inheritance, use at your own risk =)\n\t\t\tclsProto.prototype = {};\n\t\t\tfor(var i = 0, p; p = parent[i]; ++i) {\n\t\t\t\tif (p == Error && ErrorParentClass) { p = ErrorParentClass; }\n\t\t\t\tfor (var item in p.prototype) {\n\t\t\t\t\tif (!(item in clsProto.prototype)) {\n\t\t\t\t\t\tclsProto.prototype[item] = p.prototype[item];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tparent = parent[0];\n\t\t} else {\n\t\t\tif (parent == Error && ErrorParentClass) { parent = ErrorParentClass; }\n\t\t\tclsProto.prototype = parent.prototype;\n\t\t}\n\t}\n\n\tvar supr = parent ? function(context, method, args) {\n\t\t\tvar f = parent.prototype[method];\n\t\t\tif (!f) { throw new Error('method ' + method + ' does not exist'); }\n\t\t\treturn f.apply(context, args || []);\n\t\t} : null;\n\n\tvar p = cls.prototype = new clsProto();\n\tp.constructor = cls;\n\tp.__parentClass__ = parent;\n\tif (name) { p.__class__ = name; }\n\tproto.call(p, logger || supr, logger && supr);\n\treturn cls;\n}\n\nvar ErrorParentClass = exports.__class__(function ErrorCls() {\n\t\tvar err = Error.prototype.constructor.apply(this, arguments);\n\t\tfor (var prop in err) {\n\t\t\tif (err.hasOwnProperty(prop)) {\n\t\t\t\tthis[prop] = err[prop];\n\t\t\t}\n\t\t}\n\t}, function() {});\n\n/**\n * Merge two objects together.\n */\n\nexports.Class.defaults =\nexports.merge = function(base, extra) {\n\tbase = base || {};\n\n\tfor (var i = 1, len = arguments.length; i < len; ++i) {\n\t\tvar copyFrom = arguments[i];\n\t\tfor (var key in copyFrom) {\n\t\t\tif (copyFrom.hasOwnProperty(key) && !base.hasOwnProperty(key)) {\n\t\t\t\tbase[key] = copyFrom[key];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn base;\n}\n\n/**\n * Create a timer delay.\n */\n\nexports.delay = function(orig, timeout) {\n\tvar _timer = null;\n\tvar ctx, args;\n\tvar f = function() { orig.apply(ctx, args); }\n\treturn function() {\n\t\tctx = this;\n\t\targs = arguments;\n\t\tif (_timer) { clearTimeout(_timer); }\n\t\t_timer = setTimeout(f, timeout || 0);\n\t}\n}\n\n/**\n * Log constructor and default \"logger\".\n */\n\nexports.logging = (function() {\n\n\t// logging namespace, this is what is exported\n\tvar logging = {\n\t\t\tDEBUG: 1,\n\t\t\tLOG: 2,\n\t\t\tINFO: 3,\n\t\t\tWARN: 4,\n\t\t\tERROR: 5,\n\t\t\tNONE: 10\n\t\t};\n\n\tvar _loggers = {}; // all loggers\n\tvar _production = false;\n\tvar _prefix = '';\n\n\tlogging.setPrefix = function(prefix) { _prefix = prefix + ' '; }\n\n\tlogging.setProduction = function(prod) {\n\t\t_production = !!prod;\n\t\tfor (var key in _loggers) {\n\t\t\t_loggers[key].setProduction(_production);\n\t\t}\n\t}\n\n\tlogging.get = function(name) {\n\t\tvar logger = name in _loggers ? _loggers[name] :\n\t\t\t(_loggers[name] = new Logger(name));\n\t\tlogger.setProduction(_production);\n\t\treturn logger;\n\t}\n\n\tlogging.set = function(name, logger) {\n\t\t_loggers[name] = logger;\n\t}\n\n\tlogging.getAll = function() { return _loggers; }\n\n\tlogging.__create = function(pkg, ctx) { ctx.logger = logging.get(pkg); }\n\n\tvar Logger = exports.__class__(\n\t\tfunction Logger(name, level) {\n\t\t\tthis._name = name;\n\t\t\tthis._isProduction = _production;\n\n\t\t\tthis.setLevel(level || logging.LOG);\n\t\t},\n\t\tfunction () {\n\t\t\tthis.setProduction = function (isProduction) {\n\t\t\t\tthis._isProduction = isProduction;\n\t\t\t\tisProduction && this.setLevel(logging.NONE);\n\t\t\t}\n\n\t\t\tthis.setLevel = function(level) {\n\t\t\t\tthis._level = level;\n\n\t\t\t\tif (this._isProduction) {\n\t\t\t\t\tlevel = logging.NONE;\n\t\t\t\t}\n\n\t\t\t\tthis.DEBUG = level <= logging.DEBUG;\n\t\t\t\tthis.LOG   = level <= logging.LOG;\n\t\t\t\tthis.INFO  = level <= logging.INFO;\n\t\t\t\tthis.WARN  = level <= logging.WARN;\n\t\t\t\tthis.ERROR = level <= logging.ERROR;\n\t\t\t}\n\n\t\t\tfunction makeLogger(type) {\n\t\t\t\tvar level = logging[type];\n\t\t\t\treturn function() {\n\t\t\t\t\tif (!this._isProduction && level >= this._level) {\n\t\t\t\t\t\tvar prefix = type + ' ' + _prefix + this._name;\n\t\t\t\t\t\tvar listener = this._listener || exports.log;\n\n\t\t\t\t\t\treturn listener && listener.apply(this._listener, [prefix].concat(SLICE.call(arguments)));\n\t\t\t\t\t}\n\t\t\t\t\treturn arguments[0];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setListener = function(listener) { this._listener = listener; }\n\n\t\t\tthis.debug = makeLogger(\"DEBUG\");\n\t\t\tthis.log = makeLogger(\"LOG\");\n\t\t\tthis.info = makeLogger(\"INFO\");\n\t\t\tthis.warn = makeLogger(\"WARN\");\n\t\t\tthis.error = makeLogger(\"ERROR\");\n\t\t});\n\n\treturn logging;\n})();\n\nvar logger = exports.logging.get('jsiocore');\n\n","pre":true},"modules/devkit-core/src/clientapi/browser/launchClient.js":{"path":"modules/devkit-core/src/clientapi/browser/launchClient.js","friendlyPath":"devkit.browser.launchClient","directory":"modules/devkit-core/src/clientapi/browser/","filename":"launchClient.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/* globals jsio, CONFIG, DEBUG */\n\n// no dynamic source fetching\njsio.__env.fetch = function (filename) { return false; };\n\njsio('import Promise');\nGLOBAL.Promise = Promise;\n\nvar isSimulator = GLOBAL.CONFIG && !!CONFIG.simulator;\nvar isNative = /^native/.test(CONFIG.target);\n\nif (isSimulator) {\n  // prefix filenames in the debugger\n  jsio.__env.debugPath = function (path) { return 'http://' + (CONFIG.bundleID || CONFIG.packageName) + '/' + path.replace(/^[\\.\\/]+/, ''); };\n\n  if (isNative) {\n    jsio('import ..debugging.nativeShim');\n  }\n}\n\n// shims\n\nif (!window.JSON) {\n  jsio('import std.JSON').createGlobal();\n}\n\nif (!window.console) {\n  window.console = {};\n  window.console.log = window.console.info = window.console.error = window.console.warn = function () {};\n}\n\nif (typeof localStorage !== 'undefined') {\n  /* jshint -W020 */\n  localStorage = {\n    getItem: function () {},\n    setItem: function () {},\n    removeItem: function () {}\n  };\n  /* jshint +W020 */\n}\n\nif (!isSimulator) {\n  // start the cache service-worker\n  jsio('import .cache');\n}\n\nvar splash = document.getElementById('_GCSplash');\nif (splash) {\n  if (!CONFIG.splash.hide) {\n    CONFIG.splash.hide = function () {\n        // timeout lengths are debateable. Perhaps they could\n        // be configurable. On one hand these time out lengths increase\n        // the length of time that nothing is happening. However, it also\n        // makes the transition into the game much smoother. The initial timeout\n        // is for images to pop in.\n        setTimeout(function() {\n          splash.style.opacity = 0;\n          splash.style.pointerEvents = 'none';\n          setTimeout(function() {\n            splash.parentNode.removeChild(splash);\n          }, 500);\n        }, 100);\n      };\n  }\n}\n\n// parsing options\njsio('import std.uri');\nvar uri = new std.uri(window.location);\nvar mute = uri.hash('mute');\nCONFIG.isMuted = mute !== undefined && mute !== 'false' && mute !== '0' && mute !== 'no';\n\nvar simulatorModules;\nif (DEBUG && isSimulator && Array.isArray(CONFIG.simulator.modules)) {\n  simulatorModules = [];\n\n  // client API inside simulator: call onLaunch() on each simulator module,\n  // optionally block on a returned promise for up to 5 seconds\n  Promise\n    .map(CONFIG.simulator.modules, function (name) {\n      try {\n        var module = jsio(name);\n        if (module) {\n          simulatorModules.push(module);\n          if (typeof module.onLaunch == 'function') {\n            return module.onLaunch();\n          }\n        }\n      } catch (e) {\n        console.warn(e);\n      }\n    })\n    .timeout(5000)\n    .finally(queueStart);\n} else {\n  queueStart();\n}\n\nfunction queueStart() {\n  /* jshint -W117 */\n  if (window.GC_LIVE_EDIT && GC_LIVE_EDIT._isLiveEdit) {\n    var intervalId = setInterval(function(){\n      if (GC_LIVE_EDIT._liveEditReady) {\n        try {\n          startApp();\n        } catch(err) {\n          // In case loading fails, we will still clear the interval\n          console.error('Error while starting app', err);\n        }\n        clearInterval(intervalId);\n      }\n    }, 100);\n  } else {\n    startApp();\n  }\n  /* jshint +W117 */\n}\n\nfunction startApp () {\n\n  // setup timestep device API\n  jsio('import device');\n  jsio('import platforms.browser.initialize');\n  device.init();\n\n  // init sets up the GC object\n  jsio('import devkit');\n\n  GLOBAL.GC = new devkit.ClientAPI();\n  if (simulatorModules) {\n    GLOBAL.GC.on('app', function (app) {\n      // client API inside simulator: call init() on each simulator module,\n      // optionally block on a returned promise for up to 5 seconds\n      simulatorModules.forEach(function (module) {\n        if (typeof module.onApp == 'function') {\n          module.onApp(app);\n        }\n      });\n    });\n  }\n\n  GLOBAL.GC.buildApp('launchUI');\n}\n","pre":true},"modules/devkit-core/src/clientapi/api/Promise.js":{"path":"modules/devkit-core/src/clientapi/api/Promise.js","friendlyPath":"Promise","directory":"modules/devkit-core/src/clientapi/api/","filename":"Promise.js","baseMod":"Promise","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/src/clientapi/api/Promise","src":"/* @preserve\n * The MIT License (MIT)\n *\n * Copyright (c) 2014 Petka Antonov\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:</p>\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n/**\n * bluebird build version 2.9.6\n * Features enabled: core, map, nodeify, promisify, reduce, progress, cancel, filter, each, timers\n * Features disabled: race, call_get, generators, props, settle, some, using, any\n*/\n!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var f;\"undefined\"!=typeof window?f=window:\"undefined\"!=typeof global?f=global:\"undefined\"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof _dereq_==\"function\"&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof _dereq_==\"function\"&&_dereq_;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n\"use strict\";\nvar firstLineError;\ntry {throw new Error(); } catch (e) {firstLineError = e;}\nvar schedule = _dereq_(\"./schedule.js\");\nvar Queue = _dereq_(\"./queue.js\");\nvar _process = typeof process !== \"undefined\" ? process : undefined;\n\nfunction Async() {\n    this._isTickUsed = false;\n    this._lateQueue = new Queue(16);\n    this._normalQueue = new Queue(16);\n    var self = this;\n    this.drainQueues = function () {\n        self._drainQueues();\n    };\n    this._schedule =\n        schedule.isStatic ? schedule(this.drainQueues) : schedule;\n}\n\nAsync.prototype.haveItemsQueued = function () {\n    return this._normalQueue.length() > 0;\n};\n\nAsync.prototype._withDomain = function(fn) {\n    if (_process !== undefined &&\n        _process.domain != null &&\n        !fn.domain) {\n        fn = _process.domain.bind(fn);\n    }\n    return fn;\n};\n\nAsync.prototype.throwLater = function(fn, arg) {\n    if (arguments.length === 1) {\n        arg = fn;\n        fn = function () { throw arg; };\n    }\n    fn = this._withDomain(fn);\n    if (typeof setTimeout !== \"undefined\") {\n        setTimeout(function() {\n            fn(arg);\n        }, 0);\n    } else try {\n        this._schedule(function() {\n            fn(arg);\n        });\n    } catch (e) {\n        throw new Error(\"No async scheduler available\\u000a\\u000a    See http://goo.gl/m3OTXk\\u000a\");\n    }\n};\n\nAsync.prototype.invokeLater = function (fn, receiver, arg) {\n    fn = this._withDomain(fn);\n    this._lateQueue.push(fn, receiver, arg);\n    this._queueTick();\n};\n\nAsync.prototype.invokeFirst = function (fn, receiver, arg) {\n    fn = this._withDomain(fn);\n    this._normalQueue.unshift(fn, receiver, arg);\n    this._queueTick();\n};\n\nAsync.prototype.invoke = function (fn, receiver, arg) {\n    fn = this._withDomain(fn);\n    this._normalQueue.push(fn, receiver, arg);\n    this._queueTick();\n};\n\nAsync.prototype.settlePromises = function(promise) {\n    this._normalQueue._pushOne(promise);\n    this._queueTick();\n};\n\nAsync.prototype._drainQueue = function(queue) {\n    while (queue.length() > 0) {\n        var fn = queue.shift();\n        if (typeof fn !== \"function\") {\n            fn._settlePromises();\n            continue;\n        }\n        var receiver = queue.shift();\n        var arg = queue.shift();\n        fn.call(receiver, arg);\n    }\n};\n\nAsync.prototype._drainQueues = function () {\n    this._drainQueue(this._normalQueue);\n    this._reset();\n    this._drainQueue(this._lateQueue);\n};\n\nAsync.prototype._queueTick = function () {\n    if (!this._isTickUsed) {\n        this._isTickUsed = true;\n        this._schedule(this.drainQueues);\n    }\n};\n\nAsync.prototype._reset = function () {\n    this._isTickUsed = false;\n};\n\nmodule.exports = new Async();\nmodule.exports.firstLineError = firstLineError;\n\n},{\"./queue.js\":24,\"./schedule.js\":26}],2:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise) {\nfunction returnThis() { return this.value; }\nfunction throwThis() { throw this.reason; }\nfunction awaitBindingThenResolve(value) {\n    return this._then(returnThis, null, null, {value: value}, undefined);\n}\nfunction awaitBindingThenReject(reason) {\n    return this._then(throwThis, throwThis, null, {reason: reason}, undefined);\n}\nfunction setBinding(binding) { this._setBoundTo(binding); }\nPromise.prototype.bind = function (thisArg) {\n    var maybePromise = tryConvertToPromise(thisArg);\n    if (maybePromise instanceof Promise) {\n        if (maybePromise.isFulfilled()) {\n            thisArg = maybePromise.value();\n        } else if (maybePromise.isRejected()) {\n            return Promise.reject(maybePromise.reason());\n        } else {\n            var ret = this.then();\n            var parent = ret;\n            ret = ret._then(awaitBindingThenResolve,\n                            awaitBindingThenReject,\n                            null, maybePromise, undefined);\n            maybePromise._then(setBinding, ret._reject, null, ret, null);\n            if (!ret._cancellable()) ret._setPendingCancellationParent(parent);\n            return ret;\n        }\n    }\n    var ret = this.then();\n    ret._setBoundTo(thisArg);\n    return ret;\n};\n\nPromise.bind = function (thisArg, value) {\n    return Promise.resolve(value).bind(thisArg);\n};\n\nPromise.prototype._setPendingCancellationParent = function(parent) {\n    this._settledValue = parent;\n};\n\nPromise.prototype._pendingCancellationParent = function() {\n    if (this.isPending() && this._settledValue !== undefined) {\n        var ret = this._settledValue;\n        ret.cancellable();\n        this._settledValue = undefined;\n        return ret;\n    }\n};\n\nPromise.prototype._setIsMigratingBinding = function () {\n    this._bitField = this._bitField | 8388608;\n};\n\nPromise.prototype._unsetIsMigratingBinding = function () {\n    this._bitField = this._bitField & (~8388608);\n};\n\nPromise.prototype._isMigratingBinding = function () {\n    return (this._bitField & 8388608) === 8388608;\n};\n\nPromise.prototype._setBoundTo = function (obj) {\n    this._boundTo = obj;\n};\n\nPromise.prototype._isBound = function () {\n    return this._boundTo !== undefined;\n};\n};\n\n},{}],3:[function(_dereq_,module,exports){\n\"use strict\";\nvar old;\nif (typeof Promise !== \"undefined\") old = Promise;\nfunction noConflict() {\n    try { if (Promise === bluebird) Promise = old; }\n    catch (e) {}\n    return bluebird;\n}\nvar bluebird = _dereq_(\"./promise.js\")();\nbluebird.noConflict = noConflict;\nmodule.exports = bluebird;\n\n},{\"./promise.js\":20}],4:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar errors = _dereq_(\"./errors.js\");\nvar async = _dereq_(\"./async.js\");\nvar CancellationError = errors.CancellationError;\n\nPromise.prototype._cancel = function (reason) {\n    if (!this.isCancellable()) return this;\n    var parent;\n    var promiseToReject = this;\n    while ((parent = promiseToReject._cancellationParent) !== undefined &&\n        parent.isCancellable()) {\n        promiseToReject = parent;\n    }\n    this._unsetCancellable();\n    promiseToReject._target()._rejectCallback(reason, false, true);\n};\n\nPromise.prototype.cancel = function (reason) {\n    if (!this.isCancellable()) return this;\n    if (reason === undefined) reason = new CancellationError();\n    async.invokeLater(this._cancel, this, reason);\n    return this;\n};\n\nPromise.prototype.cancellable = function () {\n    if (this._cancellable()) return this;\n    this._setCancellable();\n    this._cancellationParent = this._pendingCancellationParent();\n    return this;\n};\n\nPromise.prototype.uncancellable = function () {\n    var ret = this.then();\n    ret._unsetCancellable();\n    return ret;\n};\n\nPromise.prototype.fork = function (didFulfill, didReject, didProgress) {\n    var ret = this._then(didFulfill, didReject, didProgress,\n                         undefined, undefined);\n\n    ret._setCancellable();\n    ret._cancellationParent = undefined;\n    return ret;\n};\n};\n\n},{\"./async.js\":1,\"./errors.js\":11}],5:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function() {\nvar async = _dereq_(\"./async.js\");\nvar util = _dereq_(\"./util.js\");\nvar bluebirdFramePattern =\n    /[\\\\\\/]bluebird[\\\\\\/]js[\\\\\\/](main|debug|zalgo|instrumented)/;\nvar stackFramePattern = null;\nvar formatStack = null;\nvar indentStackFrames = false;\n\nfunction CapturedTrace(parent) {\n    this._parent = parent;\n    var length = this._length = 1 + (parent === undefined ? 0 : parent._length);\n    captureStackTrace(this, CapturedTrace);\n    if (length > 32) this.uncycle();\n}\nutil.inherits(CapturedTrace, Error);\n\nCapturedTrace.prototype.uncycle = function() {\n    var length = this._length;\n    if (length < 2) return;\n    var nodes = [];\n    var stackToIndex = {};\n\n    for (var i = 0, node = this; node !== undefined; ++i) {\n        nodes.push(node);\n        node = node._parent;\n    }\n    length = this._length = i;\n    for (var i = length - 1; i >= 0; --i) {\n        var stack = nodes[i].stack;\n        if (stackToIndex[stack] === undefined) {\n            stackToIndex[stack] = i;\n        }\n    }\n    for (var i = 0; i < length; ++i) {\n        var currentStack = nodes[i].stack;\n        var index = stackToIndex[currentStack];\n        if (index !== undefined && index !== i) {\n            if (index > 0) {\n                nodes[index - 1]._parent = undefined;\n                nodes[index - 1]._length = 1;\n            }\n            nodes[i]._parent = undefined;\n            nodes[i]._length = 1;\n            var cycleEdgeNode = i > 0 ? nodes[i - 1] : this;\n\n            if (index < length - 1) {\n                cycleEdgeNode._parent = nodes[index + 1];\n                cycleEdgeNode._parent.uncycle();\n                cycleEdgeNode._length =\n                    cycleEdgeNode._parent._length + 1;\n            } else {\n                cycleEdgeNode._parent = undefined;\n                cycleEdgeNode._length = 1;\n            }\n            var currentChildLength = cycleEdgeNode._length + 1;\n            for (var j = i - 2; j >= 0; --j) {\n                nodes[j]._length = currentChildLength;\n                currentChildLength++;\n            }\n            return;\n        }\n    }\n};\n\nCapturedTrace.prototype.parent = function() {\n    return this._parent;\n};\n\nCapturedTrace.prototype.hasParent = function() {\n    return this._parent !== undefined;\n};\n\nCapturedTrace.prototype.attachExtraTrace = function(error) {\n    if (error.__stackCleaned__) return;\n    this.uncycle();\n    var parsed = CapturedTrace.parseStackAndMessage(error);\n    var message = parsed.message;\n    var stacks = [parsed.stack];\n\n    var trace = this;\n    while (trace !== undefined) {\n        stacks.push(cleanStack(trace.stack.split(\"\\n\")));\n        trace = trace._parent;\n    }\n    removeCommonRoots(stacks);\n    removeDuplicateOrEmptyJumps(stacks);\n    error.stack = reconstructStack(message, stacks);\n    error.__stackCleaned__ = true;\n};\n\nfunction reconstructStack(message, stacks) {\n    for (var i = 0; i < stacks.length - 1; ++i) {\n        stacks[i].push(\"From previous event:\");\n        stacks[i] = stacks[i].join(\"\\n\");\n    }\n    if (i < stacks.length) {\n        stacks[i] = stacks[i].join(\"\\n\");\n    }\n    return message + \"\\n\" + stacks.join(\"\\n\");\n}\n\nfunction removeDuplicateOrEmptyJumps(stacks) {\n    for (var i = 0; i < stacks.length; ++i) {\n        if (stacks[i].length === 0 ||\n            ((i + 1 < stacks.length) && stacks[i][0] === stacks[i+1][0])) {\n            stacks.splice(i, 1);\n            i--;\n        }\n    }\n}\n\nfunction removeCommonRoots(stacks) {\n    var current = stacks[0];\n    for (var i = 1; i < stacks.length; ++i) {\n        var prev = stacks[i];\n        var currentLastIndex = current.length - 1;\n        var currentLastLine = current[currentLastIndex];\n        var commonRootMeetPoint = -1;\n\n        for (var j = prev.length - 1; j >= 0; --j) {\n            if (prev[j] === currentLastLine) {\n                commonRootMeetPoint = j;\n                break;\n            }\n        }\n\n        for (var j = commonRootMeetPoint; j >= 0; --j) {\n            var line = prev[j];\n            if (current[currentLastIndex] === line) {\n                current.pop();\n                currentLastIndex--;\n            } else {\n                break;\n            }\n        }\n        current = prev;\n    }\n}\n\nfunction cleanStack(stack) {\n    var ret = [];\n    for (var i = 0; i < stack.length; ++i) {\n        var line = stack[i];\n        var isTraceLine = stackFramePattern.test(line) ||\n            \"    (No stack trace)\" === line;\n        var isInternalFrame = isTraceLine && shouldIgnore(line);\n        if (isTraceLine && !isInternalFrame) {\n            if (indentStackFrames && line.charAt(0) !== \" \") {\n                line = \"    \" + line;\n            }\n            ret.push(line);\n        }\n    }\n    return ret;\n}\n\nfunction stackFramesAsArray(error) {\n    var stack = error.stack.replace(/\\s+$/g, \"\").split(\"\\n\");\n    for (var i = 0; i < stack.length; ++i) {\n        var line = stack[i];\n        if (\"    (No stack trace)\" === line || stackFramePattern.test(line)) {\n            break;\n        }\n    }\n    if (i > 0) {\n        stack = stack.slice(i);\n    }\n    return stack;\n}\n\nCapturedTrace.parseStackAndMessage = function(error) {\n    var stack = error.stack;\n    var message = error.toString();\n    stack = typeof stack === \"string\" && stack.length > 0\n                ? stackFramesAsArray(error) : [\"    (No stack trace)\"];\n    return {\n        message: message,\n        stack: cleanStack(stack)\n    };\n};\n\nCapturedTrace.formatAndLogError = function(error, title) {\n    if (typeof console === \"object\") {\n        var message;\n        if (typeof error === \"object\" || typeof error === \"function\") {\n            var stack = error.stack;\n            message = title + formatStack(stack, error);\n        } else {\n            message = title + String(error);\n        }\n        if (typeof console.warn === \"function\" ||\n            typeof console.warn === \"object\") {\n            console.warn(message);\n        } else if (typeof console.log === \"function\" ||\n            typeof console.log === \"object\") {\n            console.log(message);\n        }\n    }\n};\n\nCapturedTrace.unhandledRejection = function (reason) {\n    CapturedTrace.formatAndLogError(reason, \"^--- With additional stack trace: \");\n};\n\nCapturedTrace.isSupported = function () {\n    return typeof captureStackTrace === \"function\";\n};\n\nCapturedTrace.fireRejectionEvent =\nfunction(name, localHandler, reason, promise) {\n    var localEventFired = false;\n    try {\n        if (typeof localHandler === \"function\") {\n            localEventFired = true;\n            if (name === \"rejectionHandled\") {\n                localHandler(promise);\n            } else {\n                localHandler(reason, promise);\n            }\n        }\n    } catch (e) {\n        async.throwLater(e);\n    }\n\n    var globalEventFired = false;\n    try {\n        globalEventFired = fireGlobalEvent(name, reason, promise);\n    } catch (e) {\n        globalEventFired = true;\n        async.throwLater(e);\n    }\n\n    var domEventFired = false;\n    if (fireDomEvent) {\n        try {\n            domEventFired = fireDomEvent(name.toLowerCase(), {\n                reason: reason,\n                promise: promise\n            });\n        } catch (e) {\n            domEventFired = true;\n            async.throwLater(e);\n        }\n    }\n\n    if (!globalEventFired && !localEventFired && !domEventFired &&\n        name === \"unhandledRejection\") {\n        CapturedTrace.formatAndLogError(reason, \"Possibly unhandled \");\n    }\n};\n\nfunction formatNonError(obj) {\n    var str;\n    if (typeof obj === \"function\") {\n        str = \"[function \" +\n            (obj.name || \"anonymous\") +\n            \"]\";\n    } else {\n        str = obj.toString();\n        var ruselessToString = /\\[object [a-zA-Z0-9$_]+\\]/;\n        if (ruselessToString.test(str)) {\n            try {\n                var newStr = JSON.stringify(obj);\n                str = newStr;\n            }\n            catch(e) {\n\n            }\n        }\n        if (str.length === 0) {\n            str = \"(empty array)\";\n        }\n    }\n    return (\"(<\" + snip(str) + \">, no stack trace)\");\n}\n\nfunction snip(str) {\n    var maxChars = 41;\n    if (str.length < maxChars) {\n        return str;\n    }\n    return str.substr(0, maxChars - 3) + \"...\";\n}\n\nvar shouldIgnore = function() { return false; };\nvar parseLineInfoRegex = /[\\/<\\(]([^:\\/]+):(\\d+):(?:\\d+)\\)?\\s*$/;\nfunction parseLineInfo(line) {\n    var matches = line.match(parseLineInfoRegex);\n    if (matches) {\n        return {\n            fileName: matches[1],\n            line: parseInt(matches[2], 10)\n        };\n    }\n}\nCapturedTrace.setBounds = function(firstLineError, lastLineError) {\n    if (!CapturedTrace.isSupported()) return;\n    var firstStackLines = firstLineError.stack.split(\"\\n\");\n    var lastStackLines = lastLineError.stack.split(\"\\n\");\n    var firstIndex = -1;\n    var lastIndex = -1;\n    var firstFileName;\n    var lastFileName;\n    for (var i = 0; i < firstStackLines.length; ++i) {\n        var result = parseLineInfo(firstStackLines[i]);\n        if (result) {\n            firstFileName = result.fileName;\n            firstIndex = result.line;\n            break;\n        }\n    }\n    for (var i = 0; i < lastStackLines.length; ++i) {\n        var result = parseLineInfo(lastStackLines[i]);\n        if (result) {\n            lastFileName = result.fileName;\n            lastIndex = result.line;\n            break;\n        }\n    }\n    if (firstIndex < 0 || lastIndex < 0 || !firstFileName || !lastFileName ||\n        firstFileName !== lastFileName || firstIndex >= lastIndex) {\n        return;\n    }\n\n    shouldIgnore = function(line) {\n        if (bluebirdFramePattern.test(line)) return true;\n        var info = parseLineInfo(line);\n        if (info) {\n            if (info.fileName === firstFileName &&\n                (firstIndex <= info.line && info.line <= lastIndex)) {\n                return true;\n            }\n        }\n        return false;\n    };\n};\n\nvar captureStackTrace = (function stackDetection() {\n    var v8stackFramePattern = /^\\s*at\\s*/;\n    var v8stackFormatter = function(stack, error) {\n        if (typeof stack === \"string\") return stack;\n\n        if (error.name !== undefined &&\n            error.message !== undefined) {\n            return error.toString();\n        }\n        return formatNonError(error);\n    };\n\n    if (typeof Error.stackTraceLimit === \"number\" &&\n        typeof Error.captureStackTrace === \"function\") {\n        Error.stackTraceLimit = Error.stackTraceLimit + 6;\n        stackFramePattern = v8stackFramePattern;\n        formatStack = v8stackFormatter;\n        var captureStackTrace = Error.captureStackTrace;\n\n        shouldIgnore = function(line) {\n            return bluebirdFramePattern.test(line);\n        };\n        return function(receiver, ignoreUntil) {\n            Error.stackTraceLimit = Error.stackTraceLimit + 6;\n            captureStackTrace(receiver, ignoreUntil);\n            Error.stackTraceLimit = Error.stackTraceLimit - 6;\n        };\n    }\n    var err = new Error();\n\n    if (typeof err.stack === \"string\" &&\n        err.stack.split(\"\\n\")[0].indexOf(\"stackDetection@\") >= 0) {\n        stackFramePattern = /@/;\n        formatStack = v8stackFormatter;\n        indentStackFrames = true;\n        return function captureStackTrace(o) {\n            o.stack = new Error().stack;\n        };\n    }\n\n    var hasStackAfterThrow;\n    try { throw new Error(); }\n    catch(e) {\n        hasStackAfterThrow = (\"stack\" in e);\n    }\n    if (!(\"stack\" in err) && hasStackAfterThrow) {\n        stackFramePattern = v8stackFramePattern;\n        formatStack = v8stackFormatter;\n        return function captureStackTrace(o) {\n            Error.stackTraceLimit = Error.stackTraceLimit + 6;\n            try { throw new Error(); }\n            catch(e) { o.stack = e.stack; }\n            Error.stackTraceLimit = Error.stackTraceLimit - 6;\n        };\n    }\n\n    formatStack = function(stack, error) {\n        if (typeof stack === \"string\") return stack;\n\n        if ((typeof error === \"object\" ||\n            typeof error === \"function\") &&\n            error.name !== undefined &&\n            error.message !== undefined) {\n            return error.toString();\n        }\n        return formatNonError(error);\n    };\n\n    return null;\n\n})([]);\n\nvar fireDomEvent;\nvar fireGlobalEvent = (function() {\n    if (util.isNode) {\n        return function(name, reason, promise) {\n            if (name === \"rejectionHandled\") {\n                return process.emit(name, promise);\n            } else {\n                return process.emit(name, reason, promise);\n            }\n        };\n    } else {\n        var customEventWorks = false;\n        var anyEventWorks = true;\n        try {\n            var ev = new self.CustomEvent(\"test\");\n            customEventWorks = ev instanceof CustomEvent;\n        } catch (e) {}\n        if (!customEventWorks) {\n            try {\n                var event = document.createEvent(\"CustomEvent\");\n                event.initCustomEvent(\"testingtheevent\", false, true, {});\n                self.dispatchEvent(event);\n            } catch (e) {\n                anyEventWorks = false;\n            }\n        }\n        if (anyEventWorks) {\n            fireDomEvent = function(type, detail) {\n                var event;\n                if (customEventWorks) {\n                    event = new self.CustomEvent(type, {\n                        detail: detail,\n                        bubbles: false,\n                        cancelable: true\n                    });\n                } else if (self.dispatchEvent) {\n                    event = document.createEvent(\"CustomEvent\");\n                    event.initCustomEvent(type, false, true, detail);\n                }\n\n                return event ? !self.dispatchEvent(event) : false;\n            };\n        }\n\n        var toWindowMethodNameMap = {};\n        toWindowMethodNameMap[\"unhandledRejection\"] = (\"on\" +\n            \"unhandledRejection\").toLowerCase();\n        toWindowMethodNameMap[\"rejectionHandled\"] = (\"on\" +\n            \"rejectionHandled\").toLowerCase();\n\n        return function(name, reason, promise) {\n            var methodName = toWindowMethodNameMap[name];\n            var method = self[methodName];\n            if (!method) return false;\n            if (name === \"rejectionHandled\") {\n                method.call(self, promise);\n            } else {\n                method.call(self, reason, promise);\n            }\n            return true;\n        };\n    }\n})();\n\nreturn CapturedTrace;\n};\n\n},{\"./async.js\":1,\"./util.js\":30}],6:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(NEXT_FILTER) {\nvar util = _dereq_(\"./util.js\");\nvar errors = _dereq_(\"./errors.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar keys = _dereq_(\"./es5.js\").keys;\nvar TypeError = errors.TypeError;\n\nfunction CatchFilter(instances, callback, promise) {\n    this._instances = instances;\n    this._callback = callback;\n    this._promise = promise;\n}\n\nfunction safePredicate(predicate, e) {\n    var safeObject = {};\n    var retfilter = tryCatch(predicate).call(safeObject, e);\n\n    if (retfilter === errorObj) return retfilter;\n\n    var safeKeys = keys(safeObject);\n    if (safeKeys.length) {\n        errorObj.e = new TypeError(\"Catch filter must inherit from Error or be a simple predicate function\\u000a\\u000a    See http://goo.gl/o84o68\\u000a\");\n        return errorObj;\n    }\n    return retfilter;\n}\n\nCatchFilter.prototype.doFilter = function (e) {\n    var cb = this._callback;\n    var promise = this._promise;\n    var boundTo = promise._boundTo;\n    for (var i = 0, len = this._instances.length; i < len; ++i) {\n        var item = this._instances[i];\n        var itemIsErrorType = item === Error ||\n            (item != null && item.prototype instanceof Error);\n\n        if (itemIsErrorType && e instanceof item) {\n            var ret = tryCatch(cb).call(boundTo, e);\n            if (ret === errorObj) {\n                NEXT_FILTER.e = ret.e;\n                return NEXT_FILTER;\n            }\n            return ret;\n        } else if (typeof item === \"function\" && !itemIsErrorType) {\n            var shouldHandle = safePredicate(item, e);\n            if (shouldHandle === errorObj) {\n                e = errorObj.e;\n                break;\n            } else if (shouldHandle) {\n                var ret = tryCatch(cb).call(boundTo, e);\n                if (ret === errorObj) {\n                    NEXT_FILTER.e = ret.e;\n                    return NEXT_FILTER;\n                }\n                return ret;\n            }\n        }\n    }\n    NEXT_FILTER.e = e;\n    return NEXT_FILTER;\n};\n\nreturn CatchFilter;\n};\n\n},{\"./errors.js\":11,\"./es5.js\":12,\"./util.js\":30}],7:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, CapturedTrace, isDebugging) {\nvar contextStack = [];\nfunction Context() {\n    this._trace = new CapturedTrace(peekContext());\n}\nContext.prototype._pushContext = function () {\n    if (!isDebugging()) return;\n    if (this._trace !== undefined) {\n        contextStack.push(this._trace);\n    }\n};\n\nContext.prototype._popContext = function () {\n    if (!isDebugging()) return;\n    if (this._trace !== undefined) {\n        contextStack.pop();\n    }\n};\n\nfunction createContext() {\n    if (isDebugging()) return new Context();\n}\n\nfunction peekContext() {\n    var lastIndex = contextStack.length - 1;\n    if (lastIndex >= 0) {\n        return contextStack[lastIndex];\n    }\n    return undefined;\n}\n\nPromise.prototype._peekContext = peekContext;\nPromise.prototype._pushContext = Context.prototype._pushContext;\nPromise.prototype._popContext = Context.prototype._popContext;\n\nreturn createContext;\n};\n\n},{}],8:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, CapturedTrace) {\nvar async = _dereq_(\"./async.js\");\nvar Warning = _dereq_(\"./errors.js\").Warning;\nvar util = _dereq_(\"./util.js\");\nvar canAttachTrace = util.canAttachTrace;\nvar unhandledRejectionHandled;\nvar possiblyUnhandledRejection;\nvar debugging = false || (util.isNode &&\n                    (!!process.env[\"BLUEBIRD_DEBUG\"] ||\n                     process.env[\"NODE_ENV\"] === \"development\"));\n\nPromise.prototype._ensurePossibleRejectionHandled = function () {\n    this._setRejectionIsUnhandled();\n    async.invokeLater(this._notifyUnhandledRejection, this, undefined);\n};\n\nPromise.prototype._notifyUnhandledRejectionIsHandled = function () {\n    CapturedTrace.fireRejectionEvent(\"rejectionHandled\",\n                                  unhandledRejectionHandled, undefined, this);\n};\n\nPromise.prototype._notifyUnhandledRejection = function () {\n    if (this._isRejectionUnhandled()) {\n        var reason = this._getCarriedStackTrace() || this._settledValue;\n        this._setUnhandledRejectionIsNotified();\n        CapturedTrace.fireRejectionEvent(\"unhandledRejection\",\n                                      possiblyUnhandledRejection, reason, this);\n    }\n};\n\nPromise.prototype._setUnhandledRejectionIsNotified = function () {\n    this._bitField = this._bitField | 524288;\n};\n\nPromise.prototype._unsetUnhandledRejectionIsNotified = function () {\n    this._bitField = this._bitField & (~524288);\n};\n\nPromise.prototype._isUnhandledRejectionNotified = function () {\n    return (this._bitField & 524288) > 0;\n};\n\nPromise.prototype._setRejectionIsUnhandled = function () {\n    this._bitField = this._bitField | 2097152;\n};\n\nPromise.prototype._unsetRejectionIsUnhandled = function () {\n    this._bitField = this._bitField & (~2097152);\n    if (this._isUnhandledRejectionNotified()) {\n        this._unsetUnhandledRejectionIsNotified();\n        this._notifyUnhandledRejectionIsHandled();\n    }\n};\n\nPromise.prototype._isRejectionUnhandled = function () {\n    return (this._bitField & 2097152) > 0;\n};\n\nPromise.prototype._setCarriedStackTrace = function (capturedTrace) {\n    this._bitField = this._bitField | 1048576;\n    this._fulfillmentHandler0 = capturedTrace;\n};\n\nPromise.prototype._isCarryingStackTrace = function () {\n    return (this._bitField & 1048576) > 0;\n};\n\nPromise.prototype._getCarriedStackTrace = function () {\n    return this._isCarryingStackTrace()\n        ? this._fulfillmentHandler0\n        : undefined;\n};\n\nPromise.prototype._captureStackTrace = function () {\n    if (debugging) {\n        this._trace = new CapturedTrace(this._peekContext());\n    }\n    return this;\n};\n\nPromise.prototype._attachExtraTrace = function (error, ignoreSelf) {\n    if (debugging && canAttachTrace(error)) {\n        var trace = this._trace;\n        if (trace !== undefined) {\n            if (ignoreSelf) trace = trace._parent;\n        }\n        if (trace !== undefined) {\n            trace.attachExtraTrace(error);\n        } else if (!error.__stackCleaned__) {\n            var parsed = CapturedTrace.parseStackAndMessage(error);\n            error.stack = parsed.stack.join(\"\\n\");\n            error.__stackCleaned__ = true;\n        }\n    }\n};\n\nPromise.prototype._warn = function(message) {\n    var warning = new Warning(message);\n    var ctx = this._peekContext();\n    if (ctx) {\n        ctx.attachExtraTrace(warning);\n    } else {\n        var parsed = CapturedTrace.parseStackAndMessage(warning);\n        warning.stack = parsed.message + \"\\n\" + parsed.stack.join(\"\\n\");\n    }\n    CapturedTrace.formatAndLogError(warning, \"\");\n};\n\nPromise.onPossiblyUnhandledRejection = function (fn) {\n    possiblyUnhandledRejection = typeof fn === \"function\" ? fn : undefined;\n};\n\nPromise.onUnhandledRejectionHandled = function (fn) {\n    unhandledRejectionHandled = typeof fn === \"function\" ? fn : undefined;\n};\n\nPromise.longStackTraces = function () {\n    if (async.haveItemsQueued() &&\n        debugging === false\n   ) {\n        throw new Error(\"cannot enable long stack traces after promises have been created\\u000a\\u000a    See http://goo.gl/DT1qyG\\u000a\");\n    }\n    debugging = CapturedTrace.isSupported();\n};\n\nPromise.hasLongStackTraces = function () {\n    return debugging && CapturedTrace.isSupported();\n};\n\nif (!CapturedTrace.isSupported()) {\n    Promise.longStackTraces = function(){};\n    debugging = false;\n}\n\nreturn function() {\n    return debugging;\n};\n};\n\n},{\"./async.js\":1,\"./errors.js\":11,\"./util.js\":30}],9:[function(_dereq_,module,exports){\n\"use strict\";\nvar util = _dereq_(\"./util.js\");\nvar isPrimitive = util.isPrimitive;\nvar wrapsPrimitiveReceiver = util.wrapsPrimitiveReceiver;\n\nmodule.exports = function(Promise) {\nvar returner = function () {\n    return this;\n};\nvar thrower = function () {\n    throw this;\n};\n\nvar wrapper = function (value, action) {\n    if (action === 1) {\n        return function () {\n            throw value;\n        };\n    } else if (action === 2) {\n        return function () {\n            return value;\n        };\n    }\n};\n\n\nPromise.prototype[\"return\"] =\nPromise.prototype.thenReturn = function (value) {\n    if (wrapsPrimitiveReceiver && isPrimitive(value)) {\n        return this._then(\n            wrapper(value, 2),\n            undefined,\n            undefined,\n            undefined,\n            undefined\n       );\n    }\n    return this._then(returner, undefined, undefined, value, undefined);\n};\n\nPromise.prototype[\"throw\"] =\nPromise.prototype.thenThrow = function (reason) {\n    if (wrapsPrimitiveReceiver && isPrimitive(reason)) {\n        return this._then(\n            wrapper(reason, 1),\n            undefined,\n            undefined,\n            undefined,\n            undefined\n       );\n    }\n    return this._then(thrower, undefined, undefined, reason, undefined);\n};\n};\n\n},{\"./util.js\":30}],10:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseReduce = Promise.reduce;\n\nPromise.prototype.each = function (fn) {\n    return PromiseReduce(this, fn, null, INTERNAL);\n};\n\nPromise.each = function (promises, fn) {\n    return PromiseReduce(promises, fn, null, INTERNAL);\n};\n};\n\n},{}],11:[function(_dereq_,module,exports){\n\"use strict\";\nvar Objectfreeze = _dereq_(\"./es5.js\").freeze;\nvar util = _dereq_(\"./util.js\");\nvar inherits = util.inherits;\nvar notEnumerableProp = util.notEnumerableProp;\n\nfunction subError(nameProperty, defaultMessage) {\n    function SubError(message) {\n        if (!(this instanceof SubError)) return new SubError(message);\n        notEnumerableProp(this, \"message\",\n            typeof message === \"string\" ? message : defaultMessage);\n        notEnumerableProp(this, \"name\", nameProperty);\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        } else {\n            Error.call(this);\n        }\n    }\n    inherits(SubError, Error);\n    return SubError;\n}\n\nvar _TypeError, _RangeError;\nvar Warning = subError(\"Warning\", \"warning\");\nvar CancellationError = subError(\"CancellationError\", \"cancellation error\");\nvar TimeoutError = subError(\"TimeoutError\", \"timeout error\");\nvar AggregateError = subError(\"AggregateError\", \"aggregate error\");\ntry {\n    _TypeError = TypeError;\n    _RangeError = RangeError;\n} catch(e) {\n    _TypeError = subError(\"TypeError\", \"type error\");\n    _RangeError = subError(\"RangeError\", \"range error\");\n}\n\nvar methods = (\"join pop push shift unshift slice filter forEach some \" +\n    \"every map indexOf lastIndexOf reduce reduceRight sort reverse\").split(\" \");\n\nfor (var i = 0; i < methods.length; ++i) {\n    if (typeof Array.prototype[methods[i]] === \"function\") {\n        AggregateError.prototype[methods[i]] = Array.prototype[methods[i]];\n    }\n}\n\nAggregateError.prototype.length = 0;\nAggregateError.prototype[\"isOperational\"] = true;\nvar level = 0;\nAggregateError.prototype.toString = function() {\n    var indent = Array(level * 4 + 1).join(\" \");\n    var ret = \"\\n\" + indent + \"AggregateError of:\" + \"\\n\";\n    level++;\n    indent = Array(level * 4 + 1).join(\" \");\n    for (var i = 0; i < this.length; ++i) {\n        var str = this[i] === this ? \"[Circular AggregateError]\" : this[i] + \"\";\n        var lines = str.split(\"\\n\");\n        for (var j = 0; j < lines.length; ++j) {\n            lines[j] = indent + lines[j];\n        }\n        str = lines.join(\"\\n\");\n        ret += str + \"\\n\";\n    }\n    level--;\n    return ret;\n};\n\nfunction OperationalError(message) {\n    if (!(this instanceof OperationalError))\n        return new OperationalError(message);\n    notEnumerableProp(this, \"name\", \"OperationalError\");\n    notEnumerableProp(this, \"message\", message);\n    this.cause = message;\n    this[\"isOperational\"] = true;\n\n    if (message instanceof Error) {\n        notEnumerableProp(this, \"message\", message.message);\n        notEnumerableProp(this, \"stack\", message.stack);\n    } else if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, this.constructor);\n    }\n\n}\ninherits(OperationalError, Error);\n\nvar errorTypes = Error[\"__BluebirdErrorTypes__\"];\nif (!errorTypes) {\n    errorTypes = Objectfreeze({\n        CancellationError: CancellationError,\n        TimeoutError: TimeoutError,\n        OperationalError: OperationalError,\n        RejectionError: OperationalError,\n        AggregateError: AggregateError\n    });\n    notEnumerableProp(Error, \"__BluebirdErrorTypes__\", errorTypes);\n}\n\nmodule.exports = {\n    Error: Error,\n    TypeError: _TypeError,\n    RangeError: _RangeError,\n    CancellationError: errorTypes.CancellationError,\n    OperationalError: errorTypes.OperationalError,\n    TimeoutError: errorTypes.TimeoutError,\n    AggregateError: errorTypes.AggregateError,\n    Warning: Warning\n};\n\n},{\"./es5.js\":12,\"./util.js\":30}],12:[function(_dereq_,module,exports){\nvar isES5 = (function(){\n    \"use strict\";\n    return this === undefined;\n})();\n\nif (isES5) {\n    module.exports = {\n        freeze: Object.freeze,\n        defineProperty: Object.defineProperty,\n        keys: Object.keys,\n        getPrototypeOf: Object.getPrototypeOf,\n        isArray: Array.isArray,\n        isES5: isES5,\n        propertyIsWritable: function(obj, prop) {\n            var descriptor = Object.getOwnPropertyDescriptor(obj, prop);\n            return !!(!descriptor || descriptor.writable || descriptor.set);\n        }\n    };\n} else {\n    var has = {}.hasOwnProperty;\n    var str = {}.toString;\n    var proto = {}.constructor.prototype;\n\n    var ObjectKeys = function (o) {\n        var ret = [];\n        for (var key in o) {\n            if (has.call(o, key)) {\n                ret.push(key);\n            }\n        }\n        return ret;\n    };\n\n    var ObjectDefineProperty = function (o, key, desc) {\n        o[key] = desc.value;\n        return o;\n    };\n\n    var ObjectFreeze = function (obj) {\n        return obj;\n    };\n\n    var ObjectGetPrototypeOf = function (obj) {\n        try {\n            return Object(obj).constructor.prototype;\n        }\n        catch (e) {\n            return proto;\n        }\n    };\n\n    var ArrayIsArray = function (obj) {\n        try {\n            return str.call(obj) === \"[object Array]\";\n        }\n        catch(e) {\n            return false;\n        }\n    };\n\n    module.exports = {\n        isArray: ArrayIsArray,\n        keys: ObjectKeys,\n        defineProperty: ObjectDefineProperty,\n        freeze: ObjectFreeze,\n        getPrototypeOf: ObjectGetPrototypeOf,\n        isES5: isES5,\n        propertyIsWritable: function() {\n            return true;\n        }\n    };\n}\n\n},{}],13:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseMap = Promise.map;\n\nPromise.prototype.filter = function (fn, options) {\n    return PromiseMap(this, fn, options, INTERNAL);\n};\n\nPromise.filter = function (promises, fn, options) {\n    return PromiseMap(promises, fn, options, INTERNAL);\n};\n};\n\n},{}],14:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, NEXT_FILTER, tryConvertToPromise) {\nvar util = _dereq_(\"./util.js\");\nvar wrapsPrimitiveReceiver = util.wrapsPrimitiveReceiver;\nvar isPrimitive = util.isPrimitive;\nvar thrower = util.thrower;\n\nfunction returnThis() {\n    return this;\n}\nfunction throwThis() {\n    throw this;\n}\nfunction return$(r) {\n    return function() {\n        return r;\n    };\n}\nfunction throw$(r) {\n    return function() {\n        throw r;\n    };\n}\nfunction promisedFinally(ret, reasonOrValue, isFulfilled) {\n    var then;\n    if (wrapsPrimitiveReceiver && isPrimitive(reasonOrValue)) {\n        then = isFulfilled ? return$(reasonOrValue) : throw$(reasonOrValue);\n    } else {\n        then = isFulfilled ? returnThis : throwThis;\n    }\n    return ret._then(then, thrower, undefined, reasonOrValue, undefined);\n}\n\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundTo)\n                    : handler();\n\n    if (ret !== undefined) {\n        var maybePromise = tryConvertToPromise(ret, promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            return promisedFinally(maybePromise, reasonOrValue,\n                                    promise.isFulfilled());\n        }\n    }\n\n    if (promise.isRejected()) {\n        NEXT_FILTER.e = reasonOrValue;\n        return NEXT_FILTER;\n    } else {\n        return reasonOrValue;\n    }\n}\n\nfunction tapHandler(value) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    var ret = promise._isBound()\n                    ? handler.call(promise._boundTo, value)\n                    : handler(value);\n\n    if (ret !== undefined) {\n        var maybePromise = tryConvertToPromise(ret, promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            return promisedFinally(maybePromise, value, true);\n        }\n    }\n    return value;\n}\n\nPromise.prototype._passThroughHandler = function (handler, isFinally) {\n    if (typeof handler !== \"function\") return this.then();\n\n    var promiseAndHandler = {\n        promise: this,\n        handler: handler\n    };\n\n    return this._then(\n            isFinally ? finallyHandler : tapHandler,\n            isFinally ? finallyHandler : undefined, undefined,\n            promiseAndHandler, undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThroughHandler(handler, true);\n};\n\nPromise.prototype.tap = function (handler) {\n    return this._passThroughHandler(handler, false);\n};\n};\n\n},{\"./util.js\":30}],15:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, tryConvertToPromise, INTERNAL) {\nvar util = _dereq_(\"./util.js\");\nvar canEvaluate = util.canEvaluate;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar reject;\n\nif (!true) {\nif (canEvaluate) {\n    var thenCallback = function(i) {\n        return new Function(\"value\", \"holder\", \"                             \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = value;                                           \\n\\\n            holder.checkFulfillment(this);                                   \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var caller = function(count) {\n        var values = [];\n        for (var i = 1; i <= count; ++i) values.push(\"holder.p\" + i);\n        return new Function(\"holder\", \"                                      \\n\\\n            'use strict';                                                    \\n\\\n            var callback = holder.fn;                                        \\n\\\n            return callback(values);                                         \\n\\\n            \".replace(/values/g, values.join(\", \")));\n    };\n    var thenCallbacks = [];\n    var callers = [undefined];\n    for (var i = 1; i <= 5; ++i) {\n        thenCallbacks.push(thenCallback(i));\n        callers.push(caller(i));\n    }\n\n    var Holder = function(total, fn) {\n        this.p1 = this.p2 = this.p3 = this.p4 = this.p5 = null;\n        this.fn = fn;\n        this.total = total;\n        this.now = 0;\n    };\n\n    Holder.prototype.callers = callers;\n    Holder.prototype.checkFulfillment = function(promise) {\n        var now = this.now;\n        now++;\n        var total = this.total;\n        if (now >= total) {\n            var handler = this.callers[total];\n            promise._pushContext();\n            var ret = tryCatch(handler)(this);\n            promise._popContext();\n            if (ret === errorObj) {\n                promise._rejectCallback(ret.e, false, true);\n            } else {\n                promise._resolveCallback(ret);\n            }\n        } else {\n            this.now = now;\n        }\n    };\n\n    var reject = function (reason) {\n        this._reject(reason);\n    };\n}\n}\n\nPromise.join = function () {\n    var last = arguments.length - 1;\n    var fn;\n    if (last > 0 && typeof arguments[last] === \"function\") {\n        fn = arguments[last];\n        if (!true) {\n            if (last < 6 && canEvaluate) {\n                var ret = new Promise(INTERNAL);\n                ret._captureStackTrace();\n                var holder = new Holder(last, fn);\n                var callbacks = thenCallbacks;\n                for (var i = 0; i < last; ++i) {\n                    var maybePromise = tryConvertToPromise(arguments[i], ret);\n                    if (maybePromise instanceof Promise) {\n                        maybePromise = maybePromise._target();\n                        if (maybePromise._isPending()) {\n                            maybePromise._then(callbacks[i], reject,\n                                               undefined, ret, holder);\n                        } else if (maybePromise._isFulfilled()) {\n                            callbacks[i].call(ret,\n                                              maybePromise._value(), holder);\n                        } else {\n                            ret._reject(maybePromise._reason());\n                        }\n                    } else {\n                        callbacks[i].call(ret, maybePromise, holder);\n                    }\n                }\n                return ret;\n            }\n        }\n    }\n    var $_len = arguments.length;var args = new Array($_len); for(var $_i = 0; $_i < $_len; ++$_i) {args[$_i] = arguments[$_i];}\n    if (fn) args.pop();\n    var ret = new PromiseArray(args).promise();\n    return fn !== undefined ? ret.spread(fn) : ret;\n};\n\n};\n\n},{\"./util.js\":30}],16:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL) {\nvar util = _dereq_(\"./util.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar PENDING = {};\nvar EMPTY_ARRAY = [];\n\nfunction MappingPromiseArray(promises, fn, limit, _filter) {\n    this.constructor$(promises);\n    this._promise._setIsSpreadable();\n    this._promise._captureStackTrace();\n    this._callback = fn;\n    this._preservedValues = _filter === INTERNAL\n        ? new Array(this.length())\n        : null;\n    this._limit = limit;\n    this._inFlight = 0;\n    this._queue = limit >= 1 ? [] : EMPTY_ARRAY;\n    this._init$(undefined, -2);\n}\nutil.inherits(MappingPromiseArray, PromiseArray);\n\nMappingPromiseArray.prototype._init = function () {};\n\nMappingPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var limit = this._limit;\n    if (values[index] === PENDING) {\n        values[index] = value;\n        if (limit >= 1) {\n            this._inFlight--;\n            this._drainQueue();\n            if (this._isResolved()) return;\n        }\n    } else {\n        if (limit >= 1 && this._inFlight >= limit) {\n            values[index] = value;\n            this._queue.push(index);\n            return;\n        }\n        if (preservedValues !== null) preservedValues[index] = value;\n\n        var callback = this._callback;\n        var receiver = this._promise._boundTo;\n        this._promise._pushContext();\n        var ret = tryCatch(callback).call(receiver, value, index, length);\n        this._promise._popContext();\n        if (ret === errorObj) return this._reject(ret.e);\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (maybePromise._isPending()) {\n                if (limit >= 1) this._inFlight++;\n                values[index] = PENDING;\n                return maybePromise._proxyPromiseArray(this, index);\n            } else if (maybePromise._isFulfilled()) {\n                ret = maybePromise._value();\n            } else {\n                return this._reject(maybePromise._reason());\n            }\n        }\n        values[index] = ret;\n    }\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= length) {\n        if (preservedValues !== null) {\n            this._filter(values, preservedValues);\n        } else {\n            this._resolve(values);\n        }\n\n    }\n};\n\nMappingPromiseArray.prototype._drainQueue = function () {\n    var queue = this._queue;\n    var limit = this._limit;\n    var values = this._values;\n    while (queue.length > 0 && this._inFlight < limit) {\n        if (this._isResolved()) return;\n        var index = queue.pop();\n        this._promiseFulfilled(values[index], index);\n    }\n};\n\nMappingPromiseArray.prototype._filter = function (booleans, values) {\n    var len = values.length;\n    var ret = new Array(len);\n    var j = 0;\n    for (var i = 0; i < len; ++i) {\n        if (booleans[i]) ret[j++] = values[i];\n    }\n    ret.length = j;\n    this._resolve(ret);\n};\n\nMappingPromiseArray.prototype.preservedValues = function () {\n    return this._preservedValues;\n};\n\nfunction map(promises, fn, options, _filter) {\n    var limit = typeof options === \"object\" && options !== null\n        ? options.concurrency\n        : 0;\n    limit = typeof limit === \"number\" &&\n        isFinite(limit) && limit >= 1 ? limit : 0;\n    return new MappingPromiseArray(promises, fn, limit, _filter);\n}\n\nPromise.prototype.map = function (fn, options) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n\n    return map(this, fn, options, null).promise();\n};\n\nPromise.map = function (promises, fn, options, _filter) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    return map(promises, fn, options, _filter).promise();\n};\n\n\n};\n\n},{\"./util.js\":30}],17:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, INTERNAL, tryConvertToPromise, apiRejection) {\nvar util = _dereq_(\"./util.js\");\nvar tryCatch = util.tryCatch;\n\nPromise.method = function (fn) {\n    if (typeof fn !== \"function\") {\n        throw new Promise.TypeError(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    }\n    return function () {\n        var ret = new Promise(INTERNAL);\n        ret._captureStackTrace();\n        ret._pushContext();\n        var value = tryCatch(fn).apply(this, arguments);\n        ret._popContext();\n        ret._resolveFromSyncValue(value);\n        return ret;\n    };\n};\n\nPromise.attempt = Promise[\"try\"] = function (fn, args, ctx) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    }\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    ret._pushContext();\n    var value = util.isArray(args)\n        ? tryCatch(fn).apply(ctx, args)\n        : tryCatch(fn).call(ctx, args);\n    ret._popContext();\n    ret._resolveFromSyncValue(value);\n    return ret;\n};\n\nPromise.prototype._resolveFromSyncValue = function (value) {\n    if (value === util.errorObj) {\n        this._rejectCallback(value.e, false, true);\n    } else {\n        this._resolveCallback(value, true);\n    }\n};\n};\n\n},{\"./util.js\":30}],18:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar util = _dereq_(\"./util.js\");\nvar async = _dereq_(\"./async.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\n\nfunction spreadAdapter(val, nodeback) {\n    var promise = this;\n    if (!util.isArray(val)) return successAdapter.call(promise, val, nodeback);\n    var ret = tryCatch(nodeback).apply(promise._boundTo, [null].concat(val));\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\n\nfunction successAdapter(val, nodeback) {\n    var promise = this;\n    var receiver = promise._boundTo;\n    var ret = val === undefined\n        ? tryCatch(nodeback).call(receiver, null)\n        : tryCatch(nodeback).call(receiver, null, val);\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\nfunction errorAdapter(reason, nodeback) {\n    var promise = this;\n    if (!reason) {\n        var target = promise._target();\n        var newReason = target._getCarriedStackTrace();\n        newReason.cause = reason;\n        reason = newReason;\n    }\n    var ret = tryCatch(nodeback).call(promise._boundTo, reason);\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\n\nPromise.prototype.nodeify = function (nodeback, options) {\n    if (typeof nodeback == \"function\") {\n        var adapter = successAdapter;\n        if (options !== undefined && Object(options).spread) {\n            adapter = spreadAdapter;\n        }\n        this._then(\n            adapter,\n            errorAdapter,\n            undefined,\n            this,\n            nodeback\n        );\n    }\n    return this;\n};\n};\n\n},{\"./async.js\":1,\"./util.js\":30}],19:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, PromiseArray) {\nvar util = _dereq_(\"./util.js\");\nvar async = _dereq_(\"./async.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\n\nPromise.prototype.progressed = function (handler) {\n    return this._then(undefined, undefined, handler, undefined, undefined);\n};\n\nPromise.prototype._progress = function (progressValue) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    this._target()._progressUnchecked(progressValue);\n\n};\n\nPromise.prototype._progressHandlerAt = function (index) {\n    return index === 0\n        ? this._progressHandler0\n        : this[(index << 2) + index - 5 + 2];\n};\n\nPromise.prototype._doProgressWith = function (progression) {\n    var progressValue = progression.value;\n    var handler = progression.handler;\n    var promise = progression.promise;\n    var receiver = progression.receiver;\n\n    var ret = tryCatch(handler).call(receiver, progressValue);\n    if (ret === errorObj) {\n        if (ret.e != null &&\n            ret.e.name !== \"StopProgressPropagation\") {\n            var trace = util.canAttachTrace(ret.e)\n                ? ret.e : new Error(util.toString(ret.e));\n            promise._attachExtraTrace(trace);\n            promise._progress(ret.e);\n        }\n    } else if (ret instanceof Promise) {\n        ret._then(promise._progress, null, null, promise, undefined);\n    } else {\n        promise._progress(ret);\n    }\n};\n\n\nPromise.prototype._progressUnchecked = function (progressValue) {\n    var len = this._length();\n    var progress = this._progress;\n    for (var i = 0; i < len; i++) {\n        var handler = this._progressHandlerAt(i);\n        var promise = this._promiseAt(i);\n        if (!(promise instanceof Promise)) {\n            var receiver = this._receiverAt(i);\n            if (typeof handler === \"function\") {\n                handler.call(receiver, progressValue, promise);\n            } else if (receiver instanceof PromiseArray &&\n                       !receiver._isResolved()) {\n                receiver._promiseProgressed(progressValue, promise);\n            }\n            continue;\n        }\n\n        if (typeof handler === \"function\") {\n            async.invoke(this._doProgressWith, this, {\n                handler: handler,\n                promise: promise,\n                receiver: this._receiverAt(i),\n                value: progressValue\n            });\n        } else {\n            async.invoke(progress, promise, progressValue);\n        }\n    }\n};\n};\n\n},{\"./async.js\":1,\"./util.js\":30}],20:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function() {\nvar makeSelfResolutionError = function () {\n    return new TypeError(\"circular promise resolution chain\\u000a\\u000a    See http://goo.gl/LhFpo0\\u000a\");\n};\nvar reflect = function() {\n    return new Promise.PromiseInspection(this._target());\n};\nvar apiRejection = function(msg) {\n    return Promise.reject(new TypeError(msg));\n};\nvar util = _dereq_(\"./util.js\");\nvar async = _dereq_(\"./async.js\");\nvar errors = _dereq_(\"./errors.js\");\nvar TypeError = Promise.TypeError = errors.TypeError;\nPromise.RangeError = errors.RangeError;\nPromise.CancellationError = errors.CancellationError;\nPromise.TimeoutError = errors.TimeoutError;\nPromise.OperationalError = errors.OperationalError;\nPromise.RejectionError = errors.OperationalError;\nPromise.AggregateError = errors.AggregateError;\nvar INTERNAL = function(){};\nvar APPLY = {};\nvar NEXT_FILTER = {e: null};\nvar tryConvertToPromise = _dereq_(\"./thenables.js\")(Promise, INTERNAL);\nvar PromiseArray =\n    _dereq_(\"./promise_array.js\")(Promise, INTERNAL,\n                                    tryConvertToPromise, apiRejection);\nvar CapturedTrace = _dereq_(\"./captured_trace.js\")();\nvar isDebugging = _dereq_(\"./debuggability.js\")(Promise, CapturedTrace);\n /*jshint unused:false*/\nvar createContext =\n    _dereq_(\"./context.js\")(Promise, CapturedTrace, isDebugging);\nvar CatchFilter = _dereq_(\"./catch_filter.js\")(NEXT_FILTER);\nvar PromiseResolver = _dereq_(\"./promise_resolver.js\");\nvar nodebackForPromise = PromiseResolver._nodebackForPromise;\nvar errorObj = util.errorObj;\nvar tryCatch = util.tryCatch;\nfunction Promise(resolver) {\n    if (typeof resolver !== \"function\") {\n        throw new TypeError(\"the promise constructor requires a resolver function\\u000a\\u000a    See http://goo.gl/EC22Yn\\u000a\");\n    }\n    if (this.constructor !== Promise) {\n        throw new TypeError(\"the promise constructor cannot be invoked directly\\u000a\\u000a    See http://goo.gl/KsIlge\\u000a\");\n    }\n    this._bitField = 0;\n    this._fulfillmentHandler0 = undefined;\n    this._rejectionHandler0 = undefined;\n    this._progressHandler0 = undefined;\n    this._promise0 = undefined;\n    this._receiver0 = undefined;\n    this._settledValue = undefined;\n    this._boundTo = undefined;\n    if (resolver !== INTERNAL) this._resolveFromResolver(resolver);\n}\n\nPromise.prototype.toString = function () {\n    return \"[object Promise]\";\n};\n\nPromise.prototype.caught = Promise.prototype[\"catch\"] = function (fn) {\n    var len = arguments.length;\n    if (len > 1) {\n        var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (typeof item === \"function\") {\n                catchInstances[j++] = item;\n            } else {\n                return Promise.reject(\n                    new TypeError(\"Catch filter must inherit from Error or be a simple predicate function\\u000a\\u000a    See http://goo.gl/o84o68\\u000a\"));\n            }\n        }\n        catchInstances.length = j;\n        fn = arguments[i];\n        var catchFilter = new CatchFilter(catchInstances, fn, this);\n        return this._then(undefined, catchFilter.doFilter, undefined,\n            catchFilter, undefined);\n    }\n    return this._then(undefined, fn, undefined, undefined, undefined);\n};\n\nPromise.prototype.reflect = function () {\n    return this._then(reflect, reflect, undefined, this, undefined);\n};\n\nPromise.prototype.then = function (didFulfill, didReject, didProgress) {\n    if (isDebugging() && arguments.length > 0 &&\n        typeof didFulfill !== \"function\" &&\n        typeof didReject !== \"function\") {\n        var msg = \".then() only accepts functions but was passed: \" +\n                util.classString(didFulfill);\n        if (arguments.length > 1) {\n            msg += \", \" + util.classString(didReject);\n        }\n        this._warn(msg);\n    }\n    return this._then(didFulfill, didReject, didProgress,\n        undefined, undefined);\n};\n\nPromise.prototype.done = function (didFulfill, didReject, didProgress) {\n    var promise = this._then(didFulfill, didReject, didProgress,\n        undefined, undefined);\n    promise._setIsFinal();\n};\n\nPromise.prototype.spread = function (didFulfill, didReject) {\n    var followee = this._target();\n    var target = followee._isSpreadable()\n        ? (followee === this ? this : this.then())\n        : this.all();\n    return target._then(didFulfill, didReject, undefined, APPLY, undefined);\n};\n\nPromise.prototype.isCancellable = function () {\n    return !this.isResolved() &&\n        this._cancellable();\n};\n\nPromise.prototype.toJSON = function () {\n    var ret = {\n        isFulfilled: false,\n        isRejected: false,\n        fulfillmentValue: undefined,\n        rejectionReason: undefined\n    };\n    if (this.isFulfilled()) {\n        ret.fulfillmentValue = this.value();\n        ret.isFulfilled = true;\n    } else if (this.isRejected()) {\n        ret.rejectionReason = this.reason();\n        ret.isRejected = true;\n    }\n    return ret;\n};\n\nPromise.prototype.all = function () {\n    var ret = new PromiseArray(this).promise();\n    ret._setIsSpreadable();\n    return ret;\n};\n\nPromise.prototype.error = function (fn) {\n    return this.caught(util.originatesFromRejection, fn);\n};\n\nPromise.is = function (val) {\n    return val instanceof Promise;\n};\n\nPromise.fromNode = function(fn) {\n    var ret = new Promise(INTERNAL);\n    var result = tryCatch(fn)(nodebackForPromise(ret));\n    if (result === errorObj) {\n        ret._rejectCallback(result.e, true, true);\n    }\n    return ret;\n};\n\nPromise.all = function (promises) {\n    var ret = new PromiseArray(promises).promise();\n    ret._setIsSpreadable();\n    return ret;\n};\n\nPromise.defer = Promise.pending = function () {\n    var promise = new Promise(INTERNAL);\n    return new PromiseResolver(promise);\n};\n\nPromise.cast = function (obj) {\n    var ret = tryConvertToPromise(obj);\n    if (!(ret instanceof Promise)) {\n        var val = ret;\n        ret = new Promise(INTERNAL);\n        ret._fulfillUnchecked(val);\n    }\n    return ret;\n};\n\nPromise.resolve = Promise.fulfilled = Promise.cast;\n\nPromise.reject = Promise.rejected = function (reason) {\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    ret._rejectCallback(reason, true);\n    return ret;\n};\n\nPromise.setScheduler = function(fn) {\n    if (typeof fn !== \"function\") throw new TypeError(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    var prev = async._schedule;\n    async._schedule = fn;\n    return prev;\n};\n\nPromise.prototype._then = function (\n    didFulfill,\n    didReject,\n    didProgress,\n    receiver,\n    internalData\n) {\n    var haveInternalData = internalData !== undefined;\n    var ret = haveInternalData ? internalData : new Promise(INTERNAL);\n\n    if (!haveInternalData) {\n        ret._propagateFrom(this, 4 | 1);\n        ret._captureStackTrace();\n    }\n\n    var target = this._target();\n    if (target !== this) {\n        if (!haveInternalData) {\n            ret._setIsMigrated();\n            if (receiver === undefined) {\n                ret._setIsMigratingBinding();\n                receiver = this;\n            }\n        }\n    }\n\n    var callbackIndex =\n        target._addCallbacks(didFulfill, didReject, didProgress, ret, receiver);\n\n    if (target._isResolved() && !target._isSettlePromisesQueued()) {\n        async.invoke(\n            target._settlePromiseAtPostResolution, target, callbackIndex);\n    }\n\n    return ret;\n};\n\nPromise.prototype._settlePromiseAtPostResolution = function (index) {\n    if (this._isRejectionUnhandled()) this._unsetRejectionIsUnhandled();\n    this._settlePromiseAt(index);\n};\n\nPromise.prototype._length = function () {\n    return this._bitField & 131071;\n};\n\nPromise.prototype._isFollowingOrFulfilledOrRejected = function () {\n    return (this._bitField & 939524096) > 0;\n};\n\nPromise.prototype._isFollowing = function () {\n    return (this._bitField & 536870912) === 536870912;\n};\n\nPromise.prototype._setLength = function (len) {\n    this._bitField = (this._bitField & -131072) |\n        (len & 131071);\n};\n\nPromise.prototype._setFulfilled = function () {\n    this._bitField = this._bitField | 268435456;\n};\n\nPromise.prototype._setRejected = function () {\n    this._bitField = this._bitField | 134217728;\n};\n\nPromise.prototype._setFollowing = function () {\n    this._bitField = this._bitField | 536870912;\n};\n\nPromise.prototype._setIsFinal = function () {\n    this._bitField = this._bitField | 33554432;\n};\n\nPromise.prototype._isFinal = function () {\n    return (this._bitField & 33554432) > 0;\n};\n\nPromise.prototype._cancellable = function () {\n    return (this._bitField & 67108864) > 0;\n};\n\nPromise.prototype._setCancellable = function () {\n    this._bitField = this._bitField | 67108864;\n};\n\nPromise.prototype._unsetCancellable = function () {\n    this._bitField = this._bitField & (~67108864);\n};\n\nPromise.prototype._isSpreadable = function () {\n    return (this._bitField & 131072) > 0;\n};\n\nPromise.prototype._setIsSpreadable = function () {\n    this._bitField = this._bitField | 131072;\n};\n\nPromise.prototype._setIsMigrated = function () {\n    this._bitField = this._bitField | 4194304;\n};\n\nPromise.prototype._unsetIsMigrated = function () {\n    this._bitField = this._bitField & (~4194304);\n};\n\nPromise.prototype._isMigrated = function () {\n    return (this._bitField & 4194304) > 0;\n};\n\nPromise.prototype._receiverAt = function (index) {\n    var ret = index === 0\n        ? this._receiver0\n        : this[\n            index * 5 - 5 + 4];\n    if (this._isBound() && ret === undefined) {\n        return this._boundTo;\n    }\n    return ret;\n};\n\nPromise.prototype._promiseAt = function (index) {\n    return index === 0\n        ? this._promise0\n        : this[index * 5 - 5 + 3];\n};\n\nPromise.prototype._fulfillmentHandlerAt = function (index) {\n    return index === 0\n        ? this._fulfillmentHandler0\n        : this[index * 5 - 5 + 0];\n};\n\nPromise.prototype._rejectionHandlerAt = function (index) {\n    return index === 0\n        ? this._rejectionHandler0\n        : this[index * 5 - 5 + 1];\n};\n\nPromise.prototype._migrateCallbacks = function (follower, index) {\n    var fulfill = follower._fulfillmentHandlerAt(index);\n    var reject = follower._rejectionHandlerAt(index);\n    var progress = follower._progressHandlerAt(index);\n    var promise = follower._promiseAt(index);\n    var receiver = follower._receiverAt(index);\n    if (promise instanceof Promise) {\n        promise._setIsMigrated();\n        if (receiver === undefined) {\n            receiver = follower;\n            promise._setIsMigratingBinding();\n        }\n    }\n    this._addCallbacks(fulfill, reject, progress, promise, receiver);\n};\n\nPromise.prototype._addCallbacks = function (\n    fulfill,\n    reject,\n    progress,\n    promise,\n    receiver\n) {\n    var index = this._length();\n\n    if (index >= 131071 - 5) {\n        index = 0;\n        this._setLength(0);\n    }\n\n    if (index === 0) {\n        this._promise0 = promise;\n        if (receiver !== undefined) this._receiver0 = receiver;\n        if (typeof fulfill === \"function\" && !this._isCarryingStackTrace())\n            this._fulfillmentHandler0 = fulfill;\n        if (typeof reject === \"function\") this._rejectionHandler0 = reject;\n        if (typeof progress === \"function\") this._progressHandler0 = progress;\n    } else {\n        var base = index * 5 - 5;\n        this[base + 3] = promise;\n        this[base + 4] = receiver;\n        if (typeof fulfill === \"function\")\n            this[base + 0] = fulfill;\n        if (typeof reject === \"function\")\n            this[base + 1] = reject;\n        if (typeof progress === \"function\")\n            this[base + 2] = progress;\n    }\n    this._setLength(index + 1);\n    return index;\n};\n\nPromise.prototype._setProxyHandlers = function (receiver, promiseSlotValue) {\n    var index = this._length();\n\n    if (index >= 131071 - 5) {\n        index = 0;\n        this._setLength(0);\n    }\n    if (index === 0) {\n        this._promise0 = promiseSlotValue;\n        this._receiver0 = receiver;\n    } else {\n        var base = index * 5 - 5;\n        this[base + 3] = promiseSlotValue;\n        this[base + 4] = receiver;\n    }\n    this._setLength(index + 1);\n};\n\nPromise.prototype._proxyPromiseArray = function (promiseArray, index) {\n    this._setProxyHandlers(promiseArray, index);\n};\n\nPromise.prototype._resolveCallback = function(value, shouldBind) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    if (value === this)\n        return this._rejectCallback(makeSelfResolutionError(), false, true);\n    var maybePromise = tryConvertToPromise(value, this);\n    if (!(maybePromise instanceof Promise)) return this._fulfill(value);\n\n    var propagationFlags = 1 | (shouldBind ? 4 : 0);\n    this._propagateFrom(maybePromise, propagationFlags);\n    var promise = maybePromise._target();\n    if (promise._isPending()) {\n        var len = this._length();\n        for (var i = 0; i < len; ++i) {\n            promise._migrateCallbacks(this, i);\n        }\n        this._setFollowing();\n        this._setLength(0);\n        this._setFollowee(promise);\n    } else if (promise._isFulfilled()) {\n        this._fulfillUnchecked(promise._value());\n    } else {\n        this._rejectUnchecked(promise._reason(),\n            promise._getCarriedStackTrace());\n    }\n};\n\nPromise.prototype._rejectCallback =\nfunction(reason, synchronous, shouldNotMarkOriginatingFromRejection) {\n    if (!shouldNotMarkOriginatingFromRejection) {\n        util.markAsOriginatingFromRejection(reason);\n    }\n    var trace = util.ensureErrorObject(reason);\n    var hasStack = util.canAttachTrace(reason) &&\n        typeof trace.stack === \"string\" && trace.stack.length > 0;\n    this._attachExtraTrace(trace, synchronous ? hasStack : false);\n    this._reject(reason, trace === reason ? undefined : trace);\n};\n\nPromise.prototype._resolveFromResolver = function (resolver) {\n    var promise = this;\n    this._captureStackTrace();\n    this._pushContext();\n    var synchronous = true;\n    var r = tryCatch(resolver)(function(value) {\n        if (promise === null) return;\n        promise._resolveCallback(value);\n        promise = null;\n    }, function (reason) {\n        if (promise === null) return;\n        promise._rejectCallback(reason, synchronous);\n        promise = null;\n    });\n    synchronous = false;\n    this._popContext();\n\n    if (r !== undefined && r === errorObj && promise !== null) {\n        promise._rejectCallback(r.e, true, true);\n        promise = null;\n    }\n};\n\nPromise.prototype._settlePromiseFromHandler = function (\n    handler, receiver, value, promise\n) {\n    if (promise._isRejected()) return;\n    promise._pushContext();\n    var x;\n    if (receiver === APPLY && !this._isRejected()) {\n        x = tryCatch(handler).apply(this._boundTo, value);\n    } else {\n        x = tryCatch(handler).call(receiver, value);\n    }\n    promise._popContext();\n\n    if (x === errorObj || x === promise || x === NEXT_FILTER) {\n        var err = x === promise ? makeSelfResolutionError() : x.e;\n        promise._rejectCallback(err, false, true);\n    } else {\n        promise._resolveCallback(x);\n    }\n};\n\nPromise.prototype._target = function() {\n    var ret = this;\n    while (ret._isFollowing()) ret = ret._followee();\n    return ret;\n};\n\nPromise.prototype._followee = function() {\n    return this._rejectionHandler0;\n};\n\nPromise.prototype._setFollowee = function(promise) {\n    this._rejectionHandler0 = promise;\n};\n\nPromise.prototype._cleanValues = function () {\n    if (this._cancellable()) {\n        this._cancellationParent = undefined;\n    }\n};\n\nPromise.prototype._propagateFrom = function (parent, flags) {\n    if ((flags & 1) > 0 && parent._cancellable()) {\n        this._setCancellable();\n        this._cancellationParent = parent;\n    }\n    if ((flags & 4) > 0) {\n        this._setBoundTo(parent._boundTo);\n    }\n};\n\nPromise.prototype._fulfill = function (value) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    this._fulfillUnchecked(value);\n};\n\nPromise.prototype._reject = function (reason, carriedStackTrace) {\n    if (this._isFollowingOrFulfilledOrRejected()) return;\n    this._rejectUnchecked(reason, carriedStackTrace);\n};\n\nPromise.prototype._settlePromiseAt = function (index) {\n    var promise = this._promiseAt(index);\n    var isPromise = promise instanceof Promise;\n\n    if (isPromise && promise._isMigrated()) {\n        promise._unsetIsMigrated();\n        return async.invoke(this._settlePromiseAt, this, index);\n    }\n    var handler = this._isFulfilled()\n        ? this._fulfillmentHandlerAt(index)\n        : this._rejectionHandlerAt(index);\n\n    var carriedStackTrace =\n        this._isCarryingStackTrace() ? this._getCarriedStackTrace() : undefined;\n    var value = this._settledValue;\n    var receiver = this._receiverAt(index);\n    if (isPromise && promise._isMigratingBinding()) {\n        promise._unsetIsMigratingBinding();\n        receiver = receiver._boundTo;\n    }\n\n    this._clearCallbackDataAtIndex(index);\n\n    if (typeof handler === \"function\") {\n        if (!isPromise) {\n            handler.call(receiver, value, promise);\n        } else {\n            this._settlePromiseFromHandler(handler, receiver, value, promise);\n        }\n    } else if (receiver instanceof PromiseArray) {\n        if (!receiver._isResolved()) {\n            if (this._isFulfilled()) {\n                receiver._promiseFulfilled(value, promise);\n            }\n            else {\n                receiver._promiseRejected(value, promise);\n            }\n        }\n    } else if (isPromise) {\n        if (this._isFulfilled()) {\n            promise._fulfill(value);\n        } else {\n            promise._reject(value, carriedStackTrace);\n        }\n    }\n\n    if (index >= 4 && (index & 31) === 4)\n        async.invokeLater(this._setLength, this, 0);\n};\n\nPromise.prototype._clearCallbackDataAtIndex = function(index) {\n    if (index === 0) {\n        if (!this._isCarryingStackTrace()) {\n            this._fulfillmentHandler0 = undefined;\n        }\n        this._rejectionHandler0 =\n        this._progressHandler0 =\n        this._receiver0 =\n        this._promise0 = undefined;\n    } else {\n        var base = index * 5 - 5;\n        this[base + 3] =\n        this[base + 4] =\n        this[base + 0] =\n        this[base + 1] =\n        this[base + 2] = undefined;\n    }\n};\n\nPromise.prototype._isSettlePromisesQueued = function () {\n    return (this._bitField &\n            -1073741824) === -1073741824;\n};\n\nPromise.prototype._setSettlePromisesQueued = function () {\n    this._bitField = this._bitField | -1073741824;\n};\n\nPromise.prototype._unsetSettlePromisesQueued = function () {\n    this._bitField = this._bitField & (~-1073741824);\n};\n\nPromise.prototype._queueSettlePromises = function() {\n    async.settlePromises(this);\n    this._setSettlePromisesQueued();\n};\n\nPromise.prototype._fulfillUnchecked = function (value) {\n    if (value === this) {\n        var err = makeSelfResolutionError();\n        this._attachExtraTrace(err);\n        return this._rejectUnchecked(err, undefined);\n    }\n    this._setFulfilled();\n    this._settledValue = value;\n    this._cleanValues();\n\n    if (this._length() > 0) {\n        this._queueSettlePromises();\n    }\n};\n\nPromise.prototype._rejectUncheckedCheckError = function (reason) {\n    var trace = util.ensureErrorObject(reason);\n    this._rejectUnchecked(reason, trace === reason ? undefined : trace);\n};\n\nPromise.prototype._rejectUnchecked = function (reason, trace) {\n    if (reason === this) {\n        var err = makeSelfResolutionError();\n        this._attachExtraTrace(err);\n        return this._rejectUnchecked(err);\n    }\n    this._setRejected();\n    this._settledValue = reason;\n    this._cleanValues();\n\n    if (this._isFinal()) {\n        async.throwLater(function(e) {\n            if (\"stack\" in e) {\n                async.invokeFirst(\n                    CapturedTrace.unhandledRejection, undefined, e);\n            }\n            throw e;\n        }, trace === undefined ? reason : trace);\n        return;\n    }\n\n    if (trace !== undefined && trace !== reason) {\n        this._setCarriedStackTrace(trace);\n    }\n\n    if (this._length() > 0) {\n        this._queueSettlePromises();\n    } else {\n        this._ensurePossibleRejectionHandled();\n    }\n};\n\nPromise.prototype._settlePromises = function () {\n    this._unsetSettlePromisesQueued();\n    var len = this._length();\n    for (var i = 0; i < len; i++) {\n        this._settlePromiseAt(i);\n    }\n};\n\nPromise._makeSelfResolutionError = makeSelfResolutionError;\n_dereq_(\"./method.js\")(Promise, INTERNAL, tryConvertToPromise, apiRejection);\n_dereq_(\"./bind.js\")(Promise, INTERNAL, tryConvertToPromise);\n_dereq_(\"./finally.js\")(Promise, NEXT_FILTER, tryConvertToPromise);\n_dereq_(\"./direct_resolve.js\")(Promise);\n_dereq_(\"./synchronous_inspection.js\")(Promise);\n_dereq_(\"./join.js\")(Promise, PromiseArray, tryConvertToPromise, INTERNAL);\n\nutil.toFastProperties(Promise);\nutil.toFastProperties(Promise.prototype);\nPromise.Promise = Promise;\nCapturedTrace.setBounds(async.firstLineError, util.lastLineError);\n_dereq_('./cancel.js')(Promise);\n_dereq_('./map.js')(Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL);\n_dereq_('./nodeify.js')(Promise);\n_dereq_('./progress.js')(Promise, PromiseArray);\n_dereq_('./promisify.js')(Promise, INTERNAL);\n_dereq_('./reduce.js')(Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL);\n_dereq_('./timers.js')(Promise, INTERNAL);\n_dereq_('./each.js')(Promise, INTERNAL);\n_dereq_('./filter.js')(Promise, INTERNAL);\n\nPromise.prototype = Promise.prototype;\nreturn Promise;\n\n};\n\n},{\"./async.js\":1,\"./bind.js\":2,\"./cancel.js\":4,\"./captured_trace.js\":5,\"./catch_filter.js\":6,\"./context.js\":7,\"./debuggability.js\":8,\"./direct_resolve.js\":9,\"./each.js\":10,\"./errors.js\":11,\"./filter.js\":13,\"./finally.js\":14,\"./join.js\":15,\"./map.js\":16,\"./method.js\":17,\"./nodeify.js\":18,\"./progress.js\":19,\"./promise_array.js\":21,\"./promise_resolver.js\":22,\"./promisify.js\":23,\"./reduce.js\":25,\"./synchronous_inspection.js\":27,\"./thenables.js\":28,\"./timers.js\":29,\"./util.js\":30}],21:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise,\n    apiRejection) {\nvar util = _dereq_(\"./util.js\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -2: return [];\n    case -3: return {};\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    var parent;\n    if (values instanceof Promise) {\n        parent = values;\n        promise._propagateFrom(parent, 1 | 4);\n    }\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(undefined, -2);\n}\nPromiseArray.prototype.length = function () {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseArray.prototype._init = function init(_, resolveValueIfEmpty) {\n    var values = tryConvertToPromise(this._values, this._promise);\n    if (values instanceof Promise) {\n        values._setBoundTo(this._promise._boundTo);\n        values = values._target();\n        this._values = values;\n        if (values._isFulfilled()) {\n            values = values._value();\n            if (!isArray(values)) {\n                var err = new Promise.TypeError(\"expecting an array, a promise or a thenable\\u000a\\u000a    See http://goo.gl/s8MMhc\\u000a\");\n                this.__hardReject__(err);\n                return;\n            }\n        } else if (values._isPending()) {\n            values._then(\n                init,\n                this._reject,\n                undefined,\n                this,\n                resolveValueIfEmpty\n           );\n            return;\n        } else {\n            this._reject(values._reason());\n            return;\n        }\n    } else if (!isArray(values)) {\n        this._promise._reject(apiRejection(\"expecting an array, a promise or a thenable\\u000a\\u000a    See http://goo.gl/s8MMhc\\u000a\")._reason());\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    var len = this.getActualLength(values.length);\n    this._length = len;\n    this._values = this.shouldCopyValues() ? new Array(len) : this._values;\n    var promise = this._promise;\n    for (var i = 0; i < len; ++i) {\n        var isResolved = this._isResolved();\n        var maybePromise = tryConvertToPromise(values[i], promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (isResolved) {\n                maybePromise._unsetRejectionIsUnhandled();\n            } else if (maybePromise._isPending()) {\n                maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise._isFulfilled()) {\n                this._promiseFulfilled(maybePromise._value(), i);\n            } else {\n                this._promiseRejected(maybePromise._reason(), i);\n            }\n        } else if (!isResolved) {\n            this._promiseFulfilled(maybePromise, i);\n        }\n    }\n};\n\nPromiseArray.prototype._isResolved = function () {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function (value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype.__hardReject__ =\nPromiseArray.prototype._reject = function (reason) {\n    this._values = null;\n    this._promise._rejectCallback(reason, false, true);\n};\n\nPromiseArray.prototype._promiseProgressed = function (progressValue, index) {\n    this._promise._progress({\n        index: index,\n        value: progressValue\n    });\n};\n\n\nPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n    }\n};\n\nPromiseArray.prototype._promiseRejected = function (reason, index) {\n    this._totalResolved++;\n    this._reject(reason);\n};\n\nPromiseArray.prototype.shouldCopyValues = function () {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength = function (len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n\n},{\"./util.js\":30}],22:[function(_dereq_,module,exports){\n\"use strict\";\nvar util = _dereq_(\"./util.js\");\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar errors = _dereq_(\"./errors.js\");\nvar TimeoutError = errors.TimeoutError;\nvar OperationalError = errors.OperationalError;\nvar haveGetters = util.haveGetters;\nvar es5 = _dereq_(\"./es5.js\");\n\nfunction isUntypedError(obj) {\n    return obj instanceof Error &&\n        es5.getPrototypeOf(obj) === Error.prototype;\n}\n\nvar rErrorKey = /^(?:name|message|stack|cause)$/;\nfunction wrapAsOperationalError(obj) {\n    var ret;\n    if (isUntypedError(obj)) {\n        ret = new OperationalError(obj);\n        ret.name = obj.name;\n        ret.message = obj.message;\n        ret.stack = obj.stack;\n        var keys = es5.keys(obj);\n        for (var i = 0; i < keys.length; ++i) {\n            var key = keys[i];\n            if (!rErrorKey.test(key)) {\n                ret[key] = obj[key];\n            }\n        }\n        return ret;\n    }\n    util.markAsOriginatingFromRejection(obj);\n    return obj;\n}\n\nfunction nodebackForPromise(promise) {\n    return function(err, value) {\n        if (promise === null) return;\n\n        if (err) {\n            var wrapped = wrapAsOperationalError(maybeWrapAsError(err));\n            promise._attachExtraTrace(wrapped);\n            promise._reject(wrapped);\n        } else if (arguments.length > 2) {\n            var $_len = arguments.length;var args = new Array($_len - 1); for(var $_i = 1; $_i < $_len; ++$_i) {args[$_i - 1] = arguments[$_i];}\n            promise._fulfill(args);\n        } else {\n            promise._fulfill(value);\n        }\n\n        promise = null;\n    };\n}\n\n\nvar PromiseResolver;\nif (!haveGetters) {\n    PromiseResolver = function (promise) {\n        this.promise = promise;\n        this.asCallback = nodebackForPromise(promise);\n        this.callback = this.asCallback;\n    };\n}\nelse {\n    PromiseResolver = function (promise) {\n        this.promise = promise;\n    };\n}\nif (haveGetters) {\n    var prop = {\n        get: function() {\n            return nodebackForPromise(this.promise);\n        }\n    };\n    es5.defineProperty(PromiseResolver.prototype, \"asCallback\", prop);\n    es5.defineProperty(PromiseResolver.prototype, \"callback\", prop);\n}\n\nPromiseResolver._nodebackForPromise = nodebackForPromise;\n\nPromiseResolver.prototype.toString = function () {\n    return \"[object PromiseResolver]\";\n};\n\nPromiseResolver.prototype.resolve =\nPromiseResolver.prototype.fulfill = function (value) {\n    if (!(this instanceof PromiseResolver)) {\n        throw new TypeError(\"Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\\u000a\\u000a    See http://goo.gl/sdkXL9\\u000a\");\n    }\n    this.promise._resolveCallback(value);\n};\n\nPromiseResolver.prototype.reject = function (reason) {\n    if (!(this instanceof PromiseResolver)) {\n        throw new TypeError(\"Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\\u000a\\u000a    See http://goo.gl/sdkXL9\\u000a\");\n    }\n    this.promise._rejectCallback(reason);\n};\n\nPromiseResolver.prototype.progress = function (value) {\n    if (!(this instanceof PromiseResolver)) {\n        throw new TypeError(\"Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\\u000a\\u000a    See http://goo.gl/sdkXL9\\u000a\");\n    }\n    this.promise._progress(value);\n};\n\nPromiseResolver.prototype.cancel = function (err) {\n    this.promise.cancel(err);\n};\n\nPromiseResolver.prototype.timeout = function () {\n    this.reject(new TimeoutError(\"timeout\"));\n};\n\nPromiseResolver.prototype.isResolved = function () {\n    return this.promise.isResolved();\n};\n\nPromiseResolver.prototype.toJSON = function () {\n    return this.promise.toJSON();\n};\n\nmodule.exports = PromiseResolver;\n\n},{\"./errors.js\":11,\"./es5.js\":12,\"./util.js\":30}],23:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar THIS = {};\nvar util = _dereq_(\"./util.js\");\nvar nodebackForPromise = _dereq_(\"./promise_resolver.js\")\n    ._nodebackForPromise;\nvar withAppended = util.withAppended;\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar canEvaluate = util.canEvaluate;\nvar TypeError = _dereq_(\"./errors\").TypeError;\nvar defaultSuffix = \"Async\";\nvar defaultFilter = function(name, func) {\n    return util.isIdentifier(name) &&\n        name.charAt(0) !== \"_\" &&\n        !util.isClass(func);\n};\nvar defaultPromisified = {__isPromisified__: true};\n\nfunction isPromisified(fn) {\n    try {\n        return fn.__isPromisified__ === true;\n    }\n    catch (e) {\n        return false;\n    }\n}\n\nfunction hasPromisified(obj, key, suffix) {\n    var val = util.getDataPropertyOrDefault(obj, key + suffix,\n                                            defaultPromisified);\n    return val ? isPromisified(val) : false;\n}\nfunction checkValid(ret, suffix, suffixRegexp) {\n    for (var i = 0; i < ret.length; i += 2) {\n        var key = ret[i];\n        if (suffixRegexp.test(key)) {\n            var keyWithoutAsyncSuffix = key.replace(suffixRegexp, \"\");\n            for (var j = 0; j < ret.length; j += 2) {\n                if (ret[j] === keyWithoutAsyncSuffix) {\n                    throw new TypeError(\"Cannot promisify an API that has normal methods with '%s'-suffix\\u000a\\u000a    See http://goo.gl/iWrZbw\\u000a\"\n                        .replace(\"%s\", suffix));\n                }\n            }\n        }\n    }\n}\n\nfunction promisifiableMethods(obj, suffix, suffixRegexp, filter) {\n    var keys = util.inheritedDataKeys(obj);\n    var ret = [];\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        var value = obj[key];\n        var passesDefaultFilter = filter === defaultFilter\n            ? true : defaultFilter(key, value, obj);\n        if (typeof value === \"function\" &&\n            !isPromisified(value) &&\n            !hasPromisified(obj, key, suffix) &&\n            filter(key, value, obj, passesDefaultFilter)) {\n            ret.push(key, value);\n        }\n    }\n    checkValid(ret, suffix, suffixRegexp);\n    return ret;\n}\n\nvar escapeIdentRegex = function(str) {\n    return str.replace(/([$])/, \"\\\\$\");\n};\n\nvar makeNodePromisifiedEval;\nif (!true) {\nvar switchCaseArgumentOrder = function(likelyArgumentCount) {\n    var ret = [likelyArgumentCount];\n    var min = Math.max(0, likelyArgumentCount - 1 - 5);\n    for(var i = likelyArgumentCount - 1; i >= min; --i) {\n        ret.push(i);\n    }\n    for(var i = likelyArgumentCount + 1; i <= 5; ++i) {\n        ret.push(i);\n    }\n    return ret;\n};\n\nvar argumentSequence = function(argumentCount) {\n    return util.filledRange(argumentCount, \"arguments[\", \"]\");\n};\n\nvar parameterDeclaration = function(parameterCount) {\n    return util.filledRange(parameterCount, \"_arg\", \"\");\n};\n\nvar parameterCount = function(fn) {\n    if (typeof fn.length === \"number\") {\n        return Math.max(Math.min(fn.length, 1023 + 1), 0);\n    }\n    return 0;\n};\n\nvar generatePropertyAccess = function(key) {\n    if (util.isIdentifier(key)) {\n        return \".\" + key;\n    }\n    else return \"['\" + key.replace(/(['\\\\])/g, \"\\\\$1\") + \"']\";\n};\n\nmakeNodePromisifiedEval =\nfunction(callback, receiver, originalName, fn, suffix) {\n    var newParameterCount = Math.max(0, parameterCount(fn) - 1);\n    var argumentOrder = switchCaseArgumentOrder(newParameterCount);\n    var callbackName =\n        (typeof originalName === \"string\" && util.isIdentifier(originalName)\n            ? originalName + suffix\n            : \"promisified\");\n\n    function generateCallForArgumentCount(count) {\n        var args = argumentSequence(count).join(\", \");\n        var comma = count > 0 ? \", \" : \"\";\n        var ret;\n        if (typeof callback === \"string\") {\n            ret = \"                                                          \\n\\\n                this.method({{args}}, fn);                                   \\n\\\n                break;                                                       \\n\\\n            \".replace(\".method\", generatePropertyAccess(callback));\n        } else if (receiver === THIS) {\n            ret =  \"                                                         \\n\\\n                callback.call(this, {{args}}, fn);                           \\n\\\n                break;                                                       \\n\\\n            \";\n        } else if (receiver !== undefined) {\n            ret =  \"                                                         \\n\\\n                callback.call(receiver, {{args}}, fn);                       \\n\\\n                break;                                                       \\n\\\n            \";\n        } else {\n            ret =  \"                                                         \\n\\\n                callback({{args}}, fn);                                      \\n\\\n                break;                                                       \\n\\\n            \";\n        }\n        return ret.replace(\"{{args}}\", args).replace(\", \", comma);\n    }\n\n    function generateArgumentSwitchCase() {\n        var ret = \"\";\n        for(var i = 0; i < argumentOrder.length; ++i) {\n            ret += \"case \" + argumentOrder[i] +\":\" +\n                generateCallForArgumentCount(argumentOrder[i]);\n        }\n        var codeForCall;\n        if (typeof callback === \"string\") {\n            codeForCall = \"                                                  \\n\\\n                this.property.apply(this, args);                             \\n\\\n            \"\n                .replace(\".property\", generatePropertyAccess(callback));\n        } else if (receiver === THIS) {\n            codeForCall = \"                                                  \\n\\\n                callback.apply(this, args);                                  \\n\\\n            \";\n        } else {\n            codeForCall = \"                                                  \\n\\\n                callback.apply(receiver, args);                              \\n\\\n            \";\n        }\n\n        ret += \"                                                             \\n\\\n        default:                                                             \\n\\\n            var args = new Array(len + 1);                                   \\n\\\n            var i = 0;                                                       \\n\\\n            for (var i = 0; i < len; ++i) {                                  \\n\\\n               args[i] = arguments[i];                                       \\n\\\n            }                                                                \\n\\\n            args[i] = fn;                                                    \\n\\\n            [CodeForCall]                                                    \\n\\\n            break;                                                           \\n\\\n        \".replace(\"[CodeForCall]\", codeForCall);\n        return ret;\n    }\n\n    return new Function(\"Promise\",\n                        \"callback\",\n                        \"receiver\",\n                        \"withAppended\",\n                        \"maybeWrapAsError\",\n                        \"nodebackForPromise\",\n                        \"INTERNAL\",\"                                         \\n\\\n        var ret = function (Parameters) {                        \\n\\\n            'use strict';                                                    \\n\\\n            var len = arguments.length;                                      \\n\\\n            var promise = new Promise(INTERNAL);                             \\n\\\n            promise._captureStackTrace();                                    \\n\\\n            promise._setIsSpreadable();                                      \\n\\\n            var fn = nodebackForPromise(promise);                            \\n\\\n            try {                                                            \\n\\\n                switch(len) {                                                \\n\\\n                    [CodeForSwitchCase]                                      \\n\\\n                }                                                            \\n\\\n            } catch (e) {                                                    \\n\\\n                var wrapped = maybeWrapAsError(e);                           \\n\\\n                promise._attachExtraTrace(wrapped);                          \\n\\\n                promise._reject(wrapped);                                    \\n\\\n            }                                                                \\n\\\n            return promise;                                                  \\n\\\n        };                                                                   \\n\\\n        ret.__isPromisified__ = true;                                        \\n\\\n        return ret;                                                          \\n\\\n        \"\n        .replace(\"FunctionName\", callbackName)\n        .replace(\"Parameters\", parameterDeclaration(newParameterCount))\n        .replace(\"[CodeForSwitchCase]\", generateArgumentSwitchCase()))(\n            Promise,\n            callback,\n            receiver,\n            withAppended,\n            maybeWrapAsError,\n            nodebackForPromise,\n            INTERNAL\n        );\n};\n}\n\nfunction makeNodePromisifiedClosure(callback, receiver) {\n    function promisified() {\n        var _receiver = receiver;\n        if (receiver === THIS) _receiver = this;\n        if (typeof callback === \"string\") {\n            callback = _receiver[callback];\n        }\n        var promise = new Promise(INTERNAL);\n        promise._captureStackTrace();\n        promise._setIsSpreadable();\n        var fn = nodebackForPromise(promise);\n        try {\n            callback.apply(_receiver, withAppended(arguments, fn));\n        } catch(e) {\n            var wrapped = maybeWrapAsError(e);\n            promise._attachExtraTrace(wrapped);\n            promise._reject(wrapped);\n        }\n        return promise;\n    }\n    promisified.__isPromisified__ = true;\n    return promisified;\n}\n\nvar makeNodePromisified = canEvaluate\n    ? makeNodePromisifiedEval\n    : makeNodePromisifiedClosure;\n\nfunction promisifyAll(obj, suffix, filter, promisifier) {\n    var suffixRegexp = new RegExp(escapeIdentRegex(suffix) + \"$\");\n    var methods =\n        promisifiableMethods(obj, suffix, suffixRegexp, filter);\n\n    for (var i = 0, len = methods.length; i < len; i+= 2) {\n        var key = methods[i];\n        var fn = methods[i+1];\n        var promisifiedKey = key + suffix;\n        obj[promisifiedKey] = promisifier === makeNodePromisified\n                ? makeNodePromisified(key, THIS, key, fn, suffix)\n                : promisifier(fn, function() {\n                    return makeNodePromisified(key, THIS, key, fn, suffix);\n                });\n    }\n    util.toFastProperties(obj);\n    return obj;\n}\n\nfunction promisify(callback, receiver) {\n    return makeNodePromisified(callback, receiver, undefined, callback);\n}\n\nPromise.promisify = function (fn, receiver) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    }\n    if (isPromisified(fn)) {\n        return fn;\n    }\n    return promisify(fn, arguments.length < 2 ? THIS : receiver);\n};\n\nPromise.promisifyAll = function (target, options) {\n    if (typeof target !== \"function\" && typeof target !== \"object\") {\n        throw new TypeError(\"the target of promisifyAll must be an object or a function\\u000a\\u000a    See http://goo.gl/9ITlV0\\u000a\");\n    }\n    options = Object(options);\n    var suffix = options.suffix;\n    if (typeof suffix !== \"string\") suffix = defaultSuffix;\n    var filter = options.filter;\n    if (typeof filter !== \"function\") filter = defaultFilter;\n    var promisifier = options.promisifier;\n    if (typeof promisifier !== \"function\") promisifier = makeNodePromisified;\n\n    if (!util.isIdentifier(suffix)) {\n        throw new RangeError(\"suffix must be a valid identifier\\u000a\\u000a    See http://goo.gl/8FZo5V\\u000a\");\n    }\n\n    var keys = util.inheritedDataKeys(target, {includeHidden: true});\n    for (var i = 0; i < keys.length; ++i) {\n        var value = target[keys[i]];\n        if (keys[i] !== \"constructor\" &&\n            util.isClass(value)) {\n            promisifyAll(value.prototype, suffix, filter, promisifier);\n            promisifyAll(value, suffix, filter, promisifier);\n        }\n    }\n\n    return promisifyAll(target, suffix, filter, promisifier);\n};\n};\n\n\n},{\"./errors\":11,\"./promise_resolver.js\":22,\"./util.js\":30}],24:[function(_dereq_,module,exports){\n\"use strict\";\nfunction arrayMove(src, srcIndex, dst, dstIndex, len) {\n    for (var j = 0; j < len; ++j) {\n        dst[j + dstIndex] = src[j + srcIndex];\n        src[j + srcIndex] = void 0;\n    }\n}\n\nfunction Queue(capacity) {\n    this._capacity = capacity;\n    this._length = 0;\n    this._front = 0;\n}\n\nQueue.prototype._willBeOverCapacity = function (size) {\n    return this._capacity < size;\n};\n\nQueue.prototype._pushOne = function (arg) {\n    var length = this.length();\n    this._checkCapacity(length + 1);\n    var i = (this._front + length) & (this._capacity - 1);\n    this[i] = arg;\n    this._length = length + 1;\n};\n\nQueue.prototype._unshiftOne = function(value) {\n    var capacity = this._capacity;\n    this._checkCapacity(this.length() + 1);\n    var front = this._front;\n    var i = (((( front - 1 ) &\n                    ( capacity - 1) ) ^ capacity ) - capacity );\n    this[i] = value;\n    this._front = i;\n    this._length = this.length() + 1;\n};\n\nQueue.prototype.unshift = function(fn, receiver, arg) {\n    this._unshiftOne(arg);\n    this._unshiftOne(receiver);\n    this._unshiftOne(fn);\n};\n\nQueue.prototype.push = function (fn, receiver, arg) {\n    var length = this.length() + 3;\n    if (this._willBeOverCapacity(length)) {\n        this._pushOne(fn);\n        this._pushOne(receiver);\n        this._pushOne(arg);\n        return;\n    }\n    var j = this._front + length - 3;\n    this._checkCapacity(length);\n    var wrapMask = this._capacity - 1;\n    this[(j + 0) & wrapMask] = fn;\n    this[(j + 1) & wrapMask] = receiver;\n    this[(j + 2) & wrapMask] = arg;\n    this._length = length;\n};\n\nQueue.prototype.shift = function () {\n    var front = this._front,\n        ret = this[front];\n\n    this[front] = undefined;\n    this._front = (front + 1) & (this._capacity - 1);\n    this._length--;\n    return ret;\n};\n\nQueue.prototype.length = function () {\n    return this._length;\n};\n\nQueue.prototype._checkCapacity = function (size) {\n    if (this._capacity < size) {\n        this._resizeTo(this._capacity << 1);\n    }\n};\n\nQueue.prototype._resizeTo = function (capacity) {\n    var oldCapacity = this._capacity;\n    this._capacity = capacity;\n    var front = this._front;\n    var length = this._length;\n    var moveItemsCount = (front + length) & (oldCapacity - 1);\n    arrayMove(this, 0, this, oldCapacity, moveItemsCount);\n};\n\nmodule.exports = Queue;\n\n},{}],25:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL) {\nvar util = _dereq_(\"./util.js\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nfunction ReductionPromiseArray(promises, fn, accum, _each) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    this._preservedValues = _each === INTERNAL ? [] : null;\n    this._zerothIsAccum = (accum === undefined);\n    this._gotAccum = false;\n    this._reducingIndex = (this._zerothIsAccum ? 1 : 0);\n    this._valuesPhase = undefined;\n    var maybePromise = tryConvertToPromise(accum, this._promise);\n    var rejected = false;\n    var isPromise = maybePromise instanceof Promise;\n    if (isPromise) {\n        maybePromise = maybePromise._target();\n        if (maybePromise._isPending()) {\n            maybePromise._proxyPromiseArray(this, -1);\n        } else if (maybePromise._isFulfilled()) {\n            accum = maybePromise._value();\n            this._gotAccum = true;\n        } else {\n            this._reject(maybePromise._reason());\n            rejected = true;\n        }\n    }\n    if (!(isPromise || this._zerothIsAccum)) this._gotAccum = true;\n    this._callback = fn;\n    this._accum = accum;\n    if (!rejected) this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._init = function () {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function () {\n    if (this._gotAccum || this._zerothIsAccum) {\n        this._resolve(this._preservedValues !== null\n                        ? [] : this._accum);\n    }\n};\n\nReductionPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    values[index] = value;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var isEach = preservedValues !== null;\n    var gotAccum = this._gotAccum;\n    var valuesPhase = this._valuesPhase;\n    var valuesPhaseIndex;\n    if (!valuesPhase) {\n        valuesPhase = this._valuesPhase = new Array(length);\n        for (valuesPhaseIndex=0; valuesPhaseIndex<length; ++valuesPhaseIndex) {\n            valuesPhase[valuesPhaseIndex] = 0;\n        }\n    }\n    valuesPhaseIndex = valuesPhase[index];\n\n    if (index === 0 && this._zerothIsAccum) {\n        this._accum = value;\n        this._gotAccum = gotAccum = true;\n        valuesPhase[index] = ((valuesPhaseIndex === 0)\n            ? 1 : 2);\n    } else if (index === -1) {\n        this._accum = value;\n        this._gotAccum = gotAccum = true;\n    } else {\n        if (valuesPhaseIndex === 0) {\n            valuesPhase[index] = 1;\n        } else {\n            valuesPhase[index] = 2;\n            this._accum = value;\n        }\n    }\n    if (!gotAccum) return;\n\n    var callback = this._callback;\n    var receiver = this._promise._boundTo;\n    var ret;\n\n    for (var i = this._reducingIndex; i < length; ++i) {\n        valuesPhaseIndex = valuesPhase[i];\n        if (valuesPhaseIndex === 2) {\n            this._reducingIndex = i + 1;\n            continue;\n        }\n        if (valuesPhaseIndex !== 1) return;\n        value = values[i];\n        this._promise._pushContext();\n        if (isEach) {\n            preservedValues.push(value);\n            ret = tryCatch(callback).call(receiver, value, i, length);\n        }\n        else {\n            ret = tryCatch(callback)\n                .call(receiver, this._accum, value, i, length);\n        }\n        this._promise._popContext();\n\n        if (ret === errorObj) return this._reject(ret.e);\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            if (maybePromise._isPending()) {\n                valuesPhase[i] = 4;\n                return maybePromise._proxyPromiseArray(this, i);\n            } else if (maybePromise._isFulfilled()) {\n                ret = maybePromise._value();\n            } else {\n                return this._reject(maybePromise._reason());\n            }\n        }\n\n        this._reducingIndex = i + 1;\n        this._accum = ret;\n    }\n\n    this._resolve(isEach ? preservedValues : this._accum);\n};\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") return apiRejection(\"fn must be a function\\u000a\\u000a    See http://goo.gl/916lJJ\\u000a\");\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n};\n\n},{\"./util.js\":30}],26:[function(_dereq_,module,exports){\n\"use strict\";\nvar schedule;\nif (_dereq_(\"./util.js\").isNode) {\n    var version = process.version.split(\".\").map(Number);\n    schedule = (version[0] === 0 && version[1] > 10) || (version[0] > 0)\n        ? global.setImmediate : process.nextTick;\n}\nelse if (typeof MutationObserver !== \"undefined\") {\n    schedule = function(fn) {\n        var div = document.createElement(\"div\");\n        var observer = new MutationObserver(fn);\n        observer.observe(div, {attributes: true});\n        return function() { div.classList.toggle(\"foo\"); };\n    };\n    schedule.isStatic = true;\n}\nelse if (typeof setTimeout !== \"undefined\") {\n    schedule = function (fn) {\n        setTimeout(fn, 0);\n    };\n}\nelse {\n    schedule = function() {\n        throw new Error(\"No async scheduler available\\u000a\\u000a    See http://goo.gl/m3OTXk\\u000a\");\n    };\n}\nmodule.exports = schedule;\n\n},{\"./util.js\":30}],27:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nfunction PromiseInspection(promise) {\n    if (promise !== undefined) {\n        promise = promise._target();\n        this._bitField = promise._bitField;\n        this._settledValue = promise._settledValue;\n    }\n    else {\n        this._bitField = 0;\n        this._settledValue = undefined;\n    }\n}\n\nPromiseInspection.prototype.value = function () {\n    if (!this.isFulfilled()) {\n        throw new TypeError(\"cannot get fulfillment value of a non-fulfilled promise\\u000a\\u000a    See http://goo.gl/hc1DLj\\u000a\");\n    }\n    return this._settledValue;\n};\n\nPromiseInspection.prototype.error =\nPromiseInspection.prototype.reason = function () {\n    if (!this.isRejected()) {\n        throw new TypeError(\"cannot get rejection reason of a non-rejected promise\\u000a\\u000a    See http://goo.gl/hPuiwB\\u000a\");\n    }\n    return this._settledValue;\n};\n\nPromiseInspection.prototype.isFulfilled =\nPromise.prototype._isFulfilled = function () {\n    return (this._bitField & 268435456) > 0;\n};\n\nPromiseInspection.prototype.isRejected =\nPromise.prototype._isRejected = function () {\n    return (this._bitField & 134217728) > 0;\n};\n\nPromiseInspection.prototype.isPending =\nPromise.prototype._isPending = function () {\n    return (this._bitField & 402653184) === 0;\n};\n\nPromiseInspection.prototype.isResolved =\nPromise.prototype._isResolved = function () {\n    return (this._bitField & 402653184) > 0;\n};\n\nPromise.prototype.isPending = function() {\n    return this._target()._isPending();\n};\n\nPromise.prototype.isRejected = function() {\n    return this._target()._isRejected();\n};\n\nPromise.prototype.isFulfilled = function() {\n    return this._target()._isFulfilled();\n};\n\nPromise.prototype.isResolved = function() {\n    return this._target()._isResolved();\n};\n\nPromise.prototype._value = function() {\n    return this._settledValue;\n};\n\nPromise.prototype._reason = function() {\n    this._unsetRejectionIsUnhandled();\n    return this._settledValue;\n};\n\nPromise.prototype.value = function() {\n    var target = this._target();\n    if (!target.isFulfilled()) {\n        throw new TypeError(\"cannot get fulfillment value of a non-fulfilled promise\\u000a\\u000a    See http://goo.gl/hc1DLj\\u000a\");\n    }\n    return target._settledValue;\n};\n\nPromise.prototype.reason = function() {\n    var target = this._target();\n    if (!target.isRejected()) {\n        throw new TypeError(\"cannot get rejection reason of a non-rejected promise\\u000a\\u000a    See http://goo.gl/hPuiwB\\u000a\");\n    }\n    target._unsetRejectionIsUnhandled();\n    return target._settledValue;\n};\n\n\nPromise.PromiseInspection = PromiseInspection;\n};\n\n},{}],28:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar util = _dereq_(\"./util.js\");\nvar errorObj = util.errorObj;\nvar isObject = util.isObject;\n\nfunction tryConvertToPromise(obj, context) {\n    if (isObject(obj)) {\n        if (obj instanceof Promise) {\n            return obj;\n        }\n        else if (isAnyBluebirdPromise(obj)) {\n            var ret = new Promise(INTERNAL);\n            obj._then(\n                ret._fulfillUnchecked,\n                ret._rejectUncheckedCheckError,\n                ret._progressUnchecked,\n                ret,\n                null\n            );\n            return ret;\n        }\n        var then = util.tryCatch(getThen)(obj);\n        if (then === errorObj) {\n            if (context) context._pushContext();\n            var ret = Promise.reject(then.e);\n            if (context) context._popContext();\n            return ret;\n        } else if (typeof then === \"function\") {\n            return doThenable(obj, then, context);\n        }\n    }\n    return obj;\n}\n\nfunction getThen(obj) {\n    return obj.then;\n}\n\nvar hasProp = {}.hasOwnProperty;\nfunction isAnyBluebirdPromise(obj) {\n    return hasProp.call(obj, \"_promise0\");\n}\n\nfunction doThenable(x, then, context) {\n    var promise = new Promise(INTERNAL);\n    var ret = promise;\n    if (context) context._pushContext();\n    promise._captureStackTrace();\n    if (context) context._popContext();\n    var synchronous = true;\n    var result = util.tryCatch(then).call(x,\n                                        resolveFromThenable,\n                                        rejectFromThenable,\n                                        progressFromThenable);\n    synchronous = false;\n    if (promise && result === errorObj) {\n        promise._rejectCallback(result.e, true, true);\n        promise = null;\n    }\n\n    function resolveFromThenable(value) {\n        if (!promise) return;\n        if (x === value) {\n            promise._rejectCallback(\n                Promise._makeSelfResolutionError(), false, true);\n        } else {\n            promise._resolveCallback(value);\n        }\n        promise = null;\n    }\n\n    function rejectFromThenable(reason) {\n        if (!promise) return;\n        promise._rejectCallback(reason, synchronous, true);\n        promise = null;\n    }\n\n    function progressFromThenable(value) {\n        if (!promise) return;\n        if (typeof promise._progress === \"function\") {\n            promise._progress(value);\n        }\n    }\n    return ret;\n}\n\nreturn tryConvertToPromise;\n};\n\n},{\"./util.js\":30}],29:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar util = _dereq_(\"./util.js\");\nvar TimeoutError = Promise.TimeoutError;\n\nvar afterTimeout = function (promise, message) {\n    if (!promise.isPending()) return;\n    if (typeof message !== \"string\") {\n        message = \"operation timed out\";\n    }\n    var err = new TimeoutError(message);\n    util.markAsOriginatingFromRejection(err);\n    promise._attachExtraTrace(err);\n    promise._cancel(err);\n};\n\nvar afterValue = function(value) { return delay(+this).thenReturn(value); };\nvar delay = Promise.delay = function (value, ms) {\n    if (ms === undefined) {\n        ms = value;\n        value = undefined;\n        var ret = new Promise(INTERNAL);\n        setTimeout(function() { ret._fulfill(); }, ms);\n        return ret;\n    }\n    ms = +ms;\n    return Promise.resolve(value)._then(afterValue, null, null, ms, undefined);\n};\n\nPromise.prototype.delay = function (ms) {\n    return delay(this, ms);\n};\n\nfunction successClear(value) {\n    var handle = this;\n    if (handle instanceof Number) handle = +handle;\n    clearTimeout(handle);\n    return value;\n}\n\nfunction failureClear(reason) {\n    var handle = this;\n    if (handle instanceof Number) handle = +handle;\n    clearTimeout(handle);\n    throw reason;\n}\n\nPromise.prototype.timeout = function (ms, message) {\n    ms = +ms;\n    var ret = this.then().cancellable();\n    ret._cancellationParent = this;\n    var handle = setTimeout(function timeoutTimeout() {\n        afterTimeout(ret, message);\n    }, ms);\n    return ret._then(successClear, failureClear, undefined, handle, undefined);\n};\n\n};\n\n},{\"./util.js\":30}],30:[function(_dereq_,module,exports){\n\"use strict\";\nvar es5 = _dereq_(\"./es5.js\");\nvar canEvaluate = typeof navigator == \"undefined\";\nvar haveGetters = (function(){\n    try {\n        var o = {};\n        es5.defineProperty(o, \"f\", {\n            get: function () {\n                return 3;\n            }\n        });\n        return o.f === 3;\n    }\n    catch (e) {\n        return false;\n    }\n\n})();\n\nvar errorObj = {e: {}};\nvar tryCatchTarget;\nfunction tryCatcher() {\n    try {\n        return tryCatchTarget.apply(this, arguments);\n    } catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\nfunction tryCatch(fn) {\n    tryCatchTarget = fn;\n    return tryCatcher;\n}\n\nvar inherits = function(Child, Parent) {\n    var hasProp = {}.hasOwnProperty;\n\n    function T() {\n        this.constructor = Child;\n        this.constructor$ = Parent;\n        for (var propertyName in Parent.prototype) {\n            if (hasProp.call(Parent.prototype, propertyName) &&\n                propertyName.charAt(propertyName.length-1) !== \"$\"\n           ) {\n                this[propertyName + \"$\"] = Parent.prototype[propertyName];\n            }\n        }\n    }\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n    return Child.prototype;\n};\n\nfunction asString(val) {\n    return typeof val === \"string\" ? val : (\"\" + val);\n}\n\nfunction isPrimitive(val) {\n    return val == null || val === true || val === false ||\n        typeof val === \"string\" || typeof val === \"number\";\n\n}\n\nfunction isObject(value) {\n    return !isPrimitive(value);\n}\n\nfunction maybeWrapAsError(maybeError) {\n    if (!isPrimitive(maybeError)) return maybeError;\n\n    return new Error(asString(maybeError));\n}\n\nfunction withAppended(target, appendee) {\n    var len = target.length;\n    var ret = new Array(len + 1);\n    var i;\n    for (i = 0; i < len; ++i) {\n        ret[i] = target[i];\n    }\n    ret[i] = appendee;\n    return ret;\n}\n\nfunction getDataPropertyOrDefault(obj, key, defaultValue) {\n    if (es5.isES5) {\n        var desc = Object.getOwnPropertyDescriptor(obj, key);\n        if (desc != null) {\n            return desc.get == null && desc.set == null\n                    ? desc.value\n                    : defaultValue;\n        }\n    } else {\n        return {}.hasOwnProperty.call(obj, key) ? obj[key] : undefined;\n    }\n}\n\nfunction notEnumerableProp(obj, name, value) {\n    if (isPrimitive(obj)) return obj;\n    var descriptor = {\n        value: value,\n        configurable: true,\n        enumerable: false,\n        writable: true\n    };\n    es5.defineProperty(obj, name, descriptor);\n    return obj;\n}\n\n\nvar wrapsPrimitiveReceiver = (function() {\n    return this !== \"string\";\n}).call(\"string\");\n\nfunction thrower(r) {\n    throw r;\n}\n\nvar inheritedDataKeys = (function() {\n    if (es5.isES5) {\n        return function(obj, opts) {\n            var ret = [];\n            var visitedKeys = Object.create(null);\n            var getKeys = Object(opts).includeHidden\n                ? Object.getOwnPropertyNames\n                : Object.keys;\n            while (obj != null) {\n                var keys;\n                try {\n                    keys = getKeys(obj);\n                } catch (e) {\n                    return ret;\n                }\n                for (var i = 0; i < keys.length; ++i) {\n                    var key = keys[i];\n                    if (visitedKeys[key]) continue;\n                    visitedKeys[key] = true;\n                    var desc = Object.getOwnPropertyDescriptor(obj, key);\n                    if (desc != null && desc.get == null && desc.set == null) {\n                        ret.push(key);\n                    }\n                }\n                obj = es5.getPrototypeOf(obj);\n            }\n            return ret;\n        };\n    } else {\n        return function(obj) {\n            var ret = [];\n            /*jshint forin:false */\n            for (var key in obj) {\n                ret.push(key);\n            }\n            return ret;\n        };\n    }\n\n})();\n\nfunction isClass(fn) {\n    try {\n        if (typeof fn === \"function\") {\n            var keys = es5.keys(fn.prototype);\n            return keys.length > 0 &&\n                   !(keys.length === 1 && keys[0] === \"constructor\");\n        }\n        return false;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction toFastProperties(obj) {\n    /*jshint -W027*/\n    function f() {}\n    f.prototype = obj;\n    return f;\n    eval(obj);\n}\n\nvar rident = /^[a-z$_][a-z$_0-9]*$/i;\nfunction isIdentifier(str) {\n    return rident.test(str);\n}\n\nfunction filledRange(count, prefix, suffix) {\n    var ret = new Array(count);\n    for(var i = 0; i < count; ++i) {\n        ret[i] = prefix + i + suffix;\n    }\n    return ret;\n}\n\nfunction safeToString(obj) {\n    try {\n        return obj + \"\";\n    } catch (e) {\n        return \"[no string representation]\";\n    }\n}\n\nfunction markAsOriginatingFromRejection(e) {\n    try {\n        notEnumerableProp(e, \"isOperational\", true);\n    }\n    catch(ignore) {}\n}\n\nfunction originatesFromRejection(e) {\n    if (e == null) return false;\n    return ((e instanceof Error[\"__BluebirdErrorTypes__\"].OperationalError) ||\n        e[\"isOperational\"] === true);\n}\n\nfunction canAttachTrace(obj) {\n    return obj instanceof Error && es5.propertyIsWritable(obj, \"stack\");\n}\n\nvar ensureErrorObject = (function() {\n    if (!(\"stack\" in new Error())) {\n        return function(value) {\n            if (canAttachTrace(value)) return value;\n            try {throw new Error(safeToString(value));}\n            catch(err) {return err;}\n        };\n    } else {\n        return function(value) {\n            if (canAttachTrace(value)) return value;\n            return new Error(safeToString(value));\n        };\n    }\n})();\n\nfunction classString(obj) {\n    return {}.toString.call(obj);\n}\n\nvar ret = {\n    isClass: isClass,\n    isIdentifier: isIdentifier,\n    inheritedDataKeys: inheritedDataKeys,\n    getDataPropertyOrDefault: getDataPropertyOrDefault,\n    thrower: thrower,\n    isArray: es5.isArray,\n    haveGetters: haveGetters,\n    notEnumerableProp: notEnumerableProp,\n    isPrimitive: isPrimitive,\n    isObject: isObject,\n    canEvaluate: canEvaluate,\n    errorObj: errorObj,\n    tryCatch: tryCatch,\n    inherits: inherits,\n    withAppended: withAppended,\n    asString: asString,\n    maybeWrapAsError: maybeWrapAsError,\n    wrapsPrimitiveReceiver: wrapsPrimitiveReceiver,\n    toFastProperties: toFastProperties,\n    filledRange: filledRange,\n    toString: safeToString,\n    canAttachTrace: canAttachTrace,\n    ensureErrorObject: ensureErrorObject,\n    originatesFromRejection: originatesFromRejection,\n    markAsOriginatingFromRejection: markAsOriginatingFromRejection,\n    classString: classString,\n    isNode: typeof process !== \"undefined\" &&\n        classString(process).toLowerCase() === \"[object process]\"\n};\ntry {throw new Error(); } catch (e) {ret.lastLineError = e;}\nmodule.exports = ret;\n\n},{\"./es5.js\":12}]},{},[3])(3)\n});                    ;if (typeof window !== 'undefined' && window !== null) {                               window.P = window.Promise;                                                     } else if (typeof self !== 'undefined' && self !== null) {                             self.P = self.Promise;                                                         }\n","pre":true},"modules/devkit-core/src/clientapi/debugging/nativeShim.js":{"path":"modules/devkit-core/src/clientapi/debugging/nativeShim.js","friendlyPath":"..debugging.nativeShim","directory":"modules/devkit-core/src/clientapi/debugging/","filename":"nativeShim.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.PubSub');\njsio('import lib.Callback');\njsio('import device');\n\nexports.isShim = true;\nexports.backButton = new lib.PubSub();\nexports.dialogs = {\n  showDialog: function () {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",\"Showing a dialog!\");\n  },\n  showAppRater: function () {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",\"Showing rate dialog!\");\n  }\n};\n\nvar _withContacts = new lib.Callback();\n_withContacts.fire();\n\nexports.contacts = merge(new lib.PubSub(), {\n\n  getContactList: function () {\n    return [];\n  },\n\n  withContacts: function () { _withContacts.forward(arguments); },\n\n  sendAutomatedSMS: function (phone, msg, cb) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'Send Automated SMS:', phone, msg);\n    cb && cb();\n  },\n\n  sendSMS: function (phone, msg, cb) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'Send SMS:', phone, msg);\n    cb && cb();\n  },\n\n  getPicture: function (id) {\n    return null;\n  },\n\n  getPictures: function (ids) {\n    return null;\n  },\n\n  getPictureBase64: function (id) {\n    return null;\n  }\n\n});\n\nvar _withPhoneNumber = new lib.Callback();\n_withPhoneNumber.fire(null);\n\nvar _withPhoneNumber = new lib.Callback();\n_withPhoneNumber.fire(null);\n\nexports.profile = {\n  fullName: \"\",\n\n  getPicture: function (id) {\n    return null;\n  },\n\n  getPictureBase64: function (id) {\n    return null;\n  },\n\n  withPhoneNumber: function () { _withPhoneNumber.forward(arguments); }\n};\n\nexports.sound = {\n  playSound: function (url, volume) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: play a sound');\n  },\n  loadSound: function (url) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: load a sound');\n  },\n  pauseSound: function (url) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: pause a sound');\n  },\n  stopSound: function (url) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: stop a sound');\n  },\n  setVolume: function (url, volume) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: set the volume of a sound');\n  },\n  loadBackgroundMusic: function (url) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: load background music');\n  },\n  playBackgroundMusic: function (url) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: play background music');\n  },\n  registerMusic: function (url) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: register background music');\n  }\n};\n\nexports.events = {\n  registerHandler: function(eventName) {\n    // logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: register an event handler for the ' + eventName + ' event');\n  }\n};\n\nexports.plugins = {\n  sendEvent: function(plugin, eventName) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: send a ' + eventName + ' event to the ' + plugin + ' plugin');\n  },\n  sendRequest: function(plugin, name, cb) {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",'NATIVE shim: send a ' + name + ' request to the ' + plugin + ' plugin');\n  }\n};\n\nexports.alerts = new lib.PubSub();\nmerge(exports.alerts, {\n  onNotificationLoad: function () {},\n  showNotification: function () {\n    return -1;\n  },\n  showRecurringNotification: function () {\n    logger.LOG&&console.log(\"LOG\",\"..debugging.nativeShim\",\"Setting up a recurring notification!\");\n    return -1;\n  }\n});\n\nexports.social = new lib.PubSub();\n\nexports.isSimulator = function() { return device.isNativeSimulator; };\n\nif (!GLOBAL.NATIVE) {\n  GLOBAL.NATIVE = exports;\n}\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/lib/PubSub.js":{"path":"modules/devkit-core/node_modules/jsio/packages/lib/PubSub.js","friendlyPath":"lib.PubSub","directory":"modules/devkit-core/node_modules/jsio/packages/lib/","filename":"PubSub.js","baseMod":"lib","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/node_modules/jsio/packages/lib","src":"/**\n * Summary: inherit from lib.PubSub if a class wants publish/subscribe ability\n * Methods:\n *  - publish(signal, args...) - all subscribers to signal will be called\n *     with the list of arguments provided.\n *  - subscribe(signal, ctx, method, args...) - register a bound method\n *     to a signal.  Any args that are passed in will be the first args\n *     when the method is invoked during a publish.\n *  Usage notes: There is one special signal '__any'.  Any subscribers to\n *     '__any' will be called on every publish with the first publish\n *     argument being the signal itself (after any args passed in during\n *     the corresponding subscribe).\n *     Calling the super constructor is not required for descendants of\n *     lib.PubSub.\n */\n\njsio('from ..std.uuid import uuid');\n\nvar ctx = jsio.__env.global,\n\tSLICE = Array.prototype.slice;\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_lib_PubSub=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_lib_PubSub(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_lib_PubSub(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function () {};\n\n\tthis.publish = function (signal) {\n\t\tif (this._subscribers) {\n\t\t\tvar args = SLICE.call(arguments, 1);\n\t\t\tif (this._subscribers.__any) {\n\t\t\t\tvar anyArgs = [signal].concat(args),\n\t\t\t\t\tsubs = this._subscribers.__any.slice(0);\n\t\t\t\tfor(var i = 0, sub; sub = subs[i]; ++i) {\n\t\t\t\t\tsub.apply(ctx, anyArgs);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this._subscribers[signal]) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tvar subs = this._subscribers[signal].slice(0);\n\t\t\tfor (var i = 0, sub; sub = subs[i]; ++i) {\n\t\t\t\tsub.apply(ctx, args);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.subscribe = function (signal, ctx, method) {\n\t\tvar cb;\n\t\tif (arguments.length == 2) {\n\t\t\tcb = ctx;\n\t\t} else {\n\t\t\tcb = bind.apply(GLOBAL, SLICE.call(arguments, 1));\n\t\t\tcb._ctx = ctx; // references for unsubscription\n\t\t\tcb._method = method;\n\t\t}\n\n\t\tvar s = this._subscribers || (this._subscribers = {});\n\t\t(s[signal] || (s[signal] = [])).push(cb);\n\t\treturn this;\n\t};\n\n\tthis.subscribeOnce = function (signal, ctx, method) {\n\t\tvar args = arguments,\n\t\t\tcb = bind(this, function () {\n\t\t\t\tthis.unsubscribe(signal, cb);\n\t\t\t\tif (args.length == 2) {\n\t\t\t\t\tctx.apply(GLOBAL, arguments);\n\t\t\t\t} else {\n\t\t\t\t\tbind.apply(GLOBAL, SLICE.call(args, 1))\n\t\t\t\t\t\t.apply(GLOBAL, arguments);\n\t\t\t\t}\n\t\t\t});\n\n\t\tif (args.length >= 3) {\n\t\t\tcb._ctx = ctx;\n\t\t\tcb._method = method;\n\t\t}\n\n\t\treturn this.subscribe(signal, cb);\n\t};\n\n\t// If no method is specified, all subscriptions with a callback context\n\t// of ctx will be removed.\n\n\tthis.unsubscribe = function (signal, ctx, method) {\n\t\tif (!this._subscribers || !this._subscribers[signal]) {\n\t\t\treturn this;\n\t\t}\n\t\tvar subs = this._subscribers[signal];\n\t\tfor (var i = 0, c; c = subs[i]; ++i) {\n\t\t\tif (c == ctx || c._ctx == ctx && (!method || c._method == method)) {\n\t\t\t\tsubs.splice(i--, 1);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\t/**\n\t * EventEmitter-style API\n\t * http://nodejs.org/api/events.html\n\t */\n\n\tthis.listeners = function (type) {\n\t\tthis._subscribers = (this._subscribers ? this._subscribers : {});\n\t\treturn (this.hasOwnProperty.call(this._subscribers, type))\n\t\t\t? this._subscribers[type]\n\t\t\t: (this._subscribers[type] = []);\n\t};\n\n\tthis.addListener = this.on = function (type, f) {\n\t\tif (this.listeners(type).length + 1 > this._maxListeners && this._maxListeners !== 0) {\n\t\t\tif (typeof console !== \"undefined\") {\n\t\t\t\tconsole.warn(\"Possible EventEmitter memory leak detected. \" + this._subscribers[type].length + \" listeners added. Use emitter.setMaxListeners() to increase limit.\");\n\t\t\t}\n\t\t}\n\t\tthis.emit(\"newListener\", type, f);\n\t\treturn this.subscribe(type, this, f);\n\t};\n\n\tthis.once = function (type, f) {\n\t\treturn this.subscribeOnce(type, this, f);\n\t};\n\n\tthis.removeListener = function (type, f) {\n\t\tthis.unsubscribe(type, this, f);\n\t\treturn this;\n\t};\n\n\tthis.removeAllListeners = function (type) {\n\t\tif (this._subscribers) {\n\t\t\tfor (var k in this._subscribers) {\n\t\t\t\tif (type == null || type == k) {\n\t\t\t\t\tdelete this._subscribers[k];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.emit = function (type) {\n\t\tthis.publish.apply(this, arguments);\n\t\treturn this.listeners(type).length > 0;\n\t};\n\n\tthis._maxListeners = 10;\n\n\tthis.setMaxListeners = function (_maxListeners) {\n\t\tthis._maxListeners = _maxListeners;\n\t};\n\n\tthis.hasListeners = function (type) {\n\t\treturn this._subscribers && this._subscribers[type] && this._subscribers[type].length;\n\t};\n\n\t/**\n\t * listenTo for inverting control of #subscribe, #on, etc.\n\t * @param {object} obj something extending js.io's lib.PubSub\n\t * @param {string} name the event name to listen to\n\t * @param {callback} function to run on event\n\t * @return {this}\n\t */\n\tthis.listenTo = function (obj, name, callback) {\n\t\tvar listeningTo = this._listeningTo || (this._listeningTo = {});\n\t\tvar id = obj._listenId || (obj._listenId = uuid(8, 16));\n\t\tlisteningTo[id] = obj;\n\t\tobj.subscribe(name, this, callback);\n\t\treturn this;\n\t};\n\n\t/**\n\t * Stop listening to objects previously passed to `listenTo`.\n\t *\n\t * @example\n\t *     // Stop listening to all events on all objects\n\t *     this.stopListening();\n\t *\n\t *     // Stop listening to all events on `obj`\n\t *     this.stopListening(obj);\n\t *\n\t *     // Stop all of my callbacks for a given event\n\t *     this.stopListening(obj, name);\n\t *\n\t *     // Stop a single callback from firing\n\t *     this.stopListening(obj, name, callback);\n\t *\n\t * @param {object} [obj] object extending lib.PubSub and using listenTo\n\t * @param {string} [name] the event name to listen to\n\t * @param {callback} [callback] function to stop running\n\t * @return {this}\n\t */\n\tthis.stopListening = function (obj, name, callback) {\n\t\tvar events, names, retain, i, j, k, l, ev;\n\t\tvar listeningTo = this._listeningTo;\n\t\tif (!listeningTo) {\n\t\t\treturn this;\n\t\t}\n\n\t\tlogger.LOG&&console.log(\"LOG\",\"lib.PubSub\",obj);\n\t\tvar remove = !name && !callback;\n\t\tif (obj) {\n\t\t\t(listeningTo = {})[obj._listenId] = obj;\n\t\t}\n\n\t\tfor (var id in listeningTo) {\n\t\t\tobj = listeningTo[id];\n\n\t\t\tnames = name ? [name] : Object.keys(obj._subscribers);\n\t\t\tfor (i = 0, l = names.length; i < l; i++) {\n\t\t\t\tname = names[i];\n\t\t\t\tif (events = obj._subscribers[name]) {\n\t\t\t\t\tobj._subscribers[name] = retain = [];\n\t\t\t\t\tfor (j = 0, k = events.length; j < k; j++) {\n\t\t\t\t\t\tev = events[j];\n\t\t\t\t\t\tif ((callback && callback !== ev._method) ||\n\t\t\t\t\t\t\t\t(this && this !== ev._ctx)) {\n\t\t\t\t\t\t\tretain.push(ev);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!retain.length) delete obj._subscribers[name];\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (remove) {\n\t\t\t\tdelete this._listeningTo[id];\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n});\n\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/std/uuid.js":{"path":"modules/devkit-core/node_modules/jsio/packages/std/uuid.js","friendlyPath":"..std.uuid","directory":"modules/devkit-core/node_modules/jsio/packages/std/","filename":"uuid.js","src":"/*\nBased on Math.uuid.js 1.4 by Robert Kieffer\n\n----\nCopyright (c) 2008, Robert Kieffer\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n  * Redistributions of source code must retain the above copyright notice,\n\tthis list of conditions and the following disclaimer.\n  * Redistributions in binary form must reproduce the above copyright\n\tnotice, this list of conditions and the following disclaimer in the\n\tdocumentation and/or other materials provided with the distribution.\n  * Neither the name of Robert Kieffer nor the names of its contributors\n\tmay be used to endorse or promote products derived from this software\n\twithout specific prior written permission.\n  \nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\nAND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\nARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE\nLIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\nCONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\nSUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS\nINTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\nARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\nPOSSIBILITY OF SUCH DAMAGE.\n\n*/\n\n\n\n/*\n * Generate a random uuid.\n *\n * USAGE: uuid.uuid(length, radix)\n *   length - the desired number of characters\n *   radix  - the number of allowable values for each character.\n *\n * EXAMPLES:\n *   // No arguments  - returns RFC4122, version 4 ID\n *   >>> std.uuid()\n *   \"92329D39-6F5C-4520-ABFC-AAB64544E172\"\n * \n *   // One argument - returns ID of the specified length\n *   >>> std.uuid(15)\t // 15 character ID (default base=62)\n *   \"VcydxgltxrVZSTV\"\n *\n *   // Two arguments - returns ID of the specified length, and radix. (Radix must be <= 62)\n *   >>> std.uuid(8, 2)  // 8 character ID (base=2)\n *   \"01001010\"\n *   >>> std.uuid(8, 10) // 8 character ID (base=10)\n *   \"47473046\"\n *   >>> std.uuid(8, 16) // 8 character ID (base=16)\n *   \"098F4D35\"\n */\n\n\nvar CHARS = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''); \nexports.uuid = function (len, radix) {\n\tvar chars = CHARS, uuid = [], rnd = Math.random;\n\tradix = radix || chars.length;\n\n\tif (len) {\n\t\t// Compact form\n\t\tfor (var i = 0; i < len; i++) uuid[i] = chars[0 | rnd()*radix];\n\t} else {\n\t\t// rfc4122, version 4 form\n\t\tvar r;\n\n\t\t// rfc4122 requires these characters\n\t\tuuid[8] = uuid[13] = uuid[18] = uuid[23] = '-';\n\t\tuuid[14] = '4';\n\n\t\t// Fill in random data.  At i==19 set the high bits of clock sequence as\n\t\t// per rfc4122, sec. 4.1.5\n\t\tfor (var i = 0; i < 36; i++) {\n\t\t\tif (!uuid[i]) {\n\t\t\t\tr = 0 | rnd()*16;\n\t\t\t\tuuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r & 0xf];\n\t\t\t}\n\t\t}\n\t}\n\treturn uuid.join('');\n};\n\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/lib/Callback.js":{"path":"modules/devkit-core/node_modules/jsio/packages/lib/Callback.js","friendlyPath":"lib.Callback","directory":"modules/devkit-core/node_modules/jsio/packages/lib/","filename":"Callback.js","src":"var Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_lib_Callback=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_lib_Callback(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_lib_Callback(){return this.init&&this.init.apply(this,arguments)},function() {\n\n\tthis._fired = false;\n\tthis._id = 0;\n\tthis._pending = null;\n\n\tthis.init = function() { this._run = []; };\n\t\n\t/* fired is @deprecated in favor of hasFired*/\n\tthis.hasFired = this.fired = function() { return this._fired; } ;\n\n\t// preserve pending callbacks, but clear fired status\n\tthis.reset = function() { this._args = []; this._fired = false; };\n\n\t// clear fired status and remove any pending callbacks\n\tthis.clear = function() { this.reset(); this._run = []; this._pending = null; this._stat = null; };\n\n\t// a convenience function to proxy arguments to `this.run`: arguments passed as the first argument\n\tthis.forward = function(args) { this.run.apply(this, args); };\n\n\t// when the lib.Callback object fires, run a ctx, method, and\n\t// (optional) curried arguments or a single callback function\n\tthis.run = function(ctx, method) {\n\t\tvar f = method ? bind.apply(this, arguments) : ctx;\n\t\tif (f) {\n\t\t\tif (this._fired) {\n\t\t\t\tf.apply(this, this._args);\n\t\t\t} else {\n\t\t\t\tthis._run.push(f);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.runOrTimeout = function(onFire, onTimeout, duration) {\n\t\tif (!onFire && !onTimeout) { return; }\n\n\t\tif (this._fired) {\n\t\t\tonFire.apply(this, this._args);\n\t\t} else {\n\t\t\tvar f = bind(this, function() {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\tonFire.apply(this, this._args);\n\t\t\t});\n\n\t\t\tthis.run(f);\n\n\t\t\tvar timeout = setTimeout(bind(this, function() {\n\t\t\t\tfor (var i = 0, n = this._run.length; i < n; ++i) {\n\t\t\t\t\tif (this._run[i] == f) {\n\t\t\t\t\t\tthis._run.splice(i, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tonTimeout();\n\t\t\t}), duration);\n\t\t}\n\t};\n\n\tthis.fire = function() {\n\t\tif (this._fired) { return; }\n\t\tthis._fired = true;\n\n\t\tvar cbs = this._run;\n\t\tthis._args = arguments;\n\t\tfor(var i = 0, len = cbs.length; i < len; ++i) {\n\t\t\tif (cbs[i]) { cbs[i].apply(this, arguments); }\n\t\t}\n\t};\n\n\tthis.chain = function(id) {\n\t\tif (!this._pending) { this._pending = {}; }\n\t\tif (id === undefined) { id = this._id++; }\n\t\tthis._pending[id] = true;\n\n\t\tthis.reset();\n\t\treturn bind(this, '_deferred', id);\n\t};\n\n\tthis._deferred = function(id) {\n\t\tif (!this._stat) { this._stat = {}; }\n\t\tif (this._stat.hasOwnProperty(id)) { return; }\n\n\t\tthis._stat[id] = Array.prototype.slice.call(arguments, 1);\n\t\tvar pending = this._pending;\n\t\tdelete pending[id];\n\t\tfor (var id in pending) {\n\t\t\tif (pending.hasOwnProperty(id)) { return; }\n\t\t}\n\n\t\tthis.fire(this._stat);\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/device.js":{"path":"modules/devkit-core/modules/timestep/src/device.js","friendlyPath":"device","directory":"modules/devkit-core/modules/timestep/src/","filename":"device.js","baseMod":"device","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/modules/timestep/src/device","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module device;\n *\n * Namespace for the current device. Determines what device we're running using\n * navigator.userAgent. This namespace exposes various properties about the\n * current device, such as screen size, mobile/browser, pixel ratios, etc.\n *\n * Using device.get('...') imports device-specific implementations from\n *   timestep.env.* by default, or from packages registered using\n *   registerDevice().\n * Using device.importUI('...') imports rendering classes for DOM or canvas.\n *\n * @doc http://doc.gameclosure.com/api/device.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/device.md\n */\n\n/* globals jsio */\njsio('import event.Emitter as Emitter');\njsio('import util.setProperty');\n\nif (typeof navigator == 'undefined' || !navigator.userAgent) {\n\tlogger.WARN&&console.warn(\"WARN\",\"device\",'> Timestep was unable to determine your device! Please check that navigator.userAgent is defined.');\n\texports = {isUnknown: true};\n}\n\nvar ua = navigator.userAgent;\n\n/**\n * @namespace\n */\n\nvar _devices = {};\nexports.registerDevice = function (name, path) {\n\t_devices[name] = path;\n};\n\nexports.get = function (module) {\n\n\t// deprecated: InputPrompt used to be platform-specific\n\tif (module == 'InputPrompt') { return jsio('import ui.InputPrompt'); }\n\n\tvar path = _devices[exports.name] || 'platforms.browser';\n\treturn jsio('import ' + path + '.' + module, {dontExport: true, suppressErrors: true});\n};\n\nexports.importUI = function (module) {\n  var domOrCanvas = exports.useDOM ? 'dom' : 'canvas';\n  var importString = 'import ui.backend.' + domOrCanvas + '.' + module;\n  var importOpts = {dontExport: true, suppressErrors: true};\n  return jsio(importString, importOpts);\n};\n\nexports.isMobileNative = exports.isMobile = /TeaLeaf/.test(ua);\n\nlogger.LOG&&console.log(\"LOG\",\"device\",exports.isMobile ? 'on mobile device' : 'in web browser');\n\nexports.screen = new Emitter();\n\nvar devicePixelRatio = window.originalDevicePixelRatio || window.devicePixelRatio || 1;\n\n// @deprecated\nexports.devicePixelRatio = devicePixelRatio;\n\nexports.screen.devicePixelRatio = devicePixelRatio;\nexports.screen.width = window.screen.width * devicePixelRatio;\nexports.screen.height = window.screen.height * devicePixelRatio;\n\n// This is stubbed out unless available on the current device.\nexports.hideAddressBar = function () {};\n\nutil.setProperty(exports, 'defaultFontFamily', {\n\tcb: function (value) {\n\t\tjsio('import ui.resource.Font');\n\t\tui.resource.Font.setDefaultFontFamily(value);\n\t},\n\tvalue: 'Helvetica'\n});\nexports.defaultFontWeight = \"\";\n\nif ('ontouchstart' in window && (!/BlackBerry/.test(ua))) {\n\texports.events = {\n\t\tstart: 'touchstart',\n\t\tmove: 'touchmove',\n\t\tend: 'touchend'\n\t};\n} else {\n\texports.events = {\n\t\tstart: 'mousedown',\n\t\tmove: 'mousemove',\n\t\tend: 'mouseup'\n\t};\n}\n\nexports.isMobileBrowser = false;\nexports.isUIWebView = false;\nexports.isSafari = /Safari/.test(ua);\n\nexports.isSimulator = GLOBAL.CONFIG && !!CONFIG.simulator;\nif (exports.isSimulator) {\n\texports.isIOSSimulator = /iphone|ipod|ipad/i.test(CONFIG.simulator.deviceType);\n\n\t// Until we support more platforms, if it's not\n\t// iOS then it's assumed to be an Android device\n\texports.isAndroidSimulator = !exports.isIOSSimulator;\n\n\texports.isNativeSimulator = /^native/.test(CONFIG.target);\n} else {\n\texports.isAndroidSimulator = false;\n\texports.isIOSSimulator = false;\n\texports.isNativeSimulator = false;\n}\n\nif (exports.isMobile) {\n\texports.name = 'tealeaf';\n\texports.width = navigator.width;\n\texports.height = navigator.height;\n\texports.isAndroid = /Android/.test(ua);\n\tif (exports.isAndroid) {\n\t\texports.isTablet = navigator.width/devicePixelRatio >= 600;\n\t} else {\n\t\texports.isIPad = exports.isTablet = /iPad/.test(ua);\n\t\texports.isIPhone = /iPhone/.test(ua);\n\n\t\t// Until we support more platforms, if it's not\n\t\t// Android then it's assumed to be an iOS device\n\t\texports.isIOS = true;\n\t}\n} else {\n\tif (/(iPod|iPhone|iPad)/i.test(ua)) {\n\t\texports.name = 'browser';\n\t\texports.isMobileBrowser = true;\n\t\texports.isIOS = true;\n\n\t\tvar match = ua.match(/iPhone OS ([0-9]+)/);\n\t\texports.iosVersion = match && parseInt(match[1]);\n\t\texports.isUIWebView = !exports.isSafari;\n\n\t\texports.screen.defaultOrientation = 'portrait';\n\t\texports.screen.browserChrome = {\n\t\t\tportrait: {top: 20 * devicePixelRatio, bottom: 44 * devicePixelRatio},\n\t\t\tlandscape: {top: 20 * devicePixelRatio, bottom: 32 * devicePixelRatio}\n\t\t};\n\n\t} else if (/Mobile Safari/.test(ua) || /Android/.test(ua) || /BlackBerry/.test(ua)) {\n\t\texports.name = 'browser';\n\t\texports.isMobileBrowser = true;\n\t\texports.isAndroid = true;\n\n\t\texports.screen.width = window.outerWidth;\n\t\texports.screen.height = window.outerHeight - 1;\n\n\t\texports.screen.defaultOrientation = 'portrait';\n\t\texports.screen.browserChrome = {\n\t\t\tportrait: {top: 0, bottom: 0},\n\t\t\tlandscape: {top: 0, bottom: 0}\n\t\t};\n\t} else {\n\t\t// All other browsers\n\t\texports.screen.width = window.innerWidth;\n\t\texports.screen.height = window.innerHeight;\n\t\texports.name = 'browser';\n\t\texports.canResize = false;\n\t}\n\n\t// Set up device.width and device.height for browser case\n\texports.width = exports.screen.width;\n\texports.height = exports.screen.height;\n}\n\nexports.useDOM = false;\nexports.setUseDOM = function (useDOM) {\n\tconsole.warn(\"Attempting to set 'useDom' property, which is no longer supported.\")\n\treturn;\n}\n\nexports.getDimensions = function (isLandscape) {\n\tvar dMin = Math.min(exports.width, exports.height),\n\t\tdMax = Math.max(exports.width, exports.height);\n\n\treturn isLandscape\n\t\t? {height: dMin, width: dMax}\n\t\t: {height: dMax, width: dMin};\n}\n\n/**\n * Initialize the device. Called from somewhere else.\n */\n\nexports.init = function () {\n\tjsio('import ui.init');\n\texports.get('initialize').init();\n\texports.screen.width = exports.width;\n\texports.screen.height = exports.height;\n}\n\n/**\n * Event handlers\n */\nexports.setBackButtonHandler = function (handler) {\n\tNATIVE && (NATIVE.onBackButton = handler);\n}\n\nexports.setRotationHandler = function (handler) {\n\tNATIVE && (NATIVE.onRotation = handler);\n}\n\n/*\n * Stay awake\n */\nexports.stayAwake = function(enable) {\n\tNATIVE && NATIVE.stayAwake && NATIVE.stayAwake(enable);\n}\n\n/**\n * Garbage Collection\n */\nexports.collectGarbage = function () {\n\tlogger.LOG&&console.log(\"LOG\",\"device\",'collecting garbage');\n\tNATIVE && NATIVE.gc && NATIVE.gc.runGC();\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/event/Emitter.js":{"path":"modules/devkit-core/modules/timestep/src/event/Emitter.js","friendlyPath":"event.Emitter","directory":"modules/devkit-core/modules/timestep/src/event/","filename":"Emitter.js","baseMod":"event","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/modules/timestep/src/event","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.Emitter;\n * Namespace shim to bring in PubSub from jsio.\n *\n * @doc http://doc.gameclosure.com/api/event.html#class-event.emitter\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/event.md\n */\n\njsio('import lib.PubSub as exports');\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/setProperty.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/setProperty.js","friendlyPath":"util.setProperty","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"setProperty.js","baseMod":"util","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/node_modules/jsio/packages/util","src":"function createGetter(ctx, name) {\n\treturn function() {\n\t\treturn this[name];\n\t}\n}\n\nfunction createSetter(ctx, name, callback, initialValue) {\n\tif (initialValue !== undefined) {\n\t\tctx[name] = initialValue;\n\t}\n\t\n\tif (typeof callback == 'function') {\n\t\treturn function(value) {\n\t\t\tif (this[name] !== value) {\n\t\t\t\tvar old = this[name];\n\t\t\t\tthis[name] = value;\n\t\t\t\tcallback.call(this, name, value, old);\n\t\t\t}\n\t\t}\n\t} else if (typeof callback == 'string') {\n\t\treturn function(value) {\n\t\t\tif (this[name] !== value) {\n\t\t\t\tvar old = this[name];\n\t\t\t\tthis[name] = value;\n\t\t\t\tthis[callback](name, value, old);\n\t\t\t}\n\t\t}\n\t} else {\n\t\treturn function(value) {\n\t\t\tthis[name] = value;\n\t\t}\n\t}\n}\n\nexports = function(ctx, name, def) {\n\tif (!def.get && !def.set && !def.cb && ('value' in def)) {\n\t\tctx[name] = def.value;\n\t} else {\n\t\tif (!def.get) { def.get = createGetter(ctx, '_' + name); }\n\t\tif (!def.set) { def.set = createSetter(ctx, '_' + name, def.cb, def.value); }\n\t\tif ('value' in def) { ctx['_' + name] = def.value; }\n\n\t\tdelete def.value;\n\t\tif (Object.defineProperty) {\n\t\t\tObject.defineProperty(ctx, name, def);\n\t\t\t// merge(def, {\n\t\t\t// \t\t\t\tconfigurable: false,\n\t\t\t// \t\t\t\tenumerable: true\n\t\t\t// \t\t\t});\n\t\t} else if (ctx.__defineSetter__) {\n\t\t\tctx.__defineSetter__(name, def.set);\n\t\t\tctx.__defineGetter__(name, def.get);\n\t\t} else {\n\t\t\tctx[name] = def.value;\n\t\t}\n\t}\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/doc.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/doc.js","friendlyPath":".doc","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"doc.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.PubSub');\njsio('import lib.Enum as Enum');\njsio('from util.browser import $');\n\njsio('import device');\n\nvar SCALING = Enum('FIXED', 'RESIZE', 'MANUAL');\nvar defaultScalingMode = !device.isMobileNative || device.simulating ? SCALING.RESIZE : SCALING.FIXED;\n\n/**\n * @extends lib.PubSub\n */\nDocument=__class__;var Document=Document(function Document(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\tthis.init = function () {\n\t\tif (!$) {\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tvar doc = GLOBAL.document,\n\t\t\tbody = doc && doc.body;\n\t\t\n\t\tthis._el = $({\n\t\t\tparent: body,\n\t\t\tstyle: {\n \t\t\t\tposition: 'absolute',\n\t\t\t\toverflow: 'hidden',\n\t\t\t\twidth: '100%',\n\t\t\t\theight: '100%'\n\t\t\t}\n\t\t});\n\t\t\n\t\tdevice.screen.subscribe('Resize', this, 'onResize');\n\t\t\n\t\tif (exports.postCreateHook) { exports.postCreateHook(this); }\n\t\tthis.setScalingMode(defaultScalingMode);\n\t}\n\t\n\tthis.unsubscribeResize = function () {\n\t\tdevice.screen.unsubscribe('Resize', this, 'onResize');\n\t}\n\t\n\tthis.setEngine = function (engine) {\n\t\tif (engine == this._engine) { return; }\n\t\t\n\t\tthis._engine = engine;\n\t\tthis._canvas = this._engine.getCanvas();\n\t\tthis.appendChild(this._canvas);\n\n\t\tif (this._canvas.getContext) {\n\t\t\tvar ctx = this._canvas.getContext(window.WebGLRenderingContext ? 'webgl' : '2d');\n\t\t\tif (ctx.setParentNode) {\n\t\t\t\tctx.setParentNode(this._el);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tthis.getElement = function () {\n\t\treturn this._el;\n\t};\n\t\n\tthis.setScalingMode = function (scalingMode, opts) {\n\t\tthis._scalingMode = scalingMode;\n\t\t\n\t\tvar el = this._el,\n\t\t\ts = el.style;\n\t\t\n\t\tswitch (scalingMode) {\n\t\t\tcase SCALING.FIXED:\n\t\t\t\topts = merge(opts, {\n\t\t\t\t\t\twidth: device.width,\n\t\t\t\t\t\theight: device.height\n\t\t\t\t\t});\n\t\t\t\ts.width = opts.width + 'px';\n\t\t\t\ts.height = opts.height + 'px';\n\t\t\t\tbreak;\n\t\t\tcase SCALING.RESIZE:\n\t\t\t\topts = merge(opts, {\n\t\t\t\t\t\tresizeCanvas: true\n\t\t\t\t\t});\n\t\t\t\t// fall through:\n\t\t\tcase SCALING.MANUAL:\n\t\t\t\ts.margin = '0px';\n\t\t\t\ts.width = '100%';\n\t\t\t\ts.height = '100%';\n\t\t\t\tbreak;\n\t\t}\n\t\t\n\t\tthis._scalingOpts = opts;\n\t\tthis.onResize();\n\t\tsetTimeout(bind(this, 'onResize'), 1000);\n\t}\n\t\n\tthis.onResize = function () {\n\t\tvar el = this._el;\n\t\tvar s = this._el.style;\n\t\t\n\t\tel.className = device.screen.orientation;\n\t\tlogger.LOG&&console.log(\"LOG\",\".doc\",'resize', device.width, device.height);\n\t\t\n\t\tvar width = device.width;\n\t\tvar height = device.height;\n\t\tvar mode = this._scalingMode;\n\t\tvar opts = this._scalingOpts;\n\t\t\n\t\tif (mode == SCALING.FIXED) {\n\t\t\twidth = opts.width;\n\t\t\theight = opts.height;\n\t\t}\n\t\t\n\t\t// enforce maxWidth/maxHeight\n\t\t// if maxWidth/maxHeight is met, switch a RESIZE scaling mode to FIXED (center the document on the screen)\n\t\tif (opts.maxWidth && width > opts.maxWidth) {\n\t\t\twidth = opts.maxWidth;\n\t\t\tif (mode == SCALING.RESIZE) { mode = SCALING.FIXED; }\n\t\t}\n\t\t\n\t\tif (opts.maxHeight && height > opts.maxHeight) {\n\t\t\theight = opts.maxHeight;\n\t\t\tif (mode == SCALING.RESIZE) { mode = SCALING.FIXED; }\n\t\t}\n\t\t\n\t\tswitch (mode) {\n\t\t\tcase SCALING.MANUAL:\n\t\t\t\tbreak; // do nothing\n\t\t\tcase SCALING.FIXED:\n\t\t\t\t// try to center the container\n\t\t\t\tel.style.top = Math.round(Math.max(0, (window.innerHeight - height) / 2)) + 'px';\n\t\t\t\tel.style.left = Math.round(Math.max(0, (window.innerWidth - width) / 2)) + 'px';\n\t\t\t\t\n\t\t\t\ts.width = width + 'px';\n\t\t\t\ts.height = height + 'px';\n\t\t\t\tbreak;\n\t\t\tcase SCALING.RESIZE:\n\t\t\t\t// if we have a canvas element, scale it\n\t\t\t\tif (opts.resizeCanvas && this._canvas\n\t\t\t\t\t\t&& (this._canvas.width != width || this._canvas.height != height)) {\n\t\t\t\t\tthis._canvas.width = width;\n\t\t\t\t\tthis._canvas.height = height;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\ts.width = width + 'px';\n\t\t\t\ts.height = height + 'px';\n\t\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// make sure to force a render immediately (should we use needsRepaint instead?)\n\t\tthis._setDim(width, height);\n\t\tif (this._engine) { this._engine.render(); }\n\t}\n\t\n\tthis._setDim = function (width, height) {\n\t\tif (this.width != width || this.height != height) {\n\t\t\tthis.width = width;\n\t\t\tthis.height = height;\n\t\t\tthis.publish('Resize', width, height);\n\t\t}\n\t}\n\t\n\tthis.setColors = function (bgColor, engineColor) {\n\t\tif (this._el) {\n\t\t\tthis._el.style.background = engineColor;\n\t\t\tdocument.documentElement.style.background = document.body.style.background = bgColor;\n\t\t}\n\t}\n\t\n\tthis.appendChild = function (el) {\n\t\tthis._el.appendChild(el);\n\t}\n\t\n\tthis.getOffset = function () {\n\t\treturn {\n\t\t\tx: this._el.offsetLeft,\n\t\t\ty: this._el.offsetTop\n\t\t};\n\t}\n});\n\nexports = new Document();\nexports.SCALING = SCALING;\n\nexports.setDocStyle = function () {\n\tvar doc = GLOBAL.document,\n\t\tbody = doc && doc.body;\n\t\n\tif (body) {\n\t\tvar docStyle = {\n\t\t\theight: '100%',\n\t\t\tmargin: '0px',\n\t\t\tpadding: '0px'\n\t\t};\n\t\n\t\t$.style(document.documentElement, docStyle);\n\t\t$.style(document.body, docStyle);\n\t}\n}\n\nexports.defaultParent = null;\nexports.postCreateHook = null;\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/lib/Enum.js":{"path":"modules/devkit-core/node_modules/jsio/packages/lib/Enum.js","friendlyPath":"lib.Enum","directory":"modules/devkit-core/node_modules/jsio/packages/lib/","filename":"Enum.js","src":"exports = function() {\n\tif (arguments.length == 1) {\n\t\tif (typeof arguments[0] == 'object') {\n\t\t\tvar obj = arguments[0];\n\t\t\tfor (var i in obj) {\n\t\t\t\tif (!(obj[i] in obj)) {\n\t\t\t\t\tobj[obj[i]] = i;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn obj;\n\t\t} else if (typeof arguments[0] != 'string') {\n\t\t\tkeys = arguments[0];\n\t\t}\n\t}\n\t\n\tif (!keys) { var keys = arguments; }\n\tvar obj = {};\n\tfor(var i = 0, len = keys.length; i < len; ++i) {\n\t\tif (keys[i]) {\n\t\t\tobj[keys[i]] = i + 1;\n\t\t}\n\t\tobj[i + 1] = keys[i];\n\t}\n\treturn obj;\n}","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/browser.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/browser.js","friendlyPath":"util.browser","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"browser.js","src":"jsio('external .sizzle import Sizzle');\n\njsio('import math.geom.Rect');\n\nfunction isWindow(el) {\n\treturn el && !$.isElement(el) && $.isElement(el.document);\n}\n\nvar singleId = /^#([\\w-]+)$/;\n\nvar $ = exports.$ = function(selector, win) {\n\tswitch(typeof selector) {\n\t\tcase 'object':\n\t\t\tif ($.isElement(selector)) {\n\t\t\t\treturn $.remove(selector);\n\t\t\t} else if ($.isElement(selector.document && selector.document.body)) {\n\t\t\t\treturn $.size(selector);\n\t\t\t}\n\t\t\treturn $.create(selector);\n\t\tcase 'string':\n\t\t\tif (singleId.test(selector)) { return $.id(selector.substring(1), win); }\n\t\t\treturn Sizzle.apply(GLOBAL, arguments);\n\t}\n}\n\nvar DOM2 = typeof HTMLElement === \"object\";\n$.isElement = DOM2\n\t? function(el) { return el && el instanceof HTMLElement; }\n\t: function(el) { return el && typeof el.nodeType == 'number' && typeof el.nodeName == 'string' };\n\n$.id = function(id, win) { return typeof id == 'string' ? (win || window).document.getElementById(id) : id; }\n\n$.apply = function(el, params) {\n\tif (params.attrs) {\n\t\tfor(attr in params.attrs) {\n\t\t\tel.setAttribute(attr, params.attrs[attr]);\n\t\t}\n\t}\n\n\tif (params.id) { el.id = params.id; }\n\tif (params.style) { $.style(el, params.style); }\n\tif (params.src) { el.src = params.src; }\n\tif (params['class'] || params['className']) {\n\t\tel.className = params['class'] || params['className'];\n\t}\n\n\tvar parent = params.parent || params.parentNode;\n\tif (parent && params.first) {\n\t\t$.insertBefore(parent, el, parent.firstChild);\n\t} else if (params.before) {\n\t\t$.insertBefore(params.before.parentNode || parent, el, params.before);\n\t} else if (params.after) {\n\t\t$.insertAfter(params.after.parentNode || parent, el, params.after);\n\t} else if (parent) {\n\t\tparent.appendChild(el);\n\t}\n\n\tif ('html' in params) { el.innerHTML = params.html; }\n\tif ('text' in params) { $.setText(el, params.text); }\n\n\tif (params.children) {\n\t\tvar c = params.children;\n\t\tfor (var i = 0, n = c.length; i < n; ++i) {\n\t\t\tel.appendChild($.isElement(c[i]) ? c[i] : $(c[i]));\n\t\t}\n\t}\n\n\treturn el;\n}\n\n$.insertBefore = function(parentNode, el, beforeNode) {\n\tif (!parentNode || !el) { return; }\n\tif (beforeNode && beforeNode.parentNode == parentNode) {\n\t\tparentNode.insertBefore(el, beforeNode);\n\t} else {\n\t\tparentNode.appendChild(el);\n\t}\n}\n\n$.insertAfter = function(parentNode, el, afterNode) {\n\tif (!parentNode || !el) { return; }\n\tif (!afterNode || afterNode.parentNode != parentNode) {\n\t\t$.insertBefore(parentNode, el, parentNode.firstChild);\n\t} else if (!afterNode.nextSibling) {\n\t\tparentNode.appendChild(el);\n\t} else {\n\t\tparentNode.insertBefore(el, afterNode.nextSibling);\n\t}\n}\n\n$.create = function(params) {\n\tvar doc = ((params && params.win) || window).document;\n\tif (!params || typeof params == 'string') {\n\t\treturn doc.createElement(params || 'div');\n\t};\n\n\treturn $.apply(params.el || doc.createElement(params.tag || params.tagName || 'div'), params);\n}\n\n$.show = function(el, how) { $.id(el).style.display = how || 'block'; }\n$.hide = function(el) { $.id(el).style.display = 'none'; }\n\n// accepts an array or a space-delimited string of classNames\n$.addClass = function(el, classNames) {\n\tif (!el) { return; }\n\tvar el = $.id(el);\n\tif (typeof classNames == \"string\") {\n\t\tclassNames = classNames.split(' ');\n\t}\n\n\tvar current = ' ' + el.className + ' ';\n\tfor (var i = 0, len = classNames.length; i < len; ++i) {\n\t\tvar c = classNames[i];\n\t\tif (current.indexOf(' ' + c + ' ') == -1) {\n\t\t\tcurrent += c + ' ';\n\t\t}\n\t}\n\n\tel.className = current.replace(/^\\s+|\\s+$/g, '');\n\treturn $;\n}\n\n/* returns true if the given className is found in the list of\n * classes on the given element.\n */\n$.hasClass = function(el, className) {\n\tif (!el) { return false; }\n\n\tvar el = $.id(el);\n\tvar classNames = el.className.split(' ');\n\n\tfor (var i = 0, len = classNames.length; i < len; ++i) {\n\t\tif (classNames[i].trim() === className) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\n$.getTag = function(from, tag) { return from.getElementsByTagName(tag); }\n\n$.removeClass = function(el, classNames) {\n\tif (!el) { return; }\n\tvar el = $.id(el);\n\tel.className = (' ' + el.className + ' ')\n\t\t.replace(' ', '  ')\n\t\t.replace(new RegExp('( ' + classNames.replace('\\s+', ' | ').replace('-','\\-') + ' )', 'g'), ' ')\n\t\t.replace(/\\s+/, ' ')\n\t\t.replace(/^\\s+|\\s+$/g, '');\n}\n\nfunction ieGetAlpha(el) {\n\ttry {\n\t\treturn el.filters.item(\"alpha\");\n\t} catch(e) {}\n\n\ttry {\n\t\treturn el.filters.item(\"progid:DXImageTransform.Microsoft.Alpha\");\n\t} catch(e) {}\n\n\treturn null;\n}\n\n$.style = function(el, style) {\n\tif(el instanceof Array) {\n\t\tfor(var i = 0, o; o = el[i]; ++i) { $.style(o, style); }\n\t\treturn;\n\t}\n\n\tel = $.id(el);\n\tvar s = el.style;\n\tfor(prop in style) {\n\t\tswitch(prop) {\n\t\t\tcase 'styleFloat':\n\t\t\tcase 'cssFloat':\n\t\t\tcase 'float':\n\t\t\t\ts.styleFloat = s.cssFloat = style[prop];\n\t\t\t\tbreak;\n\t\t\tcase 'opacity':\n\t\t\t\ts.opacity = style[prop];\n\t\t\t\tif(el.filters) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvar alpha = ieGetAlpha();\n\t\t\t\t\t\tvar opacity = style[prop] == 1 ? 99.99 : style[prop] * 100;\n\t\t\t\t\t\tif(!alpha) {\n\t\t\t\t\t\t\t// TODO: this might destroy any existing filters?\n\t\t\t\t\t\t\ts.filter = \"alpha(opacity=\" + opacity + \")\";\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\talpha.Opacity = opacity;\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch(e) {}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'borderRadius':\n\t\t\t\ts.borderRadius = s.MozBorderRadius = style[prop];\n\t\t\t\tbreak;\n\t\t\tcase 'boxSizing':\n\t\t\t\ts.MsBoxSizing = s.MozBoxSizing = s.WebkitBoxSizing = style[prop];\n\t\t\tdefault:\n\t\t\t\ts[prop] = style[prop];\n\t\t\t\tbreak;\n\t\t}\n\t}\n};\n\n$.onEvent = function(el, name, f) {\n\tif (typeof f != 'function') {\n\t\tf = bind.apply(GLOBAL, Array.prototype.slice.call(arguments, 2));\n\t}\n\n\tvar handler = f;\n\n\tel = $.id(el);\n\tif(el.addEventListener) {\n\t\tel.addEventListener(name, handler, false);\n\t} else {\n\t\thandler = function(e) {\n\t\t\tvar evt = e || window.event;\n\t\t\t// TODO: normalize the event object\n\t\t\tf(evt);\n\t\t};\n\n\t\tel.attachEvent('on' + name, handler);\n\t}\n\n\treturn bind($, 'removeEvent', el, name, handler);\n};\n\n$.removeEvent = function(el, name, f) {\n\tel = $.id(el);\n\tif (el.addEventListener) {\n\t\tel.removeEventListener(name, f, false);\n\t} else {\n\t\tel.detachEvent('on' + name, f);\n\t}\n}\n\n$.stopEvent = function(e) {\n\tif (e) {\n\t\te.cancelBubble = true;\n\t\tif(e.stopPropagation) e.stopPropagation();\n\t\tif(e.preventDefault) e.preventDefault();\n\t}\n}\n\n$.setText = function(el, text) {\n\tel = $.id(el);\n\ttext = String(text);\n\tif ('textContent' in el) {\n\t\tel.textContent = text;\n\t} else if ('innerText' in el) {\n\t\tel.innerText = text.replace(/\\n/g, ' ');\n\t} else {\n\t\tel.innerHTML = '';\n\t\tel.appendChild(document.createTextNode(text));\n\t}\n}\n\n$.setValue = function(el, value) {\n\tel = $.id(el);\n\tif ('value' in el) {\n\t\tel.value = value;\n\t} else if ('value' in el.firstChild) {\n\t\tel.firstChild.value = value;\n\t}\n};\n\n$.remove = function(el) {\n\tel = $.id(el);\n\tif(el && el.parentNode) {\n\t\tel.parentNode.removeChild(el);\n\t}\n}\n\n$.cursorPos = function(ev, el) {\n\tvar offset = $.pos(el);\n\toffset.top = ev.clientY - offset.top + (window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop);\n\toffset.left = ev.clientX - offset.left + (window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft);\n\treturn offset;\n}\n\n$.pos = function(el) {\n\tvar parent = el;\n\tvar offset = {top: 0, left: 0};\n\twhile(parent && parent != document.body) {\n\t\toffset.left += parent.offsetLeft;\n\t\toffset.top += parent.offsetTop;\n\t\twhile(parent.offsetParent != parent.parentNode) {\n\t\t\toffset.top -= parent.scrollTop; offset.left -= parent.scrollLeft;\n\t\t\tparent = parent.parentNode;\n\t\t}\n\t\tparent = parent.offsetParent;\n\t}\n\treturn offset;\n}\n\n$.size = function(el) {\n\tif ($.isElement(el)) {\n\t\treturn {width: el.offsetWidth, height: el.offsetHeight};\n\t} else if (el.document) {\n\t\tvar doc = el.document.documentElement || el.document.body;\n\t\treturn new math.geom.Rect(\n\t\t\tdoc.offsetTop,\n\t\t\tdoc.offsetLeft,\n\t\t\tel.innerWidth || (doc.clientWidth || doc.clientWidth),\n\t\t\tel.innerHeight || (doc.clientHeight || doc.clientHeight)\n\t\t);\n\t}\n}\n\n$.insertCSSFile = function(filename) {\n\tdocument.getElementsByTagName('head')[0].appendChild($({\n\t\ttag: 'link',\n\t\tattrs: {\n\t\t\trel: 'stylesheet',\n\t\t\ttype: 'text/css',\n\t\t\thref: filename\n\t\t}\n\t}));\n}\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/sizzle.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/sizzle.js","friendlyPath":".sizzle","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"sizzle.js","src":"/*!\n * Sizzle CSS Selector Engine - v1.0\n *  Copyright 2009, The Dojo Foundation\n *  Released under the MIT, BSD, and GPL Licenses.\n *  More information: http://sizzlejs.com/\n */\n\nSizzle = (function(){\n\nvar chunker = /((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^[\\]]*\\]|['\"][^'\"]*['\"]|[^[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?/g,\n\tdone = 0,\n\ttoString = Object.prototype.toString,\n\thasDuplicate = false;\n\nvar Sizzle = function(selector, context, results, seed) {\n\tresults = results || [];\n\tvar origContext = context = context || document;\n\n\tif ( context.nodeType !== 1 && context.nodeType !== 9 ) {\n\t\treturn [];\n\t}\n\t\n\tif ( !selector || typeof selector !== \"string\" ) {\n\t\treturn results;\n\t}\n\n\tvar parts = [], m, set, checkSet, check, mode, extra, prune = true, contextXML = isXML(context);\n\t\n\t// Reset the position of the chunker regexp (start from head)\n\tchunker.lastIndex = 0;\n\t\n\twhile ( (m = chunker.exec(selector)) !== null ) {\n\t\tparts.push( m[1] );\n\t\t\n\t\tif ( m[2] ) {\n\t\t\textra = RegExp.rightContext;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif ( parts.length > 1 && origPOS.exec( selector ) ) {\n\t\tif ( parts.length === 2 && Expr.relative[ parts[0] ] ) {\n\t\t\tset = posProcess( parts[0] + parts[1], context );\n\t\t} else {\n\t\t\tset = Expr.relative[ parts[0] ] ?\n\t\t\t\t[ context ] :\n\t\t\t\tSizzle( parts.shift(), context );\n\n\t\t\twhile ( parts.length ) {\n\t\t\t\tselector = parts.shift();\n\n\t\t\t\tif ( Expr.relative[ selector ] )\n\t\t\t\t\tselector += parts.shift();\n\n\t\t\t\tset = posProcess( selector, set );\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// Take a shortcut and set the context if the root selector is an ID\n\t\t// (but not if it'll be faster if the inner selector is an ID)\n\t\tif ( !seed && parts.length > 1 && context.nodeType === 9 && !contextXML &&\n\t\t\t\tExpr.match.ID.test(parts[0]) && !Expr.match.ID.test(parts[parts.length - 1]) ) {\n\t\t\tvar ret = Sizzle.find( parts.shift(), context, contextXML );\n\t\t\tcontext = ret.expr ? Sizzle.filter( ret.expr, ret.set )[0] : ret.set[0];\n\t\t}\n\n\t\tif ( context ) {\n\t\t\tvar ret = seed ?\n\t\t\t\t{ expr: parts.pop(), set: makeArray(seed) } :\n\t\t\t\tSizzle.find( parts.pop(), parts.length === 1 && (parts[0] === \"~\" || parts[0] === \"+\") && context.parentNode ? context.parentNode : context, contextXML );\n\t\t\tset = ret.expr ? Sizzle.filter( ret.expr, ret.set ) : ret.set;\n\n\t\t\tif ( parts.length > 0 ) {\n\t\t\t\tcheckSet = makeArray(set);\n\t\t\t} else {\n\t\t\t\tprune = false;\n\t\t\t}\n\n\t\t\twhile ( parts.length ) {\n\t\t\t\tvar cur = parts.pop(), pop = cur;\n\n\t\t\t\tif ( !Expr.relative[ cur ] ) {\n\t\t\t\t\tcur = \"\";\n\t\t\t\t} else {\n\t\t\t\t\tpop = parts.pop();\n\t\t\t\t}\n\n\t\t\t\tif ( pop == null ) {\n\t\t\t\t\tpop = context;\n\t\t\t\t}\n\n\t\t\t\tExpr.relative[ cur ]( checkSet, pop, contextXML );\n\t\t\t}\n\t\t} else {\n\t\t\tcheckSet = parts = [];\n\t\t}\n\t}\n\n\tif ( !checkSet ) {\n\t\tcheckSet = set;\n\t}\n\n\tif ( !checkSet ) {\n\t\tthrow \"Syntax error, unrecognized expression: \" + (cur || selector);\n\t}\n\n\tif ( toString.call(checkSet) === \"[object Array]\" ) {\n\t\tif ( !prune ) {\n\t\t\tresults.push.apply( results, checkSet );\n\t\t} else if ( context && context.nodeType === 1 ) {\n\t\t\tfor ( var i = 0; checkSet[i] != null; i++ ) {\n\t\t\t\tif ( checkSet[i] && (checkSet[i] === true || checkSet[i].nodeType === 1 && contains(context, checkSet[i])) ) {\n\t\t\t\t\tresults.push( set[i] );\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tfor ( var i = 0; checkSet[i] != null; i++ ) {\n\t\t\t\tif ( checkSet[i] && checkSet[i].nodeType === 1 ) {\n\t\t\t\t\tresults.push( set[i] );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else {\n\t\tmakeArray( checkSet, results );\n\t}\n\n\tif ( extra ) {\n\t\tSizzle( extra, origContext, results, seed );\n\t\tSizzle.uniqueSort( results );\n\t}\n\n\treturn results;\n};\n\nSizzle.uniqueSort = function(results){\n\tif ( sortOrder ) {\n\t\thasDuplicate = false;\n\t\tresults.sort(sortOrder);\n\n\t\tif ( hasDuplicate ) {\n\t\t\tfor ( var i = 1; i < results.length; i++ ) {\n\t\t\t\tif ( results[i] === results[i-1] ) {\n\t\t\t\t\tresults.splice(i--, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};\n\nSizzle.matches = function(expr, set){\n\treturn Sizzle(expr, null, null, set);\n};\n\nSizzle.find = function(expr, context, isXML){\n\tvar set, match;\n\n\tif ( !expr ) {\n\t\treturn [];\n\t}\n\n\tfor ( var i = 0, l = Expr.order.length; i < l; i++ ) {\n\t\tvar type = Expr.order[i], match;\n\t\t\n\t\tif ( (match = Expr.match[ type ].exec( expr )) ) {\n\t\t\tvar left = RegExp.leftContext;\n\n\t\t\tif ( left.substr( left.length - 1 ) !== \"\\\\\" ) {\n\t\t\t\tmatch[1] = (match[1] || \"\").replace(/\\\\/g, \"\");\n\t\t\t\tset = Expr.find[ type ]( match, context, isXML );\n\t\t\t\tif ( set != null ) {\n\t\t\t\t\texpr = expr.replace( Expr.match[ type ], \"\" );\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif ( !set ) {\n\t\tset = context.getElementsByTagName(\"*\");\n\t}\n\n\treturn {set: set, expr: expr};\n};\n\nSizzle.filter = function(expr, set, inplace, not){\n\tvar old = expr, result = [], curLoop = set, match, anyFound,\n\t\tisXMLFilter = set && set[0] && isXML(set[0]);\n\n\twhile ( expr && set.length ) {\n\t\tfor ( var type in Expr.filter ) {\n\t\t\tif ( (match = Expr.match[ type ].exec( expr )) != null ) {\n\t\t\t\tvar filter = Expr.filter[ type ], found, item;\n\t\t\t\tanyFound = false;\n\n\t\t\t\tif ( curLoop == result ) {\n\t\t\t\t\tresult = [];\n\t\t\t\t}\n\n\t\t\t\tif ( Expr.preFilter[ type ] ) {\n\t\t\t\t\tmatch = Expr.preFilter[ type ]( match, curLoop, inplace, result, not, isXMLFilter );\n\n\t\t\t\t\tif ( !match ) {\n\t\t\t\t\t\tanyFound = found = true;\n\t\t\t\t\t} else if ( match === true ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( match ) {\n\t\t\t\t\tfor ( var i = 0; (item = curLoop[i]) != null; i++ ) {\n\t\t\t\t\t\tif ( item ) {\n\t\t\t\t\t\t\tfound = filter( item, match, i, curLoop );\n\t\t\t\t\t\t\tvar pass = not ^ !!found;\n\n\t\t\t\t\t\t\tif ( inplace && found != null ) {\n\t\t\t\t\t\t\t\tif ( pass ) {\n\t\t\t\t\t\t\t\t\tanyFound = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tcurLoop[i] = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if ( pass ) {\n\t\t\t\t\t\t\t\tresult.push( item );\n\t\t\t\t\t\t\t\tanyFound = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( found !== undefined ) {\n\t\t\t\t\tif ( !inplace ) {\n\t\t\t\t\t\tcurLoop = result;\n\t\t\t\t\t}\n\n\t\t\t\t\texpr = expr.replace( Expr.match[ type ], \"\" );\n\n\t\t\t\t\tif ( !anyFound ) {\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Improper expression\n\t\tif ( expr == old ) {\n\t\t\tif ( anyFound == null ) {\n\t\t\t\tthrow \"Syntax error, unrecognized expression: \" + expr;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\told = expr;\n\t}\n\n\treturn curLoop;\n};\n\nvar Expr = Sizzle.selectors = {\n\torder: [ \"ID\", \"NAME\", \"TAG\" ],\n\tmatch: {\n\t\tID: /#((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,\n\t\tCLASS: /\\.((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,\n\t\tNAME: /\\[name=['\"]*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)['\"]*\\]/,\n\t\tATTR: /\\[\\s*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)\\s*(?:(\\S?=)\\s*(['\"]*)(.*?)\\3|)\\s*\\]/,\n\t\tTAG: /^((?:[\\w\\u00c0-\\uFFFF\\*_-]|\\\\.)+)/,\n\t\tCHILD: /:(only|nth|last|first)-child(?:\\((even|odd|[\\dn+-]*)\\))?/,\n\t\tPOS: /:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^-]|$)/,\n\t\tPSEUDO: /:((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)(?:\\((['\"]*)((?:\\([^\\)]+\\)|[^\\2\\(\\)]*)+)\\2\\))?/\n\t},\n\tattrMap: {\n\t\t\"class\": \"className\",\n\t\t\"for\": \"htmlFor\"\n\t},\n\tattrHandle: {\n\t\thref: function(elem){\n\t\t\treturn elem.getAttribute(\"href\");\n\t\t}\n\t},\n\trelative: {\n\t\t\"+\": function(checkSet, part, isXML){\n\t\t\tvar isPartStr = typeof part === \"string\",\n\t\t\t\tisTag = isPartStr && !/\\W/.test(part),\n\t\t\t\tisPartStrNotTag = isPartStr && !isTag;\n\n\t\t\tif ( isTag && !isXML ) {\n\t\t\t\tpart = part.toUpperCase();\n\t\t\t}\n\n\t\t\tfor ( var i = 0, l = checkSet.length, elem; i < l; i++ ) {\n\t\t\t\tif ( (elem = checkSet[i]) ) {\n\t\t\t\t\twhile ( (elem = elem.previousSibling) && elem.nodeType !== 1 ) {}\n\n\t\t\t\t\tcheckSet[i] = isPartStrNotTag || elem && elem.nodeName === part ?\n\t\t\t\t\t\telem || false :\n\t\t\t\t\t\telem === part;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ( isPartStrNotTag ) {\n\t\t\t\tSizzle.filter( part, checkSet, true );\n\t\t\t}\n\t\t},\n\t\t\">\": function(checkSet, part, isXML){\n\t\t\tvar isPartStr = typeof part === \"string\";\n\n\t\t\tif ( isPartStr && !/\\W/.test(part) ) {\n\t\t\t\tpart = isXML ? part : part.toUpperCase();\n\n\t\t\t\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\n\t\t\t\t\tvar elem = checkSet[i];\n\t\t\t\t\tif ( elem ) {\n\t\t\t\t\t\tvar parent = elem.parentNode;\n\t\t\t\t\t\tcheckSet[i] = parent.nodeName === part ? parent : false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\n\t\t\t\t\tvar elem = checkSet[i];\n\t\t\t\t\tif ( elem ) {\n\t\t\t\t\t\tcheckSet[i] = isPartStr ?\n\t\t\t\t\t\t\telem.parentNode :\n\t\t\t\t\t\t\telem.parentNode === part;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif ( isPartStr ) {\n\t\t\t\t\tSizzle.filter( part, checkSet, true );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"\": function(checkSet, part, isXML){\n\t\t\tvar doneName = done++, checkFn = dirCheck;\n\n\t\t\tif ( !/\\W/.test(part) ) {\n\t\t\t\tvar nodeCheck = part = isXML ? part : part.toUpperCase();\n\t\t\t\tcheckFn = dirNodeCheck;\n\t\t\t}\n\n\t\t\tcheckFn(\"parentNode\", part, doneName, checkSet, nodeCheck, isXML);\n\t\t},\n\t\t\"~\": function(checkSet, part, isXML){\n\t\t\tvar doneName = done++, checkFn = dirCheck;\n\n\t\t\tif ( typeof part === \"string\" && !/\\W/.test(part) ) {\n\t\t\t\tvar nodeCheck = part = isXML ? part : part.toUpperCase();\n\t\t\t\tcheckFn = dirNodeCheck;\n\t\t\t}\n\n\t\t\tcheckFn(\"previousSibling\", part, doneName, checkSet, nodeCheck, isXML);\n\t\t}\n\t},\n\tfind: {\n\t\tID: function(match, context, isXML){\n\t\t\tif ( typeof context.getElementById !== \"undefined\" && !isXML ) {\n\t\t\t\tvar m = context.getElementById(match[1]);\n\t\t\t\treturn m ? [m] : [];\n\t\t\t}\n\t\t},\n\t\tNAME: function(match, context, isXML){\n\t\t\tif ( typeof context.getElementsByName !== \"undefined\" ) {\n\t\t\t\tvar ret = [], results = context.getElementsByName(match[1]);\n\n\t\t\t\tfor ( var i = 0, l = results.length; i < l; i++ ) {\n\t\t\t\t\tif ( results[i].getAttribute(\"name\") === match[1] ) {\n\t\t\t\t\t\tret.push( results[i] );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn ret.length === 0 ? null : ret;\n\t\t\t}\n\t\t},\n\t\tTAG: function(match, context){\n\t\t\treturn context.getElementsByTagName(match[1]);\n\t\t}\n\t},\n\tpreFilter: {\n\t\tCLASS: function(match, curLoop, inplace, result, not, isXML){\n\t\t\tmatch = \" \" + match[1].replace(/\\\\/g, \"\") + \" \";\n\n\t\t\tif ( isXML ) {\n\t\t\t\treturn match;\n\t\t\t}\n\n\t\t\tfor ( var i = 0, elem; (elem = curLoop[i]) != null; i++ ) {\n\t\t\t\tif ( elem ) {\n\t\t\t\t\tif ( not ^ (elem.className && (\" \" + elem.className + \" \").indexOf(match) >= 0) ) {\n\t\t\t\t\t\tif ( !inplace )\n\t\t\t\t\t\t\tresult.push( elem );\n\t\t\t\t\t} else if ( inplace ) {\n\t\t\t\t\t\tcurLoop[i] = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\t\tID: function(match){\n\t\t\treturn match[1].replace(/\\\\/g, \"\");\n\t\t},\n\t\tTAG: function(match, curLoop){\n\t\t\tfor ( var i = 0; curLoop[i] === false; i++ ){}\n\t\t\treturn curLoop[i] && isXML(curLoop[i]) ? match[1] : match[1].toUpperCase();\n\t\t},\n\t\tCHILD: function(match){\n\t\t\tif ( match[1] == \"nth\" ) {\n\t\t\t\t// parse equations like 'even', 'odd', '5', '2n', '3n+2', '4n-1', '-n+6'\n\t\t\t\tvar test = /(-?)(\\d*)n((?:\\+|-)?\\d*)/.exec(\n\t\t\t\t\tmatch[2] == \"even\" && \"2n\" || match[2] == \"odd\" && \"2n+1\" ||\n\t\t\t\t\t!/\\D/.test( match[2] ) && \"0n+\" + match[2] || match[2]);\n\n\t\t\t\t// calculate the numbers (first)n+(last) including if they are negative\n\t\t\t\tmatch[2] = (test[1] + (test[2] || 1)) - 0;\n\t\t\t\tmatch[3] = test[3] - 0;\n\t\t\t}\n\n\t\t\t// TODO: Move to normal caching system\n\t\t\tmatch[0] = done++;\n\n\t\t\treturn match;\n\t\t},\n\t\tATTR: function(match, curLoop, inplace, result, not, isXML){\n\t\t\tvar name = match[1].replace(/\\\\/g, \"\");\n\t\t\t\n\t\t\tif ( !isXML && Expr.attrMap[name] ) {\n\t\t\t\tmatch[1] = Expr.attrMap[name];\n\t\t\t}\n\n\t\t\tif ( match[2] === \"~=\" ) {\n\t\t\t\tmatch[4] = \" \" + match[4] + \" \";\n\t\t\t}\n\n\t\t\treturn match;\n\t\t},\n\t\tPSEUDO: function(match, curLoop, inplace, result, not){\n\t\t\tif ( match[1] === \"not\" ) {\n\t\t\t\t// If we're dealing with a complex expression, or a simple one\n\t\t\t\tif ( chunker.exec(match[3]).length > 1 || /^\\w/.test(match[3]) ) {\n\t\t\t\t\tmatch[3] = Sizzle(match[3], null, null, curLoop);\n\t\t\t\t} else {\n\t\t\t\t\tvar ret = Sizzle.filter(match[3], curLoop, inplace, true ^ not);\n\t\t\t\t\tif ( !inplace ) {\n\t\t\t\t\t\tresult.push.apply( result, ret );\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} else if ( Expr.match.POS.test( match[0] ) || Expr.match.CHILD.test( match[0] ) ) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\treturn match;\n\t\t},\n\t\tPOS: function(match){\n\t\t\tmatch.unshift( true );\n\t\t\treturn match;\n\t\t}\n\t},\n\tfilters: {\n\t\tenabled: function(elem){\n\t\t\treturn elem.disabled === false && elem.type !== \"hidden\";\n\t\t},\n\t\tdisabled: function(elem){\n\t\t\treturn elem.disabled === true;\n\t\t},\n\t\tchecked: function(elem){\n\t\t\treturn elem.checked === true;\n\t\t},\n\t\tselected: function(elem){\n\t\t\t// Accessing this property makes selected-by-default\n\t\t\t// options in Safari work properly\n\t\t\telem.parentNode.selectedIndex;\n\t\t\treturn elem.selected === true;\n\t\t},\n\t\tparent: function(elem){\n\t\t\treturn !!elem.firstChild;\n\t\t},\n\t\tempty: function(elem){\n\t\t\treturn !elem.firstChild;\n\t\t},\n\t\thas: function(elem, i, match){\n\t\t\treturn !!Sizzle( match[3], elem ).length;\n\t\t},\n\t\theader: function(elem){\n\t\t\treturn /h\\d/i.test( elem.nodeName );\n\t\t},\n\t\ttext: function(elem){\n\t\t\treturn \"text\" === elem.type;\n\t\t},\n\t\tradio: function(elem){\n\t\t\treturn \"radio\" === elem.type;\n\t\t},\n\t\tcheckbox: function(elem){\n\t\t\treturn \"checkbox\" === elem.type;\n\t\t},\n\t\tfile: function(elem){\n\t\t\treturn \"file\" === elem.type;\n\t\t},\n\t\tpassword: function(elem){\n\t\t\treturn \"password\" === elem.type;\n\t\t},\n\t\tsubmit: function(elem){\n\t\t\treturn \"submit\" === elem.type;\n\t\t},\n\t\timage: function(elem){\n\t\t\treturn \"image\" === elem.type;\n\t\t},\n\t\treset: function(elem){\n\t\t\treturn \"reset\" === elem.type;\n\t\t},\n\t\tbutton: function(elem){\n\t\t\treturn \"button\" === elem.type || elem.nodeName.toUpperCase() === \"BUTTON\";\n\t\t},\n\t\tinput: function(elem){\n\t\t\treturn /input|select|textarea|button/i.test(elem.nodeName);\n\t\t}\n\t},\n\tsetFilters: {\n\t\tfirst: function(elem, i){\n\t\t\treturn i === 0;\n\t\t},\n\t\tlast: function(elem, i, match, array){\n\t\t\treturn i === array.length - 1;\n\t\t},\n\t\teven: function(elem, i){\n\t\t\treturn i % 2 === 0;\n\t\t},\n\t\todd: function(elem, i){\n\t\t\treturn i % 2 === 1;\n\t\t},\n\t\tlt: function(elem, i, match){\n\t\t\treturn i < match[3] - 0;\n\t\t},\n\t\tgt: function(elem, i, match){\n\t\t\treturn i > match[3] - 0;\n\t\t},\n\t\tnth: function(elem, i, match){\n\t\t\treturn match[3] - 0 == i;\n\t\t},\n\t\teq: function(elem, i, match){\n\t\t\treturn match[3] - 0 == i;\n\t\t}\n\t},\n\tfilter: {\n\t\tPSEUDO: function(elem, match, i, array){\n\t\t\tvar name = match[1], filter = Expr.filters[ name ];\n\n\t\t\tif ( filter ) {\n\t\t\t\treturn filter( elem, i, match, array );\n\t\t\t} else if ( name === \"contains\" ) {\n\t\t\t\treturn (elem.textContent || elem.innerText || \"\").indexOf(match[3]) >= 0;\n\t\t\t} else if ( name === \"not\" ) {\n\t\t\t\tvar not = match[3];\n\n\t\t\t\tfor ( var i = 0, l = not.length; i < l; i++ ) {\n\t\t\t\t\tif ( not[i] === elem ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\tCHILD: function(elem, match){\n\t\t\tvar type = match[1], node = elem;\n\t\t\tswitch (type) {\n\t\t\t\tcase 'only':\n\t\t\t\tcase 'first':\n\t\t\t\t\twhile ( (node = node.previousSibling) )  {\n\t\t\t\t\t\tif ( node.nodeType === 1 ) return false;\n\t\t\t\t\t}\n\t\t\t\t\tif ( type == 'first') return true;\n\t\t\t\t\tnode = elem;\n\t\t\t\tcase 'last':\n\t\t\t\t\twhile ( (node = node.nextSibling) )  {\n\t\t\t\t\t\tif ( node.nodeType === 1 ) return false;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\tcase 'nth':\n\t\t\t\t\tvar first = match[2], last = match[3];\n\n\t\t\t\t\tif ( first == 1 && last == 0 ) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar doneName = match[0],\n\t\t\t\t\t\tparent = elem.parentNode;\n\t\n\t\t\t\t\tif ( parent && (parent.sizcache !== doneName || !elem.nodeIndex) ) {\n\t\t\t\t\t\tvar count = 0;\n\t\t\t\t\t\tfor ( node = parent.firstChild; node; node = node.nextSibling ) {\n\t\t\t\t\t\t\tif ( node.nodeType === 1 ) {\n\t\t\t\t\t\t\t\tnode.nodeIndex = ++count;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} \n\t\t\t\t\t\tparent.sizcache = doneName;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tvar diff = elem.nodeIndex - last;\n\t\t\t\t\tif ( first == 0 ) {\n\t\t\t\t\t\treturn diff == 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn ( diff % first == 0 && diff / first >= 0 );\n\t\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tID: function(elem, match){\n\t\t\treturn elem.nodeType === 1 && elem.getAttribute(\"id\") === match;\n\t\t},\n\t\tTAG: function(elem, match){\n\t\t\treturn (match === \"*\" && elem.nodeType === 1) || elem.nodeName === match;\n\t\t},\n\t\tCLASS: function(elem, match){\n\t\t\treturn (\" \" + (elem.className || elem.getAttribute(\"class\")) + \" \")\n\t\t\t\t.indexOf( match ) > -1;\n\t\t},\n\t\tATTR: function(elem, match){\n\t\t\tvar name = match[1],\n\t\t\t\tresult = Expr.attrHandle[ name ] ?\n\t\t\t\t\tExpr.attrHandle[ name ]( elem ) :\n\t\t\t\t\telem[ name ] != null ?\n\t\t\t\t\t\telem[ name ] :\n\t\t\t\t\t\telem.getAttribute( name ),\n\t\t\t\tvalue = result + \"\",\n\t\t\t\ttype = match[2],\n\t\t\t\tcheck = match[4];\n\n\t\t\treturn result == null ?\n\t\t\t\ttype === \"!=\" :\n\t\t\t\ttype === \"=\" ?\n\t\t\t\tvalue === check :\n\t\t\t\ttype === \"*=\" ?\n\t\t\t\tvalue.indexOf(check) >= 0 :\n\t\t\t\ttype === \"~=\" ?\n\t\t\t\t(\" \" + value + \" \").indexOf(check) >= 0 :\n\t\t\t\t!check ?\n\t\t\t\tvalue && result !== false :\n\t\t\t\ttype === \"!=\" ?\n\t\t\t\tvalue != check :\n\t\t\t\ttype === \"^=\" ?\n\t\t\t\tvalue.indexOf(check) === 0 :\n\t\t\t\ttype === \"$=\" ?\n\t\t\t\tvalue.substr(value.length - check.length) === check :\n\t\t\t\ttype === \"|=\" ?\n\t\t\t\tvalue === check || value.substr(0, check.length + 1) === check + \"-\" :\n\t\t\t\tfalse;\n\t\t},\n\t\tPOS: function(elem, match, i, array){\n\t\t\tvar name = match[2], filter = Expr.setFilters[ name ];\n\n\t\t\tif ( filter ) {\n\t\t\t\treturn filter( elem, i, match, array );\n\t\t\t}\n\t\t}\n\t}\n};\n\nvar origPOS = Expr.match.POS;\n\nfor ( var type in Expr.match ) {\n\tExpr.match[ type ] = new RegExp( Expr.match[ type ].source + /(?![^\\[]*\\])(?![^\\(]*\\))/.source );\n}\n\nvar makeArray = function(array, results) {\n\tarray = Array.prototype.slice.call( array, 0 );\n\n\tif ( results ) {\n\t\tresults.push.apply( results, array );\n\t\treturn results;\n\t}\n\t\n\treturn array;\n};\n\n// Perform a simple check to determine if the browser is capable of\n// converting a NodeList to an array using builtin methods.\ntry {\n\tArray.prototype.slice.call( document.documentElement.childNodes, 0 );\n\n// Provide a fallback method if it does not work\n} catch(e){\n\tmakeArray = function(array, results) {\n\t\tvar ret = results || [];\n\n\t\tif ( toString.call(array) === \"[object Array]\" ) {\n\t\t\tArray.prototype.push.apply( ret, array );\n\t\t} else {\n\t\t\tif ( typeof array.length === \"number\" ) {\n\t\t\t\tfor ( var i = 0, l = array.length; i < l; i++ ) {\n\t\t\t\t\tret.push( array[i] );\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor ( var i = 0; array[i]; i++ ) {\n\t\t\t\t\tret.push( array[i] );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn ret;\n\t};\n}\n\nvar sortOrder;\n\nif ( document.documentElement.compareDocumentPosition ) {\n\tsortOrder = function( a, b ) {\n\t\tvar ret = a.compareDocumentPosition(b) & 4 ? -1 : a === b ? 0 : 1;\n\t\tif ( ret === 0 ) {\n\t\t\thasDuplicate = true;\n\t\t}\n\t\treturn ret;\n\t};\n} else if ( \"sourceIndex\" in document.documentElement ) {\n\tsortOrder = function( a, b ) {\n\t\tvar ret = a.sourceIndex - b.sourceIndex;\n\t\tif ( ret === 0 ) {\n\t\t\thasDuplicate = true;\n\t\t}\n\t\treturn ret;\n\t};\n} else if ( document.createRange ) {\n\tsortOrder = function( a, b ) {\n\t\tvar aRange = a.ownerDocument.createRange(), bRange = b.ownerDocument.createRange();\n\t\taRange.selectNode(a);\n\t\taRange.collapse(true);\n\t\tbRange.selectNode(b);\n\t\tbRange.collapse(true);\n\t\tvar ret = aRange.compareBoundaryPoints(Range.START_TO_END, bRange);\n\t\tif ( ret === 0 ) {\n\t\t\thasDuplicate = true;\n\t\t}\n\t\treturn ret;\n\t};\n}\n\n// Check to see if the browser returns elements by name when\n// querying by getElementById (and provide a workaround)\n(function(){\n\t// We're going to inject a fake input element with a specified name\n\tvar form = document.createElement(\"div\"),\n\t\tid = \"script\" + (new Date).getTime();\n\tform.innerHTML = \"<a name='\" + id + \"'/>\";\n\n\t// Inject it into the root element, check its status, and remove it quickly\n\tvar root = document.documentElement;\n\troot.insertBefore( form, root.firstChild );\n\n\t// The workaround has to do additional checks after a getElementById\n\t// Which slows things down for other browsers (hence the branching)\n\tif ( !!document.getElementById( id ) ) {\n\t\tExpr.find.ID = function(match, context, isXML){\n\t\t\tif ( typeof context.getElementById !== \"undefined\" && !isXML ) {\n\t\t\t\tvar m = context.getElementById(match[1]);\n\t\t\t\treturn m ? m.id === match[1] || typeof m.getAttributeNode !== \"undefined\" && m.getAttributeNode(\"id\").nodeValue === match[1] ? [m] : undefined : [];\n\t\t\t}\n\t\t};\n\n\t\tExpr.filter.ID = function(elem, match){\n\t\t\tvar node = typeof elem.getAttributeNode !== \"undefined\" && elem.getAttributeNode(\"id\");\n\t\t\treturn elem.nodeType === 1 && node && node.nodeValue === match;\n\t\t};\n\t}\n\n\troot.removeChild( form );\n\troot = form = null; // release memory in IE\n})();\n\n(function(){\n\t// Check to see if the browser returns only elements\n\t// when doing getElementsByTagName(\"*\")\n\n\t// Create a fake element\n\tvar div = document.createElement(\"div\");\n\tdiv.appendChild( document.createComment(\"\") );\n\n\t// Make sure no comments are found\n\tif ( div.getElementsByTagName(\"*\").length > 0 ) {\n\t\tExpr.find.TAG = function(match, context){\n\t\t\tvar results = context.getElementsByTagName(match[1]);\n\n\t\t\t// Filter out possible comments\n\t\t\tif ( match[1] === \"*\" ) {\n\t\t\t\tvar tmp = [];\n\n\t\t\t\tfor ( var i = 0; results[i]; i++ ) {\n\t\t\t\t\tif ( results[i].nodeType === 1 ) {\n\t\t\t\t\t\ttmp.push( results[i] );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tresults = tmp;\n\t\t\t}\n\n\t\t\treturn results;\n\t\t};\n\t}\n\n\t// Check to see if an attribute returns normalized href attributes\n\tdiv.innerHTML = \"<a href='#'></a>\";\n\tif ( div.firstChild && typeof div.firstChild.getAttribute !== \"undefined\" &&\n\t\t\tdiv.firstChild.getAttribute(\"href\") !== \"#\" ) {\n\t\tExpr.attrHandle.href = function(elem){\n\t\t\treturn elem.getAttribute(\"href\", 2);\n\t\t};\n\t}\n\n\tdiv = null; // release memory in IE\n})();\n\nif ( document.querySelectorAll ) (function(){\n\tvar oldSizzle = Sizzle, div = document.createElement(\"div\");\n\tdiv.innerHTML = \"<p class='TEST'></p>\";\n\n\t// Safari can't handle uppercase or unicode characters when\n\t// in quirks mode.\n\tif ( div.querySelectorAll && div.querySelectorAll(\".TEST\").length === 0 ) {\n\t\treturn;\n\t}\n\t\n\tSizzle = function(query, context, extra, seed){\n\t\tcontext = context || document;\n\n\t\t// Only use querySelectorAll on non-XML documents\n\t\t// (ID selectors don't work in non-HTML documents)\n\t\tif ( !seed && context.nodeType === 9 && !isXML(context) ) {\n\t\t\ttry {\n\t\t\t\treturn makeArray( context.querySelectorAll(query), extra );\n\t\t\t} catch(e){}\n\t\t}\n\t\t\n\t\treturn oldSizzle(query, context, extra, seed);\n\t};\n\n\tfor ( var prop in oldSizzle ) {\n\t\tSizzle[ prop ] = oldSizzle[ prop ];\n\t}\n\n\tdiv = null; // release memory in IE\n})();\n\nif ( document.getElementsByClassName && document.documentElement.getElementsByClassName ) (function(){\n\tvar div = document.createElement(\"div\");\n\tdiv.innerHTML = \"<div class='test e'></div><div class='test'></div>\";\n\n\t// Opera can't find a second classname (in 9.6)\n\tif ( div.getElementsByClassName(\"e\").length === 0 )\n\t\treturn;\n\n\t// Safari caches class attributes, doesn't catch changes (in 3.2)\n\tdiv.lastChild.className = \"e\";\n\n\tif ( div.getElementsByClassName(\"e\").length === 1 )\n\t\treturn;\n\n\tExpr.order.splice(1, 0, \"CLASS\");\n\tExpr.find.CLASS = function(match, context, isXML) {\n\t\tif ( typeof context.getElementsByClassName !== \"undefined\" && !isXML ) {\n\t\t\treturn context.getElementsByClassName(match[1]);\n\t\t}\n\t};\n\n\tdiv = null; // release memory in IE\n})();\n\nfunction dirNodeCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {\n\tvar sibDir = dir == \"previousSibling\" && !isXML;\n\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\n\t\tvar elem = checkSet[i];\n\t\tif ( elem ) {\n\t\t\tif ( sibDir && elem.nodeType === 1 ){\n\t\t\t\telem.sizcache = doneName;\n\t\t\t\telem.sizset = i;\n\t\t\t}\n\t\t\telem = elem[dir];\n\t\t\tvar match = false;\n\n\t\t\twhile ( elem ) {\n\t\t\t\tif ( elem.sizcache === doneName ) {\n\t\t\t\t\tmatch = checkSet[elem.sizset];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif ( elem.nodeType === 1 && !isXML ){\n\t\t\t\t\telem.sizcache = doneName;\n\t\t\t\t\telem.sizset = i;\n\t\t\t\t}\n\n\t\t\t\tif ( elem.nodeName === cur ) {\n\t\t\t\t\tmatch = elem;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\telem = elem[dir];\n\t\t\t}\n\n\t\t\tcheckSet[i] = match;\n\t\t}\n\t}\n}\n\nfunction dirCheck( dir, cur, doneName, checkSet, nodeCheck, isXML ) {\n\tvar sibDir = dir == \"previousSibling\" && !isXML;\n\tfor ( var i = 0, l = checkSet.length; i < l; i++ ) {\n\t\tvar elem = checkSet[i];\n\t\tif ( elem ) {\n\t\t\tif ( sibDir && elem.nodeType === 1 ) {\n\t\t\t\telem.sizcache = doneName;\n\t\t\t\telem.sizset = i;\n\t\t\t}\n\t\t\telem = elem[dir];\n\t\t\tvar match = false;\n\n\t\t\twhile ( elem ) {\n\t\t\t\tif ( elem.sizcache === doneName ) {\n\t\t\t\t\tmatch = checkSet[elem.sizset];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif ( elem.nodeType === 1 ) {\n\t\t\t\t\tif ( !isXML ) {\n\t\t\t\t\t\telem.sizcache = doneName;\n\t\t\t\t\t\telem.sizset = i;\n\t\t\t\t\t}\n\t\t\t\t\tif ( typeof cur !== \"string\" ) {\n\t\t\t\t\t\tif ( elem === cur ) {\n\t\t\t\t\t\t\tmatch = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else if ( Sizzle.filter( cur, [elem] ).length > 0 ) {\n\t\t\t\t\t\tmatch = elem;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\telem = elem[dir];\n\t\t\t}\n\n\t\t\tcheckSet[i] = match;\n\t\t}\n\t}\n}\n\nvar contains = document.compareDocumentPosition ?  function(a, b){\n\treturn a.compareDocumentPosition(b) & 16;\n} : function(a, b){\n\treturn a !== b && (a.contains ? a.contains(b) : true);\n};\n\nvar isXML = function(elem){\n\treturn elem.nodeType === 9 && elem.documentElement.nodeName !== \"HTML\" ||\n\t\t!!elem.ownerDocument && elem.ownerDocument.documentElement.nodeName !== \"HTML\";\n};\n\nvar posProcess = function(selector, context){\n\tvar tmpSet = [], later = \"\", match,\n\t\troot = context.nodeType ? [context] : context;\n\n\t// Position selectors must be done after the filter\n\t// And so must :not(positional) so we move all PSEUDOs to the end\n\twhile ( (match = Expr.match.PSEUDO.exec( selector )) ) {\n\t\tlater += match[0];\n\t\tselector = selector.replace( Expr.match.PSEUDO, \"\" );\n\t}\n\n\tselector = Expr.relative[selector] ? selector + \"*\" : selector;\n\n\tfor ( var i = 0, l = root.length; i < l; i++ ) {\n\t\tSizzle( selector, root[i], tmpSet );\n\t}\n\n\treturn Sizzle.filter( later, tmpSet );\n};\n\nreturn Sizzle;\n\n})();\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/math/geom/Rect.js":{"path":"modules/devkit-core/node_modules/jsio/packages/math/geom/Rect.js","friendlyPath":"math.geom.Rect","directory":"modules/devkit-core/node_modules/jsio/packages/math/geom/","filename":"Rect.js","baseMod":"math","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/node_modules/jsio/packages/math","src":"jsio('import lib.Enum');\njsio('import .Point');\njsio('import .Line');\njsio('import .intersect');\n\n/**\n * Model a rectangle.\n */\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Rect=__class__;var Rect = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Rect(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Rect(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(a, b, c, d) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0: // init\n\t\t\t\tthis.width = this.height = this.x = this.y = 0;\n\t\t\t\tbreak;\n\t\t\tcase 1: // copy\n\t\t\t\tthis.width = a.width;\n\t\t\t\tthis.height = a.height;\n\t\t\t\tthis.x = a.x;\n\t\t\t\tthis.y = a.y;\n\t\t\t\tbreak;\n\t\t\tcase 2: // (x, y), (width, height)\n\t\t\t\tthis.x = a.x;\n\t\t\t\tthis.y = a.y;\n\t\t\t\tthis.width = b.x;\n\t\t\t\tthis.height = b.y;\n\t\t\t\tbreak;\n\t\t\tcase 3: // (x, y), width, height\n\t\t\t\tthis.x = a.x;\n\t\t\t\tthis.y = a.y;\n\t\t\t\tthis.width = b;\n\t\t\t\tthis.height = c;\n\t\t\t\tbreak;\n\t\t\tcase 4: // x, y, width, height\n\t\t\t\tthis.x = a;\n\t\t\t\tthis.y = b;\n\t\t\t\tthis.width = c;\n\t\t\t\tthis.height = d;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Normalize negative height and width dimensions by adjusting the position\n\t * of the rect.\n\t */\n\t\n\tthis.normalize = function() {\n\t\tif (this.width < 0) {\n\t\t\tthis.x -= this.width;\n\t\t\tthis.width = -this.width;\n\t\t}\n\t\t\n\t\tif (this.height < 0) {\n\t\t\tthis.y -= this.height;\n\t\t\tthis.height = -this.height;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Generate the intersection of a rectange with another rectangle.\n\t */\n\n\tthis.intersectRect = function (rect) {\n\t\tif (intersect.isRectAndRect(this, rect)) {\n\t\t\tvar x1 = this.x;\n\t\t\tvar y1 = this.y;\n\t\t\tvar x2 = this.x + this.width;\n\t\t\tvar y2 = this.y + this.height;\n\n\t\t\tthis.x = Math.max(x1, rect.x),\n\t\t\tthis.y = Math.max(y1, rect.y),\n\t\t\tthis.width = Math.min(x2, rect.x + rect.width) - this.x;\n\t\t\tthis.height = Math.min(y2, rect.y + rect.height) - this.y;\n\t\t} else {\n\t\t\tthis.width = 0;\n\t\t\tthis.height = 0;\n\t\t}\n\t}\n\t\n\t/**\n\t * Generate the union of a rectange with another rectangle.\n\t */\n\t\n\tthis.unionRect = function(rect) {\n\t\tthis.normalize();\n\t\tif (rect.normalize) { rect.normalize(); }\n\t\t\n\t\tvar x2 = this.x + this.width,\n\t\t\ty2 = this.y + this.height;\n\t\t\n\t\tvar rx2 = rect.x + rect.width,\n\t\t\try2 = rect.y + rect.height;\n\t\t\n\t\tthis.x = this.x < rect.x ? this.x : rect.x;\n\t\tthis.y = this.y < rect.y ? this.y : rect.y;\n\t\t\n\t\tthis.width = (x2 > rx2 ? x2 : rx2) - this.x;\n\t\tthis.height = (y2 > ry2 ? y2 : ry2) - this.y;\n\t};\n\n\t/**\n\t * Get a point for the given corner.\n\t */\n\t\n\tthis.getCorner = function(i) {\n\t\tswitch(i) {\n\t\t\tcase CORNERS.TOP_LEFT:\n\t\t\t\treturn new Point(this.x, this.y);\n\t\t\tcase CORNERS.TOP_RIGHT:\n\t\t\t\treturn new Point(this.x + this.width, this.y);\n\t\t\tcase CORNERS.BOTTOM_LEFT:\n\t\t\t\treturn new Point(this.x, this.y + this.height);\n\t\t\tcase CORNERS.BOTTOM_RIGHT:\n\t\t\t\treturn new Point(this.x + this.width, this.y + this.height);\n\t\t}\n\t}\n\t\n\t/**\n\t * Return a line corresponding to the given side.\n\t */\n\t\n\tthis.getSide = function(i) {\n\t\tswitch(i) {\n\t\t\tcase SIDES.TOP:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.TOP_LEFT), this.getCorner(CORNERS.TOP_RIGHT));\n\t\t\tcase SIDES.RIGHT:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.TOP_RIGHT), this.getCorner(CORNERS.BOTTOM_RIGHT));\n\t\t\tcase SIDES.BOTTOM:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.BOTTOM_RIGHT), this.getCorner(CORNERS.BOTTOM_LEFT));\n\t\t\tcase SIDES.LEFT:\n\t\t\t\treturn new Line(this.getCorner(CORNERS.BOTTOM_LEFT), this.getCorner(CORNERS.TOP_LEFT));\n\t\t}\n\t}\n\n\t/**\n\t * Return the center point of a rectangle.\n\t */\n\t\n\tthis.getCenter = function() {\n\t\treturn new Point(this.x + this.width / 2, this.y + this.height / 2);\n\t}\n});\n\nvar SIDES = Rect.SIDES = lib.Enum('TOP', 'BOTTOM', 'LEFT', 'RIGHT');\nvar CORNERS = Rect.CORNERS = lib.Enum('TOP_LEFT', 'TOP_RIGHT', 'BOTTOM_RIGHT', 'BOTTOM_LEFT');\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/math/geom/Point.js":{"path":"modules/devkit-core/node_modules/jsio/packages/math/geom/Point.js","friendlyPath":".Point","directory":"modules/devkit-core/node_modules/jsio/packages/math/geom/","filename":"Point.js","src":"/**\n * @package math.geom.Point;\n * Models a Point in 2D space.\n */\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Point=__class__;var Point = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Point(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Point(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(a, b) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0:\n\t\t\t\tthis.x = 0;\n\t\t\t\tthis.y = 0;\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tthis.x = a.x || 0;\n\t\t\t\tthis.y = a.y || 0;\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.x = a || 0;\n\t\t\t\tthis.y = b || 0;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Rotates this point around the origin by a value in radians.\n\t */\n\t\n\tthis.rotate = function(r) {\n\t\tvar x = this.x,\n\t\t\ty = this.y,\n\t\t\tcosr = Math.cos(r),\n\t\t\tsinr = Math.sin(r);\n\t\t\n\t\tthis.x = x * cosr - y * sinr;\n\t\tthis.y = x * sinr + y * cosr;\n\t\t\n\t\treturn this;\n\t}\n\n\t/**\n\t * Translate this point by two scalars or by another point.\n\t */\n\t\n\tthis.translate = this.add = function(x, y) {\n\t\tif (typeof x == 'number') {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t} else {\n\t\t\tthis.x += x.x;\n\t\t\tthis.y += x.y;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Subtract this point by two scalars or by another point.\n\t */\n\t\n\tthis.subtract = function(x, y) {\n\t\tif (typeof x == 'number') {\n\t\t\tthis.x -= x;\n\t\t\tthis.y -= y;\n\t\t} else {\n\t\t\tthis.x -= x.x;\n\t\t\tthis.y -= x.y;\n\t\t}\n\t\treturn this;\n\t}\n\n\t/**\n\t * Scale this number.\n\t */\n\n\tthis.scale = function(sx, sy) {\n\t\t//if no scaleY specified\n\t\tif(sy === undefined) sy = sx;\n\n\t\tthis.x *= sx;\n\t\tthis.y *= sy;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Set the magnitude of this point at a constant angle.\n\t */\n\t\n\tthis.setMagnitude = function(m) {\n\t\tvar theta = this.getAngle();\n\t\tthis.x = m * Math.cos(theta);\n\t\tthis.y = m * Math.sin(theta);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Normalize this point to the unit circle.\n\t */\n\t\n\tthis.normalize = function() {\n\t\tvar m = this.getMagnitude();\n\t\tthis.x /= m;\n\t\tthis.y /= m;\n\t\treturn this;\n\t};\n\n\t/**\n\t * Add magnitude to this point.\n\t */\n\t\n\tthis.addMagnitude = function(m) {\n\t\treturn this.setMagnitude(this.getMagnitude() + m);\n\t};\n\n\tthis.getMagnitude = function() {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t};\n\n\tthis.getSquaredMagnitude = function() {\n\t\treturn this.x * this.x + this.y * this.y;\n\t};\n\n\tthis.getDirection = this.getAngle = function() {\n\t\treturn Math.atan2(this.y, this.x);\n\t};\n\t\n});\n\n/*\n */\nPoint.getPolarR = function(x, y) { \n\tthrow \"notImplemented\";\n}\n\n/*\n\t### Class Method: Point.getPolarTheta (x, y)\n\t1. `x {number}`\n\t2. `y {number}`\n\t3. Return: `{number}`\n*/\nPoint.getPolarTheta = function(x, y) { \n\tvar val = Math.atan2(y,x) + (Math.PI * 2); \n\treturn val > Math.PI * 2 ? val % (Math.PI * 2) : val;\n}\n\n/*\n\t### Class Method: Point.add (a, b, c, d)\n\t### Class Method: Point.translate (a, b, c, d)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. `d {number}`\n\t5. Return: `{Point}`\n */\nPoint.add = Point.translate = function(a, b, c, d) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).add(b);\n\t\tcase 3: return new Point(a).add(b, c);\n\t\tcase 4: return new Point(a, b).add(c, d);\n\t}\n}\n\n/*\n\t### Class Method: Point.subtract (a, b, c, d)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. `d {number}`\n\t5. Return: `{Point}`\n */\nPoint.subtract = function(a, b, c, d) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).subtract(b);\n\t\tcase 3: return new Point(a).subtract(b, c);\n\t\tcase 4: return new Point(a, b).subtract(c, d);\n\t}\n}\n\n/*\n\t### Class Method: Point.scale (a, b, c) \n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n */\nPoint.scale = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).scale(b);\n\t\tcase 3: return new Point(a, b).scale(c);\n\t}\n}\n\n/*\n\t### Class Method: Point.setMagnitude (a, b, c)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n*/\nPoint.setMagnitude = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).setMagnitude(c);\n\t\tcase 3: return new Point(a, b).setMagnitude(c);\n\t}\n}\n\n/*\n\t### Class Method: Point.addMagnitude (a, b, c)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n */\nPoint.addMagnitude = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: pt = new Point(a); break;\n\t\tcase 3: pt = new Point(a, b); b = c; break;\n\t}\n\t\n\treturn pt.addMagnitude(b);\n}\n\n/*\n\t### Class Method: Point.getMagnitude (a, b)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. Return: `{Point}`\n */\nPoint.getMagnitude = function(a, b) { return new Point(a, b).getMagnitude(); }\n\n/*\n\t### Class Method: Point.rotate (a, b, c)\n\t1. `a {number}`\n\t2. `b {number}`\n\t3. `c {number}`\n\t4. Return: `{Point}`\n */\nPoint.rotate = function(a, b, c) {\n\tswitch(arguments.length) {\n\t\tcase 2: return new Point(a).rotate(b);\n\t\tcase 3: return new Point(a, b).rotate(c);\n\t}\n}\n\n/**\n * Treat two points as vectors and project a onto b\n *  (a dot unit(b)) * unit(b)\n */\nPoint.project = function (a, b) {\n\tvar unitB = new Point(b).normalize();\n\treturn unitB.scale(unitB.x * a.x + unitB.y * a.y);\n}\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/math/geom/Line.js":{"path":"modules/devkit-core/node_modules/jsio/packages/math/geom/Line.js","friendlyPath":".Line","directory":"modules/devkit-core/node_modules/jsio/packages/math/geom/","filename":"Line.js","src":"jsio('import .Point');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Line=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Line(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Line(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(a, b, c, d) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0:\n\t\t\t\tthis.start = new Point();\n\t\t\t\tthis.end = new Point();\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tthis.start = new Point(a.start);\n\t\t\t\tthis.end = new Point(a.end);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.start = new Point(a);\n\t\t\t\tthis.end = new Point(b);\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.start = new Point(a);\n\t\t\t\tthis.end = new Point(b, c);\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\tdefault:\n\t\t\t\tthis.start = new Point(a, b);\n\t\t\t\tthis.end = new Point(c, d);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\t\n\tthis.getMagnitude = \n\tthis.getLength = function() {\n\t\tvar dx = this.end.x - this.start.x,\n\t\t\tdy = this.end.y - this.start.y;\n\t\t\n\t\treturn Math.sqrt(dx * dx + dy * dy);\n\t}\n});\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/math/geom/intersect.js":{"path":"modules/devkit-core/node_modules/jsio/packages/math/geom/intersect.js","friendlyPath":".intersect","directory":"modules/devkit-core/node_modules/jsio/packages/math/geom/","filename":"intersect.js","src":"jsio('import .Point');\njsio('import .Line');\njsio('import .Rect');\n\n/**\n * @package math.geom.intersect\n */\nvar intersect = exports;\n\nintersect.pointAndRect = intersect.ptAndRect = function (pt, rect) {\n\tvar x = pt.x,\n\t\t\ty = pt.y;\n\treturn (x >= rect.x &&\n\t\t\t\t\tx <= rect.x + rect.width &&\n\t\t\t\t\ty >= rect.y &&\n\t\t\t\t\ty <= rect.y + rect.height);\n};\n\nintersect.rectAndPoint = intersect.rectAndPt = function (rect, pt) {\n\treturn intersect.pointAndRect(pt, rect);\n};\n\nintersect.pointAndCircle = intersect.ptAndCirc = function(pt, circle) {\n\tvar dx = pt.x - circle.x,\n\t\t\tdy = pt.y - circle.y;\n\treturn dx * dx + dy * dy < circle.radius * circle.radius;\n};\n\nintersect.circleAndPoint = intersect.circAndPt = function (circle, pt) {\n\treturn intersect.pointAndCircle(pt, circle);\n};\n\nintersect.circleAndCircle = function(circle1, circle2) {\n\tvar dx = circle2.x - circle1.x,\n\t\tdy = circle2.y - circle1.y;\n\tvar radiusSum = circle1.radius + circle2.radius;\n\treturn dx * dx + dy * dy <= radiusSum * radiusSum;\n};\n\nintersect.isRectAndRect = function (rect1, rect2) {\n\treturn !((rect1.y + rect1.height < rect2.y) ||\n\t\t\t\t\t (rect2.y + rect2.height < rect1.y) ||\n\t\t\t\t\t (rect1.x + rect1.width < rect2.x) ||\n\t\t\t\t\t (rect2.x + rect2.width < rect1.x));\n};\n\nintersect.circleAndRect = function(circle, rect) {\n\tif (intersect.pointAndRect(circle, rect)) {\n\t\treturn true;\n\t}\n\treturn (intersect.lineAndCircle(rect.getSide(1), circle) ||\n\t\t\t\t\tintersect.lineAndCircle(rect.getSide(2), circle) ||\n\t\t\t\t\tintersect.lineAndCircle(rect.getSide(3), circle) ||\n\t\t\t\t\tintersect.lineAndCircle(rect.getSide(4), circle));\n};\n\nintersect.rectAndCircle = function(rect, circle) {\n\treturn intersect.circleAndRect(circle, rect);\n};\n\nintersect.lineAndCircle = function (line, circle) {\n\tvar vec = intersect.pointToLine(circle, line);\n\treturn vec.getMagnitude() < circle.radius;\n};\n\nintersect.circleAndLine = function (circle, line) {\n\treturn intersect.lineAndCircle(line, circle);\n};\n\n// returns line from pt to nearest pt on line\nintersect.pointToLine = intersect.ptToLine = function (pt, line) {\n\tvar dx = (line.end.x - line.start.x),\n\t\t\tdy = (line.end.y - line.start.y),\n\t\t\tu = ((pt.x - line.start.x) * dx\t// TODO can we abstract this from 2D to 2D/3D?\n\t\t\t\t\t + (pt.y - line.start.y) * dy) / (dx * dx + dy * dy);\n\n\tvar i;\n\tif (u < 0) {\n\t\ti = new Point(line.start);\n\t} else if (u > 1) {\n\t\ti = new Point(line.end);\n\t} else {\n\t\ti = new Point(line.start.x + u * dx, line.start.y + u * dy);\n\t}\n\treturn new Line(i, pt);\n};\n\n// returns rectangle of intersection\nintersect.rectAndRect = function (rect1, rect2) {\n\tjsio('import .Rect');\n\treturn (intersect.rectAndRect = function(rect1, rect2) {\n\t\tif (rect1 === true) { return new Rect(rect2); }\n\t\tif (rect2 === true) { return new Rect(rect2); }\n\n\t\tif (intersect.isRectAndRect(rect1, rect2)) {\n\t\t\tvar x1 = Math.max(rect1.x, rect2.x),\n\t\t\t\t\ty1 = Math.max(rect1.y, rect2.y),\n\t\t\t\t\tx2 = Math.min(rect1.x + rect1.width, rect2.x + rect2.width),\n\t\t\t\t\ty2 = Math.min(rect1.y + rect1.height, rect2.y + rect2.height);\n\t\t\treturn new Rect(x1, y1, x2 - x1, y2 - y1);\n\t\t}\n\t\treturn null;\n\t})(rect1, rect2);\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/Audio.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/Audio.js","friendlyPath":".Audio","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"Audio.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package timestep.env.browser.Audio;\n *\n * Audio implementation using the <audio> element for browsers.\n */\n\nexports = function (opts) {\n\tvar defaults = {\n\t\tautoplay: false,\n\t\tpreload: 'auto',\n\t\tvolume: 1.0,\n\t\tloop: 0,\n\t\tsrc: ''\n\t};\n\t\n\topts = merge(opts, defaults);\n\tvar el = document.createElement('Audio');\n\t\n\tel.autoplay = opts.autoplay;\n\tel.preload = opts.preload;\n\tel.volume = opts.volume;\n\tel.loop = opts.loop;\n\tel.src = opts.src;\n\t\n\treturn el;\n};","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/Canvas.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/Canvas.js","friendlyPath":".Canvas","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"Canvas.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package timestep.env.browser.Canvas;\n *\n * Canvas implementation for browsers. Wraps a Context2D.\n */\n\njsio('import .Context2D');\njsio('import .webgl.WebGLContext2D as WebGLContext2D');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_Canvas=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_Canvas(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_Canvas(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {width: 300, height: 200});\n\n\t\tthis._width = opts.width;\n\t\tthis._height = opts.height;\n\t\tthis.isWebGL = opts.useWebGL && CONFIG.useWebGL && WebGLContext2D.isSupported;\n\n\t\tvar ctx;\n\n\t\tif (this.isWebGL) {\n\t\t\tctx = WebGLContext2D.getContext(this, opts);\n\t\t} else {\n\t\t\tctx = new Context2D(opts);\n\t\t}\n\n\t\tvar el = this._el = ctx.getElement();\n\n\t\tel.complete = true;\n\n\t\tif (el.style) {\n\t\t\tel.style.userSelect =\n\t\t\tel.style.webkitUserSelect =\n\t\t\tel.style.webkitTouchCallout = 'none';\n\t\t}\n\n\t\tel.getContext = function () { return ctx; };\n\n\t\treturn el;\n\t};\n\n\tObject.defineProperties(this, {\n\t\twidth: {\n\t\t\tget: function() { return this._width; },\n\t\t\tset: function(value) {\n\t\t\t\tthis._width = value;\n\t\t\t\tif (this.isWebGL) {\n\t\t\t\t\tthis.getContext().resize(this.width, this.height);\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\theight: {\n\t\t\tget: function() { return this._height; },\n\t\t\tset: function(value) {\n\t\t\t\tthis._height = value;\n\t\t\t\tif (this.isWebGL) {\n\t\t\t\t\tthis.getContext().resize(this.width, this.height);\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t});\n\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/Context2D.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/Context2D.js","friendlyPath":".Context2D","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"Context2D.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package timestep.env.browser.Context2D;\n *\n * Generates a rendering context by creating our own Canvas element.\n */\n\njsio('import device');\njsio('import .FontRenderer');\n\nfunction setter(name) {\n\treturn (function (val) {\n\t\treturn (this[name] = val);\n\t});\n};\n\nfunction getter(name) {\n\treturn (function (val) {\n\t\treturn this[name];\n\t});\n};\n\nexports = function (opts) {\n\tvar parentNode = opts && opts.parent;\n\tvar el = opts && opts.el || document.createElement('canvas');\n\n\tel.width = opts.width;\n\tel.height = opts.height;\n\n\tvar ctx = el.getContext('2d');\n\tctx.font = '11px ' + device.defaultFontFamily;\n\tctx.getElement = function () { return el; };\n\n\tctx.reset = function () {};\n\n\tctx.clear = function () {\n\t\t//el.width = el.width;\n\t\tthis.clearRect(0, 0, el.width, el.height);\n\t};\n\n\tctx.clipRect = function (x, y, w, h) {\n\t\tctx.beginPath();\n\t\tctx.rect(x, y, w, h);\n\t\tctx.clip();\n\t};\n\n\tctx.swap = function () {};\n\tctx.execSwap = function () {};\n\n\tctx.circle = function (x, y, radius) {\n\t\tthis.beginPath();\n\t\tthis.arc(x, y, radius, 0, 2 * Math.PI, true);\n\t};\n\n\tvar _lastPointSprite = {\n\t\timg: null,\n\t\tcolor: null,\n\t\tcanvas: null\n\t};\n\n\tctx.drawPointSprites = function (x1, y1, x2, y2) {\n\t\tvar sprite = this.pointSprite;\n\t\tif (!sprite || !sprite.complete) { return; }\n\n\t\tvar width = sprite.width;\n\t\tvar height = sprite.height;\n\t\tvar canvas = _lastPointSprite.canvas || (_lastPointSprite.canvas = document.createElement('canvas'));\n\n\t\tif (sprite != _lastPointSprite.img || this.strokeStyle != _lastPointSprite.color) {\n\t\t\t_lastPointSprite.img = sprite;\n\t\t\t_lastPointSprite.color = this.strokeStyle;\n\t\t\tcanvas.width = width;\n\t\t\tcanvas.height = height;\n\t\t\tvar ctx = canvas.getContext('2d');\n\t\t\tctx.fillStyle = this.strokeStyle;\n\t\t\tctx.fillRect(0, 0, width, height);\n\t\t\tctx.globalCompositeOperation = 'destination-in';\n\t\t\tctx.drawImage(sprite, 0, 0);\n\t\t}\n\n\t\t// Add points to the buffer so there are drawing points every X pixels\n\t\tvar dx = x2 - x1;\n\t\tvar dy = y2 - y1;\n\t\tvar count = Math.ceil(Math.sqrt(dx * dx + dy * dy) / this.pointSpriteStep);\n\t\tif (count < 1) { count = 1; }\n\n\t\tvar d = this.lineWidth;\n\t\tfor (var i = 0; i < count; ++i) {\n\t\t\tvar x = x1 + dx * i / count;\n\t\t\tvar y = y1 + dy * i / count;\n\t\t\tthis.drawImage(canvas, 0, 0, width, height, x - d / 2, y - d / 2, d, d);\n\t\t}\n\t};\n\n\tctx.roundRect = function (x, y, width, height, radius) {\n\t\tthis.beginPath();\n\t\tthis.moveTo(x,y+radius);\n\t\tthis.lineTo(x,y+height-radius);\n\t\tthis.quadraticCurveTo(x,y+height,x+radius,y+height);\n\t\tthis.lineTo(x+width-radius,y+height);\n\t\tthis.quadraticCurveTo(x+width,y+height,x+width,y+height-radius);\n\t\tthis.lineTo(x+width,y+radius);\n\t\tthis.quadraticCurveTo(x+width,y,x+width-radius,y);\n\t\tthis.lineTo(x+radius,y);\n\t\tthis.quadraticCurveTo(x,y,x,y+radius);\n\t};\n\n\tctx.loadIdentity = function () {\n\t\tthis.setTransform(1, 0, 0, 1, 0, 0);\n\t};\n\n\tctx.measureText = FontRenderer.wrapMeasureText(ctx.measureText);\n\tctx.fillText = FontRenderer.wrapFillText(ctx.fillText);\n\tctx.strokeText = FontRenderer.wrapStrokeText(ctx.strokeText);\n\n\tctx.filters = {};\n\tctx.setFilters = function (filters) {\n\t\tthis.clearFilters();\n\t\tfor (var name in filters) {\n\t\t\tthis.filters[name] = filters[name];\n\t\t}\n\t};\n\n\tctx.clearFilters = function () {\n\t\tfor (var name in this.filters) {\n\t\t\tdelete this.filters[name];\n\t\t}\n\t};\n\n\treturn ctx;\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/FontRenderer.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/FontRenderer.js","friendlyPath":".FontRenderer","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"FontRenderer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package env.browser.FontRenderer;\n *\n * Render fonts or custom fonts on a Canvas context.\n */\n\njsio('import device');\njsio('import ui.resource.Image as Image');\njsio('import ui.Color as Color');\njsio('import ui.filter as filter');\njsio('import ui.resource.Font as Font');\n\nvar max = Math.max;\n\nvar _customFonts = {};\nvar _customFontInfo = {};\nvar _origMeasureText;\n\nexports.init = function () {\n\tvar manifest = window.CONFIG;\n\tif (manifest && manifest.fonts) {\n\t\tvar fonts = manifest.fonts;\n\t\tfor (var i = 0, len = fonts.length; i < len; i++) {\n\t\t\tvar font = fonts[i];\n\t\t\tvar customFont = {\n\t\t\t\tfontName: font.fontName,\n\t\t\t\tsettings: font,\n\t\t\t\timagesLoaded: -1,\n\t\t\t\timagesTotal: 0,\n\t\t\t\tloaded: false\n\t\t\t}\n\t\t\t_customFonts[font.fontName] = customFont;\n\t\t\tloadingCustomFont(customFont);\n\t\t}\n\t}\n};\n\nvar loadCustomFontImage = function(customFont, index, stroke) {\n\tvar img = new Image({\n\t\turl: 'resources/fonts/' + customFont.fontName + '_' + index\n\t\t\t+ (stroke ? '_Stroke.png' : '.png')\n\t});\n\timg.doOnLoad(function () {\n\t\tcustomFont.imagesLoaded++;\n\t\tcustomFont.loaded = (customFont.imagesLoaded === customFont.imagesTotal);\n\t});\n\treturn img;\n};\n\nvar findVerticalInfo = function(dimensions) {\n\t// A..Z, a..z, all\n\tvar ranges = [{start: 0x41, end: 0x5A}, {start: 0x61, end: 0x7A}, {start: 0x20, end: 0xFF}];\n\tvar found = false;\n\tvar baseline = 0;\n\tvar bottom = 0;\n\tfor (var i = 0, len = ranges.length; i < len; i++) {\n\t\tvar range = ranges[i];\n\t\tfor (var j = range.start; j <= range.end; j++) {\n\t\t\tvar dimension = dimensions[j];\n\t\t\tif (dimension) {\n\t\t\t\tbaseline = max(baseline, dimension.h);\n\t\t\t\tbottom = max(bottom, dimension.h);\n\t\t\t\tfound = true;\n\t\t\t}\n\t\t}\n\t\tif (found) {\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn { baseline: baseline, bottom: bottom };\n};\n\nvar findHorizontalInfo = function(dimensions) {\n\t// a..z, A..Z\n\tvar ranges = [{start: 0x61, end: 0x7A}, {start: 0x41, end: 0x5A}, {start: 0x20, end: 0xFF}];\n\tvar width = 0;\n\tvar count = 0;\n\tfor (var i = 0, len = ranges.length; i < len; i++) {\n\t\tvar range = ranges[i];\n\t\tfor (var j = range.start; j <= range.end; j++) {\n\t\t\tvar dimension = dimensions[j];\n\t\t\tif (dimension) {\n\t\t\t\twidth += dimension.w;\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\t\tif (count !== 0) {\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn { width: 0.8 * width / count };\n};\n\nvar loadingCustomFont = function(customFont) {\n\tif (customFont.imagesLoaded !== -1) {\n\t \treturn !customFont.loaded;\n\t}\n\n\tvar settings = customFont.settings;\n\tvar fontName = settings.fontName;\n\tvar info = _customFontInfo[fontName];\n\tif (info) {\n\t\tcustomFont.dimensions = info.dimensions;\n\t\tcustomFont.horizontal = info.horizontal;\n\t\tcustomFont.vertical = info.vertical;\n\t} else {\n\t\tvar json = CACHE['resources/fonts/' + fontName + '.json'];\n\t\tcustomFont.dimensions = JSON.parse(json);\n\t\tcustomFont.horizontal = findHorizontalInfo(customFont.dimensions);\n\t\tcustomFont.vertical = findVerticalInfo(customFont.dimensions);\n\n\t\t_customFontInfo[fontName] = {\n\t\t\tdimensions: customFont.dimensions,\n\t\t\thorizontal: customFont.horizontal,\n\t\t\tvertical: customFont.vertical\n\t\t};\n\t}\n\n\tvar images = customFont.images = [];\n\tvar strokeImages = customFont.strokeImages = [];\n\tcustomFont.imagesLoaded = 0;\n\tfor (var i = 0; i < settings.count; i++) {\n\t\timages.push(loadCustomFontImage(customFont, i, false));\n\t\tcustomFont.imagesTotal++;\n\n\t\tif (customFont.settings.stroke) {\n\t\t\tstrokeImages.push(loadCustomFontImage(customFont, i, true));\n\t\t\tcustomFont.imagesTotal++;\n\t\t}\n\t}\n\treturn true;\n};\n\nvar measure = function(ctx, fontInfo, text) {\n\tvar customFont = fontInfo.customFont;\n\tvar dimensions = customFont.dimensions;\n\tvar scale = fontInfo.scale;\n\tvar spacing = (customFont.settings.spacing || 0) * scale;\n\tvar width = 0;\n\tvar failed = true;\n\n\tif (dimensions) {\n\t\tfailed = false;\n\t\tvar prevCharCode = 0;\n\t\tfor (var i = 0, len = text.length; i < len; i++) {\n\t\t\tvar charCode = text.charCodeAt(i);\n\t\t\tif (charCode === 9) { // tab ...\n\t\t\t\twidth += customFont.horizontal.width * 4 * scale;\n\t\t\t} else if (charCode === 32) { // space ...\n\t\t\t\twidth += customFont.horizontal.width * scale;\n\t\t\t} else {\n\t\t\t\tif (dimensions[charCode]) {\n\t\t\t\t\tvar character = dimensions[charCode];\n\t\t\t\t\tvar kern = character.kerning[prevCharCode] || 0;\n\t\t\t\t\twidth += (character.xadvance + kern) * scale + spacing;\n\t\t\t\t} else {\n\t\t\t\t\tfailed = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (failed) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tprevCharCode = charCode;\n\t\t}\n\t}\n\n\tif (failed) {\n\t\tvar font = ctx.font;\n\t\tctx.font = fontInfo.size.value + fontInfo.size.unit + ' ' + (ctx.defaultFontFamily || device.defaultFontFamily);\n\t\tvar result = { failed: true, width: _origMeasureText.apply(ctx, [text]) };\n\t\tctx.font = font;\n\t\treturn result;\n\t} else {\n\t\treturn { failed: false, width: width };\n\t}\n};\n\nvar renderCustomFont = function(ctx, x, y, maxWidth, text, color, fontInfo, index) {\n\tvar measureInfo = measure(ctx, fontInfo, text);\n\tif (measureInfo.failed) {\n\t\treturn false;\n\t}\n\n\tvar customFont = fontInfo.customFont;\n\tvar srcBuffers = index === 0 ? customFont.images : customFont.strokeImages;\n\tvar dimensions = customFont.dimensions;\n\tvar scale = fontInfo.scale;\n\tvar width = measureInfo.width;\n\tif (width > maxWidth) {\n\t\tscale *= maxWidth / width;\n\t}\n\n\tvar spacing = (customFont.settings.spacing || 0) * scale;\n\n\tif (ctx.textBaseline === 'alphabetic') {\n\t\ty -= customFont.vertical.baseline * scale;\n\t} else if (ctx.textBaseline === 'middle') {\n\t\ty -= (customFont.vertical.bottom / 2) * scale;\n\t} else if (ctx.textBaseline === 'bottom') {\n\t\ty -= customFont.vertical.bottom * scale;\n\t}\n\n\tif (ctx.textAlign === 'center') {\n\t\tx -= width / 2;\n\t} else if (ctx.textAlign === 'right') {\n\t\tx -= width;\n\t}\n\n\tvar prevCharCode = 0;\n\tfor (var i = 0, len = text.length; i < len; i++) {\n\t\tvar charCode = text.charCodeAt(i);\n\t\tif (charCode === 9) { // tab ...\n\t\t\tx += customFont.horizontal.width * 4 * scale;\n\t\t} else if (charCode === 32) { // space ...\n\t\t\tx += customFont.horizontal.width * scale;\n\t\t} else {\n\t\t\tvar character = dimensions[charCode];\n\t\t\tvar kern = character.kerning[prevCharCode] || 0;\n\t\t\tx += kern;\n\t\t\tvar img = srcBuffers[character.sheetIndex];\n\t\t\timg.render(\n\t\t\t\tctx,\n\t\t\t\tcharacter.x,\n\t\t\t\tcharacter.y,\n\t\t\t\tcharacter.w,\n\t\t\t\tcharacter.h,\n\t\t\t\tx + character.ox * scale,\n\t\t\t\ty + character.oy * scale,\n\t\t\t\tcharacter.w * scale,\n\t\t\t\tcharacter.h * scale\n\t\t\t);\n\t\t\tx += character.xadvance * scale + spacing;\n\t\t}\n\t\tprevCharCode = charCode;\n\t}\n\n\treturn true;\n};\n\nexports.findFontInfo = function (ctx) {\n\tvar font = Font.parse(ctx.font);\n\tvar name = font.getName();\n\tif (name && _customFonts[name]) {\n\t\tcustomFont = _customFonts[name];\n\t\tfont.customFont = customFont;\n\t\tfont.scale = font.getSize() / customFont.settings.size;\n\t\treturn font;\n\t}\n\treturn null;\n};\n\nexports.wrapMeasureText = function (origMeasureText) {\n\t_origMeasureText = origMeasureText;\n\treturn function (text) {\n\t\tvar fontInfo = exports.findFontInfo(this);\n\t\tif (!fontInfo) {\n\t\t\treturn origMeasureText.apply(this, arguments);\n\t\t}\n\t\tvar measureInfo = measure(this, fontInfo, text);\n\t\tif (measureInfo.failed) {\n\t\t\treturn origMeasureText.apply(this, arguments);\n\t\t}\n\t\treturn measureInfo;\n\t}\n};\n\nexports.wrapFillText = function (origFillText) {\n\treturn function (text, x, y, maxWidth) {\n\t\tvar fontInfo = exports.findFontInfo(this);\n\t\tif (!fontInfo) {\n\t\t\treturn origFillText.apply(this, arguments);\n\t\t}\n\t\tif (loadingCustomFont(fontInfo.customFont)) {\n\t\t\treturn;\n\t\t}\n\t\tif (isNaN(x)) {\n\t\t\tx = 0;\n\t\t}\n\t\tif (isNaN(y)) {\n\t\t\ty = 0;\n\t\t}\n\n\t\t// apply color filters if necessary\n\t\tvar color = Color.parse(this.fillStyle);\n\t\tif (!this.filters[\"Tint\"]) {\n\t\t\tthis.filters[\"Tint\"] = new filter.TintFilter(color);\n\t\t}\n\t\tif (this.__bmpTxtColor !== color) {\n\t\t\tthis.__bmpTxtColor = color;\n\t\t\tthis.filters[\"Tint\"].update(color);\n\t\t}\n\n\t\tif (!renderCustomFont(this, x, y, maxWidth, text + '', this.fillStyle, fontInfo, 0)) {\n\t\t\tvar font = this.font;\n\t\t\tthis.font = fontInfo.size.value + fontInfo.size.unit + ' ' + (this.defaultFontFamily || device.defaultFontFamily);\n\t\t\torigFillText.apply(this, [text, x, y]);\n\t\t\tthis.font = font;\n\t\t}\n\t}\n};\n\nexports.wrapStrokeText = function (origStrokeText) {\n\treturn function (text, x, y, maxWidth) {\n\t\tvar fontInfo = exports.findFontInfo(this);\n\t\tif (!fontInfo) {\n\t\t\treturn origStrokeText.apply(this, arguments);\n\t\t}\n\t\tif (loadingCustomFont(fontInfo.customFont)) {\n\t\t\treturn;\n\t\t}\n\t\tif (isNaN(x)) {\n\t\t\tx = 0;\n\t\t}\n\t\tif (isNaN(y)) {\n\t\t\ty = 0;\n\t\t}\n\n\t\t// apply color filters if necessary\n\t\tvar color = Color.parse(this.strokeStyle);\n\t\tif (!this.filters[\"Tint\"]) {\n\t\t\tthis.filters[\"Tint\"] = new filter.TintFilter(color);\n\t\t}\n\t\tif (this.__bmpTxtColor !== color) {\n\t\t\tthis.__bmpTxtColor = color;\n\t\t\tthis.filters[\"Tint\"].update(color);\n\t\t}\n\n\t\tif (!renderCustomFont(this, x, y, maxWidth, text + '', this.strokeStyle, fontInfo, 1)) {\n\t\t\tvar font = this.font;\n\t\t\tthis.font = fontInfo.size.value + fontInfo.size.unit + ' ' + (this.defaultFontFamily || device.defaultFontFamily);\n\t\t\torigStrokeText.apply(this, [text, x, y]);\n\t\t\tthis.font = font;\n\t\t}\n\t}\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/resource/Image.js":{"path":"modules/devkit-core/modules/timestep/src/ui/resource/Image.js","friendlyPath":"ui.resource.Image","directory":"modules/devkit-core/modules/timestep/src/ui/resource/","filename":"Image.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.resource.Image;\n * Model an Image for rendering. Supports taking a subset of images, to support\n * extracting from compacted sprite sheets. Also supports applying filters to\n * an image, usually by the View class.\n *\n * @doc http://doc.gameclosure.com/api/ui-imageview.html#class-ui.resource.image\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/imageview.md\n */\n\njsio('import device');\njsio('import lib.PubSub');\njsio('import event.Callback as Callback');\njsio('import ui.resource.loader as resourceLoader');\njsio('import ui.backend.canvas.filterRenderer as filterRenderer');\n\nvar ImageCache = {};\n\nvar GET_IMAGE_DATA_NOT_SUPPORTED = (!GLOBAL.document || !document.createElement);\n/**\n * Callback when images are loaded. This has a failsafe that runs up to a certain\n * threshold asynchronously, attempting to read the image size, before dying.\n */\n\n\n// `imageOnLoad` is called when a DOM image object fires a `load` or `error`\n// event.  Fire the internal `cb` with the error status.\nfunction imageOnLoad(success, evt, failCount) {\n\tif (success && !this.width) {\n\t\t// Some browsers fire the load event before the image width is\n\t\t// available.  Wait up to 3 frames for the width.  Note that an image\n\t\t// with zero-width will be considered an error.\n\t\tif (failCount <= 3) {\n\t\t\tsetTimeout(bind(this, imageOnLoad, success, evt, (failCount || 0) + 1), 0);\n\t\t} else {\n\t\t\tthis.__cb.fire(false);\n\t\t}\n\t} else {\n\t\tthis.__cb.fire(!success);\n\t}\n}\n\n/**\n * This class models the region of a larger image that this \"Image\" references.\n */\n\nvar ImageMap = !CONFIG.disableNativeViews\n\t&& NATIVE.timestep && NATIVE.timestep.ImageMap;\nif (!ImageMap) {\n\tImageMap=__class__;ImageMap=ImageMap(function ImageMap(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\tthis.init = function (parentImage, x, y, width, height, marginTop, marginRight, marginBottom, marginLeft, url) {\n\t\t\tthis.url = url;\n\t\t\tthis.x = x;\n\t\t\tthis.y = y;\n\t\t\tthis.width = width;\n\t\t\tthis.height = height;\n\t\t\tthis.marginTop = marginTop;\n\t\t\tthis.marginRight = marginRight;\n\t\t\tthis.marginBottom = marginBottom;\n\t\t\tthis.marginLeft = marginLeft;\n\t\t};\n\t});\n}\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_resource_Image=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_resource_Image(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_resource_Image(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\n\tvar isNative = GLOBAL.NATIVE && !device.isNativeSimulator;\n\tvar isWebGL = CONFIG.useWebGL;\n\tvar Canvas = device.get('Canvas');\n\n\t// helper canvases for image data, initialized when/if needed\n\tvar _imgDataCanvas = null;\n\tvar _imgDataCtx = null;\n\n\tthis.init = function (opts) {\n\t\tif (!opts) {\n\t\t\topts = {};\n\t\t}\n\n\t\tthis._cb = new Callback();\n\t\tthis._map = new ImageMap(this, 0, 0, -1, -1, 0, 0, 0, 0, opts.url || '');\n\t\tthis._originalURL = opts.url || '';\n\t\tthis._scale = opts.scale || 1;\n\t\tthis._isError = false;\n\n\t\tresourceLoader._updateImageMap(this._map, opts.url, opts.sourceX, opts.sourceY, opts.sourceW, opts.sourceH);\n\n\t\t// srcImage can be null, then setSrcImg will create one\n\t\t// (use the map's URL in case it was updated to a spritesheet)\n\t\tthis._setSrcImg(opts.srcImage, this._map.url, opts.forceReload);\n\t};\n\n\tthis._setSrcImg = function (img, url, forceReload) {\n\t\tthis._cb.reset();\n\n\t\t// if we haven't found an image, look in the image cache\n\t\tif (!img && url && !forceReload && ImageCache[url]) {\n\t\t\timg = ImageCache[url];\n\t\t}\n\n\t\t// look up the base64 cache -- if it's been preloaded, we'll get back an image that's already loaded\n\t\t// if it has not been preloaded, we'll get back raw base64 in the b64 variable\n\t\tif (!img && !forceReload && Image.get) {\n\t\t\tvar b64 = Image.get(url);\n\t\t\tif (typeof b64 === 'object') {\n\t\t\t\timg = b64;\n\t\t\t} else if (b64) {\n\t\t\t\turl = b64;\n\t\t\t}\n\t\t}\n\n\t\tif (forceReload) {\n\t\t\t// clear native texture in an image object\n\t\t\tif (img && img.destroy) {\n\t\t\t\timg.destroy();\n\t\t\t}\n\n\t\t\t// clear native textures by URL\n\t\t\tif (url && NATIVE.gl && NATIVE.gl.deleteTexture) {\n\t\t\t\tNATIVE.gl.deleteTexture(url);\n\t\t\t}\n\t\t}\n\n\t\t// create an image if we don't have one\n\t\tif (!img) {\n\t\t\timg = new Image();\n\t\t}\n\n\t\tthis._srcImg = img;\n\n\t\tif (img instanceof HTMLCanvasElement || img instanceof Canvas) {\n\t\t\tthis._onLoad(false, img); // no error\n\t\t} else {\n\t\t\t// if it's already loaded, we call _onLoad immediately. Note that\n\t\t\t// we don't use `.complete` here intentionally since web browsers\n\t\t\t// set `.complete = true` before firing on the load/error\n\t\t\t// callbacks, so we can't actually detect whether there's an error\n\t\t\t// in some cases.\n\t\t\tif (!img.__cb) {\n\t\t\t\timg.__cb = new Callback();\n\t\t\t\timg.addEventListener('load', bind(img, imageOnLoad, true), false);\n\t\t\t\timg.addEventListener('error', bind(img, imageOnLoad, false), false);\n\n\t\t\t\tif (url) {\n\t\t\t\t\tImageCache[url] = img;\n\t\t\t\t}\n\n\t\t\t\tif (!img.src && url) {\n\t\t\t\t\timg.src = this._map.url = url;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\timg.__cb.run(this, function (err) {\n\t\t\t\tthis._onLoad(err, img);\n\t\t\t});\n\t\t}\n\t};\n\n\tthis.getSource = this.getSrcImg = function () {\n\t\treturn this._srcImg;\n\t};\n\n\tthis.setSource = this.setSrcImg = function (srcImg) {\n\t\tthis._setSrcImg(srcImg);\n\t};\n\n\tthis.reload = function (cb) {\n\t\tvar srcImg = this._srcImg;\n\t\tif (srcImg) {\n\t\t\t// if passed a lib.Callback, chain it\n\t\t\tif (cb && cb.chain) {\n\t\t\t\tcb = cb.chain();\n\t\t\t}\n\n\t\t\t// GC native has a reload method to force reload\n\t\t\tif (srcImg.reload) {\n\t\t\t\tvar onReload = bind(this, function () {\n\t\t\t\t\tsrcImg.removeEventListener('reload', onReload, false);\n\t\t\t\t\tcb && cb();\n\t\t\t\t});\n\t\t\t\tsrcImg.addEventListener('reload', onReload, false);\n\t\t\t\tsrcImg.reload();\n\t\t\t} else if (cb) {\n\t\t\t\tif (this._cb.fired()) {\n\t\t\t\t\t// always wait a frame before calling the callback\n\t\t\t\t\tsetTimeout(cb, 0);\n\t\t\t\t} else {\n\t\t\t\t\tthis._cb.run(cb);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getURL = function () {\n\t\treturn this._map.url;\n\t};\n\n\tthis.getOriginalURL = function () {\n\t\treturn this._originalURL;\n\t};\n\n\tthis.getSourceX = function () {\n\t\treturn this._map.x;\n\t};\n\n\tthis.getSourceY = function () {\n\t\treturn this._map.y;\n\t};\n\n\tthis.getSourceWidth = this.getSourceW = function () {\n\t\treturn this._map.width;\n\t};\n\n\tthis.getSourceHeight = this.getSourceH = function () {\n\t\treturn this._map.height;\n\t};\n\n\tthis.getOrigWidth = this.getOrigW = function () {\n\t\treturn this._srcImg.width;\n\t};\n\n\tthis.getOrigHeight = this.getOrigH = function () {\n\t\treturn this._srcImg.height;\n\t};\n\n\tthis.setSourceX = function (x) {\n\t\tthis._map.x = x;\n\t};\n\n\tthis.setSourceY = function (y) {\n\t\tthis._map.y = y;\n\t};\n\n\tthis.setSourceWidth = this.setSourceW = function (w) {\n\t\tthis._map.width = w;\n\t};\n\n\tthis.setSourceHeight = this.setSourceH = function (h) {\n\t\tthis._map.height = h;\n\t};\n\n\tthis.setMarginTop = function (n) {\n\t\tthis._map.marginTop = n;\n\t};\n\n\tthis.setMarginRight = function (n) {\n\t\tthis._map.marginRight = n;\n\t};\n\n\tthis.setMarginBottom = function (n) {\n\t\tthis._map.marginBottom = n;\n\t};\n\n\tthis.setMarginLeft = function (n) {\n\t\tthis._map.marginLeft = n;\n\t};\n\n\tthis.setURL = function (url, forceReload) {\n\t\tresourceLoader._updateImageMap(this._map, url);\n\t\tthis._setSrcImg(null, this._map.url, forceReload);\n\t};\n\n\tthis.getWidth = function () {\n\t\tvar map = this._map;\n\t\treturn (map.width == -1 ? 0\n\t\t\t: map.width + map.marginLeft + map.marginRight) / map.scale;\n\t};\n\n\tthis.getHeight = function () {\n\t\tvar map = this._map;\n\t\treturn (map.height === -1 ? 0\n\t\t\t: map.height + map.marginTop + map.marginBottom) / map.scale;\n\t};\n\n\tthis.getMap = this.getBounds = function () {\n\t\treturn this._map;\n\t};\n\n\tthis.setMap = this.setBounds = function (x, y, w, h, marginTop, marginRight, marginBottom, marginLeft) {\n\t\tvar map = this._map;\n\t\tmap.x = x;\n\t\tmap.y = y;\n\t\tmap.width = w;\n\t\tmap.height = h;\n\t\tmap.marginTop = marginTop || 0;\n\t\tmap.marginRight = marginRight || 0;\n\t\tmap.marginBottom = marginBottom || 0;\n\t\tmap.marginLeft = marginLeft || 0;\n\t\tthis.emit('changeBounds');\n\t};\n\n\t// register a callback for onload\n\tthis.doOnLoad = function () {\n\t\tthis._cb.forward(arguments);\n\t\treturn this;\n\t};\n\n\t// internal onload handler for actual Image object\n\t// img is the internal image that triggered the _onLoad callback\n\tthis._onLoad = function (err, img) {\n\t\tvar map = this._map;\n\t\tvar srcImg = this._srcImg;\n\t\t// if our source image has changed we should ignore this onload callback\n\t\t// this can happen if _setSrcImg is called multiple times with different urls/images\n\t\tif (img && img !== srcImg) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (err) {\n\t\t\t// TODO: something better?\n\t\t\tlogger.ERROR&&console.error(\"ERROR\",\"ui.resource.Image\",'Image failed to load:', map.url);\n\t\t\tthis._isError = true;\n\t\t\tthis._cb.fire({ NoImage: true });\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isError = false;\n\n\t\tif (srcImg.width === 0) {\n\t\t\tlogger.WARN&&console.warn(\"WARN\",\"ui.resource.Image\",'Image has no width', this._url);\n\t\t}\n\n\t\tif (this._scale !== 1 && (map.width !== -1 || map.height !== -1)) {\n\t\t\t// requested scale & provided a width or height\n\t\t\tif (map.width === -1) {\n\t\t\t\t// by the above check, this._sourceH should not be -1\n\t\t\t\tmap.width = srcImg.width * map.height / srcImg.height;\n\t\t\t}\n\n\t\t\tif (map.height === -1) {\n\t\t\t\t// this._sourceW was initialized above\n\t\t\t\tmap.height = srcImg.height * map.width / srcImg.width;\n\t\t\t}\n\n\t\t\t// TODO: sourceImage might be shared so we can't actually modify width/height. This is a bug.\n\t\t\tsrcImg.width = map.width;\n\t\t\tsrcImg.height = map.height;\n\t\t} else {\n\t\t\tif (map.width === -1) {\n\t\t\t\tmap.width = srcImg.width;\n\t\t\t}\n\t\t\tif (map.height === -1) {\n\t\t\t\tmap.height = srcImg.height;\n\t\t\t}\n\t\t}\n\n\t\tmap.url = srcImg.src;\n\t\tthis._cb.fire(null, this);\n\t};\n\n\tthis.isError = function () {\n\t\treturn this._isError;\n\t};\n\n\tthis.isLoaded = this.isReady = function () {\n\t\treturn !this._isError && this._cb.fired();\n\t};\n\n\n\n\tthis.render = function (ctx) {\n\t\tif (!this._cb.fired() || this._isError) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar argumentCount = arguments.length;\n\t\tvar map = this._map;\n\t\tvar srcImg = this._srcImg;\n\t\tvar srcX = map.x;\n\t\tvar srcY = map.y;\n\t\tvar srcW = map.width;\n\t\tvar srcH = map.height;\n\t\tvar destX = argumentCount > 5 ? arguments[5] : arguments[1] || 0;\n\t\tvar destY = argumentCount > 6 ? arguments[6] : arguments[2] || 0;\n\t\tvar destW = argumentCount > 7 ? arguments[7] : arguments[3] || 0;\n\t\tvar destH = argumentCount > 8 ? arguments[8] : arguments[4] || 0;\n\n\t\tif (argumentCount < 9) {\n\t\t\tvar scaleX = destW / (map.marginLeft + map.width + map.marginRight);\n\t\t\tvar scaleY = destH / (map.marginTop + map.height + map.marginBottom);\n\t\t\tdestX += scaleX * map.marginLeft;\n\t\t\tdestY += scaleY * map.marginTop;\n\t\t\tdestW = scaleX * map.width;\n\t\t\tdestH = scaleY * map.height;\n\t\t} else {\n\t\t\tsrcX = arguments[1];\n\t\t\tsrcY = arguments[2];\n\t\t\tsrcW = arguments[3];\n\t\t\tsrcH = arguments[4];\n\t\t}\n\n\t\tif (!isNative && ctx.filters) {\n\t\t\tvar filterImg = filterRenderer.renderFilter(ctx, this, srcX, srcY, srcW, srcH);\n\t\t\tif (filterImg) {\n\t\t\t\tsrcImg = filterImg;\n\t\t\t\tsrcX = 0;\n\t\t\t\tsrcY = 0;\n\t\t\t}\n\t\t}\n\n\t\tctx.drawImage(srcImg, srcX, srcY, srcW, srcH, destX, destY, destW, destH);\n\t};\n\n\tthis.getImageData = function (x, y, width, height) {\n\t\t// initialize a shared imgDataCanvas when/if needed\n\t\tif (_imgDataCanvas === null) {\n\t\t\t_imgDataCanvas = new Canvas();\n\t\t\t_imgDataCtx = _imgDataCanvas.getContext('2d');\n\t\t}\n\n\t\tvar map = this._map;\n\t\tif (GET_IMAGE_DATA_NOT_SUPPORTED) { throw 'Not supported'; }\n\t\tif (!map.width || !map.height) { throw 'Not loaded'; }\n\n\t\tx = x || 0;\n\t\ty = y || 0;\n\t\twidth = width || map.width;\n\t\theight = height || map.height;\n\t\t_imgDataCanvas.width = width;\n\t\t_imgDataCanvas.height = height;\n\n\t\t_imgDataCtx.clear();\n\t\tthis.render(_imgDataCtx, x, y, width, height, 0, 0, width, height);\n\t\treturn _imgDataCtx.getImageData(0, 0, width, height);\n\t};\n\n\tthis.setImageData = function (data) {};\n\n\tthis.destroy = function () {\n\t\tthis._srcImg.destroy && this._srcImg.destroy();\n\t};\n\n});\n\nexports.__clearCache__ = function () {\n  ImageCache = {};\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/event/Callback.js":{"path":"modules/devkit-core/modules/timestep/src/event/Callback.js","friendlyPath":"event.Callback","directory":"modules/devkit-core/modules/timestep/src/event/","filename":"Callback.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.Callback;\n * Namespace shim to bring in Callback from jsio.\n *\n * @doc http://doc.gameclosure.com/api/event.html#class-event.callback\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/event.md\n */\n\njsio('import lib.Callback as exports');\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/resource/loader.js":{"path":"modules/devkit-core/modules/timestep/src/ui/resource/loader.js","friendlyPath":"ui.resource.loader","directory":"modules/devkit-core/modules/timestep/src/ui/resource/","filename":"loader.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import .i18n');\njsio('import lib.Callback');\njsio('import event.Emitter as Emitter');\n\nvar _cache = {};\n\nvar MIME = {\n\t'.png': 'image',\n\t'.jpg': 'image',\n\t'.bmp': 'image',\n\t'.css': 'css',\n\t'.html': 'html',\n\t'.mp3': 'audio',\n\t'.ogg': 'audio',\n\t'.mp4': 'audio',\n\t'.3gp': 'audio',\n\t'.m4a': 'audio',\n\t'.aac': 'audio',\n\t'.flac': 'audio',\n\t'.mkv': 'audio',\n\t'.wav': 'audio'\n};\n\nLoader=__class__;var Loader=Loader(function Loader(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n\n\tvar globalItemsToLoad = 0;\n\tvar globalItemsLoaded = 0;\n\n\tthis._map = {};\n\n\tObject.defineProperty(this, \"progress\", {\n\t\tget: function() {\n\t\t\treturn globalItemsToLoad > 0 ? globalItemsLoaded / globalItemsToLoad : 1\n\t\t}\n\t});\n\n\tthis.has = function (src) {\n\t\treturn this._map[src];\n\t};\n\n\tthis.getMap = function () {\n\t\treturn this._map;\n\t};\n\n\tthis.setMap = function (map) {\n\t\tthis._map = i18n.localizeResourceMap(map);\n\t};\n\n\t// TODO: rename this function...\n\tthis.get = function (file) {\n\t\treturn 'resources/images/' + file;\n\t};\n\n\t/**\n\t * Adds spritesheets to the image map\n\t *\n\t * @param {Object[]} sheets          an array of spritesheet definitions\n\t * @param {string}   sheets[].f      sprite filename\n\t * @param {number}   sheets[].x      sprite position x-coordinate (integer)\n\t * @param {number}   sheets[].y      sprite position y-coordinate (integer)\n\t * @param {number}   sheets[].w      sprite content width (without margin) (integer)\n\t * @param {number}   sheets[].h      sprite content height (without margin) (integer)\n\t * @param {number}   [sheets[].t=0]  sprite transparent margin top\n\t * @param {number}   [sheets[].r=0]  sprite transparent margin right\n\t * @param {number}   [sheets[].b=0]  sprite transparent margin bottom\n\t * @param {number}   [sheets[].l=0]  sprite transparent margin left\n\t */\n\tthis.addSheets = function (sheets) {\n\t\tObject.keys(sheets).forEach(function (name) {\n\t\t\tvar sheet = sheets[name];\n\t\t\tsheet.forEach(function (info) {\n\t\t\t\tthis._map[info.f] = {\n\t\t\t\t\tsheet: name,\n\t\t\t\t\tx: info.x || 0,\n\t\t\t\t\ty: info.y || 0,\n\t\t\t\t\tw: info.w || 0,\n\t\t\t\t\th: info.h || 0,\n\t\t\t\t\tscale: info.s || 1,\n\t\t\t\t\tmarginTop: info.t || 0,\n\t\t\t\t\tmarginRight: info.r || 0,\n\t\t\t\t\tmarginBottom: info.b || 0,\n\t\t\t\t\tmarginLeft: info.l || 0\n\t\t\t\t};\n\t\t\t}, this);\n\t\t}, this);\n\t};\n\n\t/**\n\t * Preload a given resource or array of resources.\n\t * You can specify a folder name, or even a partial filename,\n\t * to preload all resources that begin with that prefix.\n\t * For instance, in a tree like so:\n\t *\n\t * resources\n\t * └── images\n     *     ├── boss\n     *     │   ├── enemy1.png\n\t *     │   └── enemy2.png\n     *     └── hero\n     *         ├── shield.png\n\t *         └── sword.png\n\t *\n\t * You could preload both enemy images in either of the following\n\t * ways:\n\t *\n\t *     ui.resource.loader.preload(\"resources/images/boss/\");\n\t *     ui.resource.loader.preload(\"resources/images/boss/enemy\");\n\t *\n\t * Pass an array of paths to preload all at once. The callback\n\t * will be called when all resources have finished loading.\n\t *\n\t * This works for both images and sounds.\n\t */\n\tthis.preload = function (pathPrefix, opts, cb) {\n\t\tif (typeof opts == 'function') {\n\t\t\tcb = opts;\n\t\t\topts = undefined;\n\t\t}\n\n\t\t// process an array of items, where cb is run at completion of the final one\n\t\tif (isArray(pathPrefix)) {\n\t\t\tvar chainCb = new lib.Callback();\n\t\t\tpathPrefix.forEach(function (prefix) {\n\t\t\t\tif (prefix) {\n\t\t\t\t\tthis.preload(prefix, opts, chainCb.chain());\n\t\t\t\t}\n\t\t\t}, this);\n\t\t\tcb && chainCb.run(cb);\n\t\t\treturn chainCb;\n\t\t} else {\n\t\t\tpathPrefix = pathPrefix.replace(/^\\//, ''); // remove leading slash\n\t\t\t// if an item is found in the map, add that item's sheet to the group.\n\t\t\t// If there is no sheet in the map (i.e. for sounds), load that file directly.\n\t\t\tvar preloadSheets = {};\n\t\t\tvar map = this._map;\n\t\t\tfor (var uri in map) {\n\t\t\t\tif (uri.indexOf(pathPrefix) == 0) {\n\t\t\t\t\t// sprites have sheet; sounds are just by the filename key itself\n\t\t\t\t\tpreloadSheets[map[uri] && map[uri].sheet || uri] = true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tvar files = Object.keys(preloadSheets);\n\n\t\t\t// If no files were specified by the preload command,\n\t\t\tif (files.length == 0) {\n\t\t\t\tfiles = [pathPrefix];\n\t\t\t}\n\n\t\t\tvar callback = this._loadGroup(merge({resources: files}, opts));\n\t\t\tcb && callback.run(cb);\n\t\t\treturn callback;\n\t\t}\n\t};\n\n\tvar _soundManager = null;\n\tvar _soundLoader = null;\n\tthis.getSound = function (src) {\n\t\tif (!_soundManager) {\n\t\t\tjsio('import AudioManager');\n\t\t\t_soundManager = new AudioManager({ preload: true });\n\t\t\t_soundLoader = _soundManager.getAudioLoader();\n\t\t}\n\n\t\tif (GLOBAL.NATIVE && GLOBAL.NATIVE.sound && GLOBAL.NATIVE.sound.preloadSound) {\n\t\t\treturn NATIVE.sound.preloadSound(src);\n\t\t} else {\n\t\t\t_soundManager.addSound(src);\n\t\t\t//HACK to make the preloader continue in the browser\n\t\t\treturn { complete: true, loader: _soundLoader };\n\t\t}\n\t};\n\n\tthis.getImagePaths = function (prefix) {\n\t\tprefix = prefix.replace(/^\\//, ''); // remove leading slash\n\t\tvar images = [];\n\t\tvar map = this._map;\n\t\tfor (var uri in map) {\n\t\t\tif (uri.indexOf(prefix) == 0) {\n\t\t\t\timages.push(uri);\n\t\t\t}\n\t\t}\n\t\treturn images;\n\t};\n\n\tthis.getImage = function (src, noWarn) {\n\t\t// create the image\n\t\tvar img = new Image();\n\n\t\t// find the base64 image if it exists\n\t\tif (Image.get) {\n\t\t\tvar b64 = Image.get(src);\n\t\t\tif (b64 instanceof Image) {\n\t\t\t\treturn b64;\n\t\t\t}\n\t\t}\n\n\t\tif (b64) {\n\t\t\timg.src = b64;\n\t\t\tImage.set(src, img);\n\t\t} else {\n\t\t\tif (!noWarn) {\n\t\t\t\tlogger.WARN&&console.warn(\"WARN\",\"ui.resource.loader\",\"Preload Warning:\", src, \"not properly cached!\");\n\t\t\t}\n\t\t\timg.src = src;\n\t\t}\n\n\t\treturn img;\n\t};\n\n\t/**\n\t * used internally by timestep.Image to seamlessly convert\n\t * non-sprited image URLs to sprited images. This is here (rather\n\t * than in timestep.Image) to keep sprite formats in one consistent place.\n\t */\n\tthis._updateImageMap = function (map, url, x, y, w, h) {\n\t\tx = x || 0;\n\t\ty = y || 0;\n\t\tw = w == undefined ? -1 : w;\n\t\th = h == undefined ? -1 : h;\n\n\t\tvar info = this._map[url];\n\t\tif (!info || !info.sheet) {\n\t\t\tmap.x = x;\n\t\t\tmap.y = y;\n\t\t\tmap.width = w;\n\t\t\tmap.height = h;\n\t\t\tmap.scale = 1;\n\t\t\tmap.url = url;\n\t\t\treturn;\n\t\t}\n\n\t\tvar scale = info.scale || 1;\n\n\t\t// calculate the source rectangle, with margins added to the edges\n\t\t// (disregarding the fact that they may fall off the edge of the sheet)\n\t\tmap.x = info.x - info.marginLeft;\n\t\tmap.y = info.y - info.marginTop;\n\t\tmap.width = info.w + info.marginLeft + info.marginRight;\n\t\tmap.height = info.h + info.marginTop + info.marginBottom;\n\n\t\t// Add in any source map options passed in to get the actual offsets\n\t\tmap.x += x * scale;\n\t\tmap.y += y * scale;\n\t\tif (w > 0) {\n\t\t\tmap.width = w * scale;\n\t\t}\n\t\tif (h > 0) {\n\t\t\tmap.height = h * scale;\n\t\t}\n\n\t\t// now updatea the margins to account for the new source map\n\t\tmap.marginLeft = Math.max(0, info.x - map.x);\n\t\tmap.marginTop = Math.max(0, info.y - map.y);\n\t\tmap.marginRight = Math.max(0, (map.x + map.width) - (info.x + info.w));\n\t\tmap.marginBottom = Math.max(0, (map.y + map.height) - (info.y + info.h));\n\n\t\t// and re-offset the source map to exclude margins\n\t\tmap.x += map.marginLeft;\n\t\tmap.y += map.marginTop;\n\t\tmap.width -= (map.marginLeft + map.marginRight);\n\t\tmap.height -= (map.marginTop + map.marginBottom);\n\n\t\t// the scale of the source image, if scaled in a spritesheet\n\t\tmap.scale = scale;\n\t\tmap.url = info.sheet;\n\t\treturn map;\n\t};\n\n\tthis._getRaw = function (type, src, copy, noWarn) {\n\t\t// always return the cached copy unless specifically requested not to\n\t\tif (!copy && _cache[src]) { return _cache[src]; }\n\t\tvar res = null;\n\t\tswitch (type) {\n\t\t\tcase 'audio':\n\t\t\t\tres = this.getSound(src);\n\t\t\t\tbreak;\n\t\t\tcase 'image':\n\t\t\t\tres = this.getImage(src, noWarn);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tlogger.ERROR&&console.error(\"ERROR\",\"ui.resource.loader\",\"Preload Error: Unknown Type\", type);\n\t\t}\n\t\treturn (_cache[src] = res);\n\t};\n\n\t// The callback is called for each image in the group with the image\n\t// source that loaded and whether there was an error.\n\t//\n\t// function callback(lastSrc, error, isComplete, numCompleted, numTotal)\n\t//    where error is true or false and isComplete is true when numCompleted == numTotal\n\t//\n\tthis._loadGroup = function (opts, cb) {\n\t\tvar timeout = opts.timeout;\n\t\tvar callback = new lib.Callback();\n\t\tvar that = this;\n\n\t\t// compute a list of images using file extensions\n\t\tvar resources = opts.resources || [];\n\t\tvar n = resources.length || 0;\n\t\tvar loadableResources = [];\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tvar ext = resources[i].substring(resources[i].lastIndexOf('.')).split('|')[0];\n\t\t\tif (MIME[ext] == 'image') {\n\t\t\t\tloadableResources.push({type:'image', resource: resources[i]});\n\t\t\t\tGLOBAL.NATIVE && NATIVE.gl && NATIVE.gl.touchTexture(resources[i]);\n\t\t\t} else if (MIME[ext] == 'audio') {\n\t\t\t\tloadableResources.push({type:'audio', resource: resources[i]});\n\t\t\t}\n\t\t}\n\n\t\t// If no resources were loadable,\n\t\tif (!loadableResources.length) {\n\t\t\tlogger.WARN&&console.warn(\"WARN\",\"ui.resource.loader\",\"Preload Fail: No Loadable Resources Found\");\n\t\t\tcb && callback.run(cb);\n\t\t\tcallback.fire();\n\t\t\treturn callback;\n\t\t}\n\n\t\t// do the preload asynchronously (note that base64 is synchronous, only downloads are asynchronous)\n\t\tvar nextIndexToLoad = 0;\n\t\tvar numResources = loadableResources.length;\n\t\tglobalItemsToLoad += numResources;\n\t\tvar parallel = Math.min(numResources, opts.parallel || 5); // how many should we try to download at a time?\n\t\tvar numLoaded = 0;\n\n\t\tvar loadResource = bind(this, function () {\n\t\t\tvar currentIndex = nextIndexToLoad++;\n\t\t\tvar src = loadableResources[currentIndex];\n\t\t\tvar res;\n\t\t\tif (src) {\n\t\t\t\tres = this._getRaw(src.type, src.resource, false, true);\n\t\t\t} else {\n\t\t\t\t// End of resource list, done!\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar next = function (failed) {\n\t\t\t\t// If already complete, stub this out\n\t\t\t\tif (numLoaded >= numResources) { return; }\n\n\t\t\t\t// Set stubs for the reload and load events so that code\n\t\t\t\t// elsewhere can blindly call these without causing problems.\n\t\t\t\t// An alternative would be to set these to null but not every\n\t\t\t\t// piece of code that uses this does the right checks.\n\t\t\t\tres.onreload = res.onload = res.onerror = function() {};\n\n\t\t\t\t// The number of loads (success or failure) has increased.\n\t\t\t\t++numLoaded;\n\t\t\t\t++globalItemsLoaded;\n\n\t\t\t\t// REALLY hacky progress tracker\n\t\t\t\tif (globalItemsLoaded === globalItemsToLoad) { globalItemsLoaded = globalItemsToLoad = 0; }\n\n\t\t\t\t// If we have loaded all of the resources,\n\t\t\t\tif (numLoaded >= numResources) {\n\t\t\t\t\t// Call the progress callback with isComplete == true\n\t\t\t\t\tcb && cb(src, failed, true, numLoaded, numResources);\n\n\t\t\t\t\t// If a timeout was set, clear it\n\t\t\t\t\tif (_timeout) {\n\t\t\t\t\t\tclearTimeout(_timeout);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Fire the completion callback chain\n\t\t\t\t\tlogger.LOG&&console.log(\"LOG\",\"ui.resource.loader\",\"Preload Complete:\", src.resource);\n\t\t\t\t\tcallback.fire();\n\t\t\t\t} else {\n\t\t\t\t\t// Call the progress callback with the current progress\n\t\t\t\t\tcb && cb(src, failed, false, numLoaded, numResources);\n\n\t\t\t\t\t// Restart on next image in list\n\t\t\t\t\tsetTimeout(loadResource, 0);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// IF this is the type of resource that has a reload method,\n\t\t\tif (res.reload && res.complete) {\n\t\t\t\t// Use the magic of closures to create a chain of onreload\n\t\t\t\t// completion callbacks.  This is really important because\n\t\t\t\t// we can be be preloading the same resource twice, and we can\n\t\t\t\t// also be simultaneously preloading two groups at once.\n\t\t\t\tvar prevOnLoad = res.onreload;\n\t\t\t\tvar prevOnError = res.onerror;\n\n\t\t\t\t// When the resource completes loading, either with success\n\t\t\t\t// or failure:\n\n\t\t\t\tres.onreload = function () {\n\t\t\t\t\t// If previous callback exists, run it first in a chain\n\t\t\t\t\tprevOnLoad && prevOnLoad();\n\n\t\t\t\t\t// React to successful load of this resource\n\t\t\t\t\tnext(false);\n\t\t\t\t};\n\n\t\t\t\tres.onerror = function () {\n\t\t\t\t\t// If previous callback exists, run it first in a chain\n\t\t\t\t\tprevOnError && prevOnError();\n\n\t\t\t\t\t// React to failed load of this resource\n\t\t\t\t\tnext(true);\n\t\t\t\t};\n\n\t\t\t\t// Start it reloading\n\t\t\t\tres.reload();\n\t\t\t} else if (res.complete) {\n\t\t\t\tif (res.loader) {\n\t\t\t\t\t// real sound loading with AudioContext ...\n\t\t\t\t\tres.loader.load([src.resource], next);\n\t\t\t\t} else {\n\t\t\t\t\t// Since the resource has already completed loading, go\n\t\t\t\t\t// ahead and invoke the next callback indicating the previous\n\t\t\t\t\t// success or failure.\n\t\t\t\t\tnext(res.failed === true);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// The comments above about onreload callback chaining equally\n\t\t\t\t// apply here.  See above.\n\t\t\t\tvar prevOnLoad = res.onload;\n\t\t\t\tvar prevOnError = res.onerror;\n\n\t\t\t\t// When the resource completes loading, either with success\n\t\t\t\t// or failure:\n\n\t\t\t\tres.onload = function () {\n\t\t\t\t\t// If previous callback exists, run it first in a chain\n\t\t\t\t\tprevOnLoad && prevOnLoad();\n\n\t\t\t\t\t// Reset fail flag\n\t\t\t\t\tres.failed = false;\n\n\t\t\t\t\t// Let subscribers know an image was loaded\n\t\t\t\t\tif (res instanceof Image) {\n\t\t\t\t\t\tthat.emit(Loader.IMAGE_LOADED, res);\n\t\t\t\t\t}\n\n\t\t\t\t\t// React to successful load of this resource\n\t\t\t\t\tnext(false);\n\t\t\t\t};\n\n\t\t\t\tres.onerror = function () {\n\t\t\t\t\t// If previous callback exists, run it first in a chain\n\t\t\t\t\tprevOnError && prevOnError();\n\n\t\t\t\t\t// Set fail flag\n\t\t\t\t\tres.failed = true;\n\n\t\t\t\t\t// React to failed load of this resource\n\t\t\t\t\tnext(true);\n\t\t\t\t};\n\t\t\t}\n\t\t});\n\n\t\tvar _timeout = null;\n\t\tsetTimeout(function () {\n\t\t\t// spin up n simultaneous loaders!\n\t\t\tfor (var i = 0; i < parallel; ++i) { loadResource(); }\n\n\t\t\t// register timeout call\n\t\t\tif (timeout) {\n\t\t\t\t_timeout = setTimeout(function () {\n\t\t\t\t\tlogger.WARN&&console.warn(\"WARN\",\"ui.resource.loader\",\"Preload Timeout: Something Failed to Load\");\n\t\t\t\t\tcallback.fire();\n\t\t\t\t\tnumLoaded = numResources;\n\t\t\t\t}, timeout);\n\t\t\t}\n\t\t}, 0);\n\t\treturn callback;\n\t};\n\n});\n\nLoader.IMAGE_LOADED = \"imageLoaded\";\n\nexports = new Loader();\n\nexports.IMAGE_LOADED = Loader.IMAGE_LOADED;\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/resource/i18n.js":{"path":"modules/devkit-core/modules/timestep/src/ui/resource/i18n.js","friendlyPath":".i18n","directory":"modules/devkit-core/modules/timestep/src/ui/resource/","filename":"i18n.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar LOCALE_CODES = navigator.language && navigator.language.split('-');\nvar LANGUAGE_CODE = (LOCALE_CODES[0] || 'en').toLowerCase();\nvar REGION_CODE = (LOCALE_CODES[1] || 'US').toUpperCase();\n\nvar EU_REGIONS = [\n\t'AD', 'AT', 'BE', 'BL', 'CY', 'DE', 'EE', 'ES', 'EU', 'FI', 'FR', 'GR',\n\t'IE', 'IT', 'LU', 'LV', 'MC', 'ME', 'MT', 'MQ', 'NL', 'PM', 'PT', 'RE',\n\t'SI', 'SK', 'SM', 'VA', 'YT'\n];\n\n/**\n * The i18n Class provides localization support for string JSON files.\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_resource_i18n=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_resource_i18n(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_resource_i18n(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tvar defaultOpts = {\n\t\tlanguageCode: LANGUAGE_CODE,\n\t\tregionCode: REGION_CODE,\n\t\tstringsPath: 'resources/strings/',\n\t\tdefaultStringsFile: 'en.json'\n\t};\n\n\tthis.init = function (opts) {\n\t\topts = merge(opts, defaultOpts);\n\t\tthis._languageCode = opts.languageCode;\n\t\tthis._regionCode = opts.regionCode;\n\t\tthis._stringsPath = opts.stringsPath;\n\t\tthis._defaultStringsFile = opts.defaultStringsFile;\n\t\tthis._strings = {};\n\n\t\tthis.loadStrings(this._stringsPath, this._defaultStringsFile);\n\t};\n\n\tthis.getLanguageCode = function () {\n\t\treturn this._languageCode;\n\t};\n\n\tthis.getRegionCode = function () {\n\t\treturn this._regionCode;\n\t};\n\n\tthis.loadStrings = function (path, defaultFile) {\n\t\tvar lc = this._languageCode;\n\t\tvar rc = this._regionCode;\n\t\tvar locPath = path + lc + '-' + rc + '.json';\n\t\tvar langPath = path + lc + '.json';\n\t\tvar defPath = path + defaultFile;\n\t\tvar data = CACHE[locPath] || CACHE[langPath] || CACHE[defPath];\n\t\tif (data) {\n\t\t\ttry {\n\t\t\t\tthis._strings = JSON.parse(data);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(\"Error loading strings JSON:\");\n\t\t\t\tconsole.error(e);\n\t\t\t}\n\t\t} else {\n\t\t\tconsole.error(\"No JSON found for files:\", locPath, langPath, defPath);\n\t\t}\n\t};\n\n\tthis.getString = function (key) {\n\t\tvar value = this._strings[key];\n\t\treturn value !== undefined ? value : key;\n\t};\n\n});\n\n/**\n * This function is used by resource/loader to map localized resources to\n * the base resources directory automatically.\n * \n * To leverage this resource localization, structure your resource\n * directories like this:\n *\n * default directory:\n *   resources\n *   └── images\n *       └── hero.png\n * \n * language localized directory:\n *   resources-zh\n *   └── images\n *       └── hero.png\n * \n * regional localized directory:\n *   resources-zh-TW\n *   └── images\n *       └── hero.png\n * \n * You can then always use resources/images/hero.png, and the image will\n * automatically point to the best image for your user's language or region.\n *\n * It also supports regional localization for the EU, to aid in localizing\n * images of currency or currency symbols.\n */\nexports.localizeResourceMap = function (map) {\n\tvar localizedMap = {};\n\t// directories listed in order of priority\n\tvar localeRes = 'resources-' + LANGUAGE_CODE + '-' + REGION_CODE;\n\tvar langRes = 'resources-' + LANGUAGE_CODE;\n\tvar regionRes = 'resources-' + REGION_CODE;\n\tvar euroRes = 'resources-EU';\n\tfor (var key in map) {\n\t\tvar path = key;\n\t\tvar localeIndex = key.indexOf(localeRes);\n\t\tvar langIndex = key.indexOf(langRes);\n\t\tvar regionIndex = key.indexOf(regionRes);\n\t\tvar euroIndex = key.indexOf(euroRes);\n\t\t// replace localized path with default path\n\t\t// i.e. resources-en-US can now be accessed by resources\n\t\tif (localeIndex === 0) {\n\t\t\tpath = 'resources' + key.substring(localeRes.length);\n\t\t} else if (langIndex === 0) {\n\t\t\tpath = 'resources' + key.substring(langRes.length);\n\t\t} else if (regionIndex === 0) {\n\t\t\tpath = 'resources' + key.substring(regionRes.length);\n\t\t} else if (euroIndex === 0 && EU_REGIONS.indexOf(REGION_CODE) !== -1) {\n\t\t\tpath = 'resources' + key.substring(euroRes.length);\n\t\t}\n\t\tlocalizedMap[path] = map[key];\n\t}\n\treturn localizedMap;\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/AudioManager.js":{"path":"modules/devkit-core/modules/timestep/src/AudioManager.js","friendlyPath":"AudioManager","directory":"modules/devkit-core/modules/timestep/src/","filename":"AudioManager.js","baseMod":"AudioManager","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/modules/timestep/src/AudioManager","src":"/**\n* @license\n* This file is part of the Game Closure SDK.\n*\n* The Game Closure SDK is free software: you can redistribute it and/or modify\n* it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n* The Game Closure SDK is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n* Mozilla Public License v. 2.0 for more details.\n\n* You should have received a copy of the Mozilla Public License v. 2.0\n* along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n*/\n\n/**\n* @class AudioManager;\n* Implements platform-aware Audio support.\n*\n* @doc http://doc.gameclosure.com/api/sound.html\n* @docsrc https://github.com/gameclosure/doc/blob/master/api/sound.md\n*/\n\njsio('import device');\njsio('import util.path');\njsio('import event.Emitter as Emitter');\njsio('import ui.backend.sound.AudioLoader as AudioLoader');\n\n// An API for playing named sounds. Sounds can be given a single file source\n// or multiple sources which will be chosen at random at play time. Sounds may\n// also be given a default volume and loop boolean.\n//\n// Only one background sound can be played at a time. They are streamed, not\n// preloaded, on native.\n\n// define AudioContext as best as possible; it may not exist\nwindow.AudioContext = window.AudioContext || window.webkitAudioContext;\n\n// global private variables\nvar _ctx = null;\nvar _muteAll = false;\nvar _registeredAudioManagers = [];\n\n/**\n* RawAudio Class\n*\n* Extend the local instance of Audio objects.\n* Created and used by MultiSound Class.\n*/\nRawAudio=__class__;var RawAudio=RawAudio(function RawAudio(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function () {\n\t\tif (typeof Audio === \"undefined\") {\n\t\t\treturn null;\n\t\t}\n\n\t\t// we can't extend an HTML5 audio object in a browser, so do our best\n\t\tvar audio = new Audio();\n\t\tvar proto = RawAudio.prototype;\n\t\tfor (var i in proto) {\n\t\t\tif (!audio[i] && proto.hasOwnProperty(i)) {\n\t\t\t\taudio[i] = proto[i];\n\t\t\t}\n\t\t}\n\n\t\tvar playTimeout = null;\n\t\taudio.oldPlay = audio.play;\n\t\taudio.play = function() {\n\t\t\tif (audio.readyState === 4) {\n\t\t\t\taudio.oldPlay();\n\t\t\t} else {\n\t\t\t\tplayTimeout = setTimeout(audio.play, 32);\n\t\t\t}\n\t\t};\n\t\taudio.oldPause = audio.pause;\n\t\taudio.pause = function() {\n\t\t\tif (playTimeout !== null) {\n\t\t\t\tclearTimeout(playTimeout);\n\t\t\t\tplayTimeout = null;\n\t\t\t}\n\t\t\taudio.oldPause();\n\t\t};\n\n\t\treturn audio;\n\t};\n\n\t// add a stop method that resets the current time\n\tthis.stop = function () {\n\t\t!this.paused && this.pause();\n\t\tif ((this.NETWORK_LOADING === undefined\n\t\t\t|| this.networkState !== this.NETWORK_LOADING\n\t\t\t|| this.networkState !== this.NETWORK_NO_SOURCE)\n\t\t\t\t&& !isNaN(this.duration))\n\t\t{\n\t\t\tthis.currentTime = 0;\n\t\t}\n\t};\n});\n\n/**\n* MultiSound Class\n*\n* A sound object that can play one of a collection of audio sources.\n* Created and used by exported AudioManager Class.\n*/\nMultiSound=__class__;var MultiSound=MultiSound(function MultiSound(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (soundManager, name, opts) {\n\t\topts = typeof opts === 'string' ? { sources: [opts] } : (opts || {});\n\n\t\tthis._soundManager = soundManager;\n\t\tthis._name = name;\n\t\tthis._isPaused = false;\n\t\tthis._lastSrc = null;\n\t\tthis._sources = [];\n\t\tthis._paths = [];\n\n\t\tthis._useAudioContext = false;\n\t\tthis._loader = null;\n\t\tthis._gainNode = null;\n\n\t\tthis.loop = opts.loop !== undefined ? opts.loop : opts.background;\n\t\tthis.isBackgroundMusic = opts.background;\n\n\t\t// if a list of file names is given in sources, load them as alternative\n\t\t// clips for this sound. Else, assume the only clip for this sound\n\t\t// is the file with its same name\n\t\tvar srcList = opts.sources || [name];\n\t\tvar sources = this._sources;\n\t\tvar paths = this._paths;\n\t\tvar basePath = soundManager.getPath();\n\t\tvar ext = soundManager.getExt();\n\t\tvar extTestExp = new RegExp(ext + '$', 'i');\n\t\tvar loop = this.loop;\n\t\tvar volume = opts.volume !== undefined ? opts.volume : 1;\n\n\t\t// HTML5 hack for browsers\n\t\tvar isPaused = bind(this, 'isPaused');\n\t\tvar _checkPauseOnPlay = function (src) {\n\t\t\tthis.removeEventListener(arguments.callee);\n\t\t\tisPaused() && this.pause();\n\t\t};\n\n\t\tif (_ctx) {\n\t\t\tthis._useAudioContext = true;\n\t\t\tthis._loader = soundManager.getAudioLoader();\n\t\t\tthis._gainNode = _ctx.createGain();\n\t\t\tthis._gainNode.connect(_ctx.destination);\n\t\t\tthis._gainNode.gain.value = volume;\n\t\t}\n\n\t\tfor (var i = 0, src; src = srcList[i]; ++i) {\n\t\t\t// file paths are relative to the base path\n\t\t\tvar fullPath = util.path.join(basePath, opts.path, src);\n\t\t\t// append the extension if not already provided\n\t\t\tif (!extTestExp.test(fullPath)) {\n\t\t\t\tfullPath += ext;\n\t\t\t}\n\t\t\tpaths.push(fullPath);\n\n\t\t\t// prefer AudioContext over Audio\n\t\t\tif (!this._useAudioContext) {\n\t\t\t\tvar audio = new RawAudio();\n\t\t\t\tif (audio) {\n\t\t\t\t\taudio.loop = loop;\n\t\t\t\t\taudio.volume = volume;\n\t\t\t\t\taudio.isBackgroundMusic = opts.background;\n\t\t\t\t\taudio.src = fullPath;\n\t\t\t\t\taudio.preload = ((audio.readyState !== 4) || (soundManager._preload && !opts.background)) ? \"auto\" : \"none\";\n\n\t\t\t\t\t// If you pause or mute an html5 audio object in the browser\n\t\t\t\t\t// before the sound is ready, it will play anyway.  Here, we\n\t\t\t\t\t// check the pause status when the audio starts playing.\n\t\t\t\t\tif (audio.addEventListener) {\n\t\t\t\t\t\taudio.addEventListener('playing', _checkPauseOnPlay);\n\t\t\t\t\t}\n\n\t\t\t\t\tsources.push(audio);\n\t\t\t\t\tif (audio.isBackgroundMusic && NATIVE && NATIVE.sound) {\n\t\t\t\t\t\tNATIVE.sound.registerMusic(fullPath, audio);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getVolume = function () {\n\t\tif (this._useAudioContext) {\n\t\t\treturn this._gainNode.gain.value;\n\t\t} else {\n\t\t\tvar src = this._sources[0];\n\t\t\treturn (src && src.volume) || 0;\n\t\t}\n\t};\n\n\tthis.setVolume = function (volume) {\n\t\tif (this._useAudioContext) {\n\t\t\tthis._gainNode.gain.value = volume;\n\t\t} else {\n\t\t\tfor (var i = 0, src; src = this._sources[i]; ++i) {\n\t\t\t\tsrc.volume = volume;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.stop = function () {\n\t\tif (this._useAudioContext) {\n\t\t\tthis._lastSrc && this._lastSrc.stop(0);\n\t\t\tthis._lastSrc = null;\n\t\t} else {\n\t\t\tfor (var i = 0, src; src = this._sources[i]; ++i) {\n\t\t\t\tsrc.stop();\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.pause = function () {\n\t\tthis._isPaused = true;\n\t\tif (this._useAudioContext) {\n\t\t\tthis.stop();\n\t\t} else {\n\t\t\tfor (var i = 0, src; src = this._sources[i]; ++i) {\n\t\t\t\tsrc.pause();\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.isPaused = function () {\n\t\treturn this._isPaused;\n\t};\n\n\tthis.isPlaying = function () {\n\t\tvar isPlaying = false;\n\t\tif (!this._useAudioContext && this._lastSrc !== null) {\n\t\t\tvar cur = this._lastSrc.currentTime;\n\t\t\tvar dur = this._lastSrc.duration;\n\t\t\t// NaN duration means the duration isn't loaded yet,\n\t\t\t// meaning the sound was started very recently. Since\n\t\t\t// this._lastSrc is defined, we know that the sound has\n\t\t\t// been played, so it's playing unless it's paused :)\n\t\t\tif (isNaN(dur) || cur < dur) {\n\t\t\t\tisPlaying = !this.isPaused();\n\t\t\t}\n\t\t}\n\t\treturn isPlaying;\n\t};\n\n\tthis.getDuration = function () {\n\t\treturn this._lastSrc && this._lastSrc.duration || 0;\n\t};\n\n\tthis.getTime = function () {\n\t\treturn this._lastSrc && this._lastSrc.currentTime || 0;\n\t};\n\n\tthis.setTime = function (t) {\n\t\tif (!this._useAudioContext && this._lastSrc && this.isBackgroundMusic) {\n\t\t\tif (this._lastSrc.duration) {\n\t\t\t\tthis._lastSrc.currentTime = t;\n\t\t\t} else {\n\t\t\t\t//setTimeout(bind(this, 'setTime', t + 0.01), 10);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.play = function (opts) {\n\t\topts = opts || {};\n\t\tvar loop = opts.loop || this.loop;\n\t\tvar time = opts.time || 0;\n\t\tvar duration = opts.duration ? opts.duration * 1000 : undefined;\n\n\t\tif (this._useAudioContext) {\n\t\t\tvar loader = this._loader;\n\t\t\tvar index = Math.random() * this._paths.length | 0;\n\t\t\tvar path = this._paths[index];\n\t\t\tvar buffer = loader.getBuffer(path);\n\t\t\tif (!buffer) {\n\t\t\t\tloader.doOnLoad(path, bind(this, function (buffers) {\n\t\t\t\t\tthis._playFromBuffer(buffers[0], loop, time, duration);\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tthis._playFromBuffer(buffer, loop, time, duration);\n\t\t\t}\n\t\t} else {\n\t\t\tvar src = this._getRandom();\n\t\t\tsrc.play();\n\t\t\tif (src.muted) {\n\t\t\t\t// Chrome bug? Audio objects with muted set before they\n\t\t\t\t// are played won't be muted, so toggle the mute state\n\t\t\t\t// twice after calling play.\n\t\t\t\tsrc.muted = false;\n\t\t\t\tsrc.muted = true;\n\t\t\t}\n\t\t\tthis.setTime(time);\n\t\t\tif (duration !== undefined) {\n\t\t\t\tsetTimeout(bind(this, 'pause'), duration);\n\t\t\t}\n\t\t\tthis._lastSrc = src;\n\t\t}\n\t};\n\n\tthis._playFromBuffer = function (buffer, loop, time, duration) {\n\t\tif (buffer) {\n\t\t\tvar src = _ctx.createBufferSource();\n\t\t\tsrc.buffer = buffer;\n\t\t\tsrc.loop = loop;\n\t\t\tsrc.connect(this._gainNode);\n\t\t\tif (duration !== undefined) {\n\t\t\t\tsrc.start(_ctx.currentTime, time, duration);\n\t\t\t} else {\n\t\t\t\tsrc.start(_ctx.currentTime, time);\n\t\t\t}\n\t\t\tthis._lastSrc = src;\n\t\t}\n\t};\n\n\tthis._getRandom = function () {\n\t\tvar index = Math.random() * this._sources.length | 0;\n\t\treturn this._sources[index];\n\t};\n});\n\n/**\n* AudioManager Class\n*\n* @extends event.Emitter\n*/\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_AudioManager=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_AudioManager(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_AudioManager(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = opts || {};\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis._loader = null;\n\t\tthis.setPath(opts.path);\n\t\tthis._map = opts.files || opts.map;\n\t\tthis._preload = opts.preload;\n\t\tthis._sounds = {};\n\t\tthis._isMusicMuted = false;\n\t\tthis._areEffectsMuted = false;\n\t\tthis._currentMusic = null;\n\t\tthis._key = \"\";\n\n\t\t// register instances of AudioManager for global app mute\n\t\tthis.setMuted(_muteAll);\n\t\t_registeredAudioManagers.push(this);\n\n\t\topts.persist && this.persistState(opts.persist);\n\n\t\t// use an AudioContext if available, otherwise fallback to Audio\n\t\tif (_ctx === null && typeof AudioContext !== 'undefined') {\n\t\t\ttry {\n\t\t\t\t_ctx = new AudioContext();\n\t\t\t} catch (e) {\n\t\t\t\t// most commonly due to hardware limits on AudioContext instances\n\t\t\t\tlogger.WARN&&console.warn(\"WARN\",\"AudioManager\",\"HTML5 AudioContext init failed, falling back to Audio!\");\n\t\t\t}\n\t\t} else if (_ctx === null) {\n\t\t\tlogger.WARN&&console.warn(\"WARN\",\"AudioManager\",\"HTML5 AudioContext not supported, falling back to Audio!\");\n\t\t}\n\t\t// pass the global AudioContext instance to AudioLoaders\n\t\t_ctx && this.setAudioContext();\n\n\t\t// determine whether browser supports mp3 or ogg. Default to mp3 if\n\t\t// both are supported. Native will return true for everything, but\n\t\t// on native, we store ogg files as .mp3 files, so return .mp3...\n\t\tif (typeof Audio !== \"undefined\") {\n\t\t\tvar sound = new Audio();\n\t\t\tif (sound.canPlayType(\"audio/mpeg\")) {\n\t\t\t\tthis._ext = \".mp3\";\n\t\t\t} else if (sound.canPlayType(\"audio/ogg\")) {\n\t\t\t\tthis._ext = \".ogg\";\n\t\t\t}\n\t\t} else {\n\t\t\tlogger.WARN&&console.warn(\"WARN\",\"AudioManager\",\"HTML5 Audio not supported!\");\n\t\t}\n\n\t\tif (this._ext === undefined) {\n\t\t\tthis._ext = \".mp3\";\n\t\t\tlogger.WARN&&console.warn(\"WARN\",\"AudioManager\",\"Warning: sound support unclear - defaulting to .mp3\");\n\t\t}\n\n\t\t// add sounds to the audio API's list of sounds and preload them\n\t\tfor (var key in this._map) {\n\t\t\tvar item = this._map[key];\n\t\t\tthis.addSound(key, item);\n\t\t}\n\n\t\t// AudioContext preloading\n\t\tif (_ctx && this._preload) {\n\t\t\tvar urls = [];\n\t\t\tfor (var key in this._sounds) {\n\t\t\t\tvar sound = this._sounds[key];\n\t\t\t\turls = urls.concat(sound._paths);\n\t\t\t}\n\t\t\tthis.preloadSounds(urls);\n\t\t}\n\t};\n\n\tthis.getAudioContext = function () {\n\t\treturn _ctx;\n\t};\n\n\tthis.setAudioContext = function () {\n\t\tif (this._loader) {\n\t\t\tthis._loader.setAudioContext(_ctx);\n\t\t} else {\n\t\t\tthis._loader = new AudioLoader({ ctx: _ctx });\n\t\t}\n\t};\n\n\tthis.getAudioLoader = function () {\n\t\treturn this._loader;\n\t};\n\n\tthis.preloadSounds = function (urls) {\n\t\t// used for AudioContext only\n\t\tthis._loader && this._loader.load(urls);\n\t};\n\n\tthis.getExt = function () {\n\t\treturn this._ext;\n\t};\n\n\tthis.getPath = function () {\n\t\treturn this._path;\n\t};\n\n\tthis.setPath = function (path) {\n\t\tif (path) {\n\t\t\tpath = path.replace(/\\/$/, '');\n\t\t}\n\t\tthis._path = path || '';\n\t};\n\n\tthis.addSound = function (name, opts) {\n\t\tthis._sounds[name] = new MultiSound(this, name, opts);\n\t};\n\n\t/* @internal for now\n\t */\n\tthis.persistState = function (key) {\n\t\tthis._key = key;\n\n\t\tvar value = localStorage.getItem(this._key);\n\t\tif (value) {\n\t\t\ttry {\n\t\t\t\tvalue = JSON.parse(value);\n\t\t\t} catch (e) {}\n\t\t}\n\n\t\tif (value) {\n\t\t\tlogger.LOG&&console.log(\"LOG\",\"AudioManager\",\"Restoring Audio API state!\");\n\t\t\tthis.setMusicMuted(value.isMusicMuted);\n\t\t\tthis.setEffectsMuted(value.areEffectsMuted);\n\t\t}\n\t};\n\n\t/* @internal for now\n\t */\n\tthis._persist = function () {\n\t\tif (this._key !== \"\") {\n\t\t\tlocalStorage.setItem(this._key, JSON.stringify({\n\t\t\t\tisMusicMuted: this._isMusicMuted,\n\t\t\t\tareEffectsMuted: this._areEffectsMuted\n\t\t\t}));\n\t\t}\n\t};\n\n\tthis.getMuted = function () {\n\t\treturn this._isMusicMuted && this._areEffectsMuted;\n\t};\n\n\tthis.getMusicMuted = function () {\n\t\treturn this._isMusicMuted;\n\t};\n\n\tthis.getEffectsMuted = function () {\n\t\treturn this._areEffectsMuted;\n\t};\n\n\tthis.setMuted = function (isMuted) {\n\t\tthis.setMusicMuted(isMuted);\n\t\tthis.setEffectsMuted(isMuted);\n\t};\n\n\tthis.setMusicMuted = function (isMusicMuted) {\n\t\tif (_muteAll) { isMusicMuted = true; }\n\t\tthis._isMusicMuted = isMusicMuted;\n\t\tthis._persist();\n\t\t// resume music on unmute\n\t\tif (this._currentMusic) {\n\t\t\tif (isMusicMuted) {\n\t\t\t\tthis._currentMusic.pause();\n\t\t\t} else {\n\t\t\t\tthis._currentMusic.play();\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.setEffectsMuted = function (areEffectsMuted) {\n\t\tif (_muteAll) { areEffectsMuted = true; }\n\t\tthis._areEffectsMuted = areEffectsMuted;\n\t\tthis._persist();\n\t\tif (areEffectsMuted) {\n\t\t\tfor (var key in this._sounds) {\n\t\t\t\tvar sound = this._sounds[key];\n\t\t\t\tif (!sound.isBackgroundMusic) {\n\t\t\t\t\tsound.stop();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getSound = function(name) {\n\t\tvar sound = this._sounds[name];\n\t\tif (!sound) { logger.WARN&&console.warn(\"WARN\",\"AudioManager\",\"Warning: no sound named \" + name); }\n\t\treturn sound;\n\t};\n\n\tthis.setVolume = function (name, volume) {\n\t\tvar sound = this.getSound(name);\n\t\tif (sound) {\n\t\t\tsound.setVolume(volume);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tthis.getVolume = function (name) {\n\t\tvar sound = this.getSound(name);\n\t\tif (sound) {\n\t\t\treturn sound.getVolume();\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t};\n\n\tthis.setTime = function (name, t) {\n\t\tvar sound = this.getSound(name);\n\t\tif (!sound) {\n\t\t\treturn false;\n\t\t}\n\t\tsound.setTime(t || 0);\n\t\treturn true;\n\t};\n\n\tthis.getTime = function (name) {\n\t\tvar sound = this.getSound(name);\n\t\tif (!sound) {\n\t\t\treturn false;\n\t\t}\n\t\treturn sound.getTime();\n\t};\n\n\tthis.getDuration = function (name) {\n\t\tvar sound = this.getSound(name);\n\t\tif (!sound) {\n\t\t\treturn false;\n\t\t}\n\t\treturn sound.getDuration();\n\t};\n\n\tthis.play = function (name, opts) {\n\t\tvar sound = this.getSound(name);\n\t\tif (!sound) {\n\t\t\treturn false;\n\t\t}\n\n\t\topts = opts || {};\n\t\tvar isBackgroundMusic = sound.isBackgroundMusic;\n\t\tif (isBackgroundMusic) {\n\t\t\t// some platforms enforce only one simultaneous background music\n\t\t\t// (native) while others do not.  Enforce it always.\n\t\t\tif (this._currentMusic) {\n\t\t\t\tthis._currentMusic.stop();\n\t\t\t}\n\t\t\tthis._currentMusic = sound;\n\t\t\t// if we're muted, make sure to resume the music if we unmute\n\t\t\tif (!this._isMusicMuted) {\n\t\t\t\tsound.play(opts);\n\t\t\t}\n\t\t} else if (!this._areEffectsMuted) {\n\t\t\tsound.play(opts);\n\t\t}\n\t\treturn true;\n\t};\n\n\tthis.pause = function (name) {\n\t\tvar sound = this.getSound(name);\n\t\tif (!sound) {\n\t\t\treturn false;\n\t\t}\n\t\t// if muted and we pause current music, don't resume it on unmute\n\t\tif (this._currentMusic === sound) {\n\t\t\tthis._currentMusic = null;\n\t\t}\n\t\tsound.pause();\n\t\treturn true;\n\t};\n\n\tthis.stop = function (name) {\n\t\tvar sound = this.getSound(name);\n\t\tif (!sound) {\n\t\t\treturn false;\n\t\t}\n\t\t// if muted and we pause current music, don't resume it on unmute\n\t\tif (this._currentMusic === sound) {\n\t\t\tthis._currentMusic = null;\n\t\t}\n\t\tsound.stop();\n\t\treturn true;\n\t};\n\n\tthis.isPaused = function (name) {\n\t\tvar sound = this.getSound(name);\n\t\tif (!sound) {\n\t\t\treturn false;\n\t\t}\n\t\treturn sound.isPaused();\n\t};\n\n\tthis.isPlaying = function (name) {\n\t\tvar sound = this.getSound(name);\n\t\tif (!sound) {\n\t\t\treturn false;\n\t\t}\n\t\treturn sound.isPlaying();\n\t};\n\n\t// @deprecated\n\tthis.playBackgroundMusic = this.play;\n\n\t// @deprecated\n\tthis.pauseBackgroundMusic = function () {\n\t\tthis._currentMusic && this._currentMusic.pause();\n\t};\n});\n\n// expose a global mute function (GC.app.muteAll)\nexports.muteAll = function(mute) {\n\t_muteAll = mute;\n\tfor (var i = 0, len = _registeredAudioManagers.length; i < len; i++) {\n\t\t_registeredAudioManagers[i].setMuted(mute);\n\t}\n};\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/path.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/path.js","friendlyPath":"util.path","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"path.js","pre":true,"src":"var util = jsio.__jsio.__util;\n\nexports.join = util.buildPath;\nexports.resolveRelativePath = util.resolveRelativePath;\nexports.splitPath = util.splitPath;\nexports.relative = util.relative;\nexports.splitExt = function(path) {\n\tvar res = exports.splitPath(path);\n\tvar i = res.filename.lastIndexOf('.');\n\tif (i == -1) {\n\t\tres.basename = res.filename;\n\t\tres.ext = '';\n\t} else {\n\t\tres.basename = res.filename.substring(0, i);\n\t\tres.ext = res.filename.substring(i);\n\t}\n\treturn res;\n}\n"},"modules/devkit-core/modules/timestep/src/ui/backend/sound/AudioLoader.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/sound/AudioLoader.js","friendlyPath":"ui.backend.sound.AudioLoader","directory":"modules/devkit-core/modules/timestep/src/ui/backend/sound/","filename":"AudioLoader.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar _ctx = null;\nvar _bufferMap = {};\nvar _loadingMap = {};\nvar _onLoadMap = {};\n\n/**\n * AudioContextLoader Class designed to work with HTML5 AudioContext\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_sound_AudioLoader=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_sound_AudioLoader(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_sound_AudioLoader(){return this.init&&this.init.apply(this,arguments)},function () {\n\t/**\n\t * Requires an instance of AudioContext\n\t */\n\tthis.init = function (opts) {\n\t\t_ctx = opts.ctx;\n\t};\n\n\t/**\n\t * Load audio files from a list of urls, call callback when all are loaded\n\t */\n\tthis.load = function (urls, callback) {\n\t\tvar batch = {\n\t\t\tfileCount: urls.length,\n\t\t\tloadedCount: 0,\n\t\t\tbuffers: [],\n\t\t\tcallback: callback || function () {\n\t\t\t\tlogger.LOG&&console.log(\"LOG\",\"ui.backend.sound.AudioLoader\",\"Finished loading audio files:\", urls);\n\t\t\t}\n\t\t};\n\n\t\tfor (var i = 0, len = urls.length; i < len; i++) {\n\t\t\tthis._loadFile(urls[i], i, batch);\n\t\t}\n\t};\n\n\t/*\n\t * Private fn to react to buffer loading / errors; guarantees that preload\n\t * callbacks get fired regardless of success so that nothing gets held up;\n\t * however, does not call individual sound onload callbacks on errors\n\t */\n\tfunction onResponse (url, index, batch, buffer) {\n\t\tif (!buffer) {\n\t\t\tlogger.ERROR&&console.error(\"ERROR\",\"ui.backend.sound.AudioLoader\",\"Error decoding audio file data:\", url);\n\t\t} else {\n\t\t\tbatch.buffers[index] = _bufferMap[url] = buffer;\n\t\t\t// on load callbacks for individual sounds\n\t\t\tvar cb = _onLoadMap[url];\n\t\t\tif (cb) {\n\t\t\t\tcb([buffer]);\n\t\t\t\t_onLoadMap[url] = null;\n\t\t\t}\n\t\t}\n\n\t\t_loadingMap[url] = false;\n\t\t// batch callback for preloading, called regardless of success\n\t\tif (++batch.loadedCount === batch.fileCount) {\n\t\t\tbatch.callback(batch.buffers);\n\t\t}\n\t};\n\n\t/**\n\t * Load an individual audio file asynchronously\n\t */\n\tthis._loadFile = function (url, index, batch) {\n\t\tvar request = new XMLHttpRequest();\n\t\trequest.open(\"GET\", url, true);\n\t\trequest.responseType = \"arraybuffer\";\n\t\trequest.onload = function () {\n\t\t\t_ctx.decodeAudioData(\n\t\t\t\trequest.response,\n\t\t\t\tfunction (buffer) {\n\t\t\t\t\tonResponse(url, index, batch, buffer);\n\t\t\t\t},\n\t\t\t\tfunction (e) {\n\t\t\t\t\tlogger.ERROR&&console.error(\"ERROR\",\"ui.backend.sound.AudioLoader\",\"Error with AudioContext decodeAudioData:\", (e && e.err) || e);\n\t\t\t\t\tonResponse(url, index, batch, null);\n\t\t\t\t}\n\t\t\t);\n\t\t};\n\t\trequest.onerror = function () {\n\t\t\tlogger.ERROR&&console.error(\"ERROR\",\"ui.backend.sound.AudioLoader\",\"Error with audio XHR on URL:\", url);\n\t\t\tonResponse(url, index, batch, null);\n\t\t};\n\n\t\t_loadingMap[url] = true;\n\t\trequest.send();\n\t};\n\n\tthis.getAudioContext = function () {\n\t\treturn _ctx;\n\t};\n\n\tthis.setAudioContext = function (ctx) {\n\t\t_ctx = ctx;\n\t};\n\n\tthis.getBuffer = function (url) {\n\t\treturn _bufferMap[url] || null;\n\t};\n\n\tthis.isLoading = function (url) {\n\t\treturn _loadingMap[url] || false;\n\t};\n\n\tthis.doOnLoad = function (url, cb) {\n\t\tif (this.isLoading(url)) {\n\t\t\t_onLoadMap[url] = cb;\n\t\t} else {\n\t\t\tvar buffer = this.getBuffer(url);\n\t\t\tif (buffer) {\n\t\t\t\tcb([buffer]);\n\t\t\t} else {\n\t\t\t\tthis.load([url], cb);\n\t\t\t}\n\t\t}\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/filterRenderer.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/filterRenderer.js","friendlyPath":"ui.backend.canvas.filterRenderer","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"filterRenderer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.backend.canvas.FilterRenderer;\n * Renders filter effects to a canvas. Manages filtered canvas caching.\n */\n\njsio('import cache.LRUCache as LRUCache');\njsio('import device');\n\nFilterRenderer=__class__;var FilterRenderer=FilterRenderer(function FilterRenderer(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tvar Canvas = null;\n\tvar noCacheCanvas = null;\n\tvar unusedCanvas = null;\n\n\tvar CACHE_SIZE = 1024;\n\tvar CACHE_FRAME_THRESHOLD = 3;\n\n\tthis.cache = new LRUCache(CACHE_SIZE);\n\n\tvar activeChecks = {};\n\tvar pendingChecks = {};\n\tvar currentFrame = 0;\n\n\tvar needsInitialization = true;\n\n\tthis.initialize = function() {\n\t\tCanvas = device.get('Canvas');\n\t\tnoCacheCanvas = new Canvas({ useWebGL: CONFIG.useWebGL });\n\t\tneedsInitialization = false;\n\t\tthis.useCache = !device.isNative && !CONFIG.useWebGL;\n\t\tthis.useWebGL = CONFIG.useWebGL;\n\t\tif (this.useCache) {\n\t\t\t// If we're using canvas caching, set up the tick subscription\n\t\t\tjsio('import ui.Engine').get().subscribe('Tick', this, this.onTick);\n\t\t}\n\t};\n\n\tthis.onTick = function(dt) {\n\t\tcurrentFrame++;\n\t\tactiveChecks = pendingChecks;\n\t\tpendingChecks = {};\n\t};\n\n\tthis.renderFilter = function (ctx, srcImg, srcX, srcY, srcW, srcH) {\n\t\tif (needsInitialization) { this.initialize(); }\n\t\tvar filterName;\n\t\tvar filter;\n\t\tfor (filterName in ctx.filters) {\n\t\t\tfilter = ctx.filters[filterName];\n\t\t\tbreak;\n\t\t}\n\n\t\t// Ugly hack, but WebGL still needs this class, for now, for masking.\n\t\t// The other filters are handled by the WebGL context itself.\n\t\tvar filterNotSupported = this.useWebGL && filterName !== \"NegativeMask\" && filterName !== \"PositiveMask\";\n\t\tif (!filter || filterNotSupported) { return null; }\n\n\t\tif (this.useCache) {\n\t\t\tvar cacheKey = this.getCacheKey(srcImg.getURL(), srcX, srcY, srcW, srcH, filter);\n\t\t\tvar resultImg = this.cache.get(cacheKey);\n\t\t\tif (resultImg) { return resultImg; }\n\t\t}\n\n\t\tvar shouldCache = this.useCache && this.testShouldCache(cacheKey);\n\t\tif (shouldCache) {\n\t\t\tresultImg = this.getCanvas(srcW, srcH);\n\t\t} else {\n\t\t\tresultImg = noCacheCanvas;\n\t\t\tresultImg.width = srcW;\n\t\t\tresultImg.height = srcH;\n\t\t}\n\n\t\tswitch (filterName) {\n\t\t\tcase \"LinearAdd\":\n\t\t\t\tthis.renderColorFilter(ctx, srcImg, srcX, srcY, srcW, srcH, filter.get(), 'lighter', resultImg);\n\t\t\t\tbreak;\n\n\t\t\tcase \"Tint\":\n\t\t\t\tthis.renderColorFilter(ctx, srcImg, srcX, srcY, srcW, srcH, filter.get(), 'source-over', resultImg);\n\t\t\t\tbreak;\n\n\t\t\tcase \"Multiply\":\n\t\t\t\tthis.renderMultiply(ctx, srcImg, srcX, srcY, srcW, srcH, filter, resultImg);\n\t\t\t\tbreak;\n\n\t\t\tcase \"NegativeMask\":\n\t\t\t\tthis.renderMask(ctx, srcImg, srcX, srcY, srcW, srcH, filter.getMask(), 'source-in', resultImg);\n\t\t\t\tbreak;\n\n\t\t\tcase \"PositiveMask\":\n\t\t\t\tthis.renderMask(ctx, srcImg, srcX, srcY, srcW, srcH, filter.getMask(), 'source-out', resultImg);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (shouldCache) {\n\t\t\tvar removedEntry = this.cache.put(cacheKey, resultImg);\n\t\t\tunusedCanvas = removedEntry ? removedEntry.value : null;\n\t\t}\n\n\t\treturn resultImg;\n\t};\n\n\tthis.testShouldCache = function(key) {\n\t\tvar checkFrame = pendingChecks[key] = activeChecks[key] || currentFrame;\n\t\treturn (currentFrame - checkFrame) > CACHE_FRAME_THRESHOLD;\n\t};\n\n\n\tthis.renderColorFilter = function (ctx, srcImg, srcX, srcY, srcW, srcH, color, op, destCanvas) {\n\t\tvar result = destCanvas;\n\t\tvar resultCtx = result.getContext('2d');\n\t\t// render the base image\n\t\tresultCtx.globalCompositeOperation = 'source-over';\n\t\tsrcImg.render(resultCtx, srcX, srcY, srcW, srcH, 0, 0, srcW, srcH);\n\t\t// render the filter color\n\t\tresultCtx.globalCompositeOperation = op;\n\t\tresultCtx.fillStyle = \"rgba(\" + color.r  + \",\" + color.g + \",\" + color.b + \",\" + color.a + \")\";\n\t\tresultCtx.fillRect(0, 0, srcW, srcH);\n\t\t// use our base image to cut out the image shape from the rect\n\t\tresultCtx.globalCompositeOperation = 'destination-in';\n\t\tsrcImg.render(resultCtx, srcX, srcY, srcW, srcH, 0, 0, srcW, srcH);\n\t\treturn result;\n\t};\n\n\tthis.renderMultiply = function(ctx, srcImg, srcX, srcY, srcW, srcH, filter, destCanvas) {\n\t\tvar color = filter.get();\n\t\tvar result = destCanvas;\n\t\tvar resultCtx = result.getContext('2d');\n\t\tvar imgData = srcImg.getImageData(srcX, srcY, srcW, srcH);\n\t\tvar data = imgData.data;\n\t\t// simplified multiply math outside of the massive for loop\n\t\tvar a = color.a;\n\t\tvar mr = 1 + a * ((color.r / 255) - 1);\n\t\tvar mg = 1 + a * ((color.g / 255) - 1);\n\t\tvar mb = 1 + a * ((color.b / 255) - 1);\n\t\tfor (var i = 0, len = data.length; i < len; i += 4) {\n\t\t  data[i] *= mr;\n\t\t  data[i + 1] *= mg;\n\t\t  data[i + 2] *= mb;\n\t\t}\n\t\t// put the updated rgb data into our new canvas\n\t\tresultCtx.putImageData(imgData, 0, 0);\n\t\treturn result;\n\t};\n\n\tthis.renderMask = function (ctx, srcImg, srcX, srcY, srcW, srcH, mask, op, destCanvas) {\n\t\tvar result = destCanvas;\n\t\tvar resultCtx = result.getContext('2d');\n\t\t// render the mask image\n\t\tvar srcMaskX = mask.getSourceX();\n\t\tvar srcMaskY = mask.getSourceY();\n\t\tvar srcMaskW = mask.getSourceW();\n\t\tvar srcMaskH = mask.getSourceH();\n\t\tresultCtx.globalCompositeOperation = 'source-over';\n\t\tmask.render(resultCtx, srcMaskX, srcMaskY, srcMaskW, srcMaskH, 0, 0, srcW, srcH);\n\t\t// render the base image\n\t\tresultCtx.globalCompositeOperation = op;\n\t\tsrcImg.render(resultCtx, srcX, srcY, srcW, srcH, 0, 0, srcW, srcH);\n\t\treturn result;\n\t};\n\n\tthis.clearCache = function () {\n\t\tthis.cache.removeAll();\n\t};\n\n\tthis.getCacheKey = function(url, srcX, srcY, srcW, srcH, filter) {\n\t\tvar filterType = filter.getType();\n\t\tvar suffix;\n\t\tif (filterType === 'NegativeMask' || filterType === 'PositiveMask') {\n\t\t\tsuffix = filter.getMask().getURL();\n\t\t} else {\n\t\t\tvar color = filter.get();\n\t\t\tvar alpha = (color.a * 255) & 0xff;\n\t\t\tsuffix = \"\" + alpha + \"|\" + color.r + \"|\" + color.g + \"|\" + color.b;\n\t\t}\n\t\tvar cacheKey = filterType + \"|\" + url + \"|\" + srcX + \"|\" + srcY + \"|\" + srcW + \"|\" + srcH + \"|\" + suffix;\n\t\treturn cacheKey;\n\t};\n\n\tthis.getCanvas = function(width, height) {\n\t\tvar result;\n\t\tif (unusedCanvas) {\n\t\t\tresult = unusedCanvas;\n\t\t\tresult.width = width;\n\t\t\tresult.height = height;\n\t\t\tunusedCanvas = null;\n\t\t} else {\n\t\t\tresult = new Canvas({ width: width, height: height });\n\t\t}\n\t\treturn result;\n\t};\n\n});\n\nexports = new FilterRenderer();\n","pre":true},"modules/devkit-core/modules/timestep/src/cache/LRUCache.js":{"path":"modules/devkit-core/modules/timestep/src/cache/LRUCache.js","friendlyPath":"cache.LRUCache","directory":"modules/devkit-core/modules/timestep/src/cache/","filename":"LRUCache.js","baseMod":"cache","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/modules/timestep/src/cache","src":"/**\n* Copyright (c) 2010 Rasmus Andersson http://hunch.se/\n*\n* MIT LICENSE\n*\n* Permission is hereby granted, free of charge, to any person obtaining a copy of\n* this software and associated documentation files (the \"Software\"), to deal in the\n* Software without restriction, including without limitation the rights to use, copy,\n* modify, merge, publish, distribute, sublicense, and/or sell copies of the Software,\n* and to permit persons to whom the Software is furnished to do so, subject to the\n* following conditions:\n*\n* The above copyright notice and this permission notice shall be included in all\n* copies or substantial portions of the Software.\n*\n* THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\n* FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\n* COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN\n* AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n* WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n * A doubly linked list-based Least Recently Used (LRU) cache. Will keep most\n * recently used items while discarding least recently used items when its limit\n * is reached.\n *\n * Illustration of the design:\n *\n *       entry             entry             entry             entry\n *       ______            ______            ______            ______\n *      | head |.newer => |      |.newer => |      |.newer => | tail |\n *      |  A   |          |  B   |          |  C   |          |  D   |\n *      |______| <= older.|______| <= older.|______| <= older.|______|\n *\n *  removed  <--  <--  <--  <--  <--  <--  <--  <--  <--  <--  <--  added\n */\nvar LRUCache = function(limit) {\n  // Current size of the cache. (Read-only).\n  this.size = 0;\n  // Maximum number of items this cache can hold.\n  this.limit = limit;\n  this._keymap = {};\n}\n\n/**\n * Put <value> into the cache associated with <key>. Returns the entry which was\n * removed to make room for the new entry. Otherwise undefined is returned\n * (i.e. if there was enough room already).\n */\nLRUCache.prototype.put = function(key, value) {\n  var entry = {key:key, value:value};\n  // Note: No protection agains replacing, and thus orphan entries. By design.\n  this._keymap[key] = entry;\n  if (this.tail) {\n    // link previous tail to the new tail (entry)\n    this.tail.newer = entry;\n    entry.older = this.tail;\n  } else {\n    // we're first in -- yay\n    this.head = entry;\n  }\n  // add new entry to the end of the linked list -- it's now the freshest entry.\n  this.tail = entry;\n  if (this.size === this.limit) {\n    // we hit the limit -- remove the head\n    return this.shift();\n  } else {\n    // increase the size counter\n    this.size++;\n  }\n};\n\n/**\n * Purge the least recently used (oldest) entry from the cache. Returns the\n * removed entry or undefined if the cache was empty.\n *\n * If you need to perform any form of finalization of purged items, this is a\n * good place to do it. Simply override/replace this function:\n *\n *   var c = new LRUCache(123);\n *   c.shift = function() {\n *     var entry = LRUCache.prototype.shift.call(this);\n *     doSomethingWith(entry);\n *     return entry;\n *   }\n */\nLRUCache.prototype.shift = function() {\n  // todo: handle special case when limit == 1\n  var entry = this.head;\n  if (entry) {\n    if (this.head.newer) {\n      this.head = this.head.newer;\n      this.head.older = undefined;\n    } else {\n      this.head = undefined;\n    }\n    // Remove last strong reference to <entry> and remove links from the purged\n    // entry being returned:\n    entry.newer = entry.older = undefined;\n    // delete is slow, but we need to do this to avoid uncontrollable growth:\n    delete this._keymap[entry.key];\n  }\n  return entry;\n};\n\n/**\n * Get and register recent use of <key>. Returns the value associated with <key>\n * or undefined if not in cache.\n */\nLRUCache.prototype.get = function(key, returnEntry) {\n  // First, find our cache entry\n  var entry = this._keymap[key];\n  if (entry === undefined) return; // Not cached. Sorry.\n  // As <key> was found in the cache, register it as being requested recently\n  if (entry === this.tail) {\n    // Already the most recenlty used entry, so no need to update the list\n    return returnEntry ? entry : entry.value;\n  }\n  // HEAD--------------TAIL\n  //   <.older   .newer>\n  //  <--- add direction --\n  //   A  B  C  <D>  E\n  if (entry.newer) {\n    if (entry === this.head)\n      this.head = entry.newer;\n    entry.newer.older = entry.older; // C <-- E.\n  }\n  if (entry.older)\n    entry.older.newer = entry.newer; // C. --> E\n  entry.newer = undefined; // D --x\n  entry.older = this.tail; // D. --> E\n  if (this.tail)\n    this.tail.newer = entry; // E. <-- D\n  this.tail = entry;\n  return returnEntry ? entry : entry.value;\n};\n\n// ----------------------------------------------------------------------------\n// Following code is optional and can be removed without breaking the core\n// functionality.\n\n/**\n * Check if <key> is in the cache without registering recent use. Feasible if\n * you do not want to chage the state of the cache, but only \"peek\" at it.\n * Returns the entry associated with <key> if found, or undefined if not found.\n */\nLRUCache.prototype.find = function(key) {\n  return this._keymap[key];\n};\n\n/**\n * Update the value of entry with <key>. Returns the old value, or undefined if\n * entry was not in the cache.\n */\nLRUCache.prototype.set = function(key, value) {\n  var oldvalue, entry = this.get(key, true);\n  if (entry) {\n    oldvalue = entry.value;\n    entry.value = value;\n  } else {\n    oldvalue = this.put(key, value);\n    if (oldvalue) oldvalue = oldvalue.value;\n  }\n  return oldvalue;\n};\n\n/**\n * Remove entry <key> from cache and return its value. Returns undefined if not\n * found.\n */\nLRUCache.prototype.remove = function(key) {\n  var entry = this._keymap[key];\n  if (!entry) return;\n  delete this._keymap[entry.key]; // need to do delete unfortunately\n  if (entry.newer && entry.older) {\n    // relink the older entry with the newer entry\n    entry.older.newer = entry.newer;\n    entry.newer.older = entry.older;\n  } else if (entry.newer) {\n    // remove the link to us\n    entry.newer.older = undefined;\n    // link the newer entry to head\n    this.head = entry.newer;\n  } else if (entry.older) {\n    // remove the link to us\n    entry.older.newer = undefined;\n    // link the newer entry to head\n    this.tail = entry.older;\n  } else {// if(entry.older === undefined && entry.newer === undefined) {\n    this.head = this.tail = undefined;\n  }\n\n  this.size--;\n  return entry.value;\n};\n\n/** Removes all entries */\nLRUCache.prototype.removeAll = function() {\n  // This should be safe, as we never expose strong refrences to the outside\n  this.head = this.tail = undefined;\n  this.size = 0;\n  this._keymap = {};\n};\n\n/**\n * Return an array containing all keys of entries stored in the cache object, in\n * arbitrary order.\n */\nif (typeof Object.keys === 'function') {\n  LRUCache.prototype.keys = function() { return Object.keys(this._keymap); };\n} else {\n  LRUCache.prototype.keys = function() {\n    var keys = [];\n    for (var k in this._keymap) keys.push(k);\n    return keys;\n  };\n}\n\n/**\n * Call `fun` for each entry. Starting with the newest entry if `desc` is a true\n * value, otherwise starts with the oldest (head) enrty and moves towards the\n * tail.\n *\n * `fun` is called with 3 arguments in the context `context`:\n *   `fun.call(context, Object key, Object value, LRUCache self)`\n */\nLRUCache.prototype.forEach = function(fun, context, desc) {\n  var entry;\n  if (context === true) { desc = true; context = undefined; }\n  else if (typeof context !== 'object') context = this;\n  if (desc) {\n    entry = this.tail;\n    while (entry) {\n      fun.call(context, entry.key, entry.value, this);\n      entry = entry.older;\n    }\n  } else {\n    entry = this.head;\n    while (entry) {\n      fun.call(context, entry.key, entry.value, this);\n      entry = entry.newer;\n    }\n  }\n};\n\n/** Returns a JSON (array) representation */\nLRUCache.prototype.toJSON = function() {\n  var s = [], entry = this.head;\n  while (entry) {\n    s.push({key:entry.key.toJSON(), value:entry.value.toJSON()});\n    entry = entry.newer;\n  }\n  return s;\n};\n\n/** Returns a String representation */\nLRUCache.prototype.toString = function() {\n  var s = '', entry = this.head;\n  while (entry) {\n    s += String(entry.key)+':'+entry.value;\n    entry = entry.newer;\n    if (entry)\n      s += ' < ';\n  }\n  return s;\n};\n\nexports = LRUCache;","pre":true},"modules/devkit-core/modules/timestep/src/ui/Engine.js":{"path":"modules/devkit-core/modules/timestep/src/ui/Engine.js","friendlyPath":"ui.Engine","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"Engine.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.Engine\n *\n * This is the game engine for timestep. It is built on a scene graph composed\n * of \"views\", and has canvas and DOM rendering backends.\n *\n * Responsibilities for the application engine includes initializing the canvas,\n * input and key listeners, game loop, animation tick, the view hierarchy and\n * rendering the scene graph.\n *\n * Not to be confused with GC.Application, the superclass exposed to games which\n * controls the game loop. A single ui.Engine is instantiated for\n * games which resides at GC.app.engine.\n *\n * @doc http://doc.gameclosure.com/api/appengine.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/appengine.md\n */\n\njsio('import event.Emitter as Emitter');\n\njsio('import event.input.dispatch as dispatch');\n\njsio('import timer');\njsio('import ui.backend.ReflowManager as ReflowManager');\n\njsio('import device');\n\nvar _timers = [];\ntimer.onTick = function (dt) {\n\tvar i = _timers.length;\n\twhile (i--) {\n\t\t_timers[i](dt);\n\t}\n}\n\nvar __instance = null;\n\n/**\n * @extends event.Emitter\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_Engine=__class__;var Engine = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_Engine(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_Engine(){return this.init&&this.init.apply(this,arguments)},Emitter, function (supr) {\n\tthis.init = function (opts) {\n\t\tif (!__instance) {\n\t\t\tjsio('import .StackView');\n\n\t\t\t__instance = this;\n\t\t}\n\n\t\tvar canvas = opts && opts.canvas;\n\t\tif (typeof canvas == 'string' && GLOBAL.document && document.getElementById) {\n\t\t\tcanvas = document.getElementById(canvas);\n\t\t}\n\n\t\tthis._opts = opts = merge(opts, {\n\t\t\tkeyListenerEnabled: true,\n\t\t\twidth: canvas && canvas.width || device.width,\n\t\t\theight: canvas && canvas.height || device.height,\n\t\t\tview: null,\n\t\t\tdtFixed: 0,\n\t\t\tdtMinimum: 0,\n\t\t\tclearEachFrame: true,\n\t\t\talwaysRepaint: true,\n\t\t\trepaintOnEvent: true,\n\t\t\tmergeMoveEvents: false,\n\t\t\tcontinuousInputCheck: !device.isMobileBrowser && !device.isMobile,\n\t\t\tshowFPS: false\n\t\t});\n\n\t\t_timers.push(bind(this, this._tick));\n\n\t\tthis._doubleBuffered = true;\n\t\tthis._countdown = null;\n\n\t\tif (!device.useDOM) {\n\t\t\tvar Canvas = device.get('Canvas');\n\t\t\tthis._rootElement = new Canvas({\n\t\t\t\tel: canvas, // use an existing canvas if one was provided, but wrap the 2D context\n\t\t\t\tuseWebGL: true, // use WebGL if supported\n\t\t\t\twidth: opts.width,\n\t\t\t\theight: opts.height,\n\t\t\t\toffscreen: false\n\t\t\t});\n\n\t\t\tthis._rootElement.id = \"timestep_onscreen_canvas\";\n\t\t\tthis._ctx = this._rootElement.getContext('2d');\n\t\t\tthis._ctx.font = '11px ' + device.defaultFontFamily;\n\t\t}\n\n\t\tthis._view = opts.view || new StackView();\n\t\tthis._view.style.update({\n\t\t\twidth: opts.width,\n\t\t\theight: opts.height\n\t\t});\n\n\t\tif (device.useDOM) {\n\t\t\tthis._rootElement = this._view.getBacking().getElement();\n\t\t}\n\n\t\t// __root is a pointer to the Engine instance that a view\n\t\t// is currently attached to.  If __root is null, the view\n\t\t// is not currently in a view hierarchy.\n\t\tthis._view.__root = this;\n\n\t\tthis._events = [];\n\n\t\tif (dispatch.KeyListener) {\n\t\t\tthis._keyListener = new dispatch.KeyListener();\n\t\t}\n\n\t\tthis._inputListener = new dispatch.InputListener({\n\t\t\trootView: this._view,\n\t\t\tel: this._rootElement,\n\t\t\tkeyListener: this._keyListener\n\t\t});\n\n\t\tthis._reflowMgr = ReflowManager.get();\n\n\t\tthis._tickBuffer = 0;\n\t\tthis._onTick = [];\n\n\t\t// configure auto-layout in the browser (expand\n\t\t// to fill the viewport)\n\t\tif (device.name == 'browser') {\n\t\t\tif (canvas) {\n\t\t\t\tdevice.width = canvas.width;\n\t\t\t\tdevice.height = canvas.height;\n\t\t\t\tdevice.screen.width = canvas.width;\n\t\t\t\tdevice.screen.height = canvas.height;\n\t\t\t} else {\n\t\t\t\tvar doc = device.get('doc');\n\t\t\t\tif (doc) {\n\t\t\t\t\tdoc.setEngine(this);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.updateOpts(this._opts);\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\tthis._opts = merge(opts, this._opts);\n\t\tif (this._keyListener) {\n\t\t\tthis._keyListener.setEnabled(this._opts.keyListenerEnabled);\n\t\t}\n\n\t\tif (this._opts.scaleUI) {\n\t\t\tif (Array.isArray(this._opts.scaleUI)) {\n\t\t\t\tif (this._opts.scaleUI.length != 2) {\n\t\t\t\t\tthrow new Error(\"Illegal value for engine option scaleUI: \" + this._opts.scaleUI);\n\t\t\t\t}\n\t\t\t\tthis.scaleUI(this._opts.scaleUI[0], this._opts.scaleUI[1]);\n\t\t\t} else {\n\t\t\t\tthis.scaleUI(576, 1024);\n\t\t\t}\n\t\t}\n\n\t\tif (this._opts.showFPS) {\n\t\t\tif (!this._applicationFPS) {\n\t\t\t\tjsio('import ui.backend.debug.FPSView as FPSView');\n\t\t\t\tthis._applicationFPS = new FPSView({application: this});\n\t\t\t}\n\n\t\t\tthis._renderFPS = bind(this._applicationFPS, this._applicationFPS.render);\n\t\t\tthis._tickFPS = bind(this._applicationFPS, this._applicationFPS.tick);\n\t\t} else {\n\t\t\tthis._renderFPS = function () {};\n\t\t\tthis._tickFPS = function () {};\n\t\t}\n\t};\n\n\tthis.scaleUI = function (w, h) {\n\t\tif (device.height > device.width) {\n\t\t\tthis._view.baseWidth = w;\n\t\t\tthis._view.baseHeight = device.height * (w / device.width);\n\t\t\tthis._view.scale = device.width / this._view.baseWidth;\n\t\t} else {\n\t\t\tthis._view.baseWidth = h;\n\t\t\tthis._view.baseHeight = device.height * (h / device.width);\n\t\t\tthis._view.scale = device.height / this._view.baseHeight;\n\t\t}\n\t\tthis._view.style.scale = this._view.scale;\n\t};\n\n\tthis.supports = function (key) {\n\t\treturn this._opts[key];\n\t};\n\n\t/* @internal */\n\tthis.getInput = function () {\n\t\treturn this._inputListener;\n\t};\n\n\tthis.getKeyListener = function () {\n\t\treturn this._keyListener;\n\t};\n\n\tthis.getEvents = function () {\n\t\treturn this._events;\n\t};\n\n\t// deprecating getCanvas...\n\tthis.getElement = this.getCanvas = function () {\n\t\treturn this._rootElement;\n\t};\n\n\tthis.getViewCtor = function () {\n\t\treturn View;\n\t};\n\n\tthis.getView = function () {\n\t\treturn this._view;\n\t};\n\n\tthis.setView = function (view) {\n\t\tthis._view = view; return this;\n\t};\n\n\tthis.show = function () {\n\t\tthis._rootElement.style.display = 'block';\n\t\treturn this;\n\t};\n\n\tthis.hide = function () {\n\t\tthis._rootElement.style.display = 'none';\n\t\treturn this;\n\t};\n\n\tthis.pause = function () {\n\t\tthis.stopLoop();\n\t\tif (this._keyListener) {\n\t\t\tthis._keyListener.setEnabled(false);\n\t\t}\n\t};\n\n\tthis.resume = function () {\n\t\tthis.startLoop();\n\t\tif (this._keyListener) {\n\t\t\tthis._keyListener.setEnabled(true);\n\t\t}\n\t};\n\n\tthis.stepFrame = function (n) {\n\t\tthis.pause();\n\t\tn = n || 1;\n\t\tthis._countdown = n;\n\t\tthis.resume();\n\t};\n\n\tthis.startLoop = function (dtMin) {\n\t\tif (this._running) { return; }\n\t\tthis._running = true;\n\n\t\tthis.now = 0;\n\t\ttimer.start(dtMin || this._opts.dtMinimum);\n\t\tthis.emit('resume');\n\t\treturn this;\n\t};\n\n\tthis.stopLoop = function () {\n\t\tif (!this._running) { return; }\n\t\tthis._running = false;\n\t\ttimer.stop();\n\t\tthis.emit('pause');\n\t\treturn this;\n\t};\n\n\tthis.isRunning = function () {\n\t\treturn this._running;\n\t};\n\n\tthis.doOnTick = function (cb) {\n\t\tif (arguments.length > 1) { cb = bind.apply(this, arguments); }\n\t\tthis._onTick.push(cb);\n\t};\n\n\tthis._tick = function (dt) {\n\t\t//if the countdown is defined\n\t\tif (this._countdown !== null) {\n\t\t\tthis._countdown--;\n\n\t\t\t//if below zero, stop timer\n\t\t\tif (this._countdown === -1) {\n\t\t\t\tthis.pause();\n\t\t\t\tthis._countdown = null;\n\t\t\t}\n\t\t}\n\n\t\tif (this._ctx) {\n\t\t\tvar el = this._ctx.getElement();\n\t\t\tvar s = this._view.style;\n\t\t\tif (el && (s.width != el.width / s.scale || s.height != el.height / s.scale)) {\n\t\t\t\ts.width = el.width / s.scale;\n\t\t\t\ts.height = el.height / s.scale;\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = 0, cb; cb = this._onTick[i]; ++i) { cb(dt); }\n\n\t\tvar events = this._inputListener.getEvents();\n\t\tvar n = events.length;\n\n\t\tthis._events = events;\n\t\tif (this._opts._mergeMoveEvents) {\n\t\t\tvar hasMove = false;\n\t\t\tfor (var i = n - 1; i >= 0; --i) {\n\t\t\t\tif (events[i].type == dispatch.eventTypes.MOVE) {\n\t\t\t\t\tif (!hasMove) {\n\t\t\t\t\t\thasMove = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevents.splice(i, 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (var i = 0, evt; evt = events[i]; ++i) {\n\t\t\tevt.srcApp = this;\n\t\t\tdispatch.dispatchEvent(this._view, evt);\n\t\t}\n\n\t\tif (!device.useDOM) {\n\t\t\tif (i > 0) {\n\t\t\t\tif (this._opts.repaintOnEvent) { this.needsRepaint(); }\n\t\t\t} else if (this._opts.continuousInputCheck) {\n\t\t\t\tvar prevMove = dispatch._evtHistory['input:move'];\n\t\t\t\tif (prevMove) {\n\t\t\t\t\tdispatch.dispatchEvent(this._view, new dispatch.InputEvent(prevMove.id, prevMove.type, prevMove.srcPt));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this._opts.dtFixed) {\n\t\t\tthis._tickBuffer += dt;\n\t\t\twhile (this._tickBuffer >= this._opts.dtFixed) {\n\t\t\t\tthis._tickBuffer -= this._opts.dtFixed;\n\t\t\t\tthis.now += this._opts.dtFixed;\n\t\t\t\tthis.__tick(this._opts.dtFixed);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.__tick(dt);\n\t\t}\n\n\t\tthis._reflowMgr.reflowViews(this._ctx);\n\n\t\tvar doRepaint = this._opts.alwaysRepaint || this._needsRepaint;\n\t\tif (!doRepaint && this._doubleBuffered && this._doubleBufferedState > 0) {\n\t\t\t// even if we don't repaint, we need to paint at least 1 more time\n\t\t\t// for devices that use multiple buffers (like the ios, I think...)\n\t\t\t--this._doubleBufferedState;\n\t\t\tthis.render(dt);\n\t\t} else if (doRepaint) {\n\t\t\tthis._doubleBufferedState = 3;\n\t\t\tthis.render(dt);\n\t\t}\n\n\t\tthis._needsRepaint = false;\n\t};\n\n\tthis.render = function (dt) {\n\t\tif (this._opts.clearEachFrame) {\n\t\t\tthis._ctx && this._ctx.clear();\n\t\t}\n\n\t\tthis._view.__view.constructor.absScale = 1;\n\t\tthis._view.__view.wrapRender(this._ctx, {});\n\t\tthis.publish('Render', this._ctx);\n\n\t\tif (this._ctx) {\n\t\t\tif (DEBUG) {\n\t\t\t\tthis._renderFPS(this._ctx, dt);\n\t\t\t}\n\n\t\t\tthis._ctx.swap();\n\t\t}\n\t};\n\n\tthis.needsRepaint = function () {\n\t\tthis._needsRepaint = true;\n\t\treturn this;\n\t};\n\n\tthis.__tick = function (dt) {\n\t\tthis._tickFPS(dt);\n\t\tthis.publish('Tick', dt);\n\t\tthis._view.__view.wrapTick(dt, this);\n\t};\n\n\tvar log_counter = 0;\n\n});\n\nexports.get = function () { return __instance; };\n","pre":true},"modules/devkit-core/modules/timestep/src/event/input/dispatch.js":{"path":"modules/devkit-core/modules/timestep/src/event/input/dispatch.js","friendlyPath":"event.input.dispatch","directory":"modules/devkit-core/modules/timestep/src/event/input/","filename":"dispatch.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module event.input.dispatch;\n * This namespace includes functions to dispatch touch events starting from the\n * root application view, which are traced through the hierarchy to each view's\n * individual InputHandler proxy. Additionally, this namespace includes those\n * functions actually in timestep.input, like InputListener and KeyListener classes.\n */\n\njsio('import math.geom.Point as Point');\njsio('import device');\njsio('import lib.Enum');\n\nexports.eventTypes = new lib.Enum('START', 'MOVE', 'SELECT', 'SCROLL', 'CLEAR');\nexports.VERTICAL_AXIS = 2;\nexports.HORIZONTAL_AXIS = 1;\n\n/**\n * capture/bubble event, starting from root Application view\n *  - publish <inputTypeCapture> on the way down (e.g. onInputStartCapture)\n *  - call callbacks (e.g. onInputStart) and publish <inputType> (e.g. onInputstart)\n *    on the way up, checking evt.cancelled to see if someone has cancelled the event\n */\nexports.dispatchEvent = function (root, evt) {\n\t// if (evt.type == input.eventTypes.MOVE) { var now = +new Date(); }\n\t// store the root in case an event listener wants the top-most view?\n\tevt.root = root;\n\t\n\t// SHOULD_HANDLE = LOCALIZE = 0;\n\n\t// grab the bottom-most view whose bounding box contains the evt.srcPt\n\t// also updates the evt object with a trace of localized points and views\n\texports.traceEvt(root, evt, evt.srcPt);\n\n\t// if (now) { logger.LOG&&console.log(\"LOG\",\"event.input.dispatch\",'TRACED A', LOCALIZE, SHOULD_HANDLE) }\n\t\n\t// once we've traced the event, we know how deep it goes\n\tvar depth = evt.depth;\n\t\n\texports._evtHistory[evt.type] = evt;\n\t\n\tvar signal = exports._evtCb[evt.type] || exports.getEvtCbName(evt.type);\n\t\n\tfor (var i = depth - 1; i >= 0; --i) {\n\t\tvar view = evt.trace[i],\n\t\t\tpt = evt.pt[view.uid];\n\t\tview.publish(signal + 'Capture', evt, pt, i == 0);\n\t\tif (evt.cancelled || view.__input.blockEvents) { return; }\n\t}\n\t\n\tvar cbName = 'on' + signal;\n\tfor (var i = 0; i < depth; ++i) {\n\t\tvar view = evt.trace[i];\n\t\tif (view.__input.canHandleEvents) {\n\t\t\tvar pt = evt.pt[view.uid];\n\t\t\tif (view[cbName]) { view[cbName](evt, pt, i == 0); }\n\t\t\tview.publish(signal, evt, pt, i == 0);\n\t\t\tview._onEventPropagate(evt, pt, i == 0);\n\t\t\tif (evt.cancelled) { break; }\n\t\t}\n\t}\n}\n\n/**\n * Trace an event recursively down to the view on which the event is triggered.\n */\nexports.traceEvt = function (view, evt, pt) {\n\t// var now = +new Date();\n\tvar localPt = view.style.localizePoint(new Point(pt));\n\tvar inputHandler = view.getInput();\n\tif (!inputHandler.containsEvent(evt, localPt)) { return false; }\n\n\tvar canHandleEvents = view.getInput().canHandleEvents;\n\tif (canHandleEvents) {\n\t\tevt.depth++;\n\t\tevt.trace.unshift(view);\n\t\tevt.pt[view.uid] = localPt;\n\t}\n\t\n\tvar subviews = view.getSubviews();\n\tfor (var i = subviews.length - 1; i >= 0; --i) {\n\t\tif (subviews[i].style.visible && exports.traceEvt(subviews[i], evt, localPt)) {\n\t\t\treturn true;\n\t\t}\n\t}\n\t\n\tif (canHandleEvents) {\n\t\tevt.target = view;\n\t\treturn true;\n\t}\n}\n\nexports._evtHistory = {};\nexports._activeInputOver = {};\n\nexports.clearOverState = function (id) {\n\tif (id) {\n\t\tvar evt = exports._activeInputOver[id];\n\t\tif (evt) {\n\t\t\tdelete exports._activeInputOver[id];\n\t\t\tvar trace = evt.trace;\n\t\t\tif (trace) {\n\t\t\t\tfor (var i = 0, view; view = trace[i]; ++i) {\n\t\t\t\t\tview.__input.onLeave(id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor (var id in exports._activeInputOver) {\n\t\t\texports.clearOverState(id);\n\t\t}\n\t}\n}\n\nexports._isDragging = false;\nexports.isDragging = function () { return exports._isDragging; }\n\nexports._evtCb = {};\nexports.getEvtCbName = function (evtType) {\n\tvar name = exports.eventTypes[evtType];\n\treturn (exports._evtCb[evtType] = 'Input' + name.charAt(0) + name.substring(1).toLowerCase());\n}\n\n/**\n * Aliases for children of the timestep.input \"package\".\n */\n\nexports.InputListener = device.get('Input');\nexports.KeyListener = device.get('KeyListener');\n\njsio('import .InputEvent as exports.InputEvent');\n","pre":true},"modules/devkit-core/modules/timestep/src/event/input/InputEvent.js":{"path":"modules/devkit-core/modules/timestep/src/event/input/InputEvent.js","friendlyPath":".InputEvent","directory":"modules/devkit-core/modules/timestep/src/event/input/","filename":"InputEvent.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.input.InputEvent;\n * This class represents an input event.\n * \n * It assumes a tree structure of View objects.  The top (root) of the\n * tree is typically the main Application view.  \n * \n * Events are assigned a root and a target.  View::dispatchEvent\n * computes the root and target from the event location (x, y).\n *\n * Propogation has two phases: capturing and bubbling.  Users \n * can mostly ignore capturing as the primary hooks are in the \n * bubbling.  Bubbling is defined as calling event handlers on\n * each view starting with 'target' and then continuing up \n * superview pointers until reaching 'root'.  Views can listen\n * to the event bubbling by adding methods such as:\n * \"input:start\" -> \"function onInputStart(evt)\"\n * \"input:drag\" -> \"function onDrag(dragEvt, moveEvt, delta)\"\n *\n * Other code can hook into a view's events by calling:\n *   myView.subscribe('input:start', function () { alert('Mouse Down'); });\n *   myView.subscribe('input:end', this, 'onChildViewClick');\n *\n * Propogation of events can be cancelled by calling evt.cancel().\n *\n * Note that onDrag is a special event that receives not only\n * a move event from an 'input:move' event, but also a custom\n * dragEvt object that contains extra data such as the start\n * position of the drag.\n *\n * @doc http://doc.gameclosure.com/api/event.html#class-event.input.inputevent\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/event.md\n */\n\njsio('import math.geom.Point as Point');\njsio('import timer');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_event_input_InputEvent=__class__;var InputEvent = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_event_input_InputEvent(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_event_input_InputEvent(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.cancelled = false; // If true, this event will not propogate\n\tthis.depth = 0; // Number of levels of the tree from root to target (inclusive)\n\t\n\t// Note that under normal usage:\n\t//   this.depth == this.trace.length\n\t//   this.root = this.trace[this.trace.length - 1]\n\t//   this.target = this.trace[0]\n\t\n\tthis.init = function (id, evtType, x, y, root, target) {\n\t\t// unique ID for a particular input - the ID should be constant for a given input\n\t\t// for example, the mouse should always have the same ID.  Each finger (touch)\n\t\t// should have the same ID throughout the touch start/move/end process\n\t\tthis.id = id; \n\t\t\n\t\t// string evtType, e.g. 'input:start'\n\t\tthis.type = evtType;\n\t\t\n\t\t// localized point coordinates, indexed by a view's uid (View::uid)\n\t\t// @internal --at least for now, concerns over performance.\n\t\tthis.point = this.pt = {};\n\t\t\n\t\t// raw (x, y) coordinates\n\t\tthis.srcPoint = this.srcPt = new Point(x, y);\n\t\t\n\t\t// list of View nodes from target to root\n\t\tthis.trace = [];\n\t\t\n\t\t// Top-most view where event is dispatched (e.g. the tree root)\n\t\tthis.root = root || null;\n\t\t\n\t\t// time of dispatch\n\t\tthis.when = timer.now;\n\t\t\n\t\t// Bottom-most view where the event occurred\n\t\tthis.target = target || null;\n\t}\n\t\n\tthis.cancel = function () {\n\t\tthis.cancelled = true;\n\t}\n\n\tthis.clone = function () {\n\t\treturn new InputEvent(this.id, this.type, this.srcPt.x, this.srcPt.y, this.root, this.target);\n\t}\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/timer.js":{"path":"modules/devkit-core/modules/timestep/src/timer.js","friendlyPath":"timer","directory":"modules/devkit-core/modules/timestep/src/","filename":"timer.js","baseMod":"timer","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/modules/timestep/src/timer","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module timer\n *\n * Implements an independent, singleton timer for use by the environment.\n * The Application Engine binds to this to generate the rendering tick.\n */\n\njsio('import device');\n\nvar Timer = device.get('Timer');\n\nvar MAX_TICK = 10000; // ticks over 10 seconds will be considered too large to process\nexports.now = 0;\nexports.frames = 0;\nexports.reset = function () { this._last = null; }\nexports.tick = function (dt) {\n\ttry {\n\t\tif (dt > MAX_TICK) {\n\t\t\texports.onLargeTick(dt, MAX_TICK);\n\t\t\tdt = 1;\n\t\t}\n\t\t\n\t\texports.now += dt;\n\t\texports.frames++;\n\t\texports.onTick(dt);\n\t\tok = true;\n\t} finally {\n\t\tif (exports.debug && !ok) {\n\t\t\tapp.stopLoop()\n\t\t}\n\t}\n}\n\n/**\n * If our computer falls asleep, dt might be an insanely large number. \n * If we're running a simulation of sorts, we don't want the computer\n * to freeze while computing 1000s of simulation steps, so just drop\n * this tick.  Anyone who is interested can listen for a call to 'onLargeTick'\n */\nexports.onLargeTick = function (largeDt, threshold) {\n\tlogger.WARN&&console.warn(\"WARN\",\"timer\",'Dropping large tick: ' + largeDt + '; Threshold is set at: ' + threshold);\n}\n\nexports.onTick = function (dt) {}\n\nexports.debug = false;\n\n\n// TODO: <jsio>('from iOS import start as exports.start, stop as exports.stop');\n\nexports.start = function (minDt) {\n\tthis.reset();\n\tthis.isRunning = true;\n\tdevice.get('Timer').start(exports.tick, minDt);\n}\n\nexports.stop = function () {\n\tthis.reset();\n\tthis.isRunning = false;\n\tdevice.get('Timer').stop();\n}\n\nexports.getTickProgress = function () {\n\tvar now = +new Date;\n\treturn (-(Timer.last || now) + now);\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/ReflowManager.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/ReflowManager.js","friendlyPath":"ui.backend.ReflowManager","directory":"modules/devkit-core/modules/timestep/src/ui/backend/","filename":"ReflowManager.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar DEBUG = false;\nvar DEBUG_TIME = true;\nif (DEBUG || DEBUG_TIME) {\n\tvar _debug = {\n\t\tspace: '',\n\t\tstepIn: function () { this.space += ' '; return true; },\n\t\tstepOut: function () { this.space = this.space.slice(0, this.space.length - 1); return true; },\n\t\tlog: function () { logger.log.apply(logger, [this.space].concat(Array.prototype.slice.call(arguments, 0))); return true; }\n\t};\n\tlogger.LOG&&console.log(\"LOG\",\"ui.backend.ReflowManager\",\"===== CREATING REFLOW MANAGER\");\n}\n\n// max reflows for any view in a given tick\nvar MAX_REFLOW_THRESHOLD = 20;\n\nvar _pool = new (Class(function () {\n\tthis._pool = [];\n\n\tthis.recycle = function (item) {\n\t\titem.view = null;\n\t\tthis._pool.push(item);\n\t}\n\n\tthis.get = function (view) {\n\t\tvar item = this._pool.pop() || {};\n\t\titem.view = view;\n\t\titem.count = 0;\n\t\titem.needsReflow = false;\n\t\treturn item;\n\t}\n}));\n\n/**\n * The ReflowManager is the controller for view layout.  It hooks into\n * the render cycle in two places:\n *  1. at the start of a render to reflow any views that we know\n *     need layout.  This is signalled by calling calls to needsReflow\n *     on a view between render cycles that result in a call to\n *     `ReflowMgr.add`.\n *  2. during render, if the view hasn't ever been rendered, the\n *     ReflowManager is notified to initiate the buildView call\n *     and handle any reflow logic before the view's first render.\n * The ReflowManager uses a queue-like structure to resolve the reflow\n * constraints. Views notify the ReflowManager through the add(view)\n * method, which then adds the view to the queue.  During a reflow cycle,\n * the ReflowManager tracks how many iterations through the queue each\n * view actually gets reflowed.  If the number of reflows exceeds the\n * MAX_REFLOW_THRESHOLD, reflow stops for that view, preventing infinite\n * loops when reflow cycles occur.\n */\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_ReflowManager=__class__;var ReflowManager = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_ReflowManager(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_ReflowManager(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function () {\n\t\tthis._pending = {};\n\t\tthis._iter = 0;\n\t\tthis._pendingCount = 0;\n\t}\n\n\tthis.add = function (view) {\n\t\tif (!view.style.layout) { return; }\n\n\t\tvar uid = view.uid;\n\t\tvar item = this._pending[uid] || (this._pending[uid] = _pool.get(view));\n\n\t\tif (!item.needsReflow) {\n\t\t\t++this._pendingCount;\n\t\t\titem.needsReflow = true;\n\n\t\t\tDEBUG && _debug.log('adding ' + view + ' (' + view.uid + ')' + (' ' + view.style.layout || '') + ':',\n\t\t\t\t(view.style.width === undefined ? '?' : view.style.width)\n\t\t\t\t\t+ 'x'\n\t\t\t\t\t+ (view.style.height === undefined ? '?' : view.style.height));\n\t\t}\n\n\t\t// increment count once per reflow iteration\n\t\tif (item.iter != this._iter) {\n\t\t\titem.iter = this._iter;\n\t\t}\n\t}\n\n\tthis.reflow = function (view) {\n\t\tif (view.style.__cachedWidth === undefined) {\n\t\t\tview.style.__cachedWidth = view.style.width;\n\t\t}\n\n\t\tif (view.style.__cachedHeight === undefined) {\n\t\t\tview.style.__cachedHeight = view.style.height;\n\t\t}\n\n\t\tvar item = this._pending[view.uid];\n\t\tif (item && item.needsReflow) {\n\t\t\titem.needsReflow = false;\n\t\t\t--this._pendingCount;\n\t\t}\n\n\t\tif (view.__layout) {\n\t\t\tview.__layout.reflow();\n\t\t}\n\n\t\tview.reflow && view.reflow();\n\n\t\t// always reflow children if a layout changes sizes\n\t\tif (view.__layout) {\n\t\t\tvar style = view.style;\n\t\t\tvar w = style.width;\n\t\t\tvar h = style.height;\n\t\t\tif (style.__cachedWidth != style.width || style.__cachedHeight != style.height) {\n\t\t\t\tvar subviews = view.getSubviews();\n\t\t\t\tfor (var i = 0, n = subviews.length; i < n; ++i) {\n\t\t\t\t\tthis.add(subviews[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.reflowViews = function (ctx) {\n\t\tif (!this._pendingCount) { return; }\n\n\t\tthis._iter = 0;\n\t\tvar count;\n\n\t\tDEBUG && _debug.stepIn();\n\t\tif (DEBUG_TIME) {\n\t\t\tvar startTime = Date.now();\n\t\t}\n\n\t\t// outer loop manages batched resize events\n\t\t// inner loop manages recursive reflow\n\t\twhile (this._pendingCount) {\n\n\t\t\t// as long as we reflowed some views, keep looping\n\t\t\twhile (this._pendingCount) {\n\t\t\t\t++this._iter; // what iteration are we on? only increment a view's count once per iteration\n\n\t\t\t\tcount = 0;\n\t\t\t\tfor (var uid in this._pending) {\n\t\t\t\t\tDEBUG && count == 0 && this._iter == 1 && console.log(\" == beginning reflow == \");\n\n\t\t\t\t\tvar item = this._pending[uid];\n\t\t\t\t\tif (item.count > MAX_REFLOW_THRESHOLD) {\n\t\t\t\t\t\tlogger.WARN&&console.warn(\"WARN\",\"ui.backend.ReflowManager\",'reflow loop detected for view', item.view.uid);\n\t\t\t\t\t\tthis.cleanUp();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (item.needsReflow) {\n\t\t\t\t\t\t// if (item.view.uid == 187) debugger;\n\t\t\t\t\t\t++item.count;\n\t\t\t\t\t\tDEBUG && _debug.log('-- reflow view', item.view.uid, '(' + item.count + ' times)') && _debug.stepIn();\n\t\t\t\t\t\tthis.reflow(item.view);\n\t\t\t\t\t\tDEBUG && _debug.stepOut();\n\t\t\t\t\t\t++count;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tDEBUG && count && _debug.log('***** iteration', this._iter, 'reflowed', count, 'views');\n\t\t\t}\n\n\t\t\tfor (var uid in this._pending) {\n\t\t\t\tvar view = this._pending[uid].view;\n\t\t\t\tif (view.hasListeners('resize')) {\n\t\t\t\t\tvar style = view.style;\n\t\t\t\t\tvar w = style.width;\n\t\t\t\t\tvar h = style.height;\n\t\t\t\t\tif (style.__cachedWidth != w || style.__cachedHeight != h) {\n\t\t\t\t\t\tDEBUG && _debug.log('view', view.uid, 'resize event firing', w + 'x' + h, '(prev: ' + style.__cachedWidth + 'x' + style.__cachedHeight + ')');\n\t\t\t\t\t\tstyle.__cachedWidth = w;\n\t\t\t\t\t\tstyle.__cachedHeight = h;\n\t\t\t\t\t\tview.emit('resize');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.cleanUp();\n\n\t\tif (DEBUG) {\n\t\t\t_debug.stepOut();\n\t\t}\n\n\t\tif (DEBUG_TIME && this._iter) {\n\t\t\tvar now = Date.now();\n\t\t\t_debug.log('total reflow time:', now - startTime);\n\t\t}\n\t}\n\n\n\tthis.cleanUp = function () {\n\t\t// recyle items\n\t\tfor (var uid in this._pending) {\n\t\t\t_pool.recycle(this._pending[uid]);\n\t\t\tdelete this._pending[uid];\n\t\t}\n\n\t\tthis._pendingCount = 0;\n\t}\n});\n\nvar _instance = null;\nexports.get = function () {\n\treturn (_instance || (_instance = new ReflowManager()));\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/StackView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/StackView.js","friendlyPath":".StackView","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"StackView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.StackView;\n * Implements a view which can switch out one of several child views to display at the front.\n *\n * @doc http://doc.gameclosure.com/api/ui-stackview.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/stackview.md\n */\n\njsio('import ui.View as View');\njsio('import animate');\n\n/**\n * @extends ui.View\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_StackView=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_StackView(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_StackView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\tlayout: 'box'\n\t\t});\n\t\tsupr(this, 'init', [opts]);\n\t\tthis.stack = [];\n\t};\n\n\tthis.getStack = function () { return this.stack; };\n\n\tthis.getCurrentView = function () {\n\t\tif (!this.stack.length) { return null; }\n\t\treturn this.stack[this.stack.length - 1];\n\t};\n\n\tthis.push = function (view, dontAnimate, reverse) {\n\t\t// don't animate the first (base) view of a stackview unless explicitly asked to\n\t\tif (!this.stack[0] && dontAnimate !== false) {\n\t\t\tdontAnimate = true;\n\t\t}\n\n\t\tvar current = this.getCurrentView();\n\t\tif (current) { this._hide(current, dontAnimate); }\n\t\tview.style.y = 0;\n\t\tview.style.width = this.style.width / view.style.scale;\n\t\tview.style.height = this.style.height / view.style.scale;\n\t\tthis.stack.push(view);\n\t\tthis._show(view, dontAnimate, reverse);\n\t\treturn view;\n\t};\n\n\tthis._hide = function (view, dontAnimate, reverse) {\n\t\tview.publish('ViewWillDisappear');\n\t\tif (!dontAnimate) {\n\t\t\tthis.getInput().blockEvents = true;\n\t\t\tanimate(view)\n\t\t\t\t.then({x: (reverse ? 1 : -1) * this.style.width})\n\t\t\t\t.then(bind(this, function () {\n\t\t\t\t\tthis.removeSubview(view);\n\t\t\t\t\tview.publish('ViewDidDisappear');\n\t\t\t\t\tthis.getInput().blockEvents = false;\n\t\t\t\t}));\n\t\t} else {\n\t\t\tthis.removeSubview(view);\n\t\t\tview.publish('ViewDidDisappear');\n\t\t}\n\t};\n\n\tthis._show = function (view, dontAnimate, reverse) {\n\t\tview.publish('ViewWillAppear');\n\t\tview.style.visible = true;\n\t\tif (!dontAnimate) {\n\t\t\tview.style.x = (reverse ? -1 : 1) * this.style.width;\n\t\t\tthis.addSubview(view);\n\t\t\tanimate(view)\n\t\t\t\t.then({x: 0})\n\t\t\t\t.then(bind(view, 'publish', 'ViewDidAppear'));\n\t\t} else {\n\t\t\tthis.addSubview(view);\n\t\t\tview.style.x = 0;\n\t\t\tview.publish('ViewDidAppear');\n\t\t}\n\t};\n\n\tthis.hasView = function (view) {\n\t\treturn this.stack.indexOf(view) >= 0;\n\t};\n\n\tthis.remove = function (view) {\n\t\tvar i = this.stack.indexOf(view);\n\t\tif (i >= 0) {\n\t\t\tthis.stack.splice(i, 1);\n\t\t}\n\t}\n\n\tthis.pop = function (dontAnimate, reverse) {\n\t\tif (!this.stack.length) { return false; }\n\t\tvar view = this.stack.pop();\n\t\t//reverse by default\n\t\tthis._hide(view, dontAnimate, (reverse === false) ? false : true);\n\n\t\tif (this.stack.length) {\n\t\t\tthis._show(this.stack[this.stack.length - 1], dontAnimate, true);\n\t\t}\n\n\t\treturn view;\n\t};\n\n\tthis.popAll = function (dontAnimate) {\n\t\twhile (this.stack[1]) {\n\t\t\tthis.pop(dontAnimate);\n\t\t}\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/View.js":{"path":"modules/devkit-core/modules/timestep/src/ui/View.js","friendlyPath":"ui.View","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"View.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.View;\n * The View base class.\n *\n * @doc http://doc.gameclosure.com/api/ui-view.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/view.md\n */\n\njsio('import device');\njsio('import event.Emitter as Emitter');\n\njsio('import math.geom.Point as Point');\njsio('import math.geom.Rect as Rect');\n\njsio('import .backend.canvas.ViewBacking');\n\njsio('import ui.backend.ReflowManager as ReflowManager');\nvar _reflowMgr = ReflowManager.get();\n\njsio('import event.input.dispatch as dispatch');\njsio('import event.input.InputHandler as InputHandler');\n\njsio('import animate');\n\njsio('import util.setProperty');\n\nvar KeyListener = device.get('KeyListener');\n\nEventScheduler=__class__;var EventScheduler=EventScheduler(function EventScheduler(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function () {\n\t\tthis._queue = [];\n\t}\n\n\tthis.add = function (f) {\n\t\tthis._queue.push(f);\n\n\t\tif (!this._running) {\n\t\t\tthis._running = true;\n\t\t\twhile ((f = this._queue.shift())) {\n\t\t\t\tf();\n\t\t\t}\n\t\t\tthis._running = false;\n\t\t}\n\t}\n});\n\nvar scheduler = new EventScheduler();\n\n/**\n * This singleton class controls the focus of the current application. Only one\n * view can be focused at a given time.\n *\n * This doesn't correspond to native and isn't being used.\n */\nvar FocusMgr = new (Class(function () {\n\tthis.init = function (opts) {\n\t\tthis._keyListener = KeyListener && (new KeyListener());\n\t\tthis._target = null;\n\t\tthis._canChange = true;\n\t};\n\n\t/**\n\t * Focus the target, unfocusing the last target with focus.\n\t */\n\tthis.focus = function (target) {\n\t\tif (this._target != target && this._canChange) {\n\t\t\tif (this._target && this._target.onBlur) {\n\t\t\t\tthis._target.onBlur(this);\n\t\t\t}\n\n\t\t\tthis._target = target;\n\t\t\tif (target && target.onFocus) {\n\t\t\t\tthis._target.onFocus(this);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.blur = function (target) {\n\t\ttarget.onBlur && target.onBlur(this);\n\t\tthis._target = false;\n\t};\n\n\t/**\n\t * Return the keylistener used by the focus manager.\n\t */\n\tthis.getKeyListener = function () {\n\t\treturn this._keyListener;\n\t};\n\n\tthis.get = function () {\n\t\treturn this;\n\t};\n}));\n\n/**\n * Unique ID counter for all views.\n */\nvar UID = 0;\n\nvar _BackingCtor = null;\n\n/**\n * @extends event.Emitter\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_View=__class__;var View = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_View(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_View(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n\t/**\n\t * infinite: boolean, default false - if true, no bounding shape at all (e.g. infinite scroll plane)\n\t * clip: boolean, default false - if true, always clip to the region\n\t * canHandleEvents: boolean, default true - if false, this view is ignored for event handling\n\t * parent: object, if provided, sets the initial superview\n\t */\n\tthis.init = function (opts) {\n\t\tif (!opts) { opts = {}; }\n\n\t\tthis.uid = ++UID;\n\n\t\t// Maintain pointers to children to keep native views from being garbage collected\n\t\tthis.__parent = null;\n\t\tthis.__children = null;\n\t\tthis.__leftSibling = null;\n\t\tthis.__rightSibling = null;\n\n\t\tthis.__input = new InputHandler(this, opts);\n\n\t\t// set with View.setDefaultViewBacking();\n\t\tthis.__view = this.style = new (opts.Backing || _BackingCtor)(this, opts);\n\n\t\tthis._filter = null;\n\n\t\tthis.__view._view = this;\n\n\t\tthis.updateOpts(opts);\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\topts = opts || {};\n\t\tif (this._opts) {\n\t\t\tfor (var key in opts) {\n\t\t\t\tthis._opts[key] = opts[key];\n\t\t\t}\n\t\t} else {\n\t\t\tthis._opts = opts;\n\t\t}\n\n\t\tif (opts.tag) { this.tag = opts.tag; }\n\t\tif (opts.filter) { this._filter = opts.filter; }\n\n\t\tif (opts.infinite) {\n\t\t\tthis._infinite = opts.infinite;\n\t\t}\n\n\t\tthis.style.update(opts);\n\t\tthis.__input.update(opts);\n\n\t\tif (opts.superview) {\n\t\t\topts.superview.addSubview(this);\n\t\t}\n\t\t//opts.parent is deprecated, use opts.superview instead\n\t\tif (opts.parent) {\n\t\t\topts.parent.addSubview(this);\n\t\t}\n\n\t\treturn opts;\n\t};\n\n\t// --- filters ---\n\t// each filter can have multiple views\n\t// but no view can have more than one filter\n\n\t/**\n\t * Returns the filters attached to this view -- DEPRECATED\n\t */\n\tthis.getFilters = function () {\n\t\tlogger.WARN&&console.warn(\"WARN\",\"ui.View\",\"View.getFilters() is deprecated! Use View.getFilter() instead.\");\n\t\tvar filters = {};\n\t\tif (this._filter) {\n\t\t\tfilters[this._filter.getType()] = this._filter;\n\t\t}\n\t\treturn filters;\n\t};\n\n\t/**\n\t * Returns the filter attached to this view.\n\t */\n\tthis.getFilter = function () {\n\t\treturn this._filter;\n\t};\n\n\t/**\n\t * Sets the filter on this view -- DEPRECATED\n\t */\n\tthis.addFilter = function (filter) {\n\t\tlogger.WARN&&console.warn(\"WARN\",\"ui.View\",\"View.addFilter() is deprecated! Use View.setFilter() instead.\");\n\t\tthis.setFilter(filter);\n\t};\n\n\t/**\n\t * Sets the filter on this view. Only one filter can exist on a view.\n\t */\n\tthis.setFilter = function (filter) {\n\t\tthis._filter = filter;\n\t};\n\n\t/**\n\t * Remove the filter from this view.\n\t */\n\tthis.removeFilter = function () {\n\t\tthis._filter = null;\n\t};\n\n\t// --- render/tick setters ---\n\n\t/**\n\t * Adds a hook to determine when the \"render\" property is set.\n\t */\n\tutil.setProperty(this, 'render', {\n\t\t\tvalue: undefined,\n\t\t\tcb: function () { this.__view && (this.__view.hasJSRender = true); }\n\t\t});\n\n\t/**\n\t * Adds a hook to determine when the \"tick\" property is set.\n\t */\n\tutil.setProperty(this, 'tick', {\n\t\t\tvalue: undefined,\n\t\t\tcb: function () { this.__view && (this.__view.hasJSTick = true); }\n\t\t});\n\n\t// --- animation component ---\n\n\t/**\n\t * Get an animation group from this view.\n\t */\n\tthis.getAnimation = function (groupID) {\n\t\treturn animate(this, groupID);\n\t};\n\n\t/**\n\t * @deprecated\n\t * Return an animation object for this view.\n\t */\n\tthis.animate = function (style, duration, easing) {\n\t\treturn this.getAnimation().then(style, duration, easing);\n\t};\n\n\t// --- ui focus/blur component ---\n\n\t/**\n\t * Indicate to the focus manager singleton this element is focused.\n\t */\n\tthis.focus = function () {\n\t\tFocusMgr.get().focus(this); return this;\n\t};\n\n\t/**\n\t * Indicate to the focus manager singleton this element is blurred.\n\t */\n\tthis.blur = function () {\n\t\tFocusMgr.get().blur(this);\n\t\treturn this;\n\t};\n\n\t/**\n\t * Triggered when focus is given to this view.\n\t */\n\tthis.onFocus = function () {\n\t\tthis._isFocused = true;\n\t};\n\n\t/**\n\t * Indicate to the focus manager singleton this element is blurred.\n\t */\n\tthis.onBlur = function () {\n\t\tthis._isFocused = false;\n\t};\n\n\t// --- input component ---\n\n\t/**\n\t * Returns a boolean indicating we are currently dragging this view.\n\t */\n\tthis.isDragging = function () {\n\t\treturn this.__input.isDragging();\n\t};\n\n\t/**\n\t * Start responding to touch input by dragging this view.\n\t */\n\tthis.startDrag = function (opts) {\n\t\tthis.__input.startDrag(opts);\n\t};\n\n\t/**\n\t * Return the InputHandler for this view.\n\t */\n\tthis.getInput = function () {\n\t\treturn this.__input;\n\t};\n\n\t/**\n\t * Returns a boolean indicating if a touch is on this view.\n\t */\n\tthis.isInputOver = function () {\n\t\treturn !!this.__input.overCount;\n\t};\n\n\t/**\n\t * Returns a number indicating how many touches are on this view.\n\t */\n\tthis.getInputOverCount = function () {\n\t\treturn this._inputOverCount;\n\t};\n\n\t/**\n\t * Renamed to setHandleEvents, canHandleEvents is deprecated.\n\t * @param {boolean} handleEvents Pass events through.\n\t * @param {boolean} ignoreSubviews Optional, defaults to false in InputHandler. Ignore events in childen as well.\n\t */\n\tthis.setHandleEvents = this.canHandleEvents = function (handleEvents, ignoreSubviews) {\n\t\tthis.__input.canHandleEvents = handleEvents;\n\n\t\tif (typeof ignoreSubviews === 'boolean') {\n\t\t\tthis.__input.blockEvents = ignoreSubviews;\n\t\t}\n\t};\n\n\t// TODO: think about refactoring internal components and exposing them differently...\n\tthis.setIsHandlingEvents = function (canHandleEvents) {\n\t\tthis.__input.canHandleEvents = canHandleEvents;\n\t};\n\n\tthis.isHandlingEvents = function () {\n\t\treturn this.__input.canHandleEvents;\n\t};\n\n\tthis.needsRepaint = function () {\n\t\tthis._needsRepaint = true;\n\t};\n\n\tthis.needsReflow = function () {\n\t\tif (this.reflow != DEFAULT_REFLOW || this.style.layout) {\n\t\t\t_reflowMgr.add(this);\n\t\t\tthis._needsRepaint = true;\n\t\t}\n\t};\n\n\tthis.reflowSync = function () { _reflowMgr.reflow(this); };\n\n\t/**\n\t * Consumes an event targeting this view.\n\t * NOTE: Does no actual propagation.\n\t */\n\tthis._onEventPropagate = function (evt, pt, atTarget) {\n\t\tif (atTarget) {\n\t\t\tvar id = evt.id;\n\t\t\tvar lastEvt;\n\t\t\tvar i;\n\n\t\t\tswitch(evt.type) {\n\t\t\t\tcase dispatch.eventTypes.SELECT:\n\t\t\t\tcase dispatch.eventTypes.CLEAR:\n\t\t\t\t\tdispatch._evtHistory[dispatch.eventTypes.MOVE] = null;\n\t\t\t\t\tlastEvt = dispatch._activeInputOver[id];\n\t\t\t\t\tif (lastEvt) {\n\t\t\t\t\t\tdispatch.clearOverState(id);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase dispatch.eventTypes.START:\n\t\t\t\tcase dispatch.eventTypes.MOVE:\n\t\t\t\t\t// translate input:move events into two higher-level events:\n\t\t\t\t\t//   input:over and input:out\n\n\t\t\t\t\tvar target = evt.trace[0];\n\t\t\t\t\tvar view = null;\n\n\t\t\t\t\t// fire input:out events first, start with deepest node and work out\n\t\t\t\t\tlastEvt = dispatch._activeInputOver[id];\n\t\t\t\t\tif (lastEvt && target != lastEvt.trace[0]) {\n\t\t\t\t\t\tvar trace = lastEvt.trace;\n\t\t\t\t\t\tfor (i = 0, view; view = trace[i]; ++i) {\n\t\t\t\t\t\t\tif (!(view.uid in evt.pt)) {\n\t\t\t\t\t\t\t\tview.__input.onLeave(id, target == view);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!lastEvt || target != lastEvt.trace[0]) {\n\t\t\t\t\t\t// fire input:over events second, start with outermost node and go to target\n\t\t\t\t\t\tvar trace = evt.trace;\n\t\t\t\t\t\tfor (i = evt.depth - 1; i >= 0; --i) {\n\t\t\t\t\t\t\ttrace[i].__input.onEnter(id, target == view);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// update current mouse trace\n\t\t\t\t\t\tdispatch._activeInputOver[id] = evt;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.localizePoint = function (pt) {\n\t\tvar list = this.getParents();\n\t\tvar i = 0;\n\t\tlist.push(this);\n\t\twhile (list[i]) {\n\t\t\tpt = list[i++].__view.localizePoint(pt);\n\t\t}\n\t\treturn pt;\n\t};\n\n\t// --- view hierarchy component ---\n\n\t/**\n\t * Return the subview at the given index.\n\t */\n\tthis.getSubview = function (i) {\n\t\treturn this.__view.getSubviews()[i];\n\t};\n\n\t/**\n\t * Returns an array of all subviews.\n\t */\n\tthis.getSubviews = function () {\n\t\treturn this.__view.getSubviews();\n\t};\n\n\t/**\n\t * Returns the superview of this view.\n\t */\n\tthis.getSuperview = function () {\n\t\treturn this.__view.getSuperview();\n\t};\n\n\tthis.connectEvent = function (src, name /*, args */) {\n\t\tif (!this.__subs) {\n\t\t\tthis.__subs = [];\n\n\t\t\tthis.on('ViewAdded', bind(this, '_connectEvents'));\n\t\t\tthis.on('ViewRemoved', bind(this, '_disconnectEvents'));\n\n\t\t\tif (this.__root) {\n\t\t\t\tthis._connectEvents();\n\t\t\t}\n\t\t}\n\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\tthis.__subs.push([src, args]);\n\t\tif (this.__root) {\n\t\t\tsrc.on.apply(src, args);\n\t\t}\n\t}\n\n\tfunction compareSubscription (args, sub) {\n\t\t// note that args and sub may not be the same length\n\t\t// return true if all items in args match items in sub\n\t\t// (we don't care if sub has extra arguments)\n\t\tfor (var i = 0, n = args.length; i < n; ++i) {\n\t\t\tif (args[i] != sub[i]) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tthis.disconnectEvent = function (src, name /*, args */) {\n\t\tif (this.__subs) {\n\t\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\t\tfor (var i = 0, sub; sub = this.__subs[i]; ++i) {\n\t\t\t\tif (sub[0] == src && compareSubscription(args, sub[1])) {\n\t\t\t\t\tsub[0].removeListener.apply(sub[0], sub[1]);\n\t\t\t\t\tthis.__subs.splice(i--, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._connectEvents = function () {\n\t\tfor (var i = 0, args; args = this.__subs[i]; ++i) {\n\t\t\targs[0].on.apply(args[0], args[1]);\n\t\t}\n\t};\n\n\tthis._disconnectEvents = function () {\n\t\tfor (var i = 0, args; args = this.__subs[i]; ++i) {\n\t\t\targs[0].removeListener.apply(args[0], args[1]);\n\t\t}\n\t};\n\n\t/**\n\t * Add a subview.\n\t */\n\tthis.addSubview = function (view) {\n\t\tif (this.__view.addSubview(view)) {\n\t\t\tview.needsRepaint();\n\n\t\t\tthis._linkView(view);\n\n\t\t\t// if successful, clear any residual input over count\n\t\t\tview.__input.resetOver();\n\n\t\t\tthis.publish('SubviewAdded', view);\n\t\t\tif (this.__root) {\n\t\t\t\tvar root = this.__root;\n\t\t\t\tvar viewCreated = view;\n\t\t\t\tscheduler.add(bind(this, function recurse (view) {\n\t\t\t\t\tif (!view.style.__firstRender) {\n\t\t\t\t\t\tview.style.__firstRender = true;\n\t\t\t\t\t\tview.needsReflow();\n\t\t\t\t\t}\n\n\t\t\t\t\tview.__root = root;\n\t\t\t\t\tview.emit('ViewAdded', viewCreated);\n\t\t\t\t\tvar subviews = view.getSubviews();\n\t\t\t\t\tfor (var i = 0, subview; subview = subviews[i]; ++i) {\n\t\t\t\t\t\trecurse(subview);\n\t\t\t\t\t}\n\t\t\t\t}, view));\n\t\t\t}\n\t\t}\n\n\t\treturn view;\n\t};\n\n\t// link the input view to the current view to prevent native views from being\n\t// garbage collected\n\tthis._linkView = function (view) {\n\t\t// remove any current connections\n\t\tthis._unlinkView(view);\n\n\t\t// Insert this view as the head of the sibling list\n\t\tif (this.__children) {\n\t\t\tthis.__children.__leftSibling = view;\n\t\t}\n\t\tview.__leftSibling = null;\n\t\tview.__rightSibling = this.__children;\n\t\tthis.__children = view;\n\t\tview.__parent = this;\n\n\n\t};\n\n\tthis._unlinkView = function (view) {\n\t\tif (view.__parent) {\n\t\t\t// When removing a subview, remove the view from its sibling list\n\t\t\tif (view.__leftSibling) {\n\t\t\t\tview.__leftSibling.__rightSibling = view.__rightSibling;\n\t\t\t}\n\n\t\t\tif (view.__rightSibling) {\n\t\t\t\tview.__rightSibling.__leftSibling = view.__leftSibling;\n\t\t\t}\n\n\t\t\t// If this view is the head of the sibling list\n\t\t\t// then set the next sibling to be the head\n\t\t\tif (view.__parent.__children == view) {\n\t\t\t\tview.__parent.__children = view.__rightSibling;\n\t\t\t}\n\n\t\t\tview.__leftSibling = null;\n\t\t\tview.__rightSibling = null;\n\t\t\tview.__parent = null;\n\t\t}\n\t};\n\n\t/**\n\t * Removes a subview.\n\t */\n\tthis.removeSubview = function (view) {\n\t\tif (this.__view.removeSubview(view)) {\n\t\t\tthis._unlinkView(view);\n\t\t\tthis.publish('SubviewRemoved', view);\n\t\t\tif (view.__root) {\n\t\t\t\tscheduler.add(bind(this, function recurse(view) {\n\t\t\t\t\tview.__root = null;\n\t\t\t\t\tview.emit('ViewRemoved', this);\n\t\t\t\t\tvar subviews = view.getSubviews();\n\t\t\t\t\tfor (var i = 0, subview; subview = subviews[i]; ++i) {\n\t\t\t\t\t\trecurse(subview);\n\t\t\t\t\t}\n\t\t\t\t}, view));\n\t\t\t}\n\t\t}\n\n\t\treturn view;\n\t};\n\n\t/**\n\t * Removes this view from its parent.\n\t */\n\tthis.removeFromSuperview = function () {\n\t\tvar superview = this.__view.getSuperview();\n\t\tif (superview) {\n\t\t\tsuperview.removeSubview(this);\n\t\t}\n\t};\n\n\t/**\n\t * Removes all subviews from this view.\n\t */\n\tthis.removeAllSubviews = function () {\n\t\tvar subviews = this.getSubviews();\n\t\tvar i = subviews.length;\n\t\twhile (i--) {\n\t\t\tthis.removeSubview(subviews[i]);\n\t\t}\n\t};\n\n\t// legacy implementation shim\n\tutil.setProperty(this, '_superview', {get: this.getSuperview, set: function () {}});\n\tutil.setProperty(this, '_subviews', {get: this.getSubviews, set: function () {}});\n\n\t// --- onResize callbacks ---\n\n\tvar DEFAULT_REFLOW = function () {\n\t};\n\n\tthis.reflow = DEFAULT_REFLOW;\n\n\t// ---\n\n\t/**\n\t * Get the root application for this view.\n\t */\n\tthis.getEngine = this.getApp = function () {\n\t\treturn this.__root;\n\t}\n\n\t/**\n\t * Returns an array of all ancestors of the current view.\n\t */\n\tthis.getParents = /* deprecated */\n\tthis.getSuperviews = function () {\n\n\t\tvar views = [];\n\t\tvar next = this.getSuperview();\n\t\twhile (next) {\n\t\t\tviews.unshift(next);\n\t\t\tnext = next.getSuperview();\n\t\t}\n\n\t\treturn views;\n\t};\n\n\t/**\n\t * @interface\n\t */\n\tthis.buildView = function () {};\n\n\t/**\n\t * Determine if this view contains a point.\n\t */\n\tthis.containsLocalPoint = function (pt) {\n\t\tif (this._infinite) { return true; }  // infinite plane\n\n\t\tvar s = this.style,\n\t\t\tw = s.width,\n\t\t\th = s.height;\n\n\t\tif (w > 0 && h > 0) {\n\t\t\treturn pt.x <= w && pt.y <= h && pt.x >= 0 && pt.y >= 0;\n\t\t} else if (w > 0) {\n\t\t\treturn pt.x <= w && pt.y >= h && pt.x >= 0 && pt.y <= 0;\n\t\t} else if (h > 0) {\n\t\t\treturn pt.x >= w && pt.y <= h && pt.x <= 0 && pt.y >= 0;\n\t\t} else {\n\t\t\treturn pt.x >= w && pt.y >= h && pt.x <= 0 && pt.y <= 0;\n\t\t}\n\t};\n\n\t/**\n\t * Return the bounding shape for this view. The shape is defined in the\n\t * options object when this view was constructed.\n\t */\n\tthis._boundingShape = {};\n\tthis.getBoundingShape = function (simple) {\n\t\tif (this._infinite) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\tvar s = this.style;\n\t\t\tvar w = s.width;\n\t\t\tvar h = s.height;\n\t\t\tif (!(w && h) && s.layout) {\n\t\t\t\tvar superview = this.getSuperview();\n\t\t\t\tif (superview) {\n\t\t\t\t\tvar supersize = superview.getBoundingShape(true);\n\t\t\t\t\tif (!w) {\n\t\t\t\t\t\tw = supersize.width;\n\t\t\t\t\t\tif (s.layoutWidth) {\n\t\t\t\t\t\t\tw *= parseInt(s.layoutWidth) / 100;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!h) {\n\t\t\t\t\t\th = supersize.height;\n\t\t\t\t\t\tif (s.layoutHeight) {\n\t\t\t\t\t\t\th *= parseInt(s.layoutHeight) / 100;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (simple) {\n\t\t\t\tthis._boundingShape.x = s.x;\n\t\t\t\tthis._boundingShape.y = s.y;\n\t\t\t\tthis._boundingShape.width = w * s.scale;\n\t\t\t\tthis._boundingShape.height = h * s.scale;\n\t\t\t\treturn this._boundingShape;\n\t\t\t}\n\t\t\treturn new Rect(s.x, s.y, w * s.scale, h * s.scale);\n\t\t}\n\t};\n\n\t/**\n\t * Given a rectangle and a parent view, compute the location of\n\t * the rectangle in this view's coordinate space.\n\t * WARNING: only works with non-rotated rectangles.\n\t * TODO Make it work with rotated rectangles!\n\t */\n\tthis.getRelativeRegion = function (region, parent) {\n\t\tvar offset = this.getPosition(parent || region.src);\n\t\treturn new Rect((region.x - offset.x) / offset.scale,\n\t\t\t\t\t\t(region.y - offset.y)  / offset.scale,\n\t\t\t\t\t\tregion.width / offset.scale,\n\t\t\t\t\t\tregion.height / offset.scale);\n\t};\n\n\t/**\n\t * Return a fully defined position, rotation, size, and scale for this view.\n\t */\n\tthis.getPosition = function (/* optional */ relativeTo) {\n\t\tvar abs = new Point(),\n\t\t\tview = this,\n\t\t\tr = 0,\n\t\t\ts = this.style,\n\t\t\tw = s.width,\n\t\t\th = s.height,\n\t\t\tc = 1;\n\n\t\twhile (view && view != relativeTo) {\n\t\t\tvar scale = view.style.scale;\n\n\t\t\t//translate to anchor point\n\t\t\tabs.add(\n\t\t\t\t-(view.style.anchorX),\n\t\t\t\t-(view.style.anchorY)\n\t\t\t);\n\n\t\t\t//scale and rotate\n\t\t\tabs.rotate(view.style.r);\n\t\t\tabs.scale(scale);\n\n\t\t\t//translate back\n\t\t\tabs.add(\n\t\t\t\tview.style.anchorX + view.style.x + view.style.offsetX,\n\t\t\t\tview.style.anchorY + view.style.y + view.style.offsetY\n\t\t\t);\n\n\t\t\tr += view.style.r;\n\t\t\tw *= scale;\n\t\t\th *= scale;\n\t\t\tc *= scale;\n\t\t\tview = view.__view.getSuperview();\n\t\t}\n\n\t\treturn {\n\t\t\tx: abs.x,\n\t\t\ty: abs.y,\n\t\t\tr: r % (2 * Math.PI),\n\t\t\twidth: w,\n\t\t\theight: h,\n\t\t\tscale: c,\n\t\t\tanchorX: this.style.anchorX,\n\t\t\tanchorY: this.style.anchorY\n\t\t};\n\t};\n\n\t/**\n\t * Exposes the internal implementation of the view hierarchy\n\t */\n\tthis.getBacking = function () {\n\t\treturn this.__view;\n\t};\n\n\t/**\n\t * Sets the visibility to true. Triggers repaint.\n\t */\n\tthis.show = function () {\n\t\tthis.style.visible = true;\n\t\tthis.needsRepaint();\n\t};\n\n\t/**\n\t * Sets the visibility to false. Triggers repaint.\n\t */\n\tthis.hide = function () {\n\t\tthis.style.visible = false;\n\t\tthis.needsRepaint();\n\t};\n\n\t/**\n\t * Return a human-readable tag for this view.\n\t */\n\tthis.toString = this.getTag = function () {\n\t\tvar cls = \"View\";\n\n\t\tif (DEBUG) {\n\t\t\t// check the cached name\n\t\t\tif (this.__tagClassName) {\n\t\t\t\tcls = this.__tagClassName;\n\t\t\t} else {\n\t\t\t\t// generate the classname\n\t\t\t\tcls = this.constructor.name;\n\n\t\t\t\tif (!cls) {\n\t\t\t\t\tcls = this.constructor.toString().match(/^function ([^(]*)/)[1];\n\t\t\t\t}\n\n\t\t\t\tif (cls) {\n\t\t\t\t\tcls = cls.substr(cls.lastIndexOf(\"_\") + 1);\n\t\t\t\t}\n\n\t\t\t\tthis.__tagClassName = cls || 'unknown';\n\t\t\t}\n\t\t}\n\n\t\treturn cls + this.uid + (this.tag ? ':' + this.tag : '');\n\t};\n});\n\nvar _extensions = [];\nView.addExtension = function (ext) {\n\text.extend(View.BackingCtor);\n\t_extensions.push(ext);\n};\n\nView.setDefaultViewBacking = function (ViewBackingCtor) {\n\t_BackingCtor = View.BackingCtor = ViewBackingCtor;\n\t_extensions.forEach(function (ext) { ext.extend(_BackingCtor); });\n};\n\n// default view backing is canvas\nView.setDefaultViewBacking(backend.canvas.ViewBacking);\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ViewBacking.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ViewBacking.js","friendlyPath":".backend.canvas.ViewBacking","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"ViewBacking.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.backend.canvas.ViewStyle;\n *\n * Models the style object of the canvas View.\n */\n\njsio('import ..strPad');\njsio('import ..BaseBacking');\njsio('import util.setProperty as setProperty');\n\nvar _styleKeys = {};\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewBacking=__class__;var ViewBacking = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewBacking(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewBacking(){return this.init&&this.init.apply(this,arguments)},BaseBacking, function () {\n\n\tvar IDENTITY_MATRIX = { a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0 };\n\n\tvar sin = Math.sin;\n\tvar cos = Math.cos;\n\n\tthis.init = function (view) {\n\t\tthis._globalTransform = { a: 1, b: 0, c: 0, d: 1, tx: 0, ty: 0 };\n\t\tthis._cachedRotation = 0;\n\t\tthis._cachedSin = 0;\n\t\tthis._cachedCos = 1;\n\t\tthis._globalOpacity = 1;\n\t\tthis._view = view;\n\t\tthis._subviews = [];\n\t\tthis._childCount = 0;\n\t}\n\n\tthis.getSuperview = function () { return this._superview; }\n\tthis.getSubviews = function () {\n\t\tif (this._needsSort) { this._needsSort = false; this._subviews.sort(); }\n\t\tvar subviews = [];\n\t\tvar backings = this._subviews;\n\t\tvar n = backings.length;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tsubviews[i] = backings[i]._view;\n\t\t}\n\n\t\treturn subviews;\n\t}\n\n\tvar ADD_COUNTER = 900000;\n\tthis.addSubview = function (view) {\n\t\tvar backing = view.__view;\n\t\tvar superview = backing._superview;\n\t\tif (superview == this._view || this == backing) { return false; }\n\t\tif (superview) { superview.__view.removeSubview(view); }\n\n\t\tvar n = this._subviews.length;\n\t\tthis._subviews[n] = backing;\n\n\t\tbacking._superview = this._view;\n\t\tbacking._setAddedAt(++ADD_COUNTER);\n\t\tthis._childCount++;\n\n\t\tif (n && backing.__sortKey < this._subviews[n - 1].__sortKey) {\n\t\t\tthis._needsSort = true;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tthis.removeSubview = function (targetView) {\n\t\tvar index = this._subviews.indexOf(targetView.__view);\n\t\tif (index != -1) {\n\t\t\tthis._subviews.splice(index, 1);\n\t\t\tthis._childCount--;\n\t\t\t// this._view.needsRepaint();\n\n\t\t\ttargetView.__view._superview = null;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tthis.wrapTick = function (dt, app) {\n\t\tthis._view._tick && this._view._tick(dt, app);\n\n\t\tvar views = this._subviews;\n\t\tfor (var i = 0; i < this._childCount; ++i) {\n\t\t\tviews[i].wrapTick(dt, app);\n\t\t}\n\n\t\t// TODO: support partial repaints?\n\t\t// if (this._view._needsRepaint) {\n\t\t// \tthis._view._needsRepaint = false;\n\t\t// \tapp.needsRepaint();\n\t\t// }\n\t}\n\n\tthis.updateGlobalTransform = function() {\n\t\tvar parent = this._view.__parent ? this._view.__parent.__view : null;\n\t\tthis._globalOpacity = parent ? parent._globalOpacity * this.opacity : this.opacity;\n\n\t\tvar flipX = this.flipX ? -1 : 1;\n\t\tvar flipY = this.flipY ? -1 : 1;\n\n\t\tvar pgt = parent ? parent._globalTransform : IDENTITY_MATRIX;\n\t\tvar gt = this._globalTransform;\n\t\tvar sx = this.scaleX * this.scale * flipX;\n\t\tvar sy = this.scaleY * this.scale * flipY;\n\t\tvar ax = this.flipX ? this._width - this.anchorX : this.anchorX;\n\t\tvar ay = this.flipY ? this._height - this.anchorY : this.anchorY;\n\t\tvar tx = this.x + this.offsetX + this.anchorX;\n\t\tvar ty = this.y + this.offsetY + this.anchorY;\n\n\t\tif (this.r === 0) {\n\t\t\ttx -= ax * sx;\n\t\t\tty -= ay * sy;\n\t\t\tgt.a = pgt.a * sx;\n\t\t\tgt.b = pgt.b * sx;\n\t\t\tgt.c = pgt.c * sy;\n\t\t\tgt.d = pgt.d * sy;\n\t\t\tgt.tx = tx * pgt.a + ty * pgt.c + pgt.tx;\n\t\t\tgt.ty = tx * pgt.b + ty * pgt.d + pgt.ty;\n\t\t} else {\n\t\t\tif (this.r !== this._cachedRotation) {\n\t\t\t\tthis._cachedRotation = this.r;\n\t\t\t\tthis._cachedSin = sin(this.r);\n\t\t\t\tthis._cachedCos = cos(this.r);\n\t\t\t}\n\t\t\tvar a  =  this._cachedCos * sx;\n\t\t\tvar b  =  this._cachedSin * sx;\n\t\t\tvar c  = -this._cachedSin * sy;\n\t\t\tvar d  =  this._cachedCos * sy;\n\n\t\t\tif (ax || ay) {\n\t\t\t\ttx -= a * ax + c * ay;\n\t\t\t\tty -= b * ax + d * ay;\n\t\t\t}\n\n\t\t\tgt.a = a * pgt.a + b * pgt.c;\n\t\t\tgt.b = a * pgt.b + b * pgt.d;\n\t\t\tgt.c = c * pgt.a + d * pgt.c;\n\t\t\tgt.d = c * pgt.b + d * pgt.d;\n\t\t\tgt.tx = tx * pgt.a + ty * pgt.c + pgt.tx;\n\t\t\tgt.ty = tx * pgt.b + ty * pgt.d + pgt.ty;\n\t\t}\n\t};\n\n\tthis.wrapRender = function (ctx, opts) {\n\t\tif (!this.visible) { return; }\n\n\t\tif (this._needsSort) {\n\t\t\tthis._needsSort = false;\n\t\t\tthis._subviews.sort();\n\t\t}\n\n\t\tvar width = this._width;\n\t\tvar height = this._height;\n\t\tif (width < 0 || height < 0) { return; }\n\n\t\tvar saveContext = this.clip || this.compositeOperation || !this._view.__parent;\n\t\tif (saveContext) { ctx.save(); }\n\n\t\tthis.updateGlobalTransform();\n\t\tvar gt = this._globalTransform;\n\t\tctx.setTransform(gt.a, gt.b, gt.c, gt.d, gt.tx, gt.ty);\n\t\tctx.globalAlpha = this._globalOpacity;\n\n\t\tif (this.clip) { ctx.clipRect(0, 0, width, height); }\n\n\t\tvar filter = this._view.getFilter();\n\t\tif (filter) {\n\t\t\tvar filters = {};\n\t\t\tfilters[filter.getType()] = filter;\n\t\t\tctx.setFilters(filters);\n\t\t} else {\n\t\t\tctx.clearFilters();\n\t\t}\n\n\t\tif (this.compositeOperation) {\n\t\t\tctx.globalCompositeOperation = this.compositeOperation;\n\t\t}\n\n\t\tif (this.backgroundColor) {\n\t\t\tctx.fillStyle = this.backgroundColor;\n\t\t\tctx.fillRect(0, 0, width, height);\n\t\t}\n\n\t\tvar viewport = opts.viewport;\n\t\tthis._view._render && this._view._render(ctx, opts);\n\t\tthis._renderSubviews(ctx, opts);\n\t\topts.viewport = viewport;\n\t\tctx.clearFilters();\n\n\t\tif (saveContext) { ctx.restore(); }\n\t}\n\n\tthis._renderSubviews = function (ctx, opts) {\n\t\tvar subviews = this._subviews;\n\t\tfor (var i = 0; i < this._childCount; i++) {\n\t\t\tsubviews[i].wrapRender(ctx, opts);\n\t\t}\n\t}\n\n\t// this._clearCache = function () { this._cache = null; }\n\n\t// this.updateRadius = function () {\n\t// \tvar w = this.width * 0.5,\n\t// \t\th = this.height * 0.5;\n\n\t// \tif (!this._cache) { this._cache = {}; }\n\t// \treturn (this._cache.radius = Math.sqrt(w * w + h * h));\n\t// }\n\n\tthis._onResize = function (prop, value, prevValue) {\n\t\t// local properties are invalidated\n\t\t// this._cache = null;\n\n\t\t// child view properties might be invalidated\n\t\tthis._view.needsReflow();\n\t}\n\n\tthis._sortIndex = strPad.initialValue;\n\tthis._onZIndex = function (_, zIndex) {\n\t\tthis._sortIndex = strPad.pad(zIndex);\n\n\t\tthis._setSortKey();\n\t\tthis._view.needsRepaint();\n\n\t\tvar superview = this._view.getSuperview();\n\t\tif (superview) { superview.__view._needsSort = true; }\n\t}\n\n\tthis._setAddedAt = function (addedAt) {\n\t\tthis._addedAt = addedAt;\n\t\tthis._setSortKey();\n\t}\n\n\tthis._setSortKey = function () {\n\t\tthis.__sortKey = this._sortIndex + this._addedAt;\n\t}\n\n\t//not implemented\n\tthis._onOffsetX = function (n) {\n\t\tthis.offsetX = n * this.width / 100;\n\t};\n\n\t//not implemented\n\tthis._onOffsetY = function (n) {\n\t\tthis.offsetY = n * this.height / 100;\n\t};\n\n\tthis.toString = function () { return this.__sortKey; }\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/strPad.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/strPad.js","friendlyPath":"..strPad","directory":"modules/devkit-core/modules/timestep/src/ui/backend/","filename":"strPad.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar LEN = 8;\nvar MAX = 99999999;\nvar MIN = -99999999;\nvar PAD = \"00000000\";\n\nexports.initialValue = PAD;\n\nexports.pad = function (val) {\n\tval = ~~val;\n\n\tif (val < MIN) { val = MIN; }\n\tif (val > MAX) { val = MAX; }\n\tif (val < 0) {\n\t\tval *= -1;\n\t\treturn '-' + PAD.substring(0, LEN - ('' + val).length) + val;\n\t} else {\n\t\treturn PAD.substring(0, LEN - ('' + val).length) + val;\n\t}\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/BaseBacking.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/BaseBacking.js","friendlyPath":"..BaseBacking","directory":"modules/devkit-core/modules/timestep/src/ui/backend/","filename":"BaseBacking.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n\njsio('import util.setProperty as setProperty');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_BaseBacking=__class__;var BaseBacking = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_BaseBacking(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_BaseBacking(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\t// required methods:\n\t//\n\t// this._onResize = function () {};\n\t// this._onZIndex = function () {};\n\n\tvar styleKeys = this.constructor.styleKeys = {};\n\n\t// keys map to properties\n\tvar BASE_STYLE_PROPS = {\n\t\t'x': {value: 0},\n\t\t'y': {value: 0},\n\t\t'offsetX': {value: 0}, //translate\n\t\t'offsetY': {value: 0},\n\t\t'offsetXPercent': {value: undefined, cb: '_onOffsetX'}, //not implemented\n\t\t'offsetYPercent': {value: undefined, cb: '_onOffsetY'},\n\t\t'anchorX': {value: 0}, //rotation and scale\n\t\t'anchorY': {value: 0},\n\t\t'centerAnchor': {value: false},\n\t\t'width': {cb: '_onResize'},\n\t\t'height': {cb: '_onResize'},\n\t\t'r': {value: 0},\n\t\t'opacity': {value: 1},\n\t\t'zIndex': {value: 0, cb: '_onZIndex'},\n\t\t// 'radius': {\n\t\t// \tget: function () {\n\t\t// \t\treturn this._cache && 'radius' in this._cache ? this._cache.radius : this.updateRadius();\n\t\t// \t}\n\t\t// },\n\t\t'scale': {value: 1},\n\t\t'scaleX': {value: 1},\n\t\t'scaleY': {value: 1},\n\t\t'flipX': {value: false},\n\t\t'flipY': {value: false},\n\t\t'visible': {value: true},\n\t\t'shadowColor': {value: 'black'}, //only has an effect in TextView??\n\t\t'clip': {value: false},\n\t\t'backgroundColor': {value: ''},\n\t\t'compositeOperation': {value: undefined},\n\t};\n\n\tthis.constructor.addProperty = function (key, def) {\n\t\tstyleKeys[key] = true;\n\t\tsetProperty(this.prototype, key, def);\n\t}\n\n\tfor (var key in BASE_STYLE_PROPS) {\n\t\tthis.constructor.addProperty(key, BASE_STYLE_PROPS[key]);\n\t}\n\n\tthis.localizePoint = function (pt) {\n\t\tpt.x -= this.x + this.anchorX + this.offsetX;\n\t\tpt.y -= this.y + this.anchorY + this.offsetY;\n\t\tif (this.r) { pt.rotate(-this.r); }\n\t\tpt.scale(1 / this.scale);\n\t\tpt.x += this.anchorX;\n\t\tpt.y += this.anchorY;\n\t\treturn pt;\n\t}\n\n\tthis.copy = function () {\n\t\tvar copy = {};\n\t\tfor (var key in styleKeys) {\n\t\t\tcopy[key] = this[key];\n\t\t}\n\n\t\treturn copy;\n\t}\n\t\n\tthis.update = function (style) {\n\t\tfor (var i in style) {\n\t\t\tif (style.hasOwnProperty(i) && styleKeys.hasOwnProperty(i)) {\n\t\t\t\tthis[i] = style[i];\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/event/input/InputHandler.js":{"path":"modules/devkit-core/modules/timestep/src/event/input/InputHandler.js","friendlyPath":"event.input.InputHandler","directory":"modules/devkit-core/modules/timestep/src/event/input/","filename":"InputHandler.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class event.input.InputHandler;\n * An event handler proxy for an individual view. This handles dispatching\n * of events onto the actual view itself, as well as determining if the view\n * is the actual target of a propagated event. \n */\n\njsio('import math.geom.Point as Point');\njsio('import event.input.dispatch as dispatch');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_event_input_InputHandler=__class__;var InputHandler = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_event_input_InputHandler(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_event_input_InputHandler(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\n\t// ---- start mouseover\n\tthis.startCount = 0;\n\tthis.dragCount = 0;\n\tthis.overCount = 0;\n\tthis.canHandleEvents = true;\n\tthis.blockEvents = false;\n\n\tthis.init = function (view, opts) {\n\t\tthis.view = view;\n\n\t\tthis.update(opts);\n\t}\n\n\tthis.update = function(opts) {\n\t\tif ('canHandleEvents' in opts) {\n\t\t\tthis.canHandleEvents = opts.canHandleEvents;\n\t\t}\n\n\t\tif ('blockEvents' in opts) {\n\t\t\tthis.blockEvents = opts.blockEvents;\n\t\t}\n\t}\n\t\n\tthis.containsEvent = function (evt, localPt) {\n\t\t// block events must be false\n\t\treturn !this.blockEvents && (!this.view._superview   // top-view captures all events\n\t\t\t\t|| this.view.containsLocalPoint(localPt));\n\t}\n\n\tthis.onEnter = function (id, atTarget) {\n\t\tvar view = this.view;\n\t\tvar over = this._over || (this._over = {});\n\t\tif (id in over) { return; }\n\t\t\n\t\tover[id] = true;\n\t\tthis.overCount++;\n\t\t\n\t\tif (view.onInputOver) { view.onInputOver(over, this.overCount, atTarget); }\n\t\tview.publish('InputOver', over, this.overCount, atTarget);\n\t}\n\t\n\tthis.onLeave = function (id, atTarget) {\n\t\tvar view = this.view;\n\t\tvar over = this._over || (this._over = {});\n\t\tif (!(id in over)) { return; }\n\t\t\n\t\tdelete over[id];\n\t\t--this.overCount;\n\t\t\n\t\tif (view.onInputOut) { view.onInputOut(over, this.overCount, atTarget); }\n\t\tview.publish('InputOut', over, this.overCount, atTarget);\n\t}\n\t\n\tthis.resetOver = function () {\n\t\tdelete this._over;\n\t\tthis.overCount = 0;\n\t}\n\t\n\t// ---- end mouseover\n\t\n\t\n\t// ---- start drag\n\t\n\tthis.startDrag = function (opts) {\n\t\topts = opts || {};\n\t\tvar view = this.view;\n\t\tvar inputStartEvt = opts.inputStartEvt || opts.inputStartEvent || dispatch._evtHistory[dispatch.eventTypes.START];\n\t\tvar id = inputStartEvt.id;\n\t\t\n\t\t// dedup drags from same input ID\n\t\tvar dragging = this._isDragging || (this._isDragging = {});\n\t\tif (dragging[id]) { return; }\n\t\tdragging[id] = true;\n\t\t\n\t\t++this.dragCount;\n\t\t++this.startCount;\n\n\t\tvar root = inputStartEvt.root;\n\t\tvar dragEvt = new dispatch.InputEvent(inputStartEvt.id, 'input:drag', inputStartEvt.srcPt.x, inputStartEvt.srcPt.y, root, view);\n\t\t\n\t\tdragEvt.didDrag = false;\n\t\tdragEvt.radius = opts.radius * opts.radius || 0;\n\t\t\n\t\troot.subscribe('InputMoveCapture', this, 'onDragStart', dragEvt);\n\t\troot.subscribe('InputSelectCapture', this, 'onDragStop', dragEvt);\n\t}\n\t\n\tthis.isDragging = function () { return this.dragCount && dispatch._isDragging; }\n\t\n\tthis.onDragStart = function (dragEvt, moveEvt) {\n\t\t// have we exceeded the move radius?\n\t\tvar dx = moveEvt.srcPt.x - dragEvt.srcPt.x;\n\t\tvar dy = moveEvt.srcPt.y - dragEvt.srcPt.y;\n\t\tif (dx * dx + dy * dy <= dragEvt.radius) { return; }\n\n\t\tif (dragEvt.didDrag) {\n\t\t\treturn;\n\t\t}\n\t\tdragEvt.didDrag = true;\n\t\t--this.startCount;\n\t\t\n\t\tvar view = this.view;\n\t\t\n\t\t// no longer need to listen for move events for onDragStart\n\t\tif (this.startCount == 0) {\n\t\t\tdragEvt.root.unsubscribe('InputMoveCapture', this, 'onDragStart');\n\t\t}\n\t\t\n\t\t// want to fire onDragStart with the current point equal to the initial point \n\t\t// even though the user has moved away by now\n\t\tdragEvt.currPt = dragEvt.srcPt;\n\t\tdragEvt.localPt = view.localizePoint(new Point(dragEvt.currPt));\n\n\t\tif (view.onDragStart) { view.onDragStart(dragEvt); }\n\t\tview.publish('DragStart', dragEvt);\n\t\t\n\t\t// future move events should be captured by _onDrag\n\t\t// we should also call _onDrag now to handle the current move event delta\n\t\tdragEvt.root.subscribe('InputMoveCapture', this, 'onDrag', dragEvt);\n\t\tthis.onDrag(dragEvt, moveEvt);\n\t}\n\t\n\tthis.onDrag = function (dragEvt, moveEvt) {\n\t\tif (dragEvt.id != moveEvt.id\n\t\t\t\t|| moveEvt.srcPt.x == dragEvt.currPt.x && moveEvt.srcPt.y == dragEvt.currPt.y) { return; }\n\n\t\tvar view = this.view;\n\t\t\n\t\tdragEvt.prevPt = dragEvt.currPt;\n\t\tdragEvt.currPt = moveEvt.srcPt;\n\n\t\tdragEvt.prevLocalPt = dragEvt.localPt;\n\t\tdragEvt.localPt = view.localizePoint(new Point(dragEvt.currPt));\n\n\t\tvar delta = Point.subtract(dragEvt.localPt, dragEvt.prevLocalPt);\n\n\t\tdispatch._isDragging = true;\n\n\t\tif (view.onDrag) { view.onDrag(dragEvt, moveEvt, delta); }\n\t\tview.publish('Drag', dragEvt, moveEvt, delta);\n\t\t\n\t\t//moveEvt.cancel();\n\t}\n\t\n\tthis.onDragStop = function (dragEvt, selectEvt) {\n\t\tvar id = dragEvt.id;\n\t\tvar dragging = this._isDragging || (this._isDragging = {});\n\t\tif (!dragging[id] || dragEvt.id != selectEvt.id) { return; }\n\t\t\n\t\tdelete dragging[id];\n\t\t--this.dragCount;\n\n\t\tif (!this.dragCount) {\n\t\t\tdragEvt.root.unsubscribe('InputMoveCapture', this, 'onDragStart');\n\t\t\tdragEvt.root.unsubscribe('InputMoveCapture', this, 'onDrag');\n\t\t\tdragEvt.root.unsubscribe('InputSelectCapture', this, 'onDragStop');\n\t\t\tdispatch._isDragging = false;\n\t\t}\n\t\t\n\t\tif (dragEvt.didDrag) {\n\t\t\tvar view = this.view;\n\t\t\t\n\t\t\t// a subscription can later 'uncancel' the selectEvt by setting 'selectEvt.cancelled = false;'\n\t\t\tselectEvt.cancel();\n\t\t\t\n\t\t\tif (view.onDragStop) { view.onDragStop(dragEvt, selectEvt); }\n\t\t\tview.publish('DragStop', dragEvt, selectEvt);\n\t\t}\n\t}\n\t\n\t// ---- end drag\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/animate.js":{"path":"modules/devkit-core/modules/timestep/src/animate.js","friendlyPath":"animate","directory":"modules/devkit-core/modules/timestep/src/","filename":"animate.js","baseMod":"animate","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/modules/timestep/src/animate","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module animate\n * Import the DOM/Canvas implementation of animate. Also define the transition function aliases.\n *\n * @doc http://doc.gameclosure.com/api/animate.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/animate.md\n */\n\njsio('import ui.backend.canvas.animate as exports');\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/animate.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/animate.js","friendlyPath":"ui.backend.canvas.animate","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"animate.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.backend.canvas.animate;\n *\n * Canvas animate namespace and functions.\n */\n\njsio('import event.Emitter as Emitter');\njsio('import animate.transitions as transitions');\njsio('import timer');\n\nvar groups = {};\nvar DEFAULT_GROUP_ID = \"__default_group\";\n\nexports = function (subject, groupID) {\n\t// TODO: we have a circular import, so do the Engine import on first use\n\tif (typeof Engine === 'undefined') {\n\t\tjsio('import ui.Engine as Engine');\n\t\tjsio('import ui.View as View');\n\t\tjsio('import device');\n\t}\n\n\tif (device.useDOM && subject instanceof View && !groupID) {\n\t\treturn subject.getAnimation();\n\t}\n\n\t// create a group for this groupID if it doesn't exist\n\tgroupID = groupID || DEFAULT_GROUP_ID;\n\t!groups[groupID] && (groups[groupID] = new Group(groupID));\n\n\t// animators created once and cached on subject '__anims' object by groupID\n\t// so they're only garbage collected when the subject is garbage collected\n\tvar anims = subject.__anims || (subject.__anims = {});\n\tvar anim = anims[groupID];\n\tif (!anim) {\n\t\tanim = subject instanceof View\n\t\t\t? new ViewAnimator(subject)\n\t\t\t: new Animator(subject);\n\t\tanim.groupID = groupID;\n\t\tanims[groupID] = anim;\n\t}\n\n\treturn anim;\n};\n\n// get all animations on a given subject\nexports.getSubjectAnimations = function (subject) {\n\tvar anims = subject.__anims || {};\n\tvar animsArray = [];\n\tfor (var id in anims) {\n\t\tanimsArray.push(anims[id]);\n\t}\n\treturn animsArray;\n};\n\n// clear all animations on a given subject\nexports.clearSubjectAnimations = function (subject) {\n\tvar anims = this.getSubjectAnimations(subject);\n\tfor (var i = 0; i < anims.length; i++) {\n\t\tanims[i].clear();\n\t}\n};\n\n// commit all animations on a given subject\nexports.commitSubjectAnimations = function (subject) {\n\tvar anims = this.getSubjectAnimations(subject);\n\tfor (var i = 0; i < anims.length; i++) {\n\t\tanims[i].commit();\n\t}\n};\n\n// pause all animations on a given subject\nexports.pauseSubjectAnimations = function (subject) {\n\tvar anims = this.getSubjectAnimations(subject);\n\tfor (var i = 0; i < anims.length; i++) {\n\t\tanims[i].pause();\n\t}\n};\n\n// resume all animations on a given subject\nexports.resumeSubjectAnimations = function (subject) {\n\tvar anims = this.getSubjectAnimations(subject);\n\tfor (var i = 0; i < anims.length; i++) {\n\t\tanims[i].resume();\n\t}\n};\n\n// clear all animations globally\nexports.clearAllAnimations = function () {\n\tfor (var id in groups) {\n\t\tgroups[id].clear();\n\t}\n};\n\n// commit all animations globally\nexports.commitAllAnimations = function () {\n\tfor (var id in groups) {\n\t\tgroups[id].commit();\n\t}\n};\n\n// pause all animations globally\nexports.pauseAllAnimations = function () {\n\tfor (var id in groups) {\n\t\tgroups[id].pause();\n\t}\n};\n\n// resume all animations globally\nexports.resumeAllAnimations = function () {\n\tfor (var id in groups) {\n\t\tgroups[id].resume();\n\t}\n};\n\n// see Group Class notes below\nexports.getGroup = function (groupID) {\n\treturn groups[groupID || DEFAULT_GROUP_ID];\n};\n\n/**\n * Group Class\n * - a collection of animations by groupID across different subjects\n * - accessed by animate.getGroup()\n * - subscribe to the 'Finish' event to fire a callback when\n *     all animations in the group are complete or cleared, for example:\n *     myGroup.once('Finish', function () { ... });\n * - exposes clear, commit, pause, and resume to apply to all group animations\n */\nGroup=__class__;var Group=Group(function Group(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n\tthis.init = function (groupID) {\n\t\tthis.groupID = groupID + '';\n\t\tthis.anims = [];\n\t};\n\n\t// add an active animator to the group\n\tthis.add = function (anim) {\n\t\tif (this.anims.indexOf(anim) === -1) {\n\t\t\tthis.anims.push(anim);\n\t\t}\n\t};\n\n\t// remove an inactive animator from the group\n\tthis.remove = function (anim) {\n\t\tvar index = this.anims.indexOf(anim);\n\t\tif (index !== -1) {\n\t\t\tthis.anims.splice(index, 1);\n\n\t\t\t// fire Finish event after final animation removed\n\t\t\tif (this.anims.length === 0) {\n\t\t\t\tthis.publish('Finish');\n\t\t\t}\n\t\t}\n\t};\n\n\t// are there any active animators in the group?\n\tthis.isActive = function () {\n\t\treturn this.anims.length > 0;\n\t};\n\n\t// clear all the animators in the group\n\tthis.clear = function () {\n\t\tvar anims = this.anims;\n\t\tfor (var i = anims.length - 1; i >= 0; i--) {\n\t\t\tanims[i].clear();\n\t\t}\n\t\treturn this;\n\t};\n\n\t// commit all the animators in the group\n\tthis.commit = function () {\n\t\tvar anims = this.anims;\n\t\tfor (var i = anims.length - 1; i >= 0; i--) {\n\t\t\tanims[i].commit();\n\t\t}\n\t\treturn this;\n\t};\n\n\t// pause all the animators in the group\n\tthis.pause = function () {\n\t\tvar anims = this.anims;\n\t\tfor (var i = anims.length - 1; i >= 0; i--) {\n\t\t\tanims[i].pause();\n\t\t}\n\t\treturn this;\n\t};\n\n\t// resume all the animators in the group\n\tthis.resume = function () {\n\t\tvar anims = this.anims;\n\t\tfor (var i = anims.length - 1; i >= 0; i--) {\n\t\t\tanims[i].resume();\n\t\t}\n\t\treturn this;\n\t};\n});\n\nvar TRANSITIONS = [\n\ttransitions.easeInOut,         // 0: default\n\ttransitions.linear,            // 1\n\ttransitions.easeIn,            // 2\n\ttransitions.easeOut,           // 3\n\ttransitions.easeInOut,         // 4\n\ttransitions.easeInQuad,        // 5\n\ttransitions.easeOutQuad,       // 6\n\ttransitions.easeInOutQuad,     // 7\n\ttransitions.easeInCubic,       // 8\n\ttransitions.easeOutCubic,      // 9\n\ttransitions.easeInOutCubic,    // 10\n\ttransitions.easeInQuart,       // 11\n\ttransitions.easeOutQuart,      // 12\n\ttransitions.easeInOutQuart,    // 13\n\ttransitions.easeInQuint,       // 14\n\ttransitions.easeOutQuint,      // 15\n\ttransitions.easeInOutQuint,    // 16\n\ttransitions.easeInSine,        // 17\n\ttransitions.easeOutSine,       // 18\n\ttransitions.easeInOutSine,     // 19\n\ttransitions.easeInExpo,        // 20\n\ttransitions.easeOutExpo,       // 21\n\ttransitions.easeInOutExpo,     // 22\n\ttransitions.easeInCirc,        // 23\n\ttransitions.easeOutCirc,       // 24\n\ttransitions.easeInOutCirc,     // 25\n\ttransitions.easeInElastic,     // 26\n\ttransitions.easeOutElastic,    // 27\n\ttransitions.easeInOutElastic,  // 28\n\ttransitions.easeInBack,        // 29\n\ttransitions.easeOutBack,       // 30\n\ttransitions.easeInOutBack,     // 31\n\ttransitions.easeInBounce,      // 32\n\ttransitions.easeOutBounce,     // 33\n\ttransitions.easeInOutBounce    // 34\n];\n\nexports.linear            = 1;\nexports.easeIn            = 2;\nexports.easeOut           = 3;\nexports.easeInOut         = 4;\nexports.easeInQuad        = 5;\nexports.easeOutQuad       = 6;\nexports.easeInOutQuad     = 7;\nexports.easeInCubic       = 8;\nexports.easeOutCubic      = 9;\nexports.easeInOutCubic    = 10;\nexports.easeInQuart       = 11;\nexports.easeOutQuart      = 12;\nexports.easeInOutQuart    = 13;\nexports.easeInQuint       = 14;\nexports.easeOutQuint      = 15;\nexports.easeInOutQuint    = 16;\nexports.easeInSine        = 17;\nexports.easeOutSine       = 18;\nexports.easeInOutSine     = 19;\nexports.easeInExpo        = 20;\nexports.easeOutExpo       = 21;\nexports.easeInOutExpo     = 22;\nexports.easeInCirc        = 23;\nexports.easeOutCirc       = 24;\nexports.easeInOutCirc     = 25;\nexports.easeInElastic     = 26;\nexports.easeOutElastic    = 27;\nexports.easeInOutElastic  = 28;\nexports.easeInBack        = 29;\nexports.easeOutBack       = 30;\nexports.easeInOutBack     = 31;\nexports.easeInBounce      = 32;\nexports.easeOutBounce     = 33;\nexports.easeInOutBounce   = 34;\n\nfunction getTransition(n) {\n\treturn (typeof n == 'function' ? n : TRANSITIONS[n | 0]);\n};\n\nFrame=__class__;var Frame=Frame(function Frame(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\tthis.subject = opts.subject;\n\t\tthis.target = opts.target;\n\t\tthis.duration = opts.duration === 0 ? 0 : (opts.duration || 500);\n\t\tthis.transition = getTransition(opts.transition);\n\t\tthis.onTick = opts.onTick;\n\t};\n\n\tthis.exec = function () {};\n\tthis.debugLog = function () {};\n});\n\nCallbackFrame=__class__;var CallbackFrame=CallbackFrame(function CallbackFrame(){return this.init&&this.init.apply(this,arguments)},Frame, function () {\n\tthis.init = function (opts) {\n\t\tFrame.prototype.init.call(this, opts);\n\t\t// CallbackFrames act like tick functions when given durations\n\t\tthis.duration = opts.duration || 0;\n\t};\n\n\tthis.exec = function (tt, t) {\n\t\tthis.target.apply(this.subject, arguments);\n\t};\n});\n\nObjectFrame=__class__;var ObjectFrame=ObjectFrame(function ObjectFrame(){return this.init&&this.init.apply(this,arguments)},Frame, function () {\n\tthis.exec = function (tt, t, debug) {\n\t\t// set starting values on first execution\n\t\tif (!this.base) {\n\t\t\tthis.base = {};\n\t\t\tfor (var key in this.target) {\n\t\t\t\tthis.base[key] = this.subject[key];\n\t\t\t}\n\t\t}\n\n\t\tfor (var key in this.target) {\n\t\t\tvar baseValue = this.base[key];\n\t\t\tthis.subject[key] = baseValue + tt * (this.target[key] - baseValue);\n\t\t}\n\t\tdebug && this.debugLog(tt);\n\t};\n\n\tthis.debugLog = function (tt) {\n\t\tvar changed = {};\n\t\tfor (var key in this.target) {\n\t\t\tchanged[key] = this.subject[key] + ' -> ' + this.target[key];\n\t\t}\n\t\tlogger.LOG&&console.log(\"LOG\",\"ui.backend.canvas.animate\",this.duration, tt, JSON.stringify(changed));\n\t};\n});\n\n// a ViewStyleFrame updates a view's style in exec\nViewStyleFrame=__class__;var ViewStyleFrame=ViewStyleFrame(function ViewStyleFrame(){return this.init&&this.init.apply(this,arguments)},Frame, function () {\n\tthis.init = function (opts) {\n\t\tFrame.prototype.init.call(this, opts);\n\t\tthis.target = merge({}, this.target);\n\t};\n\n\tthis.resolveDeltas = function (againstStyle) {\n\t\tvar style = this.target;\n\t\tfor (var key in style) {\n\t\t\tvar baseKey = key.substring(1);\n\t\t\tif (key.charAt(0) == 'd'\n\t\t\t\t&& !(key in againstStyle)\n\t\t\t\t&& (baseKey in againstStyle))\n\t\t\t{\n\t\t\t\tstyle[baseKey] = style[key] + againstStyle[baseKey];\n\t\t\t\tdelete style[key];\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.exec = function (tt, t, debug) {\n\t\tvar oldStyle = this._baseStyle;\n\t\tvar newStyle = this.target;\n\t\tvar viewStyle = this.subject.style;\n\n\t\t// resolve deltas and starting style on first execution\n\t\tif (!oldStyle) {\n\t\t\toldStyle = this._baseStyle = viewStyle.copy();\n\t\t\tthis.resolveDeltas(oldStyle);\n\t\t}\n\n\t\tfor (var key in newStyle) {\n\t\t\tif (key in oldStyle) {\n\t\t\t\tvar oldValue = oldStyle[key];\n\t\t\t\tviewStyle[key] = oldValue + tt * (newStyle[key] - oldValue);\n\t\t\t}\n\t\t}\n\t\tdebug && this.debugLog(tt);\n\t};\n\n\tthis.debugLog = function (tt) {\n\t\tvar changed = {};\n\t\tvar newStyle = this.target;\n\t\tvar viewStyle = this.subject.style;\n\t\tfor (var key in newStyle) {\n\t\t\tchanged[key] = viewStyle[key] + ' -> ' + newStyle[key];\n\t\t}\n\t\tlogger.LOG&&console.log(\"LOG\",\"ui.backend.canvas.animate\",timer.now, this.duration, tt, JSON.stringify(changed));\n\t};\n});\n\nexports.Animator=__class__;var Animator = exports.Animator=exports.Animator(function exports_Animator(){return this.init&&this.init.apply(this,arguments)},Emitter, function () {\n\tthis.init = function (subject) {\n\t\tthis.subject = subject;\n\t\tthis.clear();\n\t\tthis._isPaused = false;\n\t};\n\n\tthis.clear = function () {\n\t\tthis._elapsed = 0;\n\t\tthis._queue = [];\n\t\tthis._unschedule();\n\t\tthis._removeFromGroup();\n\t\treturn this;\n\t};\n\n\t// Careful: pause will *not* fire the finish event, so anything pending the end of the\n\t// animation will have to wait until the animation is resumed.\n\tthis.pause = function () {\n\t\tif (!this._isPaused) {\n\t\t\tthis._isPaused = true;\n\t\t\tthis._unschedule();\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.resume = function () {\n\t\tif (this._isPaused) {\n\t\t\tthis._isPaused = false;\n\t\t\tthis._schedule();\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis._schedule = function () {\n\t\tif (!this._isScheduled) {\n\t\t\tthis._isScheduled = true;\n\t\t\tEngine.get().subscribe('Tick', this, 'onTick');\n\t\t}\n\t};\n\n\tthis._unschedule = function () {\n\t\tif (this._isScheduled) {\n\t\t\tthis._isScheduled = false;\n\t\t\tEngine.get().unsubscribe('Tick', this, 'onTick');\n\t\t}\n\t};\n\n\tthis.isPaused = function () { return this._isPaused; };\n\tthis.hasFrames = function () { return !!this._queue[0]; };\n\n\tthis.wait = function (duration) {\n\t\treturn this.then(undefined, duration);\n\t};\n\n\tthis.buildFrame = function (opts) {\n\t\tvar targetType = typeof opts.target;\n\t\tif (targetType === 'function') {\n\t\t\treturn new CallbackFrame(opts);\n\t\t} else if (targetType === 'object') {\n\t\t\treturn new ObjectFrame(opts);\n\t\t} else {\n\t\t\treturn new Frame(opts);\n\t\t}\n\t};\n\n\tthis.now = function (target, duration, transition, onTick) {\n\t\ttransition = transition || (this._queue[0] ? exports.easeOut : exports.easeInOut);\n\t\tthis.clear();\n\t\treturn this.then(target, duration, transition, onTick);\n\t};\n\n\tthis.then = function (target, duration, transition, onTick) {\n\t\tif (!this._queue.length) {\n\t\t\tthis._elapsed = 0;\n\t\t}\n\n\t\tthis._queue.push(this.buildFrame({\n\t\t\tsubject: this.subject,\n\t\t\ttarget: target,\n\t\t\tduration: duration,\n\t\t\ttransition: transition,\n\t\t\tonTick: onTick\n\t\t}));\n\t\tthis._schedule();\n\t\tthis._addToGroup();\n\t\treturn this;\n\t};\n\n\tthis.debug = function () {\n\t\tthis._debug = true;\n\t\treturn this;\n\t};\n\n\tthis.commit = function () {\n\t\tthis.resume();\n\t\tthis._elapsed = 0;\n\t\tfor (var i = 0, p; p = this._queue[i]; ++i) {\n\t\t\tthis._elapsed += p.duration;\n\t\t}\n\n\t\tthis.next();\n\t\treturn this;\n\t};\n\n\tthis.onTick = function (dt) {\n\t\tif (!this._isScheduled) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._elapsed += dt;\n\t\tthis.next();\n\t};\n\n\tthis.next = function () {\n\t\tvar p = this._queue[0];\n\t\twhile (p) {\n\t\t\tvar duration = p.duration;\n\t\t\tvar frameFinished = this._elapsed >= duration;\n\t\t\tvar t = frameFinished ? 1 : this._elapsed / duration;\n\t\t\tvar tt = p.transition(t);\n\n\t\t\tif (frameFinished) {\n\t\t\t\tthis._elapsed -= duration;\n\t\t\t}\n\n\t\t\tp.exec(tt, t, this._debug);\n\t\t\tp.onTick && p.onTick.call(p.subject, tt, t);\n\n\t\t\t// remove frame if finished and queue wasn't modified by a callback\n\t\t\tif (frameFinished && p === this._queue[0]) {\n\t\t\t\tthis._queue.shift();\n\t\t\t}\n\n\t\t\t// if paused during a callback or frame not finished, don't continue\n\t\t\tif (!frameFinished || this._isPaused) { return; }\n\n\t\t\tp = this._queue[0];\n\t\t}\n\n\t\t// nothing left in the queue!\n\t\tthis._unschedule();\n\t\tthis._removeFromGroup();\n\t};\n\n\tthis._addToGroup = function () {\n\t\tvar group = groups[this.groupID];\n\t\tgroup && group.add(this);\n\t};\n\n\tthis._removeFromGroup = function () {\n\t\tvar group = groups[this.groupID];\n\t\tgroup && group.remove(this);\n\t};\n});\n\nViewAnimator=__class__;var ViewAnimator=ViewAnimator(function ViewAnimator(){return this.init&&this.init.apply(this,arguments)},Animator, function () {\n\tthis.buildFrame = function (opts) {\n\t\tif (typeof opts.target === 'object') {\n\t\t\treturn new ViewStyleFrame(opts);\n\t\t} else {\n\t\t\treturn Animator.prototype.buildFrame.call(this, opts);\n\t\t}\n\t};\n});\n\n// used to get/set native or browser ViewAnimator constructors\nexports.getViewAnimator = function () { return ViewAnimator; };\nexports.setViewAnimator = function (ctor) { ViewAnimator = ctor; };\n","pre":true},"modules/devkit-core/modules/timestep/src/animate/transitions.js":{"path":"modules/devkit-core/modules/timestep/src/animate/transitions.js","friendlyPath":"animate.transitions","directory":"modules/devkit-core/modules/timestep/src/animate/","filename":"transitions.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module animate.transitions\n *\n * Transition functions for use by the animate features. These aren't referenced\n * directly by the animate namespace, but by numerical reference.\n *\n * @doc http://doc.gameclosure.com/api/animate.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/animate.md\n */\n\nexports.linear = function (n) {\n\treturn n;\n};\nexports.easeIn = exports.easeInQuad = function (n) {\n\treturn n * n;\n};\nexports.easeOut = exports.easeOutQuad = function (n) {\n\treturn n * (2 - n);\n};\nexports.easeInOutQuad = function (n) {\n\tif ((n *= 2) < 1) return 0.5 * n * n;\n\treturn -0.5 * ((--n) * (n - 2) - 1);\n};\nexports.easeInCubic = function (n) {\n\treturn n * n * n;\n};\nexports.easeOutCubic = function (n) {\n\treturn ((n -= 1) * n * n + 1);\n};\nexports.easeInOut = exports.easeInOutCubic = function (n) {\n\tif ((n *= 2) < 1) return 0.5 * n * n * n;\n\treturn 0.5 * ((n -= 2) * n * n + 2);\n};\nexports.easeInQuart = function (n) {\n\treturn n * n * n * n;\n};\nexports.easeOutQuart = function (n) {\n\treturn -1 * ((n -= 1) * n * n * n - 1);\n};\nexports.easeInOutQuart = function (n) {\n\tif ((n *= 2) < 1) return 0.5 * n * n * n * n;\n\treturn -0.5 * ((n -= 2) * n * n * n - 2);\n};\nexports.easeInQuint = function (n) {\n\treturn n * n * n * n * n;\n};\nexports.easeOutQuint = function (n) {\n\treturn ((n -= 1) * n * n * n * n + 1);\n};\nexports.easeInOutQuint = function (n) {\n\tif ((n *= 2) < 1) return 0.5 * n * n * n * n * n;\n\treturn 0.5 * ((n -= 2) * n * n * n * n + 2);\n};\nexports.easeInSine = function(n){\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\treturn -1 * Math.cos(n * (Math.PI / 2)) + 1;\n};\nexports.easeOutSine = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\treturn Math.sin(n * (Math.PI / 2));\n};\nexports.easeInOutSine = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\treturn -0.5 * (Math.cos(Math.PI * n) - 1);\n};\nexports.easeInExpo = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\treturn (n == 0) ? 0 : Math.pow(2, 10 * (n - 1));\n};\nexports.easeOutExpo = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\treturn (n == 1) ? 1 : (-Math.pow(2, -10 * n) + 1);\n};\nexports.easeInOutExpo = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\tif ((n *= 2) < 1) return 0.5 * Math.pow(2, 10 * (n - 1));\n\treturn 0.5 * (-Math.pow(2, -10 * --n) + 2);\n};\nexports.easeInCirc = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\treturn -1 * (Math.sqrt(1 - n * n) - 1);\n};\nexports.easeOutCirc = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\treturn  Math.sqrt(1 - (n -= 1) * n);\n};\nexports.easeInOutCirc = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\tif ((n*=2) < 1) return -0.5 * (Math.sqrt(1 - n * n) - 1);\n\treturn 0.5 * (Math.sqrt(1 - (n -= 2) * n) + 1);\n};\nexports.easeInElastic = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\tvar p = 0.3;\n\tvar s = 0.075;\t// p / (2 * Math.PI) * Math.asin(1)\n\treturn -(Math.pow(2, 10 * (n -= 1)) * Math.sin((n - s) * (2 * Math.PI) / p));\n};\nexports.easeOutElastic = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\tvar p = 0.3;\n\tvar s = 0.075;\t// p / (2 * Math.PI) * Math.asin(1)\n\treturn Math.pow(2,-10 * n) * Math.sin((n - s) * (2 * Math.PI) / p) + 1;\n};\nexports.easeInOutElastic = function (n) {\n\tif (n == 0) return 0;\n\tif ((n *= 2) == 2) return 1;\n\tvar p = 0.45;\t// 0.3 * 1.5\n\tvar s = 0.1125;\t// p / (2 * Math.PI) * Math.asin(1)\n\tif (n < 1) return -.5 * (Math.pow(2, 10 * (n -= 1)) * Math.sin((n * 1 - s) * (2 * Math.PI) / p));\n\treturn Math.pow(2, -10 * (n -= 1)) * Math.sin((n * 1 - s) * (2 * Math.PI) / p ) * .5 + 1;\n};\nexports.easeInBack = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\tvar s = 1.70158;\n\treturn n * n * ((s + 1) * n - s);\n};\nexports.easeOutBack = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\tvar s = 1.70158;\n\treturn ((n -= 1) * n * ((s + 1) * n + s) + 1);\n};\nexports.easeInOutBack = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\tvar s = 1.70158;\n\tif ((n *= 2) < 1) return 0.5 * (n * n * (((s *= 1.525) + 1) * n - s));\n\treturn 0.5 * ((n -= 2) * n * (((s *= 1.525) + 1) * n + s) + 2);\n};\nexports.easeOutBounce = function (n) {\n\tif (n == 0) return 0;\n\tif (n == 1) return 1;\n\tif (n < (1 / 2.75)) {\n\t\treturn (7.5625 * n * n);\n\t} else if (n < (2 / 2.75)) {\n\t\treturn (7.5625 * (n -= (1.5 / 2.75)) * n + .75);\n\t} else if (n < (2.5 / 2.75)) {\n\t\treturn (7.5625 * (n -= (2.25 / 2.75)) * n + .9375);\n\t} else {\n\t\treturn (7.5625 * (n -= (2.625 / 2.75)) * n + .984375);\n\t}\n};\nexports.easeInBounce = function (n) {\n\treturn 1 - exports.easeOutBounce(1 - n);\n};\nexports.easeInOutBounce = function (n) {\n\tif (n < 0.5) return exports.easeInBounce(n * 2) * .5;\n\treturn exports.easeOutBounce((n * 2) - 1) * .5 + .5;\n};","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/debug/FPSView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/debug/FPSView.js","friendlyPath":"ui.backend.debug.FPSView","directory":"modules/devkit-core/modules/timestep/src/ui/backend/debug/","filename":"FPSView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.backend.debug.FPSView;\n *\n * The view which renders the FPS when showFPS is set to true on the\n * Application options.\n *\n * TODO Move to debug package.\n */\n\njsio('import device');\njsio('import lib.Enum as Enum');\n\njsio('import math.geom.Rect as Rect');\njsio('import math.geom.intersect as intersect');\n\njsio('import event.input.dispatch as dispatch');\n\nvar viewModes = new Enum('FPS', 'DT');\n\nfunction strokeRect(ctx, rect, color) {\n\tctx.fillStyle = color;\n\tctx.fillRect(rect.x, rect.y, 1, rect.height);\n\tctx.fillRect(rect.x, rect.y, rect.width, 1);\n\tctx.fillRect(rect.x + rect.width - 1, rect.y, 1, rect.height);\n\tctx.fillRect(rect.x, rect.y + rect.height - 1, rect.width, 1);\n};\n\nfunction fillRect(ctx, rect, color) {\n\tctx.fillStyle = color;\n\tctx.fillRect(rect.x, rect.y, rect.width, rect.height);\n};\n\nGraph=__class__;var Graph=Graph(function Graph(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\tvar Canvas = device.get('Canvas');\n\n\t\tthis._width = opts.width;\n\t\tthis._height = opts.height;\n\n\t\tthis._maxValue = opts.maxValue;\n\t\tthis._backgroundColor = opts.backgroundColor;\n\t\tthis._colors = opts.colors;\n\t\tthis._axisColor = opts.axisColor;\n\n\t\tthis._canvas = new Canvas({width: opts.width, height: opts.height});\n\t\tthis._ctx = this._canvas.getContext('2d');\n\t\tthis._ctx.fillStyle = opts.backgroundColor;\n\t\tthis._ctx.fillRect(0, 0, opts.width, opts.height);\n\n\t\tthis._offset = 0;\n\t\tthis._index = 0;\n\t};\n\n\tthis.addValues = function (values, timeAxis) {\n\t\tvar ctx = this._ctx,\n\t\t\twidth = this._width,\n\t\t\theight = this._height,\n\t\t\tvalue,\n\t\t\tmaxValue = this._maxValue,\n\t\t\tx = (this._offset + this._index) % width,\n\t\t\ty = this._height,\n\t\t\tn,\n\t\t\ti, j;\n\n\t\tctx.fillStyle = this._backgroundColor;\n\t\tctx.fillRect(x, 0, 2, height);\n\n\t\ti = values.length;\n\t\twhile (i) {\n\t\t\tvalue = values[--i];\n\t\t\tif (value > maxValue) {\n\t\t\t\tvalue = maxValue;\n\t\t\t}\n\t\t\tn = ~~(value / maxValue *  height);\n\t\t\tctx.fillStyle = this._colors[i];\n\t\t\tctx.fillRect(x, height - n, 2, n);\n\t\t}\n\n\t\tctx.fillStyle = this._axisColor;\n\t\tif (timeAxis) {\n\t\t\tctx.fillRect(x, 0, 1, height);\n\t\t}\n\t\tctx.fillRect(x, 25, 2, 1);\n\t\tctx.fillRect(x, 50, 2, 1);\n\t\tctx.fillRect(x, 75, 2, 1);\n\n\t\tif (this._index < width) {\n\t\t\tthis._index += 2;\n\t\t} else {\n\t\t\tthis._offset += 2;\n\t\t\tif (this._offset >= width) {\n\t\t\t\tthis._offset = 0;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.render = function (ctx, x, y) {\n\t\tvar offset = this._offset,\n\t\t\twidth = this._width,\n\t\t\theight = this._height;\n\n\t\tif (offset === 0) {\n\t\t\tctx.drawImage(this._canvas, 0, 0, width, height, x, y, width, height);\n\t\t} else {\n\t\t\tctx.drawImage(this._canvas, offset, 0, width - offset, height, x, y, width - offset, height);\n\t\t\tctx.drawImage(this._canvas, 0, 0, offset, height, width - offset + x, y, offset, height);\n\t\t}\n\t};\n});\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_debug_FPSView=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_debug_FPSView(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_debug_FPSView(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\tthis._application = opts.application;\n\n\t\tthis._time = +(new Date()) + 1000;\n\t\tthis._frames = 0;\n\t\tthis._fps = 20;\n\t\tthis._dt = 10;\n\n\t\tthis._minimized = true;\n\n\t\tvar width = 200,\n\t\t\theight = 100;\n\n\t\tthis._rectTop = new Rect(1, 1, width, 16);\n\t\tthis._rectMin = new Rect(0, 0, 24, 15);\n\t\tthis._rectMax = new Rect(0, 0, width + 2, height + 17);\n\t\tthis._rect = this._rectMin;\n\n\t\tthis._rectFPS = new Rect(141, 1, 30, 15);\n\t\tthis._rectDT = new Rect(171, 1, 30, 15);\n\n\t\tthis._borderColor = 'rgb(100,100,150)';\n\t\tthis._backgroundColor = '#17182E';\n\t\tthis._textColor = '#FFFFFF';\n\n\t\tthis._viewMode = viewModes.DT;\n\n\t\tthis._graphs = {}\n\t\tthis._graphs[viewModes.FPS] = new Graph({\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tmaxValue: 60,\n\t\t\tbackgroundColor: this._backgroundColor,\n\t\t\tcolors: ['rgba(170,170,252,0.3)', 'rgb(170,170,252)'],\n\t\t\taxisColor: '#FFFFFF'\n\t\t});\n\t\tthis._graphs[viewModes.DT] = new Graph({\n\t\t\twidth: width,\n\t\t\theight: height,\n\t\t\tmaxValue: 66,\n\t\t\tbackgroundColor: this._backgroundColor,\n\t\t\tcolors: ['rgba(255,0,0,0.5)', 'rgb(254,255,170)'],\n\t\t\taxisColor: '#FFFFFF'\n\t\t});\n\t};\n\n\tthis.tick = function (dt) {\n\t\tvar time = +(new Date());\n\t\tif (time > this._time) {\n\t\t\tthis._time = time + 1000;\n\t\t\tthis._fps = this._frames;\n\t\t\tthis._frames = 1;\n\t\t} else {\n\t\t\tthis._frames++;\n\t\t}\n\n\t\tvar events = this._application.getEvents();\n\t\tif (events.length) {\n\t\t\tthis._handleEvents(events);\n\t\t}\n\n\t\tthis._dt = this._dt * 0.8 + dt * 0.2;\n\n\t\tif (!this._minimized) {\n\t\t\tswitch (this._viewMode) {\n\t\t\t\tcase viewModes.DT:\n\t\t\t\t\tthis._graphs[viewModes.DT].addValues([this._dt, dt], (this._frames === 1));\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase viewModes.FPS:\n\t\t\t\t\tthis._graphs[viewModes.FPS].addValues([this._fps, 1000 / dt], (this._frames === 1));\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._handleEvents = function (events) {\n\t\tvar types = dispatch.eventTypes;\n\t\tvar i = events.length;\n\n\t\twhile (i) {\n\t\t\tvar event = events[--i];\n\t\t\tswitch (event.type) {\n\t\t\t\tcase types.START:\n\t\t\t\t\tif (intersect.ptAndRect(event.srcPt, this._rect)) {\n\t\t\t\t\t\tif (this._minimized) {\n\t\t\t\t\t\t\tthis._minimized = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (intersect.ptAndRect(event.srcPt, this._rectFPS)) {\n\t\t\t\t\t\t\t\tthis._viewMode = viewModes.FPS;\n\t\t\t\t\t\t\t} else if (intersect.ptAndRect(event.srcPt, this._rectDT)) {\n\t\t\t\t\t\t\t\tthis._viewMode = viewModes.DT;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis._minimized = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._rect = this._minimized ? this._rectMin : this._rectMax;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.render = function (ctx) {\n\t\tctx.save();\n\n\t\tctx.textBaseline = 'top';\n\t\tctx.textAlign = 'center';\n\t\tctx.font = '12px Verdana';\n\n\t\tif (this._minimized) {\n\t\t\tfillRect(ctx, this._rect, this._backgroundColor);\n\t\t} else {\n\t\t\tfillRect(ctx, this._rectTop, this._backgroundColor);\n\t\t\tthis._graphs[this._viewMode].render(ctx, 1, 17);\n\t\t\tctx.fillStyle = this._borderColor;\n\t\t\tctx.fillRect(0, 16, this._rect.width, 1);\n\n\t\t\tvar fpsMode = (this._viewMode === viewModes.FPS),\n\t\t\t\tdtMode = (this._viewMode === viewModes.DT);\n\n\t\t\tfillRect(ctx, this._rectFPS, fpsMode ? this._borderColor : this._backgroundColor);\n\t\t\tctx.fillStyle = fpsMode ? this._textColor : this._borderColor;\n\t\t\tctx.fillText('FPS', this._rectFPS.x + this._rectFPS.width / 2, 0);\n\n\t\t\tfillRect(ctx, this._rectDT, dtMode ? this._borderColor : this._backgroundColor);\n\t\t\tctx.fillStyle = dtMode ? this._textColor : this._borderColor;\n\t\t\tctx.fillText('DT', this._rectDT.x + this._rectDT.width / 2, 0);\n\t\t}\n\n\t\tstrokeRect(ctx, this._rect, this._borderColor);\n\n\t\tctx.fillStyle = this._textColor;\n\t\tctx.fillText(this._fps, 12, 0);\n\n\t\tctx.restore();\n\t};\n\n\tthis.getFPS = function () {\n\t\treturn this._fps;\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/Color.js":{"path":"modules/devkit-core/modules/timestep/src/ui/Color.js","friendlyPath":"ui.Color","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"Color.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.Color\n *\n * @doc http://doc.gameclosure.com/api/color.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/color.md\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_Color=__class__;var RGBA = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_Color(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_Color(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function () {\n\t\tthis.r = 0;\n\t\tthis.g = 0;\n\t\tthis.b = 0;\n\t\tthis.a = 1;\n\n\t\tthis.update.apply(this, arguments);\n\t};\n\n\tthis.update = function (rgba) {\n\t\tif (arguments.length > 2) {\n\t\t\tthis.r = arguments[0];\n\t\t\tthis.g = arguments[1];\n\t\t\tthis.b = arguments[2];\n\t\t\tthis.a = arguments[3] !== undefined ? arguments[3] : 1;\n\t\t} else if (typeof rgba === 'string') {\n\t\t\tvar cached = cache[rgba];\n\t\t\tif (cached) {\n\t\t\t\tthis.set(cached);\n\t\t\t} else {\n\t\t\t\tthis.parse(rgba);\n\t\t\t}\n\t\t} else if (rgba) {\n\t\t\tthis.set(rgba);\n\t\t}\n\t};\n\n\tthis.get = function () {\n\t\treturn {\n\t\t\tr: this.r,\n\t\t\tg: this.g,\n\t\t\tb: this.b,\n\t\t\ta: this.a\n\t\t};\n\t};\n\n\tthis.set = function (rgba) {\n\t\tif (rgba !== undefined) {\n\t\t\tthis.r = rgba.r || 0;\n\t\t\tthis.g = rgba.g || 0;\n\t\t\tthis.b = rgba.b || 0;\n\t\t\tthis.a = rgba.a !== undefined ? rgba.a : 1;\n\t\t}\n\t};\n\n\tvar rgbParser = /rgba?\\(\\s*([.0-9]+)\\s*,\\s*([.0-9]+)\\s*,\\s*([.0-9]+)\\s*,?\\s*([.0-9]+)?\\s*\\)/;\n\n\tfunction hexToRGB(a) {\n\t\ta = '0x' + a.slice(1).replace(a.length < 5 && /./g, '$&$&');\n\t\treturn [a >> 16, a >> 8 & 255, a & 255];\n\t};\n\n\tthis.parse = function (str) {\n\t\tvar match = str.match(rgbParser);\n\t\tif (match) {\n\t\t\tthis.r = parseInt(match[1]) || 0;\n\t\t\tthis.g = parseInt(match[2]) || 0;\n\t\t\tthis.b = parseInt(match[3]) || 0;\n\t\t\tif (match[4] !== undefined) {\n\t\t\t\tvar a = parseFloat(match[4]);\n\t\t\t\tthis.a = isNaN(a) ? 1 : a;\n\t\t\t} else {\n\t\t\t\tthis.a = 1;\n\t\t\t}\n\t\t} else {\n\t\t\t// handles hex strings (#FC0, #FFCC00, #FC09, #FFCC0099)\n\t\t\tthis.a = 1;\n\t\t\tvar len = str.length;\n\t\t\tif (len === 5) {\n\t\t\t\tvar a = str.substring(4, 5);\n\t\t\t\tthis.a = ('0x' + a + a | 0) / 255;\n\t\t\t\tstr = str.substring(0, 4);\n\t\t\t} else if (len === 9) {\n\t\t\t\tthis.a = ('0x' + str.substring(7, 9) | 0) / 255;\n\t\t\t\tstr = str.substring(0, 7);\n\t\t\t}\n\t\t\tvar match = hexToRGB(str);\n\t\t\tif (match) {\n\t\t\t\tthis.r = match[0];\n\t\t\t\tthis.g = match[1];\n\t\t\t\tthis.b = match[2];\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.toHex = function () {\n\t\treturn \"#\" + ((256 + this.r << 8 | this.g) << 8 | this.b).toString(16).slice(1);\n\t};\n\n\tthis.toString = function () {\n\t\treturn 'rgba(' + this.r + ',' + this.g + ',' + this.b + ',' + this.a + ')';\n\t};\n\n});\n\nexports.parse = function (str) {\n\treturn cache[str] || (cache[str] = new RGBA(str));\n};\n\nvar cache = {\n\taliceblue:            new RGBA(240, 248, 255),\n\tantiquewhite:         new RGBA(250, 235, 215),\n\taqua:                 new RGBA(  0, 255, 255),\n\taquamarine:           new RGBA(127, 255, 212),\n\tazure:                new RGBA(240, 255, 255),\n\tbeige:                new RGBA(245, 245, 220),\n\tbisque:               new RGBA(255, 228, 196),\n\tblack:                new RGBA(  0,   0,   0),\n\tblanchedalmond:       new RGBA(255, 235, 205),\n\tblue:                 new RGBA(  0,   0, 255),\n\tblueviolet:           new RGBA(138,  43, 226),\n\tbrown:                new RGBA(165,  42,  42),\n\tburlywood:            new RGBA(222, 184, 135),\n\tcadetblue:            new RGBA( 95, 158, 160),\n\tchartreuse:           new RGBA(127, 255,   0),\n\tchocolate:            new RGBA(210, 105,  30),\n\tcoral:                new RGBA(255, 127,  80),\n\tcornflowerblue:       new RGBA(100, 149, 237),\n\tcornsilk:             new RGBA(255, 248, 220),\n\tcrimson:              new RGBA(220,  20,  60),\n\tcyan:                 new RGBA(  0, 255, 255),\n\tdarkblue:             new RGBA(  0,   0, 139),\n\tdarkcyan:             new RGBA(  0, 139, 139),\n\tdarkgoldenrod:        new RGBA(184, 134,  11),\n\tdarkgray:             new RGBA(169, 169, 169),\n\tdarkgreen:            new RGBA(  0, 100,   0),\n\tdarkgrey:             new RGBA(169, 169, 169),\n\tdarkkhaki:            new RGBA(189, 183, 107),\n\tdarkmagenta:          new RGBA(139,   0, 139),\n\tdarkolivegreen:       new RGBA( 85, 107,  47),\n\tdarkorange:           new RGBA(255, 140,   0),\n\tdarkorchid:           new RGBA(153,  50, 204),\n\tdarkred:              new RGBA(139,   0,   0),\n\tdarksalmon:           new RGBA(233, 150, 122),\n\tdarkseagreen:         new RGBA(143, 188, 143),\n\tdarkslateblue:        new RGBA( 72,  61, 139),\n\tdarkslategray:        new RGBA( 47,  79,  79),\n\tdarkslategrey:        new RGBA( 47,  79,  79),\n\tdarkturquoise:        new RGBA(  0, 206, 209),\n\tdarkviolet:           new RGBA(148,   0, 211),\n\tdeeppink:             new RGBA(255,  20, 147),\n\tdeepskyblue:          new RGBA(  0, 191, 255),\n\tdimgray:              new RGBA(105, 105, 105),\n\tdimgrey:              new RGBA(105, 105, 105),\n\tdodgerblue:           new RGBA( 30, 144, 255),\n\tfirebrick:            new RGBA(178,  34,  34),\n\tfloralwhite:          new RGBA(255, 250, 240),\n\tforestgreen:          new RGBA( 34, 139,  34),\n\tfuchsia:              new RGBA(255,   0, 255),\n\tgainsboro:            new RGBA(220, 220, 220),\n\tghostwhite:           new RGBA(248, 248, 255),\n\tgold:                 new RGBA(255, 215,   0),\n\tgoldenrod:            new RGBA(218, 165,  32),\n\tgray:                 new RGBA(128, 128, 128),\n\tgrey:                 new RGBA(128, 128, 128),\n\tgreen:                new RGBA(  0, 128,   0),\n\tgreenyellow:          new RGBA(173, 255,  47),\n\thoneydew:             new RGBA(240, 255, 240),\n\thotpink:              new RGBA(255, 105, 180),\n\tindianred:            new RGBA(205,  92,  92),\n\tindigo:               new RGBA( 75,   0, 130),\n\tivory:                new RGBA(255, 255, 240),\n\tkhaki:                new RGBA(240, 230, 140),\n\tlavender:             new RGBA(230, 230, 250),\n\tlavenderblush:        new RGBA(255, 240, 245),\n\tlawngreen:            new RGBA(124, 252,   0),\n\tlemonchiffon:         new RGBA(255, 250, 205),\n\tlightblue:            new RGBA(173, 216, 230),\n\tlightcoral:           new RGBA(240, 128, 128),\n\tlightcyan:            new RGBA(224, 255, 255),\n\tlightgoldenrodyellow: new RGBA(250, 250, 210),\n\tlightgray:            new RGBA(211, 211, 211),\n\tlightgreen:           new RGBA(144, 238, 144),\n\tlightgrey:            new RGBA(211, 211, 211),\n\tlightpink:            new RGBA(255, 182, 193),\n\tlightsalmon:          new RGBA(255, 160, 122),\n\tlightseagreen:        new RGBA( 32, 178, 170),\n\tlightskyblue:         new RGBA(135, 206, 250),\n\tlightslategray:       new RGBA(119, 136, 153),\n\tlightslategrey:       new RGBA(119, 136, 153),\n\tlightsteelblue:       new RGBA(176, 196, 222),\n\tlightyellow:          new RGBA(255, 255, 224),\n\tlime:                 new RGBA(  0, 255,   0),\n\tlimegreen:            new RGBA( 50, 205,  50),\n\tlinen:                new RGBA(250, 240, 230),\n\tmagenta:              new RGBA(255,   0, 255),\n\tmaroon:               new RGBA(128,   0,   0),\n\tmediumaquamarine:     new RGBA(102, 205, 170),\n\tmediumblue:           new RGBA(  0,   0, 205),\n\tmediumorchid:         new RGBA(186,  85, 211),\n\tmediumpurple:         new RGBA(147, 112, 219),\n\tmediumseagreen:       new RGBA( 60, 179, 113),\n\tmediumslateblue:      new RGBA(123, 104, 238),\n\tmediumspringgreen:    new RGBA(  0, 250, 154),\n\tmediumturquoise:      new RGBA( 72, 209, 204),\n\tmediumvioletred:      new RGBA(199,  21, 133),\n\tmidnightblue:         new RGBA( 25,  25, 112),\n\tmintcream:            new RGBA(245, 255, 250),\n\tmistyrose:            new RGBA(255, 228, 225),\n\tmoccasin:             new RGBA(255, 228, 181),\n\tnavajowhite:          new RGBA(255, 222, 173),\n\tnavy:                 new RGBA(  0,   0, 128),\n\toldlace:              new RGBA(253, 245, 230),\n\tolive:                new RGBA(128, 128,   0),\n\tolivedrab:            new RGBA(107, 142,  35),\n\torange:               new RGBA(255, 165,   0),\n\torangered:            new RGBA(255,  69,   0),\n\torchid:               new RGBA(218, 112, 214),\n\tpalegoldenrod:        new RGBA(238, 232, 170),\n\tpalegreen:            new RGBA(152, 251, 152),\n\tpaleturquoise:        new RGBA(175, 238, 238),\n\tpalevioletred:        new RGBA(219, 112, 147),\n\tpapayawhip:           new RGBA(255, 239, 213),\n\tpeachpuff:            new RGBA(255, 218, 185),\n\tperu:                 new RGBA(205, 133,  63),\n\tpink:                 new RGBA(255, 192, 203),\n\tplum:                 new RGBA(221, 160, 221),\n\tpowderblue:           new RGBA(176, 224, 230),\n\tpurple:               new RGBA(128,   0, 128),\n\tred:                  new RGBA(255,   0,   0),\n\trosybrown:            new RGBA(188, 143, 143),\n\troyalblue:            new RGBA( 65, 105, 225),\n\tsaddlebrown:          new RGBA(139,  69,  19),\n\tsalmon:               new RGBA(250, 128, 114),\n\tsandybrown:           new RGBA(244, 164,  96),\n\tseagreen:             new RGBA( 46, 139,  87),\n\tseashell:             new RGBA(255, 245, 238),\n\tsienna:               new RGBA(160,  82,  45),\n\tsilver:               new RGBA(192, 192, 192),\n\tskyblue:              new RGBA(135, 206, 235),\n\tslateblue:            new RGBA(106,  90, 205),\n\tslategray:            new RGBA(112, 128, 144),\n\tslategrey:            new RGBA(112, 128, 144),\n\tsnow:                 new RGBA(255, 250, 250),\n\tspringgreen:          new RGBA(  0, 255, 127),\n\tsteelblue:            new RGBA( 70, 130, 180),\n\ttan:                  new RGBA(210, 180, 140),\n\tteal:                 new RGBA(  0, 128, 128),\n\tthistle:              new RGBA(216, 191, 216),\n\ttomato:               new RGBA(255,  99,  71),\n\ttransparent:          new RGBA(  0,   0,   0,   0),\n\tturquoise:            new RGBA( 64, 224, 208),\n\tviolet:               new RGBA(238, 130, 238),\n\twheat:                new RGBA(245, 222, 179),\n\twhite:                new RGBA(255, 255, 255),\n\twhitesmoke:           new RGBA(245, 245, 245),\n\tyellow:               new RGBA(255, 255,   0),\n\tyellowgreen:          new RGBA(154, 205,  50)\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/filter.js":{"path":"modules/devkit-core/modules/timestep/src/ui/filter.js","friendlyPath":"ui.filter","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"filter.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module ui.filter;\n *\n * A namespace for graphical filters used in games. These are attached using\n * View functions and applied using the Image class. This class is purely informational.\n *\n * If this is a namespace, the file name should be lower-case!\n *\n * Resources:\n *  http://jswidget.com/blog/2011/03/11/image-blending-algorithmpart-i/\n *  http://jswidget.com/blog/2011/03/11/image-blending-algorithmpart-ii/\n *\n * @doc http://doc.gameclosure.com/api/ui-filter.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/filter.md\n */\n\njsio('import ui.Color as Color');\n\nvar Image;\n\nexports.Filter=__class__;var Filter = exports.Filter=exports.Filter(function exports_Filter(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tthis.init = function (opts) {\n\t\tthis._color = new Color(opts);\n\t\tthis._type = opts.type || '';\n\t\tthis._views = [];\n\t};\n\n\tthis.get = function () {\n\t\tvar opts = this._color.get();\n\t\topts.type = this._type;\n\t\topts.priority = 0;\n\t\treturn opts;\n\t};\n\n\tthis.getType = function () {\n\t\treturn this._type;\n\t};\n\n\tthis.update = function (opts) {\n\t\topts = opts || this.get();\n\t\tthis._color.update(opts);\n\t\tthis._type = opts.type !== undefined ? opts.type : this._type;\n\n\t\tvar views = this._views;\n\t\tfor (var i = 0, len = views.length; i < len; i++) {\n\t\t\tvar view = views[i];\n\t\t\tview.__view.filterColor = this.getColorString();\n\t\t\tview.__view.filterType = Filter.TYPES[this.getType()] || 0;\n\t\t}\n\t};\n\n\tthis.setView = function (view) {\n\t\tvar views = this._views;\n\t\tif (views.indexOf(view) === -1) {\n\t\t\tviews.push(view);\n\t\t}\n\t};\n\n\tthis.removeView = function (view) {\n\t\tvar views = this._views;\n\t\tvar i = views.indexOf(view);\n\t\tif (i !== -1) {\n\t\t\tviews.splice(i, 1);\n\t\t}\n\t};\n\n\tthis.getColorString = function () {\n\t\treturn this._color.toString();\n\t};\n\n});\n\nFilter.TYPES = {\n\t\"None\": 0,\n\t\"LinearAdd\": 1,\n\t\"Multiply\": 2,\n\t\"Tint\": 3\n};\n\n/**\n * Linear add (lighten) filter.\n */\n\nexports.LinearAddFilter=__class__;exports.LinearAddFilter=exports.LinearAddFilter(function exports_LinearAddFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\tthis._type = 'LinearAdd';\n\t};\n});\n\n/**\n * Tint (averaging) filter.\n */\n\nexports.TintFilter=__class__;exports.TintFilter=exports.TintFilter(function exports_TintFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\tthis._type = 'Tint';\n\t};\n});\n\n/**\n * Multiply filter.\n */\n\nexports.MultiplyFilter=__class__;exports.MultiplyFilter=exports.MultiplyFilter(function exports_MultiplyFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\tthis._type = 'Multiply';\n\t};\n});\n\n/**\n * Positive masking.\n */\n\nexports.PositiveMaskFilter=__class__;exports.PositiveMaskFilter=exports.PositiveMaskFilter(function exports_PositiveMaskFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\tthis._type = 'PositiveMask';\n\t\tif (opts.image) {\n\t\t\tImage = Image || jsio('import ui.resource.Image');\n\t\t\tthis._mask = new Image({ url: opts.image });\n\t\t}\n\t};\n\n\tthis.getMask = function () {\n\t\treturn this._mask;\n\t};\n});\n\n/**\n * Negative masking.\n */\n\nexports.NegativeMaskFilter=__class__;exports.NegativeMaskFilter=exports.NegativeMaskFilter(function exports_NegativeMaskFilter(){return this.init&&this.init.apply(this,arguments)},Filter, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\tthis._type = 'NegativeMask';\n\t\tif (opts.image) {\n\t\t\tImage = Image || jsio('import ui.resource.Image');\n\t\t\tthis._mask = new Image({ url: opts.image });\n\t\t}\n\t};\n\n\tthis.getMask = function () {\n\t\treturn this._mask;\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/resource/Font.js":{"path":"modules/devkit-core/modules/timestep/src/ui/resource/Font.js","friendlyPath":"ui.resource.Font","directory":"modules/devkit-core/modules/timestep/src/ui/resource/","filename":"Font.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.resource.Font;\n * Font string parser, a la CSS Font strings. Exports a Font object class.\n * This class is purely informational.\n *\n * @doc http://doc.gameclosure.com/api/ui-text.html#class-ui.resource.font\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/text.md\n */\n\nvar _cache = {},\n\tweights = 'normal|bold|bolder|lighter|[1-9]00',\n\tstyles = 'normal|italic|oblique',\n\tunits = 'px|pt|pc|in|cm|mm|%',\n\tname = '([\\\\w\\\"\\'\\\\- ]+(?:,|$))+',\n\tfontParser = new RegExp(\n\t\t'^ *'\n\t\t\t+ '(?:(' + weights + ') *)?'\n\t\t\t+ '(?:(' + styles + ') *)?'\n\t\t\t+ '([\\\\d\\\\.]+)(' + units + ')'\n\t\t\t+ '('+ name + ')',\n\t\t\t'i'\n\t),\n\tsizeParser = new RegExp('([\\\\d\\\\.]+)(' + units + ')', 'i'),\n\tTO_PT = {\n\t\t'pt': 1,\n\t\t'px': 3 / 4,\n\t\t'in': 3 / 4 * 96,\n\t\t'mm': 3 / 4 * 96 / 25.4,\n\t\t'cm': 3 / 4 * 96 / 2.54\n\t},\n\tTO_PX = {\n\t\t'pt': 4 / 3,\n\t\t'px': 1,\n\t\t'in': 96,\n\t\t'mm': 96 / 25.4,\n\t\t'cm': 96 / 2.54\n\t};\n\nfunction parseSize(sizeStr, unit) {\n\tvar match = sizeStr.match(sizeParser);\n\tif (!match) { throw 'invalid font size'; }\n\treturn {\n\t\tvalue: parseFloat(match[1]),\n\t\tunit: match[2]\n\t};\n}\n\nfunction toPx(size) {\n\treturn {\n\t\tvalue: size.value * TO_PX[size.unit],\n\t\tunit: 'px'\n\t};\n}\n\nfunction toPt(size) {\n\treturn {\n\t\tvalue: size.value * TO_PT[size.unit],\n\t\tunit: 'pt'\n\t};\n}\n\nfunction parseFont(fontStr) {\n\tvar match = fontStr.match(fontParser);\n\tif (!match) { throw 'invalid font string'; }\n\t\n\tvar res = {};\n\tres.weight = match[1] || 'normal';\n\tres.style = match[2] || 'normal';\n\tres.size = {\n\t\tvalue: parseFloat(match[3]),\n\t\tunit: match[4]\n\t};\n\n\tvar splitStrings = match[5].split(',');\n\n\tres.names = splitStrings.map(function (str) {\n\t\treturn str.replace(/[\\-_]/g, ' ')\n\t\t\t.replace(/\\s+/g, ' ')\n\t\t\t.replace(/['\"]/g, '')\n\t\t\t.replace(/^\\s+|\\s+$/g, '');\n\t});\n\n\tres.name = res.names[0];\n\n\tvar origNames = splitStrings.map(function (str) {\n\t\treturn str.replace(/\\s+/g, ' ')\n\t\t\t.replace(/['\"]/g, '')\n\t\t\t.replace(/^\\s+|\\s+$/g, '');\n\t});\n\n\tres.origName = origNames[0];\n\n\treturn res;\n};\n\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_resource_Font=__class__;var Font = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_resource_Font(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_resource_Font(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\n\tvar _defaultFontFamily = null;\n\tthis.constructor.setDefaultFontFamily = function (fontFamily) {\n\t\t_defaultFontFamily = fontFamily;\n\t}\n\n\tvar defaults = {\n\t\tname: _defaultFontFamily,\n\t\tsize: 20,\n\t\tunit: 'px',\n\t\tstyle: '',\n\t\tweight: ''\n\t};\n\n\tthis.init = function (opts) {\n\t\tif (typeof opts === 'string') {\n\t\t\t_cache[opts] = this;\n\t\t\tthis._string = opts;\n\t\t\topts = parseFont(opts);\n\t\t} else {\n\t\t\topts = merge(opts, defaults);\n\t\t}\n\t\t\n\t\tif (typeof opts.size == 'string') {\n\t\t\topts.size = parseSize(opts.size);\n\t\t}\n\t\t\n\t\tthis._name = opts.name;\n\t\tthis._origName = opts.origName;\n\t\tthis._style = opts.style;\n\t\tthis.size = opts.size;\n\t\tthis.sizePx = toPx(this.size).value;\n\t\tthis.sizePt = toPt(this.size).value;\n\t\tthis._weight = opts.weight;\n\n\t\tthis._isBold = /bold/i.test(this._weight);\n\t};\n\t\n\tthis.getSize = function () { return this.sizePx; }\n\n\tthis.getName = function () { return this._name; }\n\tthis.getOrigName = function () { return this._origName; }\n\tthis.getWeight = function () { return this._weight; }\n});\n\nexports.parse = function (str) {\n\tif (str in _cache) {\n\t\treturn _cache[str];\n\t} else {\n\t\treturn new Font(str);\n\t}\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/WebGLContext2D.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/WebGLContext2D.js","friendlyPath":".webgl.WebGLContext2D","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/","filename":"WebGLContext2D.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package timestep.env.browser.WebGLContext2D;\n *\n * Generates a WebGL rendering context by creating our own Canvas element.\n */\n\njsio('import device');\n\njsio('import ui.resource.loader as loader');\njsio('import ui.Color as Color');\n\njsio('import .TextManager');\njsio('import .Shaders');\njsio('import .Matrix2D');\n\nContextStateStack=__class__;var ContextStateStack=ContextStateStack(function ContextStateStack(){return this.init&&this.init.apply(this,arguments)},function() {\n\n\tthis.init = function() {\n\t\tthis._states = [this.getObject()];\n\t\tthis._stateIndex = 0;\n\t};\n\n\tthis.save = function() {\n\t\tvar lastState = this.state;\n\t\tif (++this._stateIndex >= this._states.length) {\n\t\t\tthis._states[this._stateIndex] = this.getObject();\n\t\t}\n\t\tvar s = this.state;\n\t\ts.globalCompositeOperation = lastState.globalCompositeOperation;\n\t\ts.globalAlpha = lastState.globalAlpha;\n\t\ts.transform.copy(lastState.transform);\n\t\ts.textBaseLine = lastState.textBaseLine;\n\t\ts.lineWidth = lastState.lineWidth;\n\t\ts.strokeStyle = lastState.strokeStyle;\n\t\ts.fillStyle = lastState.fillStyle;\n\t\ts.filter = lastState.filter;\n\t\ts.clip = lastState.clip;\n\t\ts.clipRect.x = lastState.clipRect.x;\n\t\ts.clipRect.y = lastState.clipRect.y;\n\t\ts.clipRect.width = lastState.clipRect.width;\n\t\ts.clipRect.height = lastState.clipRect.height;\n\t};\n\n\tthis.restore = function() {\n\t\tif (this._stateIndex > 0) {\n\t\t\tthis._stateIndex--;\n\t\t}\n\t};\n\n\tthis.getObject = function() {\n\t\treturn {\n\t\t\tglobalCompositeOperation: \"source-over\",\n\t\t\tglobalAlpha: 1,\n\t\t\ttransform: new Matrix2D(),\n\t\t\tfilter: null,\n\t\t\tclip: false,\n\t\t\tclipRect: { x: 0, y: 0, width: 0, height: 0 },\n\t\t\tfillStyle: \"\"\n\t\t};\n\t};\n\n\tObject.defineProperty(this, 'state', {\n\t\tget: function() { return this._states[this._stateIndex]; }\n\t});\n});\n\nvar STRIDE = 24;\n\nvar RENDER_MODES = {\n\tDefault: 0,\n\tLinearAdd: 1,\n\tTint: 2,\n\tMultiply: 3,\n\tRect: 4,\n\tPositiveMask: 0,\n\tNegativeMask: 0\n};\n\nvar COLOR_MAP = {};\n\nvar getColor = function(key) {\n\tvar result = COLOR_MAP[key];\n\tif (!result) {\n\t\tresult = COLOR_MAP[key] = Color.parse(key);\n\t}\n\treturn result;\n};\n\nGLManager=__class__;var GLManager=GLManager(function GLManager(){return this.init&&this.init.apply(this,arguments)},function() {\n\n\tvar MAX_BATCH_SIZE = 1024;\n\n\tthis.init = function () {\n\t\tvar webglSupported = false;\n\n\t\ttry {\n\t\t\tvar testCanvas = document.createElement('canvas');\n\t\t\twebglSupported = !!(window.WebGLRenderingContext && testCanvas.getContext('webgl'));\n\t\t} catch(e) {}\n\n\t\tthis.width = device.width;\n\t\tthis.height = device.height;\n\t\tthis.isSupported = webglSupported;\n\n\t\tif (!this.isSupported) { return; }\n\n\t\tthis.textManager = new TextManager();\n\n\t\tthis._helperTransform = new Matrix2D();\n\n\t\tthis._canvas = document.createElement('canvas');\n\t\tthis._canvas.width = this.width;\n\t\tthis._canvas.height = this.height;\n\t\tthis._canvas.getWebGLContext = this._canvas.getContext.bind(this._canvas, 'webgl', { alpha: true, premultipliedAlpha: true });\n\n\t\tthis._indexCache = new Uint16Array(MAX_BATCH_SIZE * 6);\n\t\tthis._vertexCache = new ArrayBuffer(MAX_BATCH_SIZE * STRIDE * 4);\n\t\tthis._vertices = new Float32Array(this._vertexCache);\n\t\tthis._colors = new Uint8Array(this._vertexCache);\n\n\t\tvar indexCount = MAX_BATCH_SIZE * 6;\n\t\tfor (var i = 0, j = 0; i < indexCount; i += 6, j += 4) {\n\t\t\tthis._indexCache[i] = j;\n\t\t\tthis._indexCache[i + 1] = j + 2;\n\t\t\tthis._indexCache[i + 2] = j + 3;\n\t\t\tthis._indexCache[i + 3] = j;\n\t\t\tthis._indexCache[i + 4] = j + 3;\n\t\t\tthis._indexCache[i + 5] = j + 1;\n\t\t}\n\n\t\tthis._batchQueue = new Array(MAX_BATCH_SIZE);\n\n\t\tfor (var i = 0; i <= MAX_BATCH_SIZE; i++) {\n\t\t\tthis._batchQueue[i] = {\n\t\t\t\ttextureId: 0,\n\t\t\t\tindex: 0,\n\t\t\t\tclip: false,\n\t\t\t\tfilter: null,\n\t\t\t\tclipRect: { x: 0, y: 0, width: 0, height: 0 },\n\t\t\t\trenderMode: 0\n\t\t\t};\n\t\t}\n\n\t\tthis.contexts = [];\n\t\tthis.initGL();\n\t\tthis._primaryContext = new Context2D(this, this._canvas);\n\t\tthis.activate(this._primaryContext);\n\n\t\tloader.on(loader.IMAGE_LOADED, function(image) {\n\t\t\tvar glId = image.__GL_ID;\n\t\t\tif (glId === undefined) {\n\t\t\t\tglId = this.createTexture(image);\n\t\t\t}\n\t\t}.bind(this));\n\n\t\tthis.contextActive = true;\n\n\t\tdevice.screen.on('Resize', this.updateCanvasDimensions.bind(this));\n\t\tthis._canvas.addEventListener('webglcontextlost', this.handleContextLost.bind(this), false);\n\t\tthis._canvas.addEventListener('webglcontextrestored', this.handleContextRestored.bind(this), false);\n\t};\n\n\tthis.handleContextLost = function(e) {\n\t\te.preventDefault();\n\t\tthis.contextActive = false;\n\t\tthis.gl = null;\n\t};\n\n\tthis.handleContextRestored = function() {\n\t\tthis.initGL();\n\t\tthis.contextActive = true;\n\t};\n\n\tthis.initGL = function () {\n\t\tvar gl = this.gl = this._canvas.getWebGLContext();\n\n\t\tgl.clearColor(0.0, 0.0, 0.0, 0.0);\n\t\tgl.disable(gl.DEPTH_TEST);\n\t\tgl.disable(gl.CULL_FACE);\n\t\tgl.enable(gl.BLEND);\n\t\tgl.blendEquation(gl.FUNC_ADD);\n\t\tgl.activeTexture(gl.TEXTURE0);\n\n\t\tthis._scissorEnabled = false;\n\t\tthis._activeScissor = { x: 0, y: 0, width: 0, height: 0 };\n\n\t\tthis.setActiveCompositeOperation('source-over');\n\t\tthis._activeRenderMode = -1;\n\n\t\tgl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n\n\t\tthis.textureCache = [];\n\t\tthis._drawIndex = -1;\n\t\tthis._batchIndex = -1;\n\n\t\t// Initialize Buffers\n\t\tthis._indexBuffer = gl.createBuffer();\n\t\tthis._vertexBuffer = gl.createBuffer();\n\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer);\n\t\tgl.bufferData(gl.ELEMENT_ARRAY_BUFFER, this._indexCache, gl.STATIC_DRAW);\n\t\tgl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);\n\t\tgl.bufferData(gl.ARRAY_BUFFER, this._vertexCache, gl.DYNAMIC_DRAW);\n\n\t\t// Initialize Shaders\n\t\tthis.shaders = [];\n\t\tthis.shaders[RENDER_MODES.Default] = new Shaders.DefaultShader({ gl: gl });\n\t\tthis.shaders[RENDER_MODES.LinearAdd] = new Shaders.LinearAddShader({ gl: gl });\n\t\tthis.shaders[RENDER_MODES.Tint] = new Shaders.TintShader({ gl: gl });\n\t\tthis.shaders[RENDER_MODES.Multiply] = new Shaders.MultiplyShader({ gl: gl });\n\t\tthis.shaders[RENDER_MODES.Rect] = new Shaders.RectShader({ gl: gl });\n\n\t\tthis.reloadTextures();\n\t\tthis.updateContexts();\n\t};\n\n\tthis.reloadTextures = function() {\n\t\tvar oldCanvases = this.canvasCache;\n\t\tthis.canvasCache = [];\n\t\tif (oldCanvases) {\n\t\t\tfor (var i = 0; i < oldCanvases.length; i++) {\n\t\t\t\tthis.createTexture(oldCanvases[i]);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.updateContexts = function() {\n\t\tfor (var i = 0; i < this.contexts.length; i++) {\n\t\t\tthis.contexts[i].createOffscreenFrameBuffer();\n\t\t}\n\t};\n\n\tthis.updateCanvasDimensions = function() {\n\t\tthis._primaryContext.resize(device.screen.width, device.screen.height);\n\t};\n\n\tthis.getContext = function(canvas, opts) {\n\t\topts = opts || {};\n\n\t\tvar ctx;\n\t\tif (opts.offscreen === false) {\n\t\t\tctx = this._primaryContext;\n\t\t\tctx.resize(opts.width, opts.height);\n\t\t} else {\n\t\t\tctx = new Context2D(this, canvas);\n\t\t\tctx.createOffscreenFrameBuffer();\n\t\t\tthis.contexts.push(ctx);\n\t\t}\n\n\t\treturn ctx;\n\t};\n\n\tthis.setActiveRenderMode = function(id) {\n\t\tif (this._activeRenderMode === id || !this.gl) { return; }\n\t\tvar ctx = this._activeCtx;\n\t\tthis._activeRenderMode = id;\n\t\tvar shader = this.shaders[id];\n\t\tgl.useProgram(shader.program);\n\t\tgl.uniform2f(shader.uniforms.uResolution, ctx.width, ctx.height);\n\t\tif (shader.uniforms.uSampler !== -1) {\n\t\t\tgl.uniform1i(shader.uniforms.uSampler, 0);\n\t\t}\n\t};\n\n\tthis.setActiveCompositeOperation = function(op) {\n\n\t\top = op || 'source-over';\n\t\tif (this._activeCompositeOperation === op || !this.gl) { return; }\n\t\tthis._activeCompositeOperation = op;\n\n\t\tvar gl = this.gl;\n\t\tvar source;\n\t\tvar destination;\n\n\t\tswitch(op) {\n\t\t\tcase 'source-over':\n\t\t\t\tsource = gl.ONE;\n\t\t\t\tdestination = gl.ONE_MINUS_SRC_ALPHA;\n\t\t\t\tbreak;\n\n\t\t\tcase 'source-atop':\n\t\t\t\tsource = gl.DST_ALPHA;\n\t\t\t\tdestination = gl.ONE_MINUS_SRC_ALPHA;\n\t\t\t\tbreak;\n\n\t\t\tcase 'source-in':\n\t\t\t\tsource = gl.DST_ALPHA;\n\t\t\t\tdestination = gl.ZERO;\n\t\t\t\tbreak;\n\n\t\t\tcase 'source-out':\n\t\t\t\tsource = gl.ONE_MINUS_DST_ALPHA;\n\t\t\t\tdestination = gl.ZERO;\n\t\t\t\tbreak;\n\n\t\t\tcase 'destination-atop':\n\t\t\t\tsource = gl.DST_ALPHA;\n\t\t\t\tdestination = gl.SRC_ALPHA;\n\t\t\t\tbreak;\n\n\t\t\tcase 'destination-in':\n\t\t\t\tsource = gl.ZERO;\n\t\t\t\tdestination = gl.SRC_ALPHA;\n\t\t\t\tbreak;\n\n\t\t\tcase 'destination-out':\n\t\t\t\tsource = gl.ONE_MINUS_SRC_ALPHA;\n\t\t\t\tdestination = gl.ONE_MINUS_SRC_ALPHA;\n\t\t\t\tbreak;\n\n\t\t\tcase 'destination-over':\n\t\t\t\tsource = gl.DST_ALPHA;\n\t\t\t\tdestination = gl.SRC_ALPHA;\n\t\t\t\tbreak;\n\n\t\t\tcase 'lighter':\n\t\t\t\tsource = gl.ONE;\n\t\t\t\tdestination = gl.ONE;\n\t\t\t\tbreak;\n\n\t\t\tcase 'xor':\n\t\t\tcase 'copy':\n\t\t\t\tsource = gl.ONE;\n\t\t\t\tdestination = gl.ONE_MINUS_SRC_ALPHA;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tsource = gl.ONE;\n\t\t\t\tdestination = gl.ONE_MINUS_SRC_ALPHA;\n\t\t\t\tbreak;\n\t\t}\n\t\tgl.blendFunc(source, destination);\n\t};\n\n\tthis.flush = function() {\n\t\tif (this._batchIndex === -1 || !this.gl) { return; }\n\n\t\tvar gl = this.gl;\n\t\tgl.bufferSubData(gl.ARRAY_BUFFER, 0, this._vertexCache);\n\t\tthis._batchQueue[this._batchIndex + 1].index = this._drawIndex + 1;\n\n\t\tfor (var i = 0; i <= this._batchIndex; i++) {\n\t\t\tvar curQueueObj = this._batchQueue[i];\n\t\t\tif (curQueueObj.clip) {\n\t\t\t\tvar r = curQueueObj.clipRect;\n\t\t\t\tthis.enableScissor(r.x, r.y, r.width, r.height);\n\t\t\t} else {\n\t\t\t\tthis.disableScissor();\n\t\t\t}\n\t\t\tvar textureId = curQueueObj.textureId;\n\t\t\tif (textureId !== -1) {\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, this.textureCache[curQueueObj.textureId]);\n\t\t\t}\n\t\t\tthis.setActiveCompositeOperation(curQueueObj.globalCompositeOperation);\n\t\t\tthis.setActiveRenderMode(curQueueObj.renderMode);\n\t\t\tvar start = curQueueObj.index;\n\t\t\tvar next = this._batchQueue[i + 1].index;\n\t\t\tgl.drawElements(gl.TRIANGLES, (next - start) * 6, gl.UNSIGNED_SHORT, start * 12);\n\t\t}\n\n\t\tthis._drawIndex = -1;\n\t\tthis._batchIndex = -1;\n\t};\n\n\tthis.createTexture = function(image, id) {\n\t\tvar gl = this.gl;\n\t\tif (!gl) { return -1; }\n\n\t\tif (!id) { id = this.textureCache.length; }\n\t\tvar texture = this.textureCache[id] || gl.createTexture();\n\n\t\tgl.bindTexture(gl.TEXTURE_2D, texture);\n\n\t\tif (image instanceof HTMLCanvasElement || image instanceof Image) {\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n\t\t} else {\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, image.width, image.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\t\t}\n\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\t\tthis.textureCache[id] = texture;\n\t\tthis.canvasCache[id] = image;\n\t\timage.__GL_ID = id;\n\t\treturn id;\n\t};\n\n\tthis.getTexture = function(id) {\n\t\treturn this.textureCache[id];\n\t};\n\n\tthis.deleteTexture = function(id) {\n\t\tvar texture = this.textureCache[id];\n\t\tthis._gl.deleteTexture(texture);\n\t\tdelete this.textureCache[id];\n\t};\n\n\tthis.enableScissor = function(x, y, width, height) {\n\t\tif (!this.gl) { return; }\n\t\tvar gl = this.gl;\n\t\tif (!this._scissorEnabled) {\n\t\t\tgl.enable(gl.SCISSOR_TEST);\n\t\t\tthis._scissorEnabled = true;\n\t\t}\n\t\tvar s = this._activeScissor;\n\t\tif (x !== s.x || y !== s.y || width !== s.width || height !== s.height) {\n\t\t\ts.x = x;\n\t\t\ts.y = y;\n\t\t\ts.width = width;\n\t\t\ts.height = height;\n\t\t\tgl.scissor(x, this.height - height - y, width, height);\n\t\t}\n\t};\n\n\tthis.disableScissor = function() {\n\t\tif (!this.gl) { return; }\n\t\tif (this._scissorEnabled) {\n\t\t\tvar gl = this.gl;\n\t\t\tthis._scissorEnabled = false;\n\t\t\tgl.disable(gl.SCISSOR_TEST);\n\t\t}\n\t};\n\n\tthis.addToBatch = function(state, textureId) {\n\t\tif (this._drawIndex >= MAX_BATCH_SIZE - 1) { this.flush(); }\n\t\tthis._drawIndex++;\n\n\t\tvar filter = state.filter;\n\t\tvar clip = state.clip;\n\t\tvar clipRect = state.clipRect;\n\n\t\tvar queuedState = this._batchIndex > -1 ? this._batchQueue[this._batchIndex] : null;\n\t\tvar stateChanged = !queuedState\n\t\t\t\t|| queuedState.textureId !== textureId\n\t\t\t\t|| (textureId === -1 && queuedState.fillStyle !== state.fillStyle)\n\t\t\t\t|| queuedState.globalCompositeOperation !== state.globalCompositeOperation\n\t\t\t\t|| queuedState.filter !== filter\n\t\t\t\t|| queuedState.clip !== clip\n\t\t\t\t|| queuedState.clipRect.x !== clipRect.x\n\t\t\t\t|| queuedState.clipRect.y !== clipRect.y\n\t\t\t\t|| queuedState.clipRect.width !== clipRect.width\n\t\t\t\t|| queuedState.clipRect.height !== clipRect.height;\n\n\t\tif (stateChanged) {\n\t\t\tvar queueObject = this._batchQueue[++this._batchIndex];\n\t\t\tqueueObject.textureId = textureId;\n\t\t\tqueueObject.index = this._drawIndex;\n\t\t\tqueueObject.globalCompositeOperation = state.globalCompositeOperation;\n\t\t\tqueueObject.filter = filter;\n\t\t\tqueueObject.clip = clip;\n\t\t\tqueueObject.clipRect.x = clipRect.x;\n\t\t\tqueueObject.clipRect.y = clipRect.y;\n\t\t\tqueueObject.clipRect.width = clipRect.width;\n\t\t\tqueueObject.clipRect.height = clipRect.height;\n\t\t\tif (textureId === -1) {\n\t\t\t\tqueueObject.renderMode = RENDER_MODES.Rect;\n\t\t\t} else if (filter) {\n\t\t\t\tqueueObject.renderMode = RENDER_MODES[filter.getType()];\n\t\t\t} else {\n\t\t\t\tqueueObject.renderMode = RENDER_MODES.Default;\n\t\t\t}\n\t\t}\n\n\t\treturn this._drawIndex;\n\t};\n\n\tthis.isPowerOfTwo = function (width, height) {\n\t\treturn width > 0 && (width & (width - 1)) === 0 && height > 0 && (height & (height - 1)) === 0;\n\t};\n\n\tthis.activate = function (ctx, forceActivate) {\n\t\tvar gl = this.gl;\n\t\tif ((!forceActivate && ctx === this._activeCtx) || !gl) { return; }\n\t\tthis.flush();\n\t\tgl.finish();\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, ctx.frameBuffer);\n\t\tgl.viewport(0, 0, ctx.width, ctx.height);\n\t\tthis._activeCtx = ctx;\n\t\tthis._activeRenderMode = -1;\n\t}\n});\n\n// Create a context to measure text\nvar textCtx = document.createElement(\"canvas\").getContext(\"2d\");\n\n// ---------------------------------------------------------------------------\n// CONTEXT2D\n// ---------------------------------------------------------------------------\n\nContext2D=__class__;var Context2D=Context2D(function Context2D(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tvar createContextProperty = function(ctx, name) {\n\t\tObject.defineProperty(ctx, name, {\n\t\t\tget: function() { return this.stack.state[name]; },\n\t\t\tset: function(value) { this.stack.state[name] = value; }\n\t\t});\n\t};\n\n\tvar contextProperties = [\n\t\t'globalAlpha',\n\t\t'globalCompositeOperation',\n\t\t'textBaseLine',\n\t\t'lineWidth',\n\t\t'strokeStyle',\n\t\t'fillStyle',\n\t\t'font'\n\t];\n\n\tfor (var i = 0; i < contextProperties.length; i++) {\n\t\tcreateContextProperty(this, contextProperties[i]);\n\t}\n\n\tthis.init = function (manager, canvas) {\n\t\tthis._manager = manager;\n\t\tthis.canvas = canvas;\n\t\tthis.width = canvas.width;\n\t\tthis.height = canvas.height;\n\t\tthis.stack = new ContextStateStack();\n\t\tthis.font = '11px ' + device.defaultFontFamily;\n\t\tthis.frameBuffer = null;\n\t\tthis.filters = {};\n\t\tthis.flip = false;\n\t};\n\n\tthis.createOffscreenFrameBuffer = function () {\n\t\tvar gl = this._manager.gl;\n\t\tif (!gl) { return; }\n\t\tvar id = this._manager.createTexture(this.canvas);\n\t\tthis._texture = this._manager.getTexture(id);\n\t  this.frameBuffer = gl.createFramebuffer();\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, this.frameBuffer);\n\t\tgl.bindTexture(gl.TEXTURE_2D, this._texture);\n\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this._texture, 0);\n\t\tthis.clear();\n\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, null);\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\t\tthis.flip = true;\n\t};\n\n\tvar min = Math.min;\n\tvar max = Math.max;\n\n\tthis.loadIdentity = function() {\n\t\tthis.stack.state.transform.identity();\n\t};\n\n\tthis.setTransform = function(a, b, c, d, tx, ty) {\n\t\tthis.stack.state.transform.setTo(a, b, c, d, tx, ty);\n\t};\n\n\tthis.transform = function(a, b, c, d, tx, ty) {\n\t\tthis._helperTransform.setTo(a, b, c, d, tx, ty);\n\t\tthis.stack.state.transform.transform(this._helperTransform);\n\t};\n\n\tthis.scale = function(x, y) {\n\t\tthis.stack.state.transform.scale(x, y);\n\t};\n\n\tthis.translate = function(x, y) {\n\t\tthis.stack.state.transform.translate(x, y);\n\t};\n\n\tthis.rotate = function(angle) {\n\t\tthis.stack.state.transform.rotate(angle);\n\t};\n\n\tthis.getElement = function() { return this.canvas; };\n\n\tthis.reset = function() {};\n\n\tthis.clear = function() {\n\t\tthis._manager.activate(this);\n\t\tthis._manager.flush();\n\t\tvar gl = this._manager.gl;\n\t\tif (gl) {\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT);\n\t\t}\n\t};\n\n\tthis.resize = function(width, height) {\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t\tthis._manager.activate(this, true);\n\t\tif (this._texture && this._manager.gl) {\n\t\t\tvar gl = this._manager.gl;\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, this._texture);\n\t\t\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\t\t}\n\t};\n\n\tthis.clipRect = function(x, y, width, height) {\n\t\tvar m = this.stack.state.transform;\n\t\tvar xW = x + width;\n\t\tvar yH = y + height;\n\t\tvar x0 = x * m.a + y * m.c + m.tx;\n\t\tvar y0 = x * m.b + y * m.d + m.ty;\n\t\tvar x1 = xW * m.a + y * m.c + m.tx;\n\t\tvar y1 = xW * m.b + y * m.d + m.ty;\n\t\tvar x2 = x * m.a + yH * m.c + m.tx;\n\t\tvar y2 = x * m.b + yH * m.d + m.ty;\n\t\tvar x3 = xW * m.a + yH * m.c + m.tx;\n\t\tvar y3 = xW * m.b + yH * m.d + m.ty;\n\n\t\tvar minX = min(this.width, x0, x1, x2, x3);\n\t\tvar maxX = max(0, x0, x1, x2, x3);\n\t\tvar minY = min(this.height, y0, y1, y2, y3);\n\t\tvar maxY = max(0, y0, y1, y2, y3);\n\n\t\tthis.stack.state.clip = true;\n\t\tvar r = this.stack.state.clipRect;\n\t\tr.x = minX;\n\t\tr.y = minY;\n\t\tr.width = maxX - minX;\n\t\tr.height = maxY - minY;\n\t};\n\n\tthis.swap = function() {\n\t\tthis._manager.flush();\n\t};\n\n\tthis.execSwap = function() {};\n\n\tthis.setFilters = function(filters) {\n\t\tthis.clearFilters();\n\t\tfor (var filterId in filters) {\n\t\t\tthis.stack.state.filter = filters[filterId];\n\t\t\tthis.filters[filterId] = filters[filterId];\n\t\t\treturn;\n\t\t}\n\t\tthis.stack.state.filter = null;\n\t};\n\n\tthis.clearFilters = function() {\n\t\tfor (var name in this.filters) {\n\t\t\tdelete this.filters[name];\n\t\t}\n\t\tthis.stack.state.filter = null;\n\t};\n\n\tthis.save = function() {\n\t\tthis.stack.save();\n\t};\n\n\tthis.restore = function() {\n\t\tthis.stack.restore();\n\t};\n\n\tthis.strokeRect = function() {};\n\tthis.circle = function(x, y, radius) {};\n\tthis.drawPointSprites = function(x1, y1, x2, y2) {};\n\tthis.roundRect = function (x, y, width, height, radius) {};\n\n\tthis.fillText = function(text, x, y) {\n\t\tif (!this._manager.gl) { return; }\n\t\tvar textData = this._manager.textManager.get(this, text, false);\n\t\tif (!textData) { return; }\n\t\tvar w = textData.image.width;\n\t\tvar h = textData.image.height;\n\t\tthis.drawImage(textData.image, 0, 0, w, h, x, y, w, h);\n\t};\n\n\tthis.strokeText = function(text, x, y) {\n\t\tif (!this._manager.gl) { return; }\n\t\tvar textData = this._manager.textManager.get(this, text, true);\n\t\tif (!textData) { return; }\n\t\tvar w = textData.image.width;\n\t\tvar h = textData.image.height;\n\t\tthis.drawImage(textData.image, 0, 0, w, h, x - this.lineWidth * 0.5, y - this.lineWidth * 0.5, w, h);\n\t};\n\n\tthis.measureText = function(text) {\n\t\ttextCtx.font = this.font;\n\t\treturn textCtx.measureText(text);\n\t};\n\n\tthis.drawImage = function(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight) {\n\n\t\tif (!this._manager.gl) { return; }\n\n\t\tvar state = this.stack.state;\n\t\tvar alpha = state.globalAlpha;\n\t\tif (alpha === 0) { return; }\n\n\t\tvar manager = this._manager;\n\t\tmanager.activate(this);\n\n\t\tvar glId = image.__GL_ID;\n\t\tif (glId === undefined || image.__needsUpload) {\n\t\t\t// Invalid image? Early out if so.\n\t\t\tif (image.width === 0 || image.height === 0 || !image.complete) { return; }\n\t\t\timage.__needsUpload = false;\n\t\t\tglId = manager.createTexture(image, glId);\n\t\t}\n\n\t\tvar drawIndex = manager.addToBatch(this.stack.state, glId);\n\t\tvar width = this.width;\n\t\tvar height = this.height;\n\t\tvar imageWidth = image.width;\n\t\tvar imageHeight = image.height;\n\t\tvar m = state.transform;\n\t\tvar sxW = sx + sWidth;\n\t\tvar syH = sy + sHeight;\n\t\tvar dxW = dx + dWidth;\n\t\tvar dyH = dy + dHeight;\n\n\t\tvar needsTrim = sx < 0 || sxW > imageWidth || sy < 0 || syH > imageHeight;\n\n\t\tif (needsTrim) {\n\t\t\tvar newSX = max(0, sx);\n\t\t\tvar newSY = max(0, sy);\n\t\t\tvar newSXW = min(sxW, imageWidth);\n\t\t\tvar newSYH = min(syH, imageHeight);\n\t\t\tvar scaleX = dWidth / sWidth;\n\t\t\tvar scaleY = dHeight / sHeight;\n\t\t\tvar trimLeft = (newSX - sx) * scaleX;\n\t\t\tvar trimRight = (sxW - newSXW) * scaleX;\n\t\t\tvar trimTop = (newSY - sy) * scaleY;\n\t\t\tvar trimBottom = (syH - newSYH) * scaleY;\n\t\t\tdx += trimLeft;\n\t\t\tdxW -= trimRight;\n\t\t\tdy += trimTop;\n\t\t\tdyH -= trimBottom;\n\t\t\tsx = newSX;\n\t\t\tsy = newSY;\n\t\t\tsxW = newSXW;\n\t\t\tsyH = newSYH;\n\t\t}\n\n\t\t// Calculate 4 vertex positions\n\t\tvar x0 = dx * m.a + dy * m.c + m.tx;\n\t\tvar y0 = dx * m.b + dy * m.d + m.ty;\n\t\tvar x1 = dxW * m.a + dy * m.c + m.tx;\n\t\tvar y1 = dxW * m.b + dy * m.d + m.ty;\n\t\tvar x2 = dx * m.a + dyH * m.c + m.tx;\n\t\tvar y2 = dx * m.b + dyH * m.d + m.ty;\n\t\tvar x3 = dxW * m.a + dyH * m.c + m.tx;\n\t\tvar y3 = dxW * m.b + dyH * m.d + m.ty;\n\n\t\t// TOOD: remove private access to _vertices\n\t\tvar tw = 1 / imageWidth;\n\t\tvar th = 1 / imageHeight;\n\t\tvar vc = manager._vertices;\n\t\tvar i = drawIndex * 6 * 4;\n\n\t\tvar uLeft = sx * tw;\n\t\tvar uRight = sxW * tw;\n\t\tvar vTop = this.flip ? syH * th : sy * th;\n\t\tvar vBottom = this.flip ? sy * th : syH * th;\n\n\t\tvc[i + 0] = x0;\n\t\tvc[i + 1] = y0;\n\t\tvc[i + 2] = uLeft; // u0\n\t\tvc[i + 3] = vTop; // v0\n\t\tvc[i + 4] = alpha;\n\n\t\tvc[i + 6] = x1;\n\t\tvc[i + 7] = y1;\n\t\tvc[i + 8] = uRight; // u1\n\t\tvc[i + 9] = vTop; // v1\n\t\tvc[i + 10] = alpha;\n\n\t\tvc[i + 12] = x2;\n\t\tvc[i + 13] = y2;\n\t\tvc[i + 14] = uLeft; // u2\n\t\tvc[i + 15] = vBottom; // v2\n\t\tvc[i + 16] = alpha;\n\n\t\tvc[i + 18] = x3;\n\t\tvc[i + 19] = y3;\n\t\tvc[i + 20] = uRight; // u4\n\t\tvc[i + 21] = vBottom; // v4\n\t\tvc[i + 22] = alpha;\n\n\t\tif (state.filter) {\n\t\t\tvar color = state.filter.get();\n\t\t\tvar ci = drawIndex * 4 * STRIDE;\n\t\t\tvar cc = manager._colors;\n\t\t\tcc[ci + 20] = cc[ci + 44] = cc[ci + 68] = cc[ci + 92] = color.r; // R\n\t\t\tcc[ci + 21] = cc[ci + 45] = cc[ci + 69] = cc[ci + 93] = color.g; // G\n\t\t\tcc[ci + 22] = cc[ci + 46] = cc[ci + 70] = cc[ci + 94] = color.b; // B\n\t\t\tcc[ci + 23] = cc[ci + 47] = cc[ci + 71] = cc[ci + 95] = color.a * 255; // A\n\t\t}\n\t};\n\n\tthis.fillRect = function(x, y, width, height) {\n\n\t\tif (this.globalAlpha === 0) { return; }\n\n\t\tvar m = this.stack.state.transform;\n\t\tvar xW = x + width;\n\t\tvar yH = y + height;\n\n\t\t// Calculate 4 vertex positions\n\t\tvar x0 = x * m.a + y * m.c + m.tx;\n\t\tvar y0 = x * m.b + y * m.d + m.ty;\n\t\tvar x1 = xW * m.a + y * m.c + m.tx;\n\t\tvar y1 = xW * m.b + y * m.d + m.ty;\n\t\tvar x2 = x * m.a + yH * m.c + m.tx;\n\t\tvar y2 = x * m.b + yH * m.d + m.ty;\n\t\tvar x3 = xW * m.a + yH * m.c + m.tx;\n\t\tvar y3 = xW * m.b + yH * m.d + m.ty;\n\n\t\tvar manager = this._manager;\n\t\tmanager.activate(this);\n\t\tvar drawIndex = manager.addToBatch(this.stack.state, -1);\n\n\t\t// TODO: remove private access to _vertices\n\t\tvar vc = manager._vertices;\n\t\tvar i = drawIndex * 6 * 4;\n\n\t\tvc[i + 0] = x0;\n\t\tvc[i + 1] = y0;\n\t\tvc[i + 4] = this.globalAlpha;\n\n\t\tvc[i + 6] = x1;\n\t\tvc[i + 7] = y1;\n\t\tvc[i + 10] = this.globalAlpha;\n\n\t\tvc[i + 12] = x2;\n\t\tvc[i + 13] = y2;\n\t\tvc[i + 16] = this.globalAlpha;\n\n\t\tvc[i + 18] = x3;\n\t\tvc[i + 19] = y3;\n\t\tvc[i + 22] = this.globalAlpha;\n\n\t\tvar fillColor = getColor(this.stack.state.fillStyle);\n\t\tvar ci = drawIndex * 4 * STRIDE;\n\t\tvar cc = manager._colors;\n\t\tcc[ci + 20] = cc[ci + 44] = cc[ci + 68] = cc[ci + 92] = fillColor.r; // R\n\t\tcc[ci + 21] = cc[ci + 45] = cc[ci + 69] = cc[ci + 93] = fillColor.g; // G\n\t\tcc[ci + 22] = cc[ci + 46] = cc[ci + 70] = cc[ci + 94] = fillColor.b; // B\n\t\tcc[ci + 23] = cc[ci + 47] = cc[ci + 71] = cc[ci + 95] = fillColor.a * 255; // A\n\t};\n\n\tthis.deleteTextureForImage = function(canvas) {\n\t\tif (!this._manager.gl) { return; }\n\t\tthis._manager.deleteTextureById(canvas.__GL_ID);\n\t};\n\n});\n\nexports = new GLManager();\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/TextManager.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/TextManager.js","friendlyPath":".TextManager","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/","filename":"TextManager.js","src":"jsio('from util.browser import $');\njsio('import timer');\n\njsio('import .FontLoader');\njsio('import ui.resource.Font as Font');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_webgl_TextManager=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_webgl_TextManager(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_webgl_TextManager(){return this.init&&this.init.apply(this,arguments)},function () {\n\n  var MAX_BUFFERS = 500;\n\n  this.init = function () {\n    this._buffers = {};\n    this._numBuffers = 0;\n  };\n\n  this.get = function (ctx, text, stroked) {\n    var font = ctx.font;\n    var fontData = Font.parse(font);\n    if (!isFontLoaded(fontData.getOrigName())) { return; }\n\n    var key = (stroked\n          ? ctx.lineWidth + '|' + ctx.strokeStyle + '|'\n          : '-|' + ctx.fillStyle)\n      + '|' + font + '|' + text;\n\n    if (!this._buffers[key]) {\n      if (this._numBuffers > MAX_BUFFERS) {\n        var oldest = Infinity;\n        var oldestKey = null;\n        for (var key in this._buffers) {\n          var lastUsed = this._buffers[key].lastUsed;\n          if (lastUsed < oldest) {\n            oldest = lastUsed;\n            oldestKey = key;\n          }\n        }\n\n        ctx.deleteTextureForImage(this._buffers[oldestKey].canvas);\n        delete this._buffers[oldestKey];\n      } else {\n        ++this._numBuffers;\n      }\n\n      var canvas = document.createElement('canvas');\n      canvas.complete = true;\n      this._buffers[key] = {\n        lastUsed: 0,\n        image: canvas,\n        metrics: this._render(canvas, text, font, stroked, ctx.fillStyle, ctx.strokeStyle, ctx.lineWidth)\n      };\n    }\n\n    this._buffers[key].lastUsed = timer.now;\n    return this._buffers[key];\n  };\n\n  this._render = function (canvas, text, font, stroked, fillStyle, strokeStyle, lineWidth) {\n    var ctx = canvas.getContext('2d');\n    var metrics = getTextHeight(font);\n\n    ctx.font = font;\n\n    canvas.width = ctx.measureText(text).width + lineWidth;\n    canvas.height = metrics.height + lineWidth;\n\n    ctx.textBaseline = 'top';\n    ctx.font = font;\n    if (stroked) {\n      ctx.strokeStyle = strokeStyle;\n      ctx.lineWidth = lineWidth;\n      ctx.strokeText(text, lineWidth / 2, lineWidth / 2);\n    } else {\n      ctx.fillStyle = fillStyle;\n      ctx.fillText(text, 0, 0);\n    }\n\n    return metrics;\n  };\n});\n\nvar heightMeasure = document.body.appendChild(document.createElement('div'));\nvar contents = heightMeasure.appendChild(document.createElement('span'));\n$.setText(contents, 'Hg');\nvar baselineDiv = heightMeasure.appendChild(document.createElement('div'));\nbaselineDiv.style.cssText = 'display: inline-block; width: 1px; height: 0px; vertical-align: baseline';\nvar bottomDiv = heightMeasure.appendChild(document.createElement('div'));\nbottomDiv.style.cssText = 'display: inline-block; width: 1px; height: 0px; vertical-align: bottom';\nheightMeasure.style.cssText = 'position: absolute; top: 0px; left: -1000px; visibility: hidden; pointer-events: none';\n\nvar _fontHeightCache = {};\nfunction getTextHeight (font) {\n  if (!_fontHeightCache[font]) {\n    heightMeasure.style.font = font;\n    var metrics = {\n      ascent: baselineDiv.getBoundingClientRect().top,\n      height: bottomDiv.getBoundingClientRect().top,\n      descent: 0\n    };\n\n    metrics.descent = metrics.height - metrics.ascent;\n    _fontHeightCache[font] = metrics;\n  }\n\n  return _fontHeightCache[font];\n}\n\nvar isFontLoaded = (function () {\n  var FONT_LOADER_TIMEOUT = 30 * 1000;\n  var _loaded = {};\n  var _loading = {};\n\n  function _checkFont(font) {\n    _loading[font] = true;\n\n    new FontLoader([font], {\n      fontLoaded: function () {\n        _loaded[font] = true;\n      },\n      fontsLoaded: function (err) {\n        if (err) {\n          console.error(err);\n        }\n      }\n    }, FONT_LOADER_TIMEOUT).loadFonts();\n  }\n\n  return function isFontLoaded(font) {\n    if (!_loading[font]) {\n      _checkFont(font);\n    }\n\n    return _loaded[font];\n  };\n})();\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/FontLoader.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/FontLoader.js","friendlyPath":".FontLoader","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/","filename":"FontLoader.js","src":"// https://github.com/smnh/FontLoader/blob/master/FontLoader.js\n\n/* globals define, exports, module */\n\n(function(root, definition) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define([], definition);\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but only CommonJS-like \n    // environments that support module.exports, like Node.\n    module.exports = definition();\n  } else {\n    // Browser globals (root is window)\n    root.FontLoader = definition();\n  }\n}(window, function() {\n  \n  var isIE = /MSIE/i.test(navigator.userAgent),\n    ieVer = null;\n  \n  // Get Internet Explorer version\n  if (isIE) {\n    var re, result;\n    re = new RegExp(\"MSIE ([0-9]{1,}[.0-9]{0,})\");\n    result = re.exec(navigator.userAgent);\n    if (result !== null) {\n      ieVer = parseFloat(result[1]);\n    }\n  }\n\n    /**\n     * @typedef {Object} FontDescriptor\n     * @property {String} family\n     * @property {String} weight\n     * @property {String} style\n     */\n\n  /**\n   * FontLoader detects when web fonts specified in the \"fontFamiliesArray\" array were loaded and rendered. Then it\n   * notifies the specified delegate object via \"fontLoaded\" and \"complete\" methods when specific or all fonts were\n   * loaded respectively. The use of this functions implies that the insertion of specified web fonts into the\n   * document is done elsewhere.\n   *\n     * The fonts parameter may be an array of strings specifying the font-families with optionally specified font\n     * variations using FVD notation or font descriptor objects of the following type:\n     * {\n     *     family: \"fontFamily\",\n     *     weight: 400,\n     *     style: 'normal'\n     * }\n     * Where styles may ne one of the following: normal, bold, italic or oblique. If only string is specified, the\n     * default used weight and style are 400 and 'normal' respectively.\n     *\n   * If all the specified fonts were loaded before the timeout was reached, the \"complete\" delegate method will be\n     * invoked with \"null\" error parameter. Otherwise, if timeout was reached before all specified fonts were loaded,\n     * the \"complete\" method will be invoked with an error object with two fields: the \"message\" string and the\n     * \"notLoadedFonts\" array of FontDescriptor objects of all the fonts that weren't loaded.\n   *\n   * @param {Array.<String|FontDescriptor>} fonts   Array of font-family strings or font descriptor objects.\n   * @param {Object}        delegate                Delegate object whose callback methods will be invoked in its own context.\n   * @param {Function}      [delegate.complete]     Called when all fonts were loaded or the timeout was reached.\n   * @param {Function}      [delegate.fontLoaded]   Called for each loaded font with its font-family string as its single parameter.\n   * @param {Number}        [timeout=3000]          Timeout in milliseconds. Pass \"null\" to disable timeout.\n   * @param {HTMLDocument}  [contextDocument]       The DOM tree context to use, if none provided then it will be the document.\n   * @constructor\n   */\n  function FontLoader(fonts, delegate, timeout, contextDocument) {\n    // Public\n    this.delegate = delegate;\n    this.timeout = (typeof timeout !== \"undefined\") ? timeout : 3000;\n\n    // Private\n        this._fontsArray = this._parseFonts(fonts);\n    this._testDiv = null;\n    this._testContainer = null;\n    this._adobeBlankSizeWatcher = null;\n    this._sizeWatchers = [];\n    this._timeoutId = null;\n    this._intervalId = null;\n    this._intervalDelay = 50;\n    this._numberOfLoadedFonts = 0;\n    this._numberOfFonts = this._fontsArray.length;\n    this._fontsMap = {};\n    this._finished = false;\n    this._document = contextDocument || document;\n  }\n\n  FontLoader.useAdobeBlank = !isIE || ieVer >= 11.0;\n  FontLoader.useResizeEvent = isIE && ieVer < 11.0 && typeof document.attachEvent !== \"undefined\";\n  FontLoader.useIntervalChecking = window.opera || (isIE && ieVer < 11.0 && !FontLoader.useResizeEvent);\n  FontLoader.referenceText = \" !\\\"\\\\#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~\";\n  FontLoader.referenceFontFamilies = FontLoader.useAdobeBlank ? [\"AdobeBlank\"] : [\"serif\", \"cursive\"];\n    FontLoader.adobeBlankFontFaceStyleId = \"fontLoaderAdobeBlankFontFace\";\n    FontLoader.adobeBlankReferenceSize = null;\n  FontLoader.referenceFontFamilyVariationSizes = {};\n  FontLoader.adobeBlankFontFaceRule = \"@font-face{ font-family:AdobeBlank; src:url('data:font/opentype;base64,T1RUTwAKAIAAAwAgQ0ZGIM6ZbkwAAEPEAAAZM0RTSUcAAAABAABtAAAAAAhPUy8yAR6vMwAAARAAAABgY21hcDqI98oAACjEAAAa4GhlYWT+BQILAAAArAAAADZoaGVhCCID7wAAAOQAAAAkaG10eAPoAHwAAFz4AAAQBm1heHAIAVAAAAABCAAAAAZuYW1lD/tWxwAAAXAAACdScG9zdP+4ADIAAEOkAAAAIAABAAAAAQj1Snw1O18PPPUAAwPoAAAAAM2C2p8AAAAAzYLanwB8/4gDbANwAAAAAwACAAAAAAAAAAEAAANw/4gAyAPoAHwAfANsAAEAAAAAAAAAAAAAAAAAAAACAABQAAgBAAAABAAAAZAABQAAAooCWAAAAEsCigJYAAABXgAyANwAAAAAAAAAAAAAAAD3/67/+9///w/gAD8AAAAAQURCRQHAAAD//wNw/4gAyANwAHhgLwH/AAAAAAAAAAAAAAAgAAAAAAARANIAAQAAAAAAAQALAAAAAQAAAAAAAgAHAAsAAQAAAAAAAwAbABIAAQAAAAAABAALAAAAAQAAAAAABQA5AC0AAQAAAAAABgAKAGYAAwABBAkAAABuAHAAAwABBAkAAQAWAN4AAwABBAkAAgAOAPQAAwABBAkAAwA2AQIAAwABBAkABAAWAN4AAwABBAkABQByATgAAwABBAkABgAUAaoAAwABBAkACAA0Ab4AAwABBAkACwA0AfIAAwABBAkADSQSAiYAAwABBAkADgBIJjhBZG9iZSBCbGFua1JlZ3VsYXIxLjAzNTtBREJFO0Fkb2JlQmxhbms7QURPQkVWZXJzaW9uIDEuMDM1O1BTIDEuMDAzO2hvdGNvbnYgMS4wLjcwO21ha2VvdGYubGliMi41LjU5MDBBZG9iZUJsYW5rAKkAIAAyADAAMQAzACAAQQBkAG8AYgBlACAAUwB5AHMAdABlAG0AcwAgAEkAbgBjAG8AcgBwAG8AcgBhAHQAZQBkAC4AIABBAGwAbAAgAFIAaQBnAGgAdABzACAAUgBlAHMAZQByAHYAZQBkAC4AQQBkAG8AYgBlACAAQgBsAGEAbgBrAFIAZQBnAHUAbABhAHIAMQAuADAAMwA1ADsAQQBEAEIARQA7AEEAZABvAGIAZQBCAGwAYQBuAGsAOwBBAEQATwBCAEUAVgBlAHIAcwBpAG8AbgAgADEALgAwADMANQA7AFAAUwAgADEALgAwADAAMwA7AGgAbwB0AGMAbwBuAHYAIAAxAC4AMAAuADcAMAA7AG0AYQBrAGUAbwB0AGYALgBsAGkAYgAyAC4ANQAuADUAOQAwADAAQQBkAG8AYgBlAEIAbABhAG4AawBBAGQAbwBiAGUAIABTAHkAcwB0AGUAbQBzACAASQBuAGMAbwByAHAAbwByAGEAdABlAGQAaAB0AHQAcAA6AC8ALwB3AHcAdwAuAGEAZABvAGIAZQAuAGMAbwBtAC8AdAB5AHAAZQAvAEEAZABvAGIAZQAgAEIAbABhAG4AawAgAGkAcwAgAHIAZQBsAGUAYQBzAGUAZAAgAHUAbgBkAGUAcgAgAHQAaABlACAAUwBJAEwAIABPAHAAZQBuACAARgBvAG4AdAAgAEwAaQBjAGUAbgBzAGUAIAAtACAAcABsAGUAYQBzAGUAIAByAGUAYQBkACAAaQB0ACAAYwBhAHIAZQBmAHUAbABsAHkAIABhAG4AZAAgAGQAbwAgAG4AbwB0ACAAZABvAHcAbgBsAG8AYQBkACAAdABoAGUAIABmAG8AbgB0AHMAIAB1AG4AbABlAHMAcwAgAHkAbwB1ACAAYQBnAHIAZQBlACAAdABvACAAdABoAGUAIAB0AGgAZQAgAHQAZQByAG0AcwAgAG8AZgAgAHQAaABlACAAbABpAGMAZQBuAHMAZQA6AA0ACgANAAoAQwBvAHAAeQByAGkAZwBoAHQAIACpACAAMgAwADEAMwAgAEEAZABvAGIAZQAgAFMAeQBzAHQAZQBtAHMAIABJAG4AYwBvAHIAcABvAHIAYQB0AGUAZAAgACgAaAB0AHQAcAA6AC8ALwB3AHcAdwAuAGEAZABvAGIAZQAuAGMAbwBtAC8AKQAsACAAdwBpAHQAaAAgAFIAZQBzAGUAcgB2AGUAZAAgAEYAbwBuAHQAIABOAGEAbQBlACAAQQBkAG8AYgBlACAAQgBsAGEAbgBrAA0ACgANAAoAVABoAGkAcwAgAEYAbwBuAHQAIABTAG8AZgB0AHcAYQByAGUAIABpAHMAIABsAGkAYwBlAG4AcwBlAGQAIAB1AG4AZABlAHIAIAB0AGgAZQAgAFMASQBMACAATwBwAGUAbgAgAEYAbwBuAHQAIABMAGkAYwBlAG4AcwBlACwAIABWAGUAcgBzAGkAbwBuACAAMQAuADEALgANAAoADQAKAFQAaABpAHMAIABsAGkAYwBlAG4AcwBlACAAaQBzACAAYwBvAHAAaQBlAGQAIABiAGUAbABvAHcALAAgAGEAbgBkACAAaQBzACAAYQBsAHMAbwAgAGEAdgBhAGkAbABhAGIAbABlACAAdwBpAHQAaAAgAGEAIABGAEEAUQAgAGEAdAA6ACAAaAB0AHQAcAA6AC8ALwBzAGMAcgBpAHAAdABzAC4AcwBpAGwALgBvAHIAZwAvAE8ARgBMAA0ACgANAAoALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAA0ACgBTAEkATAAgAE8AUABFAE4AIABGAE8ATgBUACAATABJAEMARQBOAFMARQAgAFYAZQByAHMAaQBvAG4AIAAxAC4AMQAgAC0AIAAyADYAIABGAGUAYgByAHUAYQByAHkAIAAyADAAMAA3AA0ACgAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ALQAtAC0ADQAKAA0ACgBQAFIARQBBAE0AQgBMAEUADQAKAFQAaABlACAAZwBvAGEAbABzACAAbwBmACAAdABoAGUAIABPAHAAZQBuACAARgBvAG4AdAAgAEwAaQBjAGUAbgBzAGUAIAAoAE8ARgBMACkAIABhAHIAZQAgAHQAbwAgAHMAdABpAG0AdQBsAGEAdABlACAAdwBvAHIAbABkAHcAaQBkAGUAIABkAGUAdgBlAGwAbwBwAG0AZQBuAHQAIABvAGYAIABjAG8AbABsAGEAYgBvAHIAYQB0AGkAdgBlACAAZgBvAG4AdAAgAHAAcgBvAGoAZQBjAHQAcwAsACAAdABvACAAcwB1AHAAcABvAHIAdAAgAHQAaABlACAAZgBvAG4AdAAgAGMAcgBlAGEAdABpAG8AbgAgAGUAZgBmAG8AcgB0AHMAIABvAGYAIABhAGMAYQBkAGUAbQBpAGMAIABhAG4AZAAgAGwAaQBuAGcAdQBpAHMAdABpAGMAIABjAG8AbQBtAHUAbgBpAHQAaQBlAHMALAAgAGEAbgBkACAAdABvACAAcAByAG8AdgBpAGQAZQAgAGEAIABmAHIAZQBlACAAYQBuAGQAIABvAHAAZQBuACAAZgByAGEAbQBlAHcAbwByAGsAIABpAG4AIAB3AGgAaQBjAGgAIABmAG8AbgB0AHMAIABtAGEAeQAgAGIAZQAgAHMAaABhAHIAZQBkACAAYQBuAGQAIABpAG0AcAByAG8AdgBlAGQAIABpAG4AIABwAGEAcgB0AG4AZQByAHMAaABpAHAAIAB3AGkAdABoACAAbwB0AGgAZQByAHMALgANAAoADQAKAFQAaABlACAATwBGAEwAIABhAGwAbABvAHcAcwAgAHQAaABlACAAbABpAGMAZQBuAHMAZQBkACAAZgBvAG4AdABzACAAdABvACAAYgBlACAAdQBzAGUAZAAsACAAcwB0AHUAZABpAGUAZAAsACAAbQBvAGQAaQBmAGkAZQBkACAAYQBuAGQAIAByAGUAZABpAHMAdAByAGkAYgB1AHQAZQBkACAAZgByAGUAZQBsAHkAIABhAHMAIABsAG8AbgBnACAAYQBzACAAdABoAGUAeQAgAGEAcgBlACAAbgBvAHQAIABzAG8AbABkACAAYgB5ACAAdABoAGUAbQBzAGUAbAB2AGUAcwAuACAAVABoAGUAIABmAG8AbgB0AHMALAAgAGkAbgBjAGwAdQBkAGkAbgBnACAAYQBuAHkAIABkAGUAcgBpAHYAYQB0AGkAdgBlACAAdwBvAHIAawBzACwAIABjAGEAbgAgAGIAZQAgAGIAdQBuAGQAbABlAGQALAAgAGUAbQBiAGUAZABkAGUAZAAsACAAcgBlAGQAaQBzAHQAcgBpAGIAdQB0AGUAZAAgAGEAbgBkAC8AbwByACAAcwBvAGwAZAAgAHcAaQB0AGgAIABhAG4AeQAgAHMAbwBmAHQAdwBhAHIAZQAgAHAAcgBvAHYAaQBkAGUAZAAgAHQAaABhAHQAIABhAG4AeQAgAHIAZQBzAGUAcgB2AGUAZAAgAG4AYQBtAGUAcwAgAGEAcgBlACAAbgBvAHQAIAB1AHMAZQBkACAAYgB5ACAAZABlAHIAaQB2AGEAdABpAHYAZQAgAHcAbwByAGsAcwAuACAAVABoAGUAIABmAG8AbgB0AHMAIABhAG4AZAAgAGQAZQByAGkAdgBhAHQAaQB2AGUAcwAsACAAaABvAHcAZQB2AGUAcgAsACAAYwBhAG4AbgBvAHQAIABiAGUAIAByAGUAbABlAGEAcwBlAGQAIAB1AG4AZABlAHIAIABhAG4AeQAgAG8AdABoAGUAcgAgAHQAeQBwAGUAIABvAGYAIABsAGkAYwBlAG4AcwBlAC4AIABUAGgAZQAgAHIAZQBxAHUAaQByAGUAbQBlAG4AdAAgAGYAbwByACAAZgBvAG4AdABzACAAdABvACAAcgBlAG0AYQBpAG4AIAB1AG4AZABlAHIAIAB0AGgAaQBzACAAbABpAGMAZQBuAHMAZQAgAGQAbwBlAHMAIABuAG8AdAAgAGEAcABwAGwAeQAgAHQAbwAgAGEAbgB5ACAAZABvAGMAdQBtAGUAbgB0ACAAYwByAGUAYQB0AGUAZAAgAHUAcwBpAG4AZwAgAHQAaABlACAAZgBvAG4AdABzACAAbwByACAAdABoAGUAaQByACAAZABlAHIAaQB2AGEAdABpAHYAZQBzAC4ADQAKAA0ACgBEAEUARgBJAE4ASQBUAEkATwBOAFMADQAKACIARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAiACAAcgBlAGYAZQByAHMAIAB0AG8AIAB0AGgAZQAgAHMAZQB0ACAAbwBmACAAZgBpAGwAZQBzACAAcgBlAGwAZQBhAHMAZQBkACAAYgB5ACAAdABoAGUAIABDAG8AcAB5AHIAaQBnAGgAdAAgAEgAbwBsAGQAZQByACgAcwApACAAdQBuAGQAZQByACAAdABoAGkAcwAgAGwAaQBjAGUAbgBzAGUAIABhAG4AZAAgAGMAbABlAGEAcgBsAHkAIABtAGEAcgBrAGUAZAAgAGEAcwAgAHMAdQBjAGgALgAgAFQAaABpAHMAIABtAGEAeQAgAGkAbgBjAGwAdQBkAGUAIABzAG8AdQByAGMAZQAgAGYAaQBsAGUAcwAsACAAYgB1AGkAbABkACAAcwBjAHIAaQBwAHQAcwAgAGEAbgBkACAAZABvAGMAdQBtAGUAbgB0AGEAdABpAG8AbgAuAA0ACgANAAoAIgBSAGUAcwBlAHIAdgBlAGQAIABGAG8AbgB0ACAATgBhAG0AZQAiACAAcgBlAGYAZQByAHMAIAB0AG8AIABhAG4AeQAgAG4AYQBtAGUAcwAgAHMAcABlAGMAaQBmAGkAZQBkACAAYQBzACAAcwB1AGMAaAAgAGEAZgB0AGUAcgAgAHQAaABlACAAYwBvAHAAeQByAGkAZwBoAHQAIABzAHQAYQB0AGUAbQBlAG4AdAAoAHMAKQAuAA0ACgANAAoAIgBPAHIAaQBnAGkAbgBhAGwAIABWAGUAcgBzAGkAbwBuACIAIAByAGUAZgBlAHIAcwAgAHQAbwAgAHQAaABlACAAYwBvAGwAbABlAGMAdABpAG8AbgAgAG8AZgAgAEYAbwBuAHQAIABTAG8AZgB0AHcAYQByAGUAIABjAG8AbQBwAG8AbgBlAG4AdABzACAAYQBzACAAZABpAHMAdAByAGkAYgB1AHQAZQBkACAAYgB5ACAAdABoAGUAIABDAG8AcAB5AHIAaQBnAGgAdAAgAEgAbwBsAGQAZQByACgAcwApAC4ADQAKAA0ACgAiAE0AbwBkAGkAZgBpAGUAZAAgAFYAZQByAHMAaQBvAG4AIgAgAHIAZQBmAGUAcgBzACAAdABvACAAYQBuAHkAIABkAGUAcgBpAHYAYQB0AGkAdgBlACAAbQBhAGQAZQAgAGIAeQAgAGEAZABkAGkAbgBnACAAdABvACwAIABkAGUAbABlAHQAaQBuAGcALAAgAG8AcgAgAHMAdQBiAHMAdABpAHQAdQB0AGkAbgBnACAALQAtACAAaQBuACAAcABhAHIAdAAgAG8AcgAgAGkAbgAgAHcAaABvAGwAZQAgAC0ALQAgAGEAbgB5ACAAbwBmACAAdABoAGUAIABjAG8AbQBwAG8AbgBlAG4AdABzACAAbwBmACAAdABoAGUAIABPAHIAaQBnAGkAbgBhAGwAIABWAGUAcgBzAGkAbwBuACwAIABiAHkAIABjAGgAYQBuAGcAaQBuAGcAIABmAG8AcgBtAGEAdABzACAAbwByACAAYgB5ACAAcABvAHIAdABpAG4AZwAgAHQAaABlACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAgAHQAbwAgAGEAIABuAGUAdwAgAGUAbgB2AGkAcgBvAG4AbQBlAG4AdAAuAA0ACgANAAoAIgBBAHUAdABoAG8AcgAiACAAcgBlAGYAZQByAHMAIAB0AG8AIABhAG4AeQAgAGQAZQBzAGkAZwBuAGUAcgAsACAAZQBuAGcAaQBuAGUAZQByACwAIABwAHIAbwBnAHIAYQBtAG0AZQByACwAIAB0AGUAYwBoAG4AaQBjAGEAbAAgAHcAcgBpAHQAZQByACAAbwByACAAbwB0AGgAZQByACAAcABlAHIAcwBvAG4AIAB3AGgAbwAgAGMAbwBuAHQAcgBpAGIAdQB0AGUAZAAgAHQAbwAgAHQAaABlACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAuAA0ACgANAAoAUABFAFIATQBJAFMAUwBJAE8ATgAgACYAIABDAE8ATgBEAEkAVABJAE8ATgBTAA0ACgBQAGUAcgBtAGkAcwBzAGkAbwBuACAAaQBzACAAaABlAHIAZQBiAHkAIABnAHIAYQBuAHQAZQBkACwAIABmAHIAZQBlACAAbwBmACAAYwBoAGEAcgBnAGUALAAgAHQAbwAgAGEAbgB5ACAAcABlAHIAcwBvAG4AIABvAGIAdABhAGkAbgBpAG4AZwAgAGEAIABjAG8AcAB5ACAAbwBmACAAdABoAGUAIABGAG8AbgB0ACAAUwBvAGYAdAB3AGEAcgBlACwAIAB0AG8AIAB1AHMAZQAsACAAcwB0AHUAZAB5ACwAIABjAG8AcAB5ACwAIABtAGUAcgBnAGUALAAgAGUAbQBiAGUAZAAsACAAbQBvAGQAaQBmAHkALAAgAHIAZQBkAGkAcwB0AHIAaQBiAHUAdABlACwAIABhAG4AZAAgAHMAZQBsAGwAIABtAG8AZABpAGYAaQBlAGQAIABhAG4AZAAgAHUAbgBtAG8AZABpAGYAaQBlAGQAIABjAG8AcABpAGUAcwAgAG8AZgAgAHQAaABlACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAsACAAcwB1AGIAagBlAGMAdAAgAHQAbwAgAHQAaABlACAAZgBvAGwAbABvAHcAaQBuAGcAIABjAG8AbgBkAGkAdABpAG8AbgBzADoADQAKAA0ACgAxACkAIABOAGUAaQB0AGgAZQByACAAdABoAGUAIABGAG8AbgB0ACAAUwBvAGYAdAB3AGEAcgBlACAAbgBvAHIAIABhAG4AeQAgAG8AZgAgAGkAdABzACAAaQBuAGQAaQB2AGkAZAB1AGEAbAAgAGMAbwBtAHAAbwBuAGUAbgB0AHMALAAgAGkAbgAgAE8AcgBpAGcAaQBuAGEAbAAgAG8AcgAgAE0AbwBkAGkAZgBpAGUAZAAgAFYAZQByAHMAaQBvAG4AcwAsACAAbQBhAHkAIABiAGUAIABzAG8AbABkACAAYgB5ACAAaQB0AHMAZQBsAGYALgANAAoADQAKADIAKQAgAE8AcgBpAGcAaQBuAGEAbAAgAG8AcgAgAE0AbwBkAGkAZgBpAGUAZAAgAFYAZQByAHMAaQBvAG4AcwAgAG8AZgAgAHQAaABlACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAgAG0AYQB5ACAAYgBlACAAYgB1AG4AZABsAGUAZAAsACAAcgBlAGQAaQBzAHQAcgBpAGIAdQB0AGUAZAAgAGEAbgBkAC8AbwByACAAcwBvAGwAZAAgAHcAaQB0AGgAIABhAG4AeQAgAHMAbwBmAHQAdwBhAHIAZQAsACAAcAByAG8AdgBpAGQAZQBkACAAdABoAGEAdAAgAGUAYQBjAGgAIABjAG8AcAB5ACAAYwBvAG4AdABhAGkAbgBzACAAdABoAGUAIABhAGIAbwB2AGUAIABjAG8AcAB5AHIAaQBnAGgAdAAgAG4AbwB0AGkAYwBlACAAYQBuAGQAIAB0AGgAaQBzACAAbABpAGMAZQBuAHMAZQAuACAAVABoAGUAcwBlACAAYwBhAG4AIABiAGUAIABpAG4AYwBsAHUAZABlAGQAIABlAGkAdABoAGUAcgAgAGEAcwAgAHMAdABhAG4AZAAtAGEAbABvAG4AZQAgAHQAZQB4AHQAIABmAGkAbABlAHMALAAgAGgAdQBtAGEAbgAtAHIAZQBhAGQAYQBiAGwAZQAgAGgAZQBhAGQAZQByAHMAIABvAHIAIABpAG4AIAB0AGgAZQAgAGEAcABwAHIAbwBwAHIAaQBhAHQAZQAgAG0AYQBjAGgAaQBuAGUALQByAGUAYQBkAGEAYgBsAGUAIABtAGUAdABhAGQAYQB0AGEAIABmAGkAZQBsAGQAcwAgAHcAaQB0AGgAaQBuACAAdABlAHgAdAAgAG8AcgAgAGIAaQBuAGEAcgB5ACAAZgBpAGwAZQBzACAAYQBzACAAbABvAG4AZwAgAGEAcwAgAHQAaABvAHMAZQAgAGYAaQBlAGwAZABzACAAYwBhAG4AIABiAGUAIABlAGEAcwBpAGwAeQAgAHYAaQBlAHcAZQBkACAAYgB5ACAAdABoAGUAIAB1AHMAZQByAC4ADQAKAA0ACgAzACkAIABOAG8AIABNAG8AZABpAGYAaQBlAGQAIABWAGUAcgBzAGkAbwBuACAAbwBmACAAdABoAGUAIABGAG8AbgB0ACAAUwBvAGYAdAB3AGEAcgBlACAAbQBhAHkAIAB1AHMAZQAgAHQAaABlACAAUgBlAHMAZQByAHYAZQBkACAARgBvAG4AdAAgAE4AYQBtAGUAKABzACkAIAB1AG4AbABlAHMAcwAgAGUAeABwAGwAaQBjAGkAdAAgAHcAcgBpAHQAdABlAG4AIABwAGUAcgBtAGkAcwBzAGkAbwBuACAAaQBzACAAZwByAGEAbgB0AGUAZAAgAGIAeQAgAHQAaABlACAAYwBvAHIAcgBlAHMAcABvAG4AZABpAG4AZwAgAEMAbwBwAHkAcgBpAGcAaAB0ACAASABvAGwAZABlAHIALgAgAFQAaABpAHMAIAByAGUAcwB0AHIAaQBjAHQAaQBvAG4AIABvAG4AbAB5ACAAYQBwAHAAbABpAGUAcwAgAHQAbwAgAHQAaABlACAAcAByAGkAbQBhAHIAeQAgAGYAbwBuAHQAIABuAGEAbQBlACAAYQBzACAAcAByAGUAcwBlAG4AdABlAGQAIAB0AG8AIAB0AGgAZQAgAHUAcwBlAHIAcwAuAA0ACgANAAoANAApACAAVABoAGUAIABuAGEAbQBlACgAcwApACAAbwBmACAAdABoAGUAIABDAG8AcAB5AHIAaQBnAGgAdAAgAEgAbwBsAGQAZQByACgAcwApACAAbwByACAAdABoAGUAIABBAHUAdABoAG8AcgAoAHMAKQAgAG8AZgAgAHQAaABlACAARgBvAG4AdAAgAFMAbwBmAHQAdwBhAHIAZQAgAHMAaABhAGwAbAAgAG4AbwB0ACAAYgBlACAAdQBzAGUAZAAgAHQAbwAgAHAAcgBvAG0AbwB0AGUALAAgAGUAbgBkAG8AcgBzAGUAIABvAHIAIABhAGQAdgBlAHIAdABpAHMAZQAgAGEAbgB5ACAATQBvAGQAaQBmAGkAZQBkACAAVgBlAHIAcwBpAG8AbgAsACAAZQB4AGMAZQBwAHQAIAB0AG8AIABhAGMAawBuAG8AdwBsAGUAZABnAGUAIAB0AGgAZQAgAGMAbwBuAHQAcgBpAGIAdQB0AGkAbwBuACgAcwApACAAbwBmACAAdABoAGUAIABDAG8AcAB5AHIAaQBnAGgAdAAgAEgAbwBsAGQAZQByACgAcwApACAAYQBuAGQAIAB0AGgAZQAgAEEAdQB0AGgAbwByACgAcwApACAAbwByACAAdwBpAHQAaAAgAHQAaABlAGkAcgAgAGUAeABwAGwAaQBjAGkAdAAgAHcAcgBpAHQAdABlAG4AIABwAGUAcgBtAGkAcwBzAGkAbwBuAC4ADQAKAA0ACgA1ACkAIABUAGgAZQAgAEYAbwBuAHQAIABTAG8AZgB0AHcAYQByAGUALAAgAG0AbwBkAGkAZgBpAGUAZAAgAG8AcgAgAHUAbgBtAG8AZABpAGYAaQBlAGQALAAgAGkAbgAgAHAAYQByAHQAIABvAHIAIABpAG4AIAB3AGgAbwBsAGUALAAgAG0AdQBzAHQAIABiAGUAIABkAGkAcwB0AHIAaQBiAHUAdABlAGQAIABlAG4AdABpAHIAZQBsAHkAIAB1AG4AZABlAHIAIAB0AGgAaQBzACAAbABpAGMAZQBuAHMAZQAsACAAYQBuAGQAIABtAHUAcwB0ACAAbgBvAHQAIABiAGUAIABkAGkAcwB0AHIAaQBiAHUAdABlAGQAIAB1AG4AZABlAHIAIABhAG4AeQAgAG8AdABoAGUAcgAgAGwAaQBjAGUAbgBzAGUALgAgAFQAaABlACAAcgBlAHEAdQBpAHIAZQBtAGUAbgB0ACAAZgBvAHIAIABmAG8AbgB0AHMAIAB0AG8AIAByAGUAbQBhAGkAbgAgAHUAbgBkAGUAcgAgAHQAaABpAHMAIABsAGkAYwBlAG4AcwBlACAAZABvAGUAcwAgAG4AbwB0ACAAYQBwAHAAbAB5ACAAdABvACAAYQBuAHkAIABkAG8AYwB1AG0AZQBuAHQAIABjAHIAZQBhAHQAZQBkACAAdQBzAGkAbgBnACAAdABoAGUAIABGAG8AbgB0ACAAUwBvAGYAdAB3AGEAcgBlAC4ADQAKAA0ACgBUAEUAUgBNAEkATgBBAFQASQBPAE4ADQAKAFQAaABpAHMAIABsAGkAYwBlAG4AcwBlACAAYgBlAGMAbwBtAGUAcwAgAG4AdQBsAGwAIABhAG4AZAAgAHYAbwBpAGQAIABpAGYAIABhAG4AeQAgAG8AZgAgAHQAaABlACAAYQBiAG8AdgBlACAAYwBvAG4AZABpAHQAaQBvAG4AcwAgAGEAcgBlACAAbgBvAHQAIABtAGUAdAAuAA0ACgANAAoARABJAFMAQwBMAEEASQBNAEUAUgANAAoAVABIAEUAIABGAE8ATgBUACAAUwBPAEYAVABXAEEAUgBFACAASQBTACAAUABSAE8AVgBJAEQARQBEACAAIgBBAFMAIABJAFMAIgAsACAAVwBJAFQASABPAFUAVAAgAFcAQQBSAFIAQQBOAFQAWQAgAE8ARgAgAEEATgBZACAASwBJAE4ARAAsACAARQBYAFAAUgBFAFMAUwAgAE8AUgAgAEkATQBQAEwASQBFAEQALAAgAEkATgBDAEwAVQBEAEkATgBHACAAQgBVAFQAIABOAE8AVAAgAEwASQBNAEkAVABFAEQAIABUAE8AIABBAE4AWQAgAFcAQQBSAFIAQQBOAFQASQBFAFMAIABPAEYAIABNAEUAUgBDAEgAQQBOAFQAQQBCAEkATABJAFQAWQAsACAARgBJAFQATgBFAFMAUwAgAEYATwBSACAAQQAgAFAAQQBSAFQASQBDAFUATABBAFIAIABQAFUAUgBQAE8AUwBFACAAQQBOAEQAIABOAE8ATgBJAE4ARgBSAEkATgBHAEUATQBFAE4AVAAgAE8ARgAgAEMATwBQAFkAUgBJAEcASABUACwAIABQAEEAVABFAE4AVAAsACAAVABSAEEARABFAE0AQQBSAEsALAAgAE8AUgAgAE8AVABIAEUAUgAgAFIASQBHAEgAVAAuACAASQBOACAATgBPACAARQBWAEUATgBUACAAUwBIAEEATABMACAAVABIAEUAIABDAE8AUABZAFIASQBHAEgAVAAgAEgATwBMAEQARQBSACAAQgBFACAATABJAEEAQgBMAEUAIABGAE8AUgAgAEEATgBZACAAQwBMAEEASQBNACwAIABEAEEATQBBAEcARQBTACAATwBSACAATwBUAEgARQBSACAATABJAEEAQgBJAEwASQBUAFkALAAgAEkATgBDAEwAVQBEAEkATgBHACAAQQBOAFkAIABHAEUATgBFAFIAQQBMACwAIABTAFAARQBDAEkAQQBMACwAIABJAE4ARABJAFIARQBDAFQALAAgAEkATgBDAEkARABFAE4AVABBAEwALAAgAE8AUgAgAEMATwBOAFMARQBRAFUARQBOAFQASQBBAEwAIABEAEEATQBBAEcARQBTACwAIABXAEgARQBUAEgARQBSACAASQBOACAAQQBOACAAQQBDAFQASQBPAE4AIABPAEYAIABDAE8ATgBUAFIAQQBDAFQALAAgAFQATwBSAFQAIABPAFIAIABPAFQASABFAFIAVwBJAFMARQAsACAAQQBSAEkAUwBJAE4ARwAgAEYAUgBPAE0ALAAgAE8AVQBUACAATwBGACAAVABIAEUAIABVAFMARQAgAE8AUgAgAEkATgBBAEIASQBMAEkAVABZACAAVABPACAAVQBTAEUAIABUAEgARQAgAEYATwBOAFQAIABTAE8ARgBUAFcAQQBSAEUAIABPAFIAIABGAFIATwBNACAATwBUAEgARQBSACAARABFAEEATABJAE4ARwBTACAASQBOACAAVABIAEUAIABGAE8ATgBUACAAUwBPAEYAVABXAEEAUgBFAC4ADQAKAGgAdAB0AHAAOgAvAC8AdwB3AHcALgBhAGQAbwBiAGUALgBjAG8AbQAvAHQAeQBwAGUALwBsAGUAZwBhAGwALgBoAHQAbQBsAAAAAAAFAAAAAwAAADgAAAAEAAABUAABAAAAAAAsAAMAAQAAADgAAwAKAAABUAAGAAwAAAAAAAEAAAAEARgAAABCAEAABQACB/8P/xf/H/8n/y//N/8//0f/T/9X/1//Z/9v/3f/f/+H/4//l/+f/6f/r/+3/7//x//P/9f/5//v//f//c///f//AAAAAAgAEAAYACAAKAAwADgAQABIAFAAWABgAGgAcAB4AIAAiACQAJgAoACoALAAuADAAMgA0ADgAOgA8AD4AP3w//8AAfgB8AHoAeAB2AHQAcgBwAG4AbABqAGgAZgBkAGIAYABeAFwAWgBYAFYAVABSAFAATgBMAEgARgBEAEIAQgBAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAZkAAAAAAAAAIgAAAAAAAAB/8AAAABAAAIAAAAD/8AAAABAAAQAAAAF/8AAAABAAAYAAAAH/8AAAABAAAgAAAAJ/8AAAABAAAoAAAAL/8AAAABAAAwAAAAN/8AAAABAAA4AAAAP/8AAAABAABAAAAAR/8AAAABAABIAAAAT/8AAAABAABQAAAAV/8AAAABAABYAAAAX/8AAAABAABgAAAAZ/8AAAABAABoAAAAb/8AAAABAABwAAAAd/8AAAABAAB4AAAAf/8AAAABAACAAAAAh/8AAAABAACIAAAAj/8AAAABAACQAAAAl/8AAAABAACYAAAAn/8AAAABAACgAAAAp/8AAAABAACoAAAAr/8AAAABAACwAAAAt/8AAAABAAC4AAAAv/8AAAABAADAAAAAx/8AAAABAADIAAAAz/8AAAABAADQAAAA1/8AAAABAADgAAAA5/8AAAABAADoAAAA7/8AAAABAADwAAAA9/8AAAABAAD4AAAA/c8AAAABAAD98AAA//0AAAXxAAEAAAABB/8AAAABAAEIAAABD/8AAAABAAEQAAABF/8AAAABAAEYAAABH/8AAAABAAEgAAABJ/8AAAABAAEoAAABL/8AAAABAAEwAAABN/8AAAABAAE4AAABP/8AAAABAAFAAAABR/8AAAABAAFIAAABT/8AAAABAAFQAAABV/8AAAABAAFYAAABX/8AAAABAAFgAAABZ/8AAAABAAFoAAABb/8AAAABAAFwAAABd/8AAAABAAF4AAABf/8AAAABAAGAAAABh/8AAAABAAGIAAABj/8AAAABAAGQAAABl/8AAAABAAGYAAABn/8AAAABAAGgAAABp/8AAAABAAGoAAABr/8AAAABAAGwAAABt/8AAAABAAG4AAABv/8AAAABAAHAAAABx/8AAAABAAHIAAABz/8AAAABAAHQAAAB1/8AAAABAAHYAAAB3/8AAAABAAHgAAAB5/8AAAABAAHoAAAB7/8AAAABAAHwAAAB9/8AAAABAAH4AAAB//0AAAABAAIAAAACB/8AAAABAAIIAAACD/8AAAABAAIQAAACF/8AAAABAAIYAAACH/8AAAABAAIgAAACJ/8AAAABAAIoAAACL/8AAAABAAIwAAACN/8AAAABAAI4AAACP/8AAAABAAJAAAACR/8AAAABAAJIAAACT/8AAAABAAJQAAACV/8AAAABAAJYAAACX/8AAAABAAJgAAACZ/8AAAABAAJoAAACb/8AAAABAAJwAAACd/8AAAABAAJ4AAACf/8AAAABAAKAAAACh/8AAAABAAKIAAACj/8AAAABAAKQAAACl/8AAAABAAKYAAACn/8AAAABAAKgAAACp/8AAAABAAKoAAACr/8AAAABAAKwAAACt/8AAAABAAK4AAACv/8AAAABAALAAAACx/8AAAABAALIAAACz/8AAAABAALQAAAC1/8AAAABAALYAAAC3/8AAAABAALgAAAC5/8AAAABAALoAAAC7/8AAAABAALwAAAC9/8AAAABAAL4AAAC//0AAAABAAMAAAADB/8AAAABAAMIAAADD/8AAAABAAMQAAADF/8AAAABAAMYAAADH/8AAAABAAMgAAADJ/8AAAABAAMoAAADL/8AAAABAAMwAAADN/8AAAABAAM4AAADP/8AAAABAANAAAADR/8AAAABAANIAAADT/8AAAABAANQAAADV/8AAAABAANYAAADX/8AAAABAANgAAADZ/8AAAABAANoAAADb/8AAAABAANwAAADd/8AAAABAAN4AAADf/8AAAABAAOAAAADh/8AAAABAAOIAAADj/8AAAABAAOQAAADl/8AAAABAAOYAAADn/8AAAABAAOgAAADp/8AAAABAAOoAAADr/8AAAABAAOwAAADt/8AAAABAAO4AAADv/8AAAABAAPAAAADx/8AAAABAAPIAAADz/8AAAABAAPQAAAD1/8AAAABAAPYAAAD3/8AAAABAAPgAAAD5/8AAAABAAPoAAAD7/8AAAABAAPwAAAD9/8AAAABAAP4AAAD//0AAAABAAQAAAAEB/8AAAABAAQIAAAED/8AAAABAAQQAAAEF/8AAAABAAQYAAAEH/8AAAABAAQgAAAEJ/8AAAABAAQoAAAEL/8AAAABAAQwAAAEN/8AAAABAAQ4AAAEP/8AAAABAARAAAAER/8AAAABAARIAAAET/8AAAABAARQAAAEV/8AAAABAARYAAAEX/8AAAABAARgAAAEZ/8AAAABAARoAAAEb/8AAAABAARwAAAEd/8AAAABAAR4AAAEf/8AAAABAASAAAAEh/8AAAABAASIAAAEj/8AAAABAASQAAAEl/8AAAABAASYAAAEn/8AAAABAASgAAAEp/8AAAABAASoAAAEr/8AAAABAASwAAAEt/8AAAABAAS4AAAEv/8AAAABAATAAAAEx/8AAAABAATIAAAEz/8AAAABAATQAAAE1/8AAAABAATYAAAE3/8AAAABAATgAAAE5/8AAAABAAToAAAE7/8AAAABAATwAAAE9/8AAAABAAT4AAAE//0AAAABAAUAAAAFB/8AAAABAAUIAAAFD/8AAAABAAUQAAAFF/8AAAABAAUYAAAFH/8AAAABAAUgAAAFJ/8AAAABAAUoAAAFL/8AAAABAAUwAAAFN/8AAAABAAU4AAAFP/8AAAABAAVAAAAFR/8AAAABAAVIAAAFT/8AAAABAAVQAAAFV/8AAAABAAVYAAAFX/8AAAABAAVgAAAFZ/8AAAABAAVoAAAFb/8AAAABAAVwAAAFd/8AAAABAAV4AAAFf/8AAAABAAWAAAAFh/8AAAABAAWIAAAFj/8AAAABAAWQAAAFl/8AAAABAAWYAAAFn/8AAAABAAWgAAAFp/8AAAABAAWoAAAFr/8AAAABAAWwAAAFt/8AAAABAAW4AAAFv/8AAAABAAXAAAAFx/8AAAABAAXIAAAFz/8AAAABAAXQAAAF1/8AAAABAAXYAAAF3/8AAAABAAXgAAAF5/8AAAABAAXoAAAF7/8AAAABAAXwAAAF9/8AAAABAAX4AAAF//0AAAABAAYAAAAGB/8AAAABAAYIAAAGD/8AAAABAAYQAAAGF/8AAAABAAYYAAAGH/8AAAABAAYgAAAGJ/8AAAABAAYoAAAGL/8AAAABAAYwAAAGN/8AAAABAAY4AAAGP/8AAAABAAZAAAAGR/8AAAABAAZIAAAGT/8AAAABAAZQAAAGV/8AAAABAAZYAAAGX/8AAAABAAZgAAAGZ/8AAAABAAZoAAAGb/8AAAABAAZwAAAGd/8AAAABAAZ4AAAGf/8AAAABAAaAAAAGh/8AAAABAAaIAAAGj/8AAAABAAaQAAAGl/8AAAABAAaYAAAGn/8AAAABAAagAAAGp/8AAAABAAaoAAAGr/8AAAABAAawAAAGt/8AAAABAAa4AAAGv/8AAAABAAbAAAAGx/8AAAABAAbIAAAGz/8AAAABAAbQAAAG1/8AAAABAAbYAAAG3/8AAAABAAbgAAAG5/8AAAABAAboAAAG7/8AAAABAAbwAAAG9/8AAAABAAb4AAAG//0AAAABAAcAAAAHB/8AAAABAAcIAAAHD/8AAAABAAcQAAAHF/8AAAABAAcYAAAHH/8AAAABAAcgAAAHJ/8AAAABAAcoAAAHL/8AAAABAAcwAAAHN/8AAAABAAc4AAAHP/8AAAABAAdAAAAHR/8AAAABAAdIAAAHT/8AAAABAAdQAAAHV/8AAAABAAdYAAAHX/8AAAABAAdgAAAHZ/8AAAABAAdoAAAHb/8AAAABAAdwAAAHd/8AAAABAAd4AAAHf/8AAAABAAeAAAAHh/8AAAABAAeIAAAHj/8AAAABAAeQAAAHl/8AAAABAAeYAAAHn/8AAAABAAegAAAHp/8AAAABAAeoAAAHr/8AAAABAAewAAAHt/8AAAABAAe4AAAHv/8AAAABAAfAAAAHx/8AAAABAAfIAAAHz/8AAAABAAfQAAAH1/8AAAABAAfYAAAH3/8AAAABAAfgAAAH5/8AAAABAAfoAAAH7/8AAAABAAfwAAAH9/8AAAABAAf4AAAH//0AAAABAAgAAAAIB/8AAAABAAgIAAAID/8AAAABAAgQAAAIF/8AAAABAAgYAAAIH/8AAAABAAggAAAIJ/8AAAABAAgoAAAIL/8AAAABAAgwAAAIN/8AAAABAAg4AAAIP/8AAAABAAhAAAAIR/8AAAABAAhIAAAIT/8AAAABAAhQAAAIV/8AAAABAAhYAAAIX/8AAAABAAhgAAAIZ/8AAAABAAhoAAAIb/8AAAABAAhwAAAId/8AAAABAAh4AAAIf/8AAAABAAiAAAAIh/8AAAABAAiIAAAIj/8AAAABAAiQAAAIl/8AAAABAAiYAAAIn/8AAAABAAigAAAIp/8AAAABAAioAAAIr/8AAAABAAiwAAAIt/8AAAABAAi4AAAIv/8AAAABAAjAAAAIx/8AAAABAAjIAAAIz/8AAAABAAjQAAAI1/8AAAABAAjYAAAI3/8AAAABAAjgAAAI5/8AAAABAAjoAAAI7/8AAAABAAjwAAAI9/8AAAABAAj4AAAI//0AAAABAAkAAAAJB/8AAAABAAkIAAAJD/8AAAABAAkQAAAJF/8AAAABAAkYAAAJH/8AAAABAAkgAAAJJ/8AAAABAAkoAAAJL/8AAAABAAkwAAAJN/8AAAABAAk4AAAJP/8AAAABAAlAAAAJR/8AAAABAAlIAAAJT/8AAAABAAlQAAAJV/8AAAABAAlYAAAJX/8AAAABAAlgAAAJZ/8AAAABAAloAAAJb/8AAAABAAlwAAAJd/8AAAABAAl4AAAJf/8AAAABAAmAAAAJh/8AAAABAAmIAAAJj/8AAAABAAmQAAAJl/8AAAABAAmYAAAJn/8AAAABAAmgAAAJp/8AAAABAAmoAAAJr/8AAAABAAmwAAAJt/8AAAABAAm4AAAJv/8AAAABAAnAAAAJx/8AAAABAAnIAAAJz/8AAAABAAnQAAAJ1/8AAAABAAnYAAAJ3/8AAAABAAngAAAJ5/8AAAABAAnoAAAJ7/8AAAABAAnwAAAJ9/8AAAABAAn4AAAJ//0AAAABAAoAAAAKB/8AAAABAAoIAAAKD/8AAAABAAoQAAAKF/8AAAABAAoYAAAKH/8AAAABAAogAAAKJ/8AAAABAAooAAAKL/8AAAABAAowAAAKN/8AAAABAAo4AAAKP/8AAAABAApAAAAKR/8AAAABAApIAAAKT/8AAAABAApQAAAKV/8AAAABAApYAAAKX/8AAAABAApgAAAKZ/8AAAABAApoAAAKb/8AAAABAApwAAAKd/8AAAABAAp4AAAKf/8AAAABAAqAAAAKh/8AAAABAAqIAAAKj/8AAAABAAqQAAAKl/8AAAABAAqYAAAKn/8AAAABAAqgAAAKp/8AAAABAAqoAAAKr/8AAAABAAqwAAAKt/8AAAABAAq4AAAKv/8AAAABAArAAAAKx/8AAAABAArIAAAKz/8AAAABAArQAAAK1/8AAAABAArYAAAK3/8AAAABAArgAAAK5/8AAAABAAroAAAK7/8AAAABAArwAAAK9/8AAAABAAr4AAAK//0AAAABAAsAAAALB/8AAAABAAsIAAALD/8AAAABAAsQAAALF/8AAAABAAsYAAALH/8AAAABAAsgAAALJ/8AAAABAAsoAAALL/8AAAABAAswAAALN/8AAAABAAs4AAALP/8AAAABAAtAAAALR/8AAAABAAtIAAALT/8AAAABAAtQAAALV/8AAAABAAtYAAALX/8AAAABAAtgAAALZ/8AAAABAAtoAAALb/8AAAABAAtwAAALd/8AAAABAAt4AAALf/8AAAABAAuAAAALh/8AAAABAAuIAAALj/8AAAABAAuQAAALl/8AAAABAAuYAAALn/8AAAABAAugAAALp/8AAAABAAuoAAALr/8AAAABAAuwAAALt/8AAAABAAu4AAALv/8AAAABAAvAAAALx/8AAAABAAvIAAALz/8AAAABAAvQAAAL1/8AAAABAAvYAAAL3/8AAAABAAvgAAAL5/8AAAABAAvoAAAL7/8AAAABAAvwAAAL9/8AAAABAAv4AAAL//0AAAABAAwAAAAMB/8AAAABAAwIAAAMD/8AAAABAAwQAAAMF/8AAAABAAwYAAAMH/8AAAABAAwgAAAMJ/8AAAABAAwoAAAML/8AAAABAAwwAAAMN/8AAAABAAw4AAAMP/8AAAABAAxAAAAMR/8AAAABAAxIAAAMT/8AAAABAAxQAAAMV/8AAAABAAxYAAAMX/8AAAABAAxgAAAMZ/8AAAABAAxoAAAMb/8AAAABAAxwAAAMd/8AAAABAAx4AAAMf/8AAAABAAyAAAAMh/8AAAABAAyIAAAMj/8AAAABAAyQAAAMl/8AAAABAAyYAAAMn/8AAAABAAygAAAMp/8AAAABAAyoAAAMr/8AAAABAAywAAAMt/8AAAABAAy4AAAMv/8AAAABAAzAAAAMx/8AAAABAAzIAAAMz/8AAAABAAzQAAAM1/8AAAABAAzYAAAM3/8AAAABAAzgAAAM5/8AAAABAAzoAAAM7/8AAAABAAzwAAAM9/8AAAABAAz4AAAM//0AAAABAA0AAAANB/8AAAABAA0IAAAND/8AAAABAA0QAAANF/8AAAABAA0YAAANH/8AAAABAA0gAAANJ/8AAAABAA0oAAANL/8AAAABAA0wAAANN/8AAAABAA04AAANP/8AAAABAA1AAAANR/8AAAABAA1IAAANT/8AAAABAA1QAAANV/8AAAABAA1YAAANX/8AAAABAA1gAAANZ/8AAAABAA1oAAANb/8AAAABAA1wAAANd/8AAAABAA14AAANf/8AAAABAA2AAAANh/8AAAABAA2IAAANj/8AAAABAA2QAAANl/8AAAABAA2YAAANn/8AAAABAA2gAAANp/8AAAABAA2oAAANr/8AAAABAA2wAAANt/8AAAABAA24AAANv/8AAAABAA3AAAANx/8AAAABAA3IAAANz/8AAAABAA3QAAAN1/8AAAABAA3YAAAN3/8AAAABAA3gAAAN5/8AAAABAA3oAAAN7/8AAAABAA3wAAAN9/8AAAABAA34AAAN//0AAAABAA4AAAAOB/8AAAABAA4IAAAOD/8AAAABAA4QAAAOF/8AAAABAA4YAAAOH/8AAAABAA4gAAAOJ/8AAAABAA4oAAAOL/8AAAABAA4wAAAON/8AAAABAA44AAAOP/8AAAABAA5AAAAOR/8AAAABAA5IAAAOT/8AAAABAA5QAAAOV/8AAAABAA5YAAAOX/8AAAABAA5gAAAOZ/8AAAABAA5oAAAOb/8AAAABAA5wAAAOd/8AAAABAA54AAAOf/8AAAABAA6AAAAOh/8AAAABAA6IAAAOj/8AAAABAA6QAAAOl/8AAAABAA6YAAAOn/8AAAABAA6gAAAOp/8AAAABAA6oAAAOr/8AAAABAA6wAAAOt/8AAAABAA64AAAOv/8AAAABAA7AAAAOx/8AAAABAA7IAAAOz/8AAAABAA7QAAAO1/8AAAABAA7YAAAO3/8AAAABAA7gAAAO5/8AAAABAA7oAAAO7/8AAAABAA7wAAAO9/8AAAABAA74AAAO//0AAAABAA8AAAAPB/8AAAABAA8IAAAPD/8AAAABAA8QAAAPF/8AAAABAA8YAAAPH/8AAAABAA8gAAAPJ/8AAAABAA8oAAAPL/8AAAABAA8wAAAPN/8AAAABAA84AAAPP/8AAAABAA9AAAAPR/8AAAABAA9IAAAPT/8AAAABAA9QAAAPV/8AAAABAA9YAAAPX/8AAAABAA9gAAAPZ/8AAAABAA9oAAAPb/8AAAABAA9wAAAPd/8AAAABAA94AAAPf/8AAAABAA+AAAAPh/8AAAABAA+IAAAPj/8AAAABAA+QAAAPl/8AAAABAA+YAAAPn/8AAAABAA+gAAAPp/8AAAABAA+oAAAPr/8AAAABAA+wAAAPt/8AAAABAA+4AAAPv/8AAAABAA/AAAAPx/8AAAABAA/IAAAPz/8AAAABAA/QAAAP1/8AAAABAA/YAAAP3/8AAAABAA/gAAAP5/8AAAABAA/oAAAP7/8AAAABAA/wAAAP9/8AAAABAA/4AAAP//0AAAABABAAAAAQB/8AAAABABAIAAAQD/8AAAABABAQAAAQF/8AAAABABAYAAAQH/8AAAABABAgAAAQJ/8AAAABABAoAAAQL/8AAAABABAwAAAQN/8AAAABABA4AAAQP/8AAAABABBAAAAQR/8AAAABABBIAAAQT/8AAAABABBQAAAQV/8AAAABABBYAAAQX/8AAAABABBgAAAQZ/8AAAABABBoAAAQb/8AAAABABBwAAAQd/8AAAABABB4AAAQf/8AAAABABCAAAAQh/8AAAABABCIAAAQj/8AAAABABCQAAAQl/8AAAABABCYAAAQn/8AAAABABCgAAAQp/8AAAABABCoAAAQr/8AAAABABCwAAAQt/8AAAABABC4AAAQv/8AAAABABDAAAAQx/8AAAABABDIAAAQz/8AAAABABDQAAAQ1/8AAAABABDYAAAQ3/8AAAABABDgAAAQ5/8AAAABABDoAAAQ7/8AAAABABDwAAAQ9/8AAAABABD4AAAQ//0AAAABAAMAAAAAAAD/tQAyAAAAAAAAAAAAAAAAAAAAAAAAAAABAAQCAAEBAQtBZG9iZUJsYW5rAAEBATD4G/gciwwe+B0B+B4Ci/sM+gD6BAUeGgA/DB8cCAEMIvdMD/dZEfdRDCUcGRYMJAAFAQEGDk1YZ0Fkb2JlSWRlbnRpdHlDb3B5cmlnaHQgMjAxMyBBZG9iZSBTeXN0ZW1zIEluY29ycG9yYXRlZC4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5BZG9iZSBCbGFua0Fkb2JlQmxhbmstMjA0OQAAAgABB/8DAAEAAAAIAQgBAgABAEsATABNAE4ATwBQAFEAUgBTAFQAVQBWAFcAWABZAFoAWwBcAF0AXgBfAGAAYQBiAGMAZABlAGYAZwBoAGkAagBrAGwAbQBuAG8AcABxAHIAcwB0AHUAdgB3AHgAeQB6AHsAfAB9AH4AfwCAAIEAggCDAIQAhQCGAIcAiACJAIoAiwCMAI0AjgCPAJAAkQCSAJMAlACVAJYAlwCYAJkAmgCbAJwAnQCeAJ8AoAChAKIAowCkAKUApgCnAKgAqQCqAKsArACtAK4ArwCwALEAsgCzALQAtQC2ALcAuAC5ALoAuwC8AL0AvgC/AMAAwQDCAMMAxADFAMYAxwDIAMkAygDLAMwAzQDOAM8A0ADRANIA0wDUANUA1gDXANgA2QDaANsA3ADdAN4A3wDgAOEA4gDjAOQA5QDmAOcA6ADpAOoA6wDsAO0A7gDvAPAA8QDyAPMA9AD1APYA9wD4APkA+gD7APwA/QD+AP8BAAEBAQIBAwEEAQUBBgEHAQgBCQEKAQsBDAENAQ4BDwEQAREBEgETARQBFQEWARcBGAEZARoBGwEcAR0BHgEfASABIQEiASMBJAElASYBJwEoASkBKgErASwBLQEuAS8BMAExATIBMwE0ATUBNgE3ATgBOQE6ATsBPAE9AT4BPwFAAUEBQgFDAUQBRQFGAUcBSAFJAUoBSwFMAU0BTgFPAVABUQFSAVMBVAFVAVYBVwFYAVkBWgFbAVwBXQFeAV8BYAFhAWIBYwFkAWUBZgFnAWgBaQFqAWsBbAFtAW4BbwFwAXEBcgFzAXQBdQF2AXcBeAF5AXoBewF8AX0BfgF/AYABgQGCAYMBhAGFAYYBhwGIAYkBigGLAYwBjQGOAY8BkAGRAZIBkwGUAZUBlgGXAZgBmQGaAZsBnAGdAZ4BnwGgAaEBogGjAaQBpQGmAacBqAGpAaoBqwGsAa0BrgGvAbABsQGyAbMBtAG1AbYBtwG4AbkBugG7AbwBvQG+Ab8BwAHBAcIBwwHEAcUBxgHHAcgByQHKAcsBzAHNAc4BzwHQAdEB0gHTAdQB1QHWAdcB2AHZAdoB2wHcAd0B3gHfAeAB4QHiAeMB5AHlAeYB5wHoAekB6gHrAewB7QHuAe8B8AHxAfIB8wH0AfUB9gH3AfgB+QH6AfsB/AH9Af4B/wIAAgECAgIDAgQCBQIGAgcCCAIJAgoCCwIMAg0CDgIPAhACEQISAhMCFAIVAhYCFwIYAhkCGgIbAhwCHQIeAh8CIAIhAiICIwIkAiUCJgInAigCKQIqAisCLAItAi4CLwIwAjECMgIzAjQCNQI2AjcCOAI5AjoCOwI8Aj0CPgI/AkACQQJCAkMCRAJFAkYCRwJIAkkCSgJLAkwCTQJOAk8CUAJRAlICUwJUAlUCVgJXAlgCWQJaAlsCXAJdAl4CXwJgAmECYgJjAmQCZQJmAmcCaAJpAmoCawJsAm0CbgJvAnACcQJyAnMCdAJ1AnYCdwJ4AnkCegJ7AnwCfQJ+An8CgAKBAoICgwKEAoUChgKHAogCiQKKAosCjAKNAo4CjwKQApECkgKTApQClQKWApcCmAKZApoCmwKcAp0CngKfAqACoQKiAqMCpAKlAqYCpwKoAqkCqgKrAqwCrQKuAq8CsAKxArICswK0ArUCtgK3ArgCuQK6ArsCvAK9Ar4CvwLAAsECwgLDAsQCxQLGAscCyALJAsoCywLMAs0CzgLPAtAC0QLSAtMC1ALVAtYC1wLYAtkC2gLbAtwC3QLeAt8C4ALhAuIC4wLkAuUC5gLnAugC6QLqAusC7ALtAu4C7wLwAvEC8gLzAvQC9QL2AvcC+AL5AvoC+wL8Av0C/gL/AwADAQMCAwMDBAMFAwYDBwMIAwkDCgMLAwwDDQMOAw8DEAMRAxIDEwMUAxUDFgMXAxgDGQMaAxsDHAMdAx4DHwMgAyEDIgMjAyQDJQMmAycDKAMpAyoDKwMsAy0DLgMvAzADMQMyAzMDNAM1AzYDNwM4AzkDOgM7AzwDPQM+Az8DQANBA0IDQwNEA0UDRgNHA0gDSQNKA0sDTANNA04DTwNQA1EDUgNTA1QDVQNWA1cDWANZA1oDWwNcA10DXgNfA2ADYQNiA2MDZANlA2YDZwNoA2kDagNrA2wDbQNuA28DcANxA3IDcwN0A3UDdgN3A3gDeQN6A3sDfAN9A34DfwOAA4EDggODA4QDhQOGA4cDiAOJA4oDiwOMA40DjgOPA5ADkQOSA5MDlAOVA5YDlwOYA5kDmgObA5wDnQOeA58DoAOhA6IDowOkA6UDpgOnA6gDqQOqA6sDrAOtA64DrwOwA7EDsgOzA7QDtQO2A7cDuAO5A7oDuwO8A70DvgO/A8ADwQPCA8MDxAPFA8YDxwPIA8kDygPLA8wDzQPOA88D0APRA9ID0wPUA9UD1gPXA9gD2QPaA9sD3APdA94D3wPgA+ED4gPjA+QD5QPmA+cD6APpA+oD6wPsA+0D7gPvA/AD8QPyA/MD9AP1A/YD9wP4A/kD+gP7A/wD/QP+A/8EAAQBBAIEAwQEBAUEBgQHBAgECQQKBAsEDAQNBA4EDwQQBBEEEgQTBBQEFQQWBBcEGAQZBBoEGwQcBB0EHgQfBCAEIQQiBCMEJAQlBCYEJwQoBCkEKgQrBCwELQQuBC8EMAQxBDIEMwQ0BDUENgQ3BDgEOQQ6BDsEPAQ9BD4EPwRABEEEQgRDBEQERQRGBEcESARJBEoESwRMBE0ETgRPBFAEUQRSBFMEVARVBFYEVwRYBFkEWgRbBFwEXQReBF8EYARhBGIEYwRkBGUEZgRnBGgEaQRqBGsEbARtBG4EbwRwBHEEcgRzBHQEdQR2BHcEeAR5BHoEewR8BH0EfgR/BIAEgQSCBIMEhASFBIYEhwSIBIkEigSLBIwEjQSOBI8EkASRBJIEkwSUBJUElgSXBJgEmQSaBJsEnASdBJ4EnwSgBKEEogSjBKQEpQSmBKcEqASpBKoEqwSsBK0ErgSvBLAEsQSyBLMEtAS1BLYEtwS4BLkEugS7BLwEvQS+BL8EwATBBMIEwwTEBMUExgTHBMgEyQTKBMsEzATNBM4EzwTQBNEE0gTTBNQE1QTWBNcE2ATZBNoE2wTcBN0E3gTfBOAE4QTiBOME5ATlBOYE5wToBOkE6gTrBOwE7QTuBO8E8ATxBPIE8wT0BPUE9gT3BPgE+QT6BPsE/AT9BP4E/wUABQEFAgUDBQQFBQUGBQcFCAUJBQoFCwUMBQ0FDgUPBRAFEQUSBRMFFAUVBRYFFwUYBRkFGgUbBRwFHQUeBR8FIAUhBSIFIwUkBSUFJgUnBSgFKQUqBSsFLAUtBS4FLwUwBTEFMgUzBTQFNQU2BTcFOAU5BToFOwU8BT0FPgU/BUAFQQVCBUMFRAVFBUYFRwVIBUkFSgVLBUwFTQVOBU8FUAVRBVIFUwVUBVUFVgVXBVgFWQVaBVsFXAVdBV4FXwVgBWEFYgVjBWQFZQVmBWcFaAVpBWoFawVsBW0FbgVvBXAFcQVyBXMFdAV1BXYFdwV4BXkFegV7BXwFfQV+BX8FgAWBBYIFgwWEBYUFhgWHBYgFiQWKBYsFjAWNBY4FjwWQBZEFkgWTBZQFlQWWBZcFmAWZBZoFmwWcBZ0FngWfBaAFoQWiBaMFpAWlBaYFpwWoBakFqgWrBawFrQWuBa8FsAWxBbIFswW0BbUFtgW3BbgFuQW6BbsFvAW9Bb4FvwXABcEFwgXDBcQFxQXGBccFyAXJBcoFywXMBc0FzgXPBdAF0QXSBdMF1AXVBdYF1wXYBdkF2gXbBdwF3QXeBd8F4AXhBeIF4wXkBeUF5gXnBegF6QXqBesF7AXtBe4F7wXwBfEF8gXzBfQF9QX2BfcF+AX5BfoF+wX8Bf0F/gX/BgAGAQYCBgMGBAYFBgYGBwYIBgkGCgYLBgwGDQYOBg8GEAYRBhIGEwYUBhUGFgYXBhgGGQYaBhsGHAYdBh4GHwYgBiEGIgYjBiQGJQYmBicGKAYpBioGKwYsBi0GLgYvBjAGMQYyBjMGNAY1BjYGNwY4BjkGOgY7BjwGPQY+Bj8GQAZBBkIGQwZEBkUGRgZHBkgGSQZKBksGTAZNBk4GTwZQBlEGUgZTBlQGVQZWBlcGWAZZBloGWwZcBl0GXgZfBmAGYQZiBmMGZAZlBmYGZwZoBmkGagZrBmwGbQZuBm8GcAZxBnIGcwZ0BnUGdgZ3BngGeQZ6BnsGfAZ9Bn4GfwaABoEGggaDBoQGhQaGBocGiAaJBooGiwaMBo0GjgaPBpAGkQaSBpMGlAaVBpYGlwaYBpkGmgabBpwGnQaeBp8GoAahBqIGowakBqUGpganBqgGqQaqBqsGrAatBq4GrwawBrEGsgazBrQGtQa2BrcGuAa5BroGuwa8Br0Gvga/BsAGwQbCBsMGxAbFBsYGxwbIBskGygbLBswGzQbOBs8G0AbRBtIG0wbUBtUG1gbXBtgG2QbaBtsG3AbdBt4G3wbgBuEG4gbjBuQG5QbmBucG6AbpBuoG6wbsBu0G7gbvBvAG8QbyBvMG9Ab1BvYG9wb4BvkG+gb7BvwG/Qb+Bv8HAAcBBwIHAwcEBwUHBgcHBwgHCQcKBwsHDAcNBw4HDwcQBxEHEgcTBxQHFQcWBxcHGAcZBxoHGwccBx0HHgcfByAHIQciByMHJAclByYHJwcoBykHKgcrBywHLQcuBy8HMAcxBzIHMwc0BzUHNgc3BzgHOQc6BzsHPAc9Bz4HPwdAB0EHQgdDB0QHRQdGB0cHSAdJB0oHSwdMB00HTgdPB1AHUQdSB1MHVAdVB1YHVwdYB1kHWgdbB1wHXQdeB18HYAdhB2IHYwdkB2UHZgdnB2gHaQdqB2sHbAdtB24HbwdwB3EHcgdzB3QHdQd2B3cHeAd5B3oHewd8B30Hfgd/B4AHgQeCB4MHhAeFB4YHhweIB4kHigeLB4wHjQeOB48HkAeRB5IHkweUB5UHlgeXB5gHmQeaB5sHnAedB54HnwegB6EHogejB6QHpQemB6cHqAepB6oHqwesB60HrgevB7AHsQeyB7MHtAe1B7YHtwe4B7kHuge7B7wHvQe+B78HwAfBB8IHwwfEB8UHxgfHB8gHyQfKB8sHzAfNB84HzwfQB9EH0gfTB9QH1QfWB9cH2AfZB9oH2wfcB90H3gffB+AH4QfiB+MH5AflB+YH5wfoB+kH6gfrB+wH7QfuB+8H8AfxB/IH8wf0B/UH9gf3B/gH+Qf6B/sH/Af9B/4H/wgACAEIAggDCAQIBQgGCAcICAgJCAoICwgMCA0IDggPCBAIEQgSCBMIFAgVCBYIFwgYCBkIGggbCBwIHQgeCB8IIAghCCIIIwgkCCUIJggnCCgIKQgqCCsILAgtCC4ILwgwCDEIMggzCDQINQg2CDcIOAg5CDoIOwg8CD0IPgg/CEAIQQhCCEMIRAhFCEYIRwhICEkISghLIPsMt/oktwH3ELf5LLcD9xD6BBX+fPmE+nwH/Vj+JxX50gf3xfwzBaawFfvF+DcF+PYGpmIV/dIH+8X4MwVwZhX3xfw3Bfz2Bg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODgABAQEK+B8MJpocGSQS+46LHAVGiwa9Cr0L+ucVAAPoAHwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAA') format('truetype'); }\";\n    FontLoader.fontStyleAliasesMap = {\"n\": \"normal\", \"b\": \"bold\", \"i\": \"italic\", \"o\": \"oblique\"};\n  \n  FontLoader.prototype = {\n    constructor: FontLoader,\n    loadFonts: function() {\n      var self = this,\n                newFontVariations;\n      \n      if (this._numberOfFonts === 0) {\n        this._finish();\n        return;\n      }\n      \n      if (this.timeout !== null) {\n        this._timeoutId = window.setTimeout(function timeoutFire() {\n          self._finish();\n        }, this.timeout);\n      }\n      \n      // Use constant line-height so there won't be changes in height because Adobe Blank uses zero width but not zero height.\n      this._testContainer = this._document.createElement(\"div\");\n      this._testContainer.style.cssText = \"position:absolute; left:-10000px; top:-10000px; white-space:nowrap; font-size:20px; line-height:20px; visibility:hidden;\";\n\n            // Create testDiv template that will be cloned for each font\n            this._testDiv = this._document.createElement(\"div\");\n            this._testDiv.style.position = \"absolute\";\n            this._testDiv.appendChild(this._document.createTextNode(FontLoader.referenceText));\n\n            if (!FontLoader.useAdobeBlank) {\n                // AdobeBlank is not used\n                // We need to extract dimensions of reference font-families for each requested font variation.\n                // The extracted dimensions are stored in a static property \"referenceFontFamilyVariationSizes\",\n                // so we might already have some or all of them all.\n                newFontVariations = this._getNewFontVariationsFromFonts(this._fontsArray);\n                if (newFontVariations.length) {\n                    this._extractReferenceFontSizes(newFontVariations);\n                }\n                this._loadFonts();\n            } else if (FontLoader.adobeBlankReferenceSize) {\n                // AdobeBlank is used, and was loaded\n                this._loadFonts();\n            } else {\n                // AdobeBlank is used but was not loaded\n                this._loadAdobeBlankFont();\n            }\n    },\n        _extractReferenceFontSizes: function(newFontVariations) {\n      var clonedDiv, j, i,\n                key, size, fontVariation;\n\n            clonedDiv = this._testDiv.cloneNode(true);\n            this._testContainer.appendChild(clonedDiv);\n            this._document.body.appendChild(this._testContainer);\n\n            for (i = 0; i < newFontVariations.length; i++) {\n                fontVariation = newFontVariations[i];\n                key = fontVariation.key;\n                FontLoader.referenceFontFamilyVariationSizes[key] = [];\n                for (j = 0; j < FontLoader.referenceFontFamilies.length; j++) {\n                    clonedDiv.style.fontFamily = FontLoader.referenceFontFamilies[j];\n                    clonedDiv.style.fontWeight = fontVariation.weight;\n                    clonedDiv.style.fontStyle = fontVariation.style;\n                    size = new Size(clonedDiv.offsetWidth, clonedDiv.offsetHeight);\n                    FontLoader.referenceFontFamilyVariationSizes[key].push(size);\n                }\n            }\n\n            this._testContainer.parentNode.removeChild(this._testContainer);\n            clonedDiv.parentNode.removeChild(clonedDiv);\n    },\n        _loadAdobeBlankFont: function() {\n            var self = this,\n                adobeBlankDiv,\n                adobeBlankFallbackFont = \"serif\";\n\n            this._addAdobeBlankFontFaceIfNeeded();\n\n            adobeBlankDiv = this._testDiv.cloneNode(true);\n            this._testContainer.appendChild(adobeBlankDiv);\n            this._document.body.appendChild(this._testContainer);\n\n            // When using AdobeBlank (all browsers except IE < 11) only interval checking and size watcher methods\n            // are available for watching element size.\n            if (FontLoader.useIntervalChecking) {\n                adobeBlankDiv.style.fontFamily = FontLoader.referenceFontFamilies[0] + \", \" + adobeBlankFallbackFont;\n                this._testContainer.appendChild(adobeBlankDiv);\n                // Start polling element sizes but also do first synchronous check in case all fonts where already loaded.\n                this._intervalId = window.setInterval(function intervalFire() {\n                    self._checkAdobeBlankSize();\n                }, this._intervalDelay);\n                this._checkAdobeBlankSize();\n            } else {\n                adobeBlankDiv.style.fontFamily = adobeBlankFallbackFont;\n                this._adobeBlankSizeWatcher = new SizeWatcher(/** @type HTMLElement */adobeBlankDiv, {\n                    container: this._testContainer,\n                    delegate: this,\n                    continuous: true,\n                    direction: SizeWatcher.directions.decrease,\n                    dimension: SizeWatcher.dimensions.horizontal,\n                    document: this._document\n                });\n                this._adobeBlankSizeWatcher.prepareForWatch();\n                this._adobeBlankSizeWatcher.beginWatching();\n                adobeBlankDiv.style.fontFamily = FontLoader.referenceFontFamilies[0] + \", \" + adobeBlankFallbackFont;\n            }\n        },\n        _getNewFontVariationsFromFonts: function(fonts) {\n            var font, key, i,\n                variations = [],\n                variationsMap = {};\n\n            for (i = 0; i < fonts.length; i++) {\n                font = fonts[i];\n                key = this._fontVariationKeyForFont(font);\n                if (!(key in variationsMap) && !(key in FontLoader.referenceFontFamilyVariationSizes)) {\n                    variationsMap[key] = true;\n                    variations.push({\n                        key: key,\n                        weight: font.weight,\n                        style: font.style\n                    });\n                }\n            }\n            return variations;\n        },\n    _parseFonts: function(fonts) {\n      var processedFonts = [];\n\n      fonts.forEach(function (font) {\n                if (typeof font === \"string\") {\n                    if (font.indexOf(':') > -1) {\n                        processedFonts = processedFonts.concat(this._convertShorthandToFontObjects(font));\n                    } else {\n                        processedFonts.push({\n                            family: font,\n                            weight: 400,\n                            style: 'normal'\n                        });\n                    }\n                } else if (this._isValidFontObject(font)) {\n                    processedFonts.push(font);\n                } else {\n                    throw new Error(\"Invalid font format\");\n                }\n      }, this);\n\n      return processedFonts;\n    },\n        /**\n         * @param {FontDescriptor} fontObject\n         * @returns {boolean}\n         * @private\n         */\n    _isValidFontObject: function(fontObject) {\n      if (!fontObject.family || !fontObject.weight || !fontObject.style) {\n        return false;\n      }\n      return ['normal', 'italic', 'bold', 'oblique'].indexOf(fontObject.style) !== -1;\n    },\n        /**\n         * @param {string} fontString\n         * @returns {Array.<FontDescriptor>}\n         * @private\n         */\n    _convertShorthandToFontObjects: function(fontString) {\n      var fonts = [],\n                parts = fontString.split(':'),\n          variants,\n          fontFamily;\n\n            fontFamily = parts[0];\n            variants = parts[1].split(',');\n\n      variants.forEach(function (variant) {\n                var styleAlias,\n                    weightAlias,\n                    weight,\n                    style;\n\n                if (variant.length !== 2) {\n                    throw new Error(\"Invalid Font Variation Description: '\" + variant + \"' for font string: '\" + fontString + \"'\");\n                }\n\n                styleAlias = variant[0];\n                weightAlias = variant[1];\n\n                if (styleAlias in FontLoader.fontStyleAliasesMap) {\n                    style = FontLoader.fontStyleAliasesMap[styleAlias];\n                } else {\n                    return;\n                }\n\n                weight = parseInt(weightAlias, 10);\n                if (isNaN(weight)) {\n                    return;\n                } else {\n                    weight *= 100;\n                }\n\n                fonts.push({\n          family: fontFamily,\n          weight: weight,\n          style: style\n        });\n      });\n\n      return fonts;\n    },\n        _addAdobeBlankFontFaceIfNeeded: function() {\n            var adobeBlankFontFaceStyle;\n            if (!this._document.getElementById(FontLoader.adobeBlankFontFaceStyleId)) {\n                adobeBlankFontFaceStyle = this._document.createElement(\"style\");\n                adobeBlankFontFaceStyle.setAttribute(\"type\", \"text/css\");\n                adobeBlankFontFaceStyle.setAttribute(\"id\", FontLoader.adobeBlankFontFaceStyleId);\n                adobeBlankFontFaceStyle.appendChild(this._document.createTextNode(FontLoader.adobeBlankFontFaceRule));\n                this._document.getElementsByTagName(\"head\")[0].appendChild(adobeBlankFontFaceStyle);\n            }\n        },\n    _checkAdobeBlankSize: function() {\n      var adobeBlankDiv = this._testContainer.firstChild;\n      this._adobeBlankLoaded(adobeBlankDiv);\n    },\n    _adobeBlankLoaded: function(adobeBlankDiv) {\n      // Prevent false size change, for example if AdobeBlank height is higher than fallback font.\n      if (adobeBlankDiv.offsetWidth !== 0) {\n        return;\n      }\n      \n      FontLoader.adobeBlankReferenceSize = new Size(adobeBlankDiv.offsetWidth, adobeBlankDiv.offsetHeight);\n      \n      if (this._adobeBlankSizeWatcher !== null) {\n        // SizeWatcher method\n        this._adobeBlankSizeWatcher.endWatching();\n        this._adobeBlankSizeWatcher.removeScrollWatchers();\n        this._adobeBlankSizeWatcher = null;\n      } else {\n        // Polling method (IE)\n        window.clearInterval(this._intervalId);\n        adobeBlankDiv.parentNode.removeChild(adobeBlankDiv);\n      }\n      \n      this._testContainer.parentNode.removeChild(this._testContainer);\n\n      this._loadFonts();\n    },\n    _cloneNodeSetStyleAndAttributes: function(font, fontKey, referenceFontFamilyIndex) {\n      var clonedDiv = this._testDiv.cloneNode(true);\n            clonedDiv.style.fontWeight = font.weight;\n            clonedDiv.style.fontStyle = font.style;\n            clonedDiv.setAttribute(\"data-font-map-key\", fontKey);\n      clonedDiv.setAttribute(\"data-ref-font-family-index\", String(referenceFontFamilyIndex));\n      return clonedDiv;\n    },\n        _getFontMapKeyFromElement: function(element) {\n            return element.getAttribute(\"data-font-map-key\");\n        },\n        _getFontFromElement: function(element) {\n            var fontKey = this._getFontMapKeyFromElement(element);\n            return this._fontsMap[fontKey];\n        },\n        _getFontFamilyFromElement: function(element) {\n            var font = this._getFontFromElement(element);\n            return font.family;\n        },\n        _getReferenceFontFamilyIndexFromElement: function(element) {\n            return element.getAttribute(\"data-ref-font-family-index\");\n        },\n        _getReferenceFontFamilyFromElement: function(element) {\n            var referenceFontFamilyIndex = this._getReferenceFontFamilyIndexFromElement(element);\n            return FontLoader.referenceFontFamilies[referenceFontFamilyIndex];\n        },\n        _fontVariationKeyForFont: function(font) {\n            return font.weight + font.style;\n        },\n        _fontsMapKeyForFont: function(font) {\n            return font.family + font.weight + font.style\n        },\n    _loadFonts: function() {\n      var i, j, clonedDiv, sizeWatcher,\n                font,\n                fontKey,\n                fontVariationKey,\n                referenceFontSize,\n                sizeWatcherDirection,\n                sizeWatcherDimension,\n        self = this;\n\n      // Add div for each font-family\n      for (i = 0; i < this._numberOfFonts; i++) {\n                font = this._fontsArray[i];\n                fontKey = this._fontsMapKeyForFont(font);\n        this._fontsMap[fontKey] = font;\n\n        for (j = 0; j < FontLoader.referenceFontFamilies.length; j++) {\n                    clonedDiv = this._cloneNodeSetStyleAndAttributes(font, fontKey, j);\n          if (FontLoader.useResizeEvent) {\n                        clonedDiv.style.fontFamily = FontLoader.referenceFontFamilies[j];\n                        this._testContainer.appendChild(clonedDiv);\n          } else if (FontLoader.useIntervalChecking) {\n            clonedDiv.style.fontFamily = \"'\" + font.family + \"', \" + FontLoader.referenceFontFamilies[j];\n                        this._testContainer.appendChild(clonedDiv);\n          } else {\n                        clonedDiv.style.fontFamily = FontLoader.referenceFontFamilies[j];\n                        if (FontLoader.useAdobeBlank) {\n                            referenceFontSize = FontLoader.adobeBlankReferenceSize;\n                            sizeWatcherDirection = SizeWatcher.directions.increase;\n                            sizeWatcherDimension = SizeWatcher.dimensions.horizontal;\n                        } else {\n                            fontVariationKey = this._fontVariationKeyForFont(font);\n                            referenceFontSize = FontLoader.referenceFontFamilyVariationSizes[fontVariationKey][j];\n                            sizeWatcherDirection = SizeWatcher.directions.both;\n                            sizeWatcherDimension = SizeWatcher.dimensions.both;\n                        }\n            sizeWatcher = new SizeWatcher(/** @type HTMLElement */clonedDiv, {\n              container: this._testContainer,\n              delegate: this,\n              size: referenceFontSize,\n              direction: sizeWatcherDirection,\n              dimension: sizeWatcherDimension,\n              document: this._document\n            });\n            // The prepareForWatch() and beginWatching() methods will be invoked in separate iterations to\n            // reduce number of browser's CSS recalculations.\n            this._sizeWatchers.push(sizeWatcher);\n          }\n        }\n      }\n\n      // Append the testContainer after all test elements to minimize DOM insertions\n      this._document.body.appendChild(this._testContainer);\n\n      if (FontLoader.useResizeEvent) {\n        for (j = 0; j < this._testContainer.childNodes.length; j++) {\n          clonedDiv = this._testContainer.childNodes[j];\n          // \"resize\" event works only with attachEvent\n          clonedDiv.attachEvent(\"onresize\", (function(self, clonedDiv) {\n            return function() {\n              self._elementSizeChanged(clonedDiv);\n            }\n          })(this, clonedDiv));\n        }\n        window.setTimeout(function() {\n          for (j = 0; j < self._testContainer.childNodes.length; j++) {\n            clonedDiv = self._testContainer.childNodes[j];\n            clonedDiv.style.fontFamily = \"'\" + self._getFontFamilyFromElement(clonedDiv) + \"', \" + self._getReferenceFontFamilyFromElement(clonedDiv);\n          }\n        }, 0);\n      } else if (FontLoader.useIntervalChecking) {\n        // Start polling element sizes but also do first synchronous check in case all fonts where already loaded.\n        this._intervalId = window.setInterval(function intervalFire() {\n          self._checkSizes();\n        }, this._intervalDelay);\n        this._checkSizes();\n      } else {\n        // We are dividing the prepareForWatch() and beginWatching() methods to optimize browser performance by\n        // removing CSS recalculation from each iteration to the end of iterations.\n                for (i = 0; i < this._sizeWatchers.length; i++) {\n                    sizeWatcher = this._sizeWatchers[i];\n                    sizeWatcher.prepareForWatch();\n                }\n                for (i = 0; i < this._sizeWatchers.length; i++) {\n                    sizeWatcher = this._sizeWatchers[i];\n                    sizeWatcher.beginWatching();\n                    // Apply tested font-family\n                    clonedDiv = sizeWatcher.getWatchedElement();\n                    clonedDiv.style.fontFamily = \"'\" + this._getFontFamilyFromElement(clonedDiv) + \"', \" + self._getReferenceFontFamilyFromElement(clonedDiv);\n                }\n      }\n    },\n    _checkSizes: function() {\n      var i, testDiv, font, fontVariationKey, currSize, refSize, refFontFamilyIndex;\n\n      for (i = this._testContainer.childNodes.length - 1; i >= 0; i--) {\n        testDiv = this._testContainer.childNodes[i];\n        currSize = new Size(testDiv.offsetWidth, testDiv.offsetHeight);\n                if (FontLoader.useAdobeBlank) {\n                    refSize = FontLoader.adobeBlankReferenceSize;\n                } else {\n                    font = this._getFontFromElement(testDiv);\n                    fontVariationKey = this._fontVariationKeyForFont(font);\n                    refFontFamilyIndex = this._getReferenceFontFamilyIndexFromElement(testDiv);\n                    refSize = FontLoader.referenceFontFamilyVariationSizes[fontVariationKey][refFontFamilyIndex];\n                }\n        if (!refSize.isEqual(currSize)) {\n          // Element dimensions changed, this means its font loaded, remove it from testContainer div\n          testDiv.parentNode.removeChild(testDiv);\n          this._elementSizeChanged(testDiv);\n        }\n      }\n    },\n    _elementSizeChanged: function(element) {\n      var font, fontKey;\n\n      if (this._finished) {\n        return;\n      }\n\n            fontKey = this._getFontMapKeyFromElement(element);\n\n      // Check that the font of this element wasn't already marked as loaded by an element with different reference font family.\n      if (typeof this._fontsMap[fontKey] === \"undefined\") {\n        return;\n      }\n\n            font = this._fontsMap[fontKey];\n\n      this._numberOfLoadedFonts++;\n      delete this._fontsMap[fontKey];\n\n      if (this.delegate && typeof this.delegate.fontLoaded === \"function\") {\n        this.delegate.fontLoaded(font);\n      }\n\n      if (this._numberOfLoadedFonts === this._numberOfFonts) {\n        this._finish();\n      }\n    },\n    _finish: function() {\n      var error, i, sizeWatcher,\n                fontKey,\n        notLoadedFonts = [];\n      \n      if (this._finished) {\n        return;\n      }\n      \n      this._finished = true;\n      \n      if (this._adobeBlankSizeWatcher !== null) {\n                if (this._adobeBlankSizeWatcher.getState() === SizeWatcher.states.watchingForSizeChange) {\n                    this._adobeBlankSizeWatcher.endWatching();\n                }\n        this._adobeBlankSizeWatcher = null;\n      }\n\n            for (i = 0; i < this._sizeWatchers.length; i++) {\n                sizeWatcher = this._sizeWatchers[i];\n                if (sizeWatcher.getState() === SizeWatcher.states.watchingForSizeChange) {\n                    sizeWatcher.endWatching();\n                }\n            }\n            this._sizeWatchers = [];\n      \n      if (this._testContainer !== null) {\n        this._testContainer.parentNode.removeChild(this._testContainer);\n      }\n      \n      if (this._timeoutId !== null) {\n        window.clearTimeout(this._timeoutId);\n      }\n      \n      if (this._intervalId !== null) {\n        window.clearInterval(this._intervalId);\n      }\n      \n            if (this.delegate) {\n                if (this._numberOfLoadedFonts < this._numberOfFonts) {\n                    for (fontKey in this._fontsMap) {\n                        if (this._fontsMap.hasOwnProperty(fontKey)) {\n                            notLoadedFonts.push(this._fontsMap[fontKey]);\n                        }\n                    }\n                    error = {\n                        message: \"Not all fonts were loaded (\" + this._numberOfLoadedFonts + \"/\" + this._numberOfFonts + \")\",\n                        notLoadedFonts: notLoadedFonts\n                    };\n                } else {\n                    error = null;\n                }\n                if (typeof this.delegate.complete === \"function\") {\n                    this.delegate.complete(error);\n                } else if (typeof this.delegate.fontsLoaded === \"function\") {\n                    this.delegate.fontsLoaded(error);\n                }\n            }\n    },\n    /**\n     * SizeWatcher delegate method\n     * @param {SizeWatcher} sizeWatcher\n     */\n    sizeWatcherChangedSize: function(sizeWatcher) {\n      var watchedElement = sizeWatcher.getWatchedElement();\n      if (sizeWatcher === this._adobeBlankSizeWatcher) {\n        this._adobeBlankLoaded(watchedElement);\n      } else {\n        this._elementSizeChanged(watchedElement);\n      }\n    }\n  };\n\n  /**\n   * Size object\n   *\n   * @param width\n   * @param height\n   * @constructor\n   */\n  function Size(width, height) {\n    this.width = width;\n    this.height = height;\n  }\n\n    Size.sizeFromString = function(sizeString) {\n        var arr = sizeString.split(\",\");\n        if (arr.length !== 2) {\n            return null;\n        }\n        return new Size(arr[0], arr[1]);\n    };\n\n  /**\n   * Compares receiver object to passed in size object.\n   * \n   * @param otherSize\n   * @returns {boolean}\n   */\n  Size.prototype.isEqual = function(otherSize) {\n    return (this.width === otherSize.width && this.height === otherSize.height);\n  };\n\n    Size.prototype.toString = function() {\n        return this.width + \",\" + this.height;\n    };\n\n  /**\n   * SizeWatcher observes size of an element and notifies when its size is changed. It doesn't use any timeouts\n   * to check the element size, when change in size occurs a callback method immediately invoked.\n   * \n   * To watch for element's size changes the element, and other required elements are appended to a container element\n   * you specify, and which must be added to the DOM tree before invoking prepareForWatch() method. Your container\n   * element should be positioned outside of client's visible area. Therefore you shouldn't use SizeWatcher to watch\n   * for size changes of elements used for UI.\n   * Such container element could be a simple <div> that is a child of the <body> element:\n   * <div style=\"position:absolute; left:-10000px; top:-10000px;\"></div>\n   * \n   * You must invoke SizeWatcher's methods in a specific order to establish size change listeners:\n   * \n   * 1. Create SizeWatcher instance by invoke SizeWatcher constructor passing the element (size of which you want to\n   *    observe), the container element, the delegate object and optional size parameter of type Size which should be\n   *    the pre-calculated initial size of your element.\n   * 4. Invoke prepareForWatch() method. This method will calculate element size if you didn't passed it to the constructor.\n   * 5. Invoke beginWatching() method. This method will set event listeners and invoke your delegate's method once\n   *    element size changes. \n   * \n   * Failing to invoke above methods in their predefined order will throw an exception.\n   * \n   * @param {HTMLElement}   element An element, size of which will be observed for changes.\n   * @param {Object}        options\n   * @param {HTMLElement}   options.container An element to which special observing elements will be added. Must be in DOM tree\n   *                        when prepareForWatch() method is called.\n   * @param {Object}        options.delegate A delegate object with a sizeWatcherChangedSize method which will be invoked, in\n   *                        context of the delegate object, when change in size occurs. This method is invoked with single\n   *                        parameter which is the current SizeWatcher instance.\n   * @param {Size}          [options.size] The pre-calculated initial size of your element. When passed, the element is not\n   *                        asked for offsetWidth and offsetHeight, which may be useful to reduce browser's CSS\n   *                        recalculations. If you will not pass the size parameter then its size calculation will be\n   *                        deferred to prepareForWatch() method.\n   * @param {Boolean}       [options.continuous=false] A boolean flag indicating if the SizeWatcher will watch only for\n   *                        the first size change (default) or will continuously watch for size changes.\n   * @param {Number}        [options.direction=SizeWatcher.directions.both] The direction of size change that should be\n   *                        watched: SizeWatcher.directions.increase, SizeWatcher.directions.decrease or\n   *                        SizeWatcher.directions.both\n   * @param {Number}        [options.dimension=SizeWatcher.dimensions.both] The dimension of size change that should be\n   *                        watched: SizeWatcher.dimensions.horizontal, SizeWatcher.dimensions.vertical or\n   *                        SizeWatcher.dimensions.both\n   * @param {HTMLDocument}  [options.document] The DOM tree context to use, if none provided then it will be the document.\n   * @constructor\n   */\n  function SizeWatcher(element, options) {\n    this._element = element;\n    this._delegate = options.delegate;\n    this._size = null;\n    this._continuous = !!options.continuous;\n    this._direction = options.direction ? options.direction : SizeWatcher.directions.both;\n    this._dimension = options.dimension ? options.dimension : SizeWatcher.dimensions.both;\n    this._sizeIncreaseWatcherContentElm = null;\n    this._sizeDecreaseWatcherElm = null;\n    this._sizeIncreaseWatcherElm = null;\n    this._state = SizeWatcher.states.initialized;\n    this._scrollAmount = 2;\n    this._document = options.document || document;\n\n    this._generateScrollWatchers(options.size);\n    this._appendScrollWatchersToElement(options.container);\n  }\n  \n  SizeWatcher.states = {\n    initialized: 0,\n    generatedScrollWatchers: 1,\n    appendedScrollWatchers: 2,\n    preparedScrollWatchers: 3,\n    watchingForSizeChange: 4\n  };\n\n  SizeWatcher.directions = {\n    decrease: 1,\n    increase: 2,\n    both: 3\n  };\n\n  SizeWatcher.dimensions = {\n    horizontal: 1,\n    vertical: 2,\n    both: 3\n  };\n  \n  //noinspection JSUnusedLocalSymbols\n  SizeWatcher.prototype = {\n    constructor: SizeWatcher,\n    getWatchedElement: function() {\n      return this._element;\n    },\n        getState: function() {\n            return this._state;\n        },\n    setSize: function(size) {\n      this._size = size;\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.increase) {\n        this._sizeIncreaseWatcherContentElm.style.cssText = \"width: \" + (size.width + this._scrollAmount) + \"px; height: \" + (size.height + this._scrollAmount) + \"px;\";\n      }\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.decrease) {\n        this._sizeDecreaseWatcherElm.style.cssText = \"position:absolute; left: 0px; top: 0px; overflow: hidden; width: \" + (size.width - this._scrollAmount) + \"px; height: \" + (size.height - this._scrollAmount) + \"px;\";\n      }\n    },\n    _generateScrollWatchers: function(size) {\n\n      this._element.style.position = \"absolute\";\n      \n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.increase) {\n        this._sizeIncreaseWatcherContentElm = this._document.createElement(\"div\");\n        \n        this._sizeIncreaseWatcherElm = this._document.createElement(\"div\");\n        this._sizeIncreaseWatcherElm.style.cssText = \"position: absolute; left: 0; top: 0; width: 100%; height: 100%; overflow: hidden;\";\n        this._sizeIncreaseWatcherElm.appendChild(this._sizeIncreaseWatcherContentElm);\n\n        this._element.appendChild(this._sizeIncreaseWatcherElm);\n      }\n\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.decrease) {\n        this._sizeDecreaseWatcherElm = this._document.createElement(\"div\");\n        this._sizeDecreaseWatcherElm.appendChild(this._element);\n      }\n      \n      if (size) {\n        this.setSize(size);\n      }\n      \n      this._state = SizeWatcher.states.generatedScrollWatchers;\n    },\n    _appendScrollWatchersToElement: function(container) {\n      if (this._state !== SizeWatcher.states.generatedScrollWatchers) {\n        throw new Error(\"SizeWatcher._appendScrollWatchersToElement() was invoked before SizeWatcher._generateScrollWatchers()\");\n      }\n\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.decrease) {\n        container.appendChild(this._sizeDecreaseWatcherElm);\n      } else {\n        container.appendChild(this._element);\n      }\n      \n      this._state = SizeWatcher.states.appendedScrollWatchers;\n    },\n    removeScrollWatchers: function() {\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.decrease) {\n        if (this._sizeDecreaseWatcherElm.parentNode) {\n          this._sizeDecreaseWatcherElm.parentNode.removeChild(this._sizeDecreaseWatcherElm);\n        }\n      } else if (this._element.parentNode) {\n        this._element.parentNode.removeChild(this._element);\n      }\n    },\n    prepareForWatch: function() {\n      var parentNode,\n        sizeDecreaseWatcherElmScrolled = true,\n        sizeIncreaseWatcherElmScrolled = true;\n      \n      if (this._state !== SizeWatcher.states.appendedScrollWatchers) {\n        throw new Error(\"SizeWatcher.prepareForWatch() invoked before SizeWatcher._appendScrollWatchersToElement()\");\n      }\n      \n      if (this._size === null) {\n        this.setSize(new Size(this._element.offsetWidth, this._element.offsetHeight));\n      }\n\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.decrease) {\n        sizeDecreaseWatcherElmScrolled = this._scrollElementToBottomRight(this._sizeDecreaseWatcherElm);\n      }\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.increase) {\n        sizeIncreaseWatcherElmScrolled = this._scrollElementToBottomRight(this._sizeIncreaseWatcherElm);\n      }\n      \n      // Check if scroll positions updated.\n      if (!sizeDecreaseWatcherElmScrolled || !sizeIncreaseWatcherElmScrolled) {\n        \n        // Traverse tree to the top node to see if element is in the DOM tree.\n        parentNode = this._element.parentNode;\n        while (parentNode !== this._document && parentNode !== null) {\n          parentNode = parentNode.parentNode;\n        }\n        \n        if (parentNode === null) {\n          throw new Error(\"Can't set scroll position of scroll watchers. SizeWatcher is not in the DOM tree.\");\n        } else if (console && typeof console.warn === \"function\") {\n          console.warn(\"SizeWatcher can't set scroll position of scroll watchers.\");\n        }\n      }\n      \n      this._state = SizeWatcher.states.preparedScrollWatchers;\n    },\n    _scrollElementToBottomRight: function(element) {\n      var elementScrolled = true;\n      //noinspection JSBitwiseOperatorUsage\n      if (this._dimension & SizeWatcher.dimensions.vertical) {\n        element.scrollTop = this._scrollAmount;\n        elementScrolled = elementScrolled && element.scrollTop > 0;\n      }\n      //noinspection JSBitwiseOperatorUsage\n      if (this._dimension & SizeWatcher.dimensions.horizontal) {\n        element.scrollLeft = this._scrollAmount;\n        elementScrolled = elementScrolled && element.scrollLeft > 0;\n      }\n      return elementScrolled;\n    },\n    beginWatching: function() {\n      if (this._state !== SizeWatcher.states.preparedScrollWatchers) {\n        throw new Error(\"SizeWatcher.beginWatching() invoked before SizeWatcher.prepareForWatch()\");\n      }\n\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.decrease) {\n        //noinspection JSValidateTypes\n        this._sizeDecreaseWatcherElm.addEventListener(\"scroll\", this, false);\n      }\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.increase) {\n        //noinspection JSValidateTypes\n        this._sizeIncreaseWatcherElm.addEventListener(\"scroll\", this, false);\n      }\n      \n      this._state = SizeWatcher.states.watchingForSizeChange;\n    },\n    endWatching: function() {\n      if (this._state !== SizeWatcher.states.watchingForSizeChange) {\n        throw new Error(\"SizeWatcher.endWatching() invoked before SizeWatcher.beginWatching()\");\n      }\n\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.decrease) {\n        //noinspection JSValidateTypes\n        this._sizeDecreaseWatcherElm.removeEventListener(\"scroll\", this, false);\n      }\n      //noinspection JSBitwiseOperatorUsage\n      if (this._direction & SizeWatcher.directions.increase) {\n        //noinspection JSValidateTypes\n        this._sizeIncreaseWatcherElm.removeEventListener(\"scroll\", this, false);\n      }\n      this._state = SizeWatcher.states.appendedScrollWatchers;\n    },\n    /**\n     * @private\n     */\n    handleEvent: function(event) {\n      var newSize, oldSize;\n      \n      // This is not suppose to happen because when we run endWatching() we remove scroll listeners.\n      // But some browsers will fire second scroll event which was pushed into event stack before listener was\n      // removed so do this check anyway.\n      if (this._state !== SizeWatcher.states.watchingForSizeChange) {\n        return;\n      }\n      \n      newSize = new Size(this._element.offsetWidth, this._element.offsetHeight);\n      oldSize = this._size;\n\n      // Check if element size is changed. How come that element size isn't changed but scroll event fired?\n      // This can happen in two cases: when double scroll occurs or immediately after calling prepareForWatch()\n      // (event if scroll event listeners attached after it).\n      // The double scroll event happens when one size dimension (e.g.:width) is increased and another\n      // (e.g.:height) is decreased.\n      if (oldSize.isEqual(newSize)) {\n        return;\n      }\n      \n      if (this._delegate && typeof this._delegate.sizeWatcherChangedSize === \"function\") {\n        this._delegate.sizeWatcherChangedSize(this);\n        \n        // Check that endWatching() wasn't invoked from within the delegate.\n        if (this._state !== SizeWatcher.states.watchingForSizeChange) {\n          return;\n        }\n      }\n\n      if (!this._continuous) {\n        this.endWatching();\n      } else {\n        // Set the new size so in case of double scroll event we won't cause the delegate method to be executed twice\n        // and also to update to the new watched size.\n        this.setSize(newSize);\n        // change state so prepareFowWatch() won't throw exception about wrong order invocation.\n        this._state = SizeWatcher.states.appendedScrollWatchers;\n        // Run prepareForWatch to reset the scroll watchers, we have already set the size\n        this.prepareForWatch();\n        // Set state to listeningForSizeChange, there is no need to invoke beginWatching() method as scroll event\n        // listeners and callback are already set.\n        this._state = SizeWatcher.states.watchingForSizeChange;\n        \n      }\n    }\n  };\n  \n  return FontLoader;\n  \n}));","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/Shaders.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/Shaders.js","friendlyPath":".Shaders","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/","filename":"Shaders.js","src":"var STRIDE = 24;\n\nShader=__class__;var Shader=Shader(function Shader(){return this.init&&this.init.apply(this,arguments)},function() {\n\n\tthis.init = function(opts) {\n\n\t\tvar gl = this._gl = opts.gl;\n\n\t\tthis._vertexSrc = opts.vertexSrc || [\n\t\t\t'precision mediump float;',\n\t\t\t'attribute vec2 aTextureCoord;',\n\t\t\t'attribute vec2 aPosition;',\n\t\t\t'attribute vec4 aColor;',\n\t\t\t'attribute float aAlpha;',\n\t\t\t'uniform vec2 uResolution;',\n\t\t\t'varying vec2 vTextureCoord;',\n\t\t\t'varying float vAlpha;',\n\t\t\t'varying vec4 vColor;',\n\t\t\t'void main() {',\n\t\t\t'\tvTextureCoord = aTextureCoord;',\n\t\t\t'\tvColor = aColor;',\n\t\t\t'\tvAlpha = aAlpha;',\n\t\t\t'\tvec2 clipSpace = (aPosition / uResolution) * 2.0 - 1.0;',\n\t\t\t'\tgl_Position = vec4(clipSpace * vec2(1.0, -1.0), 0.0, 1.0);',\n\t\t\t'}'\n\t\t].join(\"\\n\");\n\n\t\tthis._fragmentSrc = opts.fragmentSrc || [\n\t\t\t'precision mediump float;',\n\t\t\t'varying vec2 vTextureCoord;',\n\t\t\t'varying float vAlpha;',\n\t\t\t'uniform sampler2D uSampler;',\n\t\t\t'void main(void) {',\n\t\t\t'\tgl_FragColor = texture2D(uSampler, vTextureCoord) * vAlpha;',\n\t\t\t'}'\n\t\t].join(\"\\n\");\n\n\t\tvar useTexture = opts.useTexture !== undefined ? opts.useTexture : true;\n\n\t\tthis.attributes = {\n\t\t\taTextureCoord: 0,\n\t\t\taPosition: 0,\n\t\t\taAlpha: 0,\n\t\t\taColor: 0\n\t\t};\n\n\t\tthis.uniforms = {\n\t\t\tuSampler: useTexture ? 0 : -1,\n\t\t\tuResolution: 0\n\t\t};\n\n\t\tthis.initGL();\n\t};\n\n\tthis.initGL = function() {\n\t\tthis.createProgram();\n\t\tthis.updateLocations();\n\t\tvar gl = this._gl;\n\t\tvar attr = this.attributes;\n\t\tgl.vertexAttribPointer(attr.aPosition, 2, gl.FLOAT, false, STRIDE, 0);\n\t\tgl.vertexAttribPointer(attr.aTextureCoord, 2, gl.FLOAT, false, STRIDE, 8);\n\t\tgl.vertexAttribPointer(attr.aAlpha, 1, gl.FLOAT, false, STRIDE, 16);\n\t\tgl.vertexAttribPointer(attr.aColor, 4, gl.UNSIGNED_BYTE, true, STRIDE, 20);\n\t};\n\n\tthis.updateLocations = function() {\n\t\tvar gl = this._gl;\n\t\tfor (var attrib in this.attributes) {\n\t\t\tif (this.attributes[attrib] !== -1) {\n\t\t\t\tthis.attributes[attrib] = gl.getAttribLocation(this.program, attrib);\n\t\t\t\tgl.enableVertexAttribArray(this.attributes[attrib]);\n\t\t\t}\n\t\t}\n\t\tfor (var uniform in this.uniforms) {\n\t\t\tif (this.uniforms[uniform] !== -1) {\n\t\t\t\tthis.uniforms[uniform] = gl.getUniformLocation(this.program, uniform);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.createProgram = function() {\n\t\tgl = this._gl;\n\n\t\tvar vertexShader = gl.createShader(gl.VERTEX_SHADER);\n\t\tgl.shaderSource(vertexShader, this._vertexSrc);\n\t\tgl.compileShader(vertexShader);\n\n\t\tvar fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n\t\tgl.shaderSource(fragmentShader, this._fragmentSrc);\n\t\tgl.compileShader(fragmentShader);\n\n\t\tvar program = gl.createProgram();\n\t\tgl.attachShader(program, vertexShader);\n\t\tgl.attachShader(program, fragmentShader);\n\t\tgl.linkProgram(program);\n\n\t\tif (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n\t\t\tconsole.log(\"Could not initialize shaders\");\n\t\t}\n\n\t\tthis.program = program;\n\t};\n\n});\n\nLinearAddShader=__class__;var LinearAddShader=LinearAddShader(function LinearAddShader(){return this.init&&this.init.apply(this,arguments)},Shader, function() {\n\n\tthis.init = function(opts) {\n\t\topts.fragmentSrc = [\n\t\t\t'precision mediump float;',\n\t\t\t'varying vec2 vTextureCoord;',\n\t\t\t'varying float vAlpha;',\n\t\t\t'varying vec4 vColor;',\n\t\t\t'uniform sampler2D uSampler;',\n\t\t\t'void main(void) {',\n\t\t\t'\tvec4 vSample = texture2D(uSampler, vTextureCoord);',\n\t\t\t'\tgl_FragColor = vec4((vSample.rgb + vColor.rgb * vColor.a) * vSample.a, vSample.a) * vAlpha;',\n\t\t\t'}'\n\t\t].join(\"\\n\");\n\t\tShader.prototype.init.call(this, opts);\n\t};\n\n});\n\nTintShader=__class__;var TintShader=TintShader(function TintShader(){return this.init&&this.init.apply(this,arguments)},Shader, function(supr) {\n\n\tthis.init = function(opts) {\n\t\topts.fragmentSrc = [\n\t\t\t'precision mediump float;',\n\t\t\t'varying vec2 vTextureCoord;',\n\t\t\t'varying float vAlpha;',\n\t\t\t'varying vec4 vColor;',\n\t\t\t'uniform sampler2D uSampler;',\n\t\t\t'void main(void) {',\n\t\t\t'\tvec4 vSample = texture2D(uSampler, vTextureCoord);',\n\t\t\t'\tgl_FragColor = vec4((vSample.rgb * (1.0 - vColor.a) + (vColor.rgb * vColor.a)) * vSample.a, vSample.a * vAlpha);',\n\t\t\t'}'\n\t\t].join(\"\\n\");\n\t\tShader.prototype.init.call(this, opts);\n\t};\n\n});\n\nMultiplyShader=__class__;var MultiplyShader=MultiplyShader(function MultiplyShader(){return this.init&&this.init.apply(this,arguments)},Shader, function(supr) {\n\n\tthis.init = function(opts) {\n\t\topts.fragmentSrc = [\n\t\t\t'precision mediump float;',\n\t\t\t'varying vec2 vTextureCoord;',\n\t\t\t'varying float vAlpha;',\n\t\t\t'varying vec4 vColor;',\n\t\t\t'uniform sampler2D uSampler;',\n\t\t\t'void main(void) {',\n\t\t\t'\tvec4 vSample = texture2D(uSampler, vTextureCoord);',\n\t\t\t'\tgl_FragColor = vec4(vSample.rgb * (vColor.rgb * vColor.a), vSample.a) * vAlpha;',\n\t\t\t'}'\n\t\t].join(\"\\n\");\n\t\tShader.prototype.init.call(this, opts);\n\t};\n\n});\n\nRectShader=__class__;var RectShader=RectShader(function RectShader(){return this.init&&this.init.apply(this,arguments)},Shader, function(supr) {\n\n\tthis.init = function(opts) {\n\t\topts.fragmentSrc = [\n\t\t\t'precision mediump float;',\n\t\t\t'varying float vAlpha;',\n\t\t\t'varying vec4 vColor;',\n\t\t\t'void main(void) {',\n\t\t\t'\tgl_FragColor = vColor * vAlpha;',\n\t\t\t'}'\n\t\t].join(\"\\n\");\n\t\topts.useTexture = false;\n\t\tShader.prototype.init.call(this, opts);\n\t};\n\n});\n\nexports = {\n\tDefaultShader: Shader,\n\tLinearAddShader: LinearAddShader,\n\tTintShader: TintShader,\n\tMultiplyShader: MultiplyShader,\n\tRectShader: RectShader\n};","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/Matrix2D.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/Matrix2D.js","friendlyPath":".Matrix2D","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/webgl/","filename":"Matrix2D.js","src":"Matrix2D=__class__;var Matrix2D=Matrix2D(function Matrix2D(){return this.init&&this.init.apply(this,arguments)},function() {\n\n    var sin = Math.sin;\n    var cos = Math.cos;\n\n    this.init = function() {\n        this.identity();\n    };\n\n    this.identity = function() {\n        this.a = 1;\n        this.b = 0;\n        this.c = 0;\n        this.d = 1;\n        this.tx = 0;\n        this.ty = 0;\n    };\n\n    this.clone = function() {\n        var result = new Matrix2D();\n        result.copy(this);\n        return result;\n    };\n\n    this.copy = function(matrix) {\n        this.a = matrix.a;\n        this.b = matrix.b;\n        this.c = matrix.c;\n        this.d = matrix.d;\n        this.tx = matrix.tx;\n        this.ty = matrix.ty;\n    };\n\n    this.scale = function(x, y) {\n        this.a *= x;\n        this.b *= x;\n        this.c *= y;\n        this.d *= y;\n    };\n\n    this.rotate = function (angle) {\n        var a = this.a;\n        var b = this.b;\n        var c = this.c;\n        var d = this.d;\n        var sinA = sin(angle);\n        var cosA = cos(angle);\n        this.a = a * cosA + c * sinA;\n        this.b = b * cosA + d * sinA;\n        this.c = a * -sinA + c * cosA;\n        this.d = b * -sinA + d * cosA;\n    };\n\n    this.translate = function(x, y) {\n        this.tx += this.a * x + this.c * y;\n        this.ty += this.b * x + this.d * y;\n    };\n\n    this.transform = function(matrix) {\n        var a = this.a;\n        var b = this.b;\n        var c = this.c;\n        var d = this.d;\n        this.a = a * matrix.a + c * matrix.b;\n        this.b = b * matrix.a + c * matrix.b;\n        this.c = a * matrix.c + c * matrix.c;\n        this.d = b * matrix.c + d * matrix.c;\n        this.tx += a * matrix.tx + c * matrix.ty;\n        this.ty += b * matrix.tx + d * matrix.ty;\n    };\n\n    this.setTo = function(a, b, c, d, tx, ty) {\n        this.a = a;\n        this.b = b;\n        this.c = c;\n        this.d = d;\n        this.tx = tx;\n        this.ty = ty;\n    };\n\n});\n\nexports = Matrix2D;\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/dev_error.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/dev_error.js","friendlyPath":".dev_error","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"dev_error.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package timestep.env.browser.dev_error;\n *\n * Displays a developer error.\n *\n * ??? TODO move to a debug package.\n */\n\nexports.render = function (e) {\n\tlogger.ERROR&&console.error(\"ERROR\",\".dev_error\",\"unhandled tick exception\");\n\tlogger.ERROR&&console.error(\"ERROR\",\".dev_error\",e.stack);\n\t\n\tvar c = document.getElementsByTagName('canvas');\n\tfor (var i = 0, el; el = c[i]; ++i) {\n\t\trender(el.getContext('2d'), e);\n\t}\n}\n\nfunction render(ctx, e) {\n\tctx.fillStyle = \"rgb(0, 0, 255)\";\n\tctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\t\n\tvar x = 30, y = 40;\n\n\tctx.fillStyle = \"#FFF\";\n\tctx.font = \"bold 12px Monaco,\\\"Bitstream Vera Sans Mono\\\",\\\"Lucida Console\\\",Terminal,monospace\";\n\tfunction drawLine(msg) {\n\t\tctx.fillText(msg, x, y);\n\t\ty += 20;\n\t}\n\t\n\tdrawLine(e.message);\n\ty += 40;\n\te.stack.split('\\n').map(drawLine);\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/FlashAPI.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/FlashAPI.js","friendlyPath":".FlashAPI","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"FlashAPI.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.PubSub');\njsio('import .SoundManager');\njsio('from util.underscore import _');\n\nvar soundManager = new SoundManager();\nsoundManager.url = 'media/swf';\nsoundManager.flashVersion = 9;\nsoundManager.useMovieStar = true;\nsoundManager.debugMode = false;\nsoundManager.consoleOnly = true;\nsoundManager.useHighPerformance = true;\nsoundManager.useFastPolling = true;\n\n/**\n * @extends lib.PubSub\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_FlashAPI=__class__;var AudioAPI = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_FlashAPI(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_FlashAPI(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function (supr) {\n\tthis.init = function (opts) {\n\n\t\topts = merge(opts, {\n\t\t\tmap: {},\n\t\t\tbackground: []\n\t\t});\n\n\t\tsupr(this, 'init', [opts]);\n\t\tvar path = opts.path;\n\t\tthis._map = {};\n\n\t\t_.each(opts.background, function (name) {\n\t\t\topts.map[name] = {'name': name}\n\t\t}, this);\n\n\t\tsoundManager.onready(bind(this, function () {\n\t\t\tlogger.LOG&&console.log(\"LOG\",\".FlashAPI\",'SoundManager onReady');\n\t\t\tfor (key in opts.map) {\n\t\t\t\tlogger.LOG&&console.log(\"LOG\",\".FlashAPI\",'SoundManager key: ', key);\n\t\t\t\tvar url = 'media/audio/'  + key + '.mp3';\n\t\t\t\tvar k = this._map[key] = soundManager.createSound({\n\t\t\t\t\tid: key,\n\t\t\t\t\tbufferTime: 3,\n\t\t\t\t\turl: url\n\t\t\t\t});\n\t\t\t\tk.load();\n\t\t\t}\n\n\t\t\tthis.publish('Ready');\n\t\t}));\n\t}\n\n\tthis.canPlay = function (name) {\n\t\treturn (name in this._map);\n\t}\n\n\tthis.setVolume = function (volume) {\n\t\tthis._soundPlaying && soundManager.setVolume(this._soundPlaying, volume);\n\t\tthis._backgroundSoundPlaying && soundManager.setVolume(this._backgroundSoundPlaying, volume);\n\t}\n\n\tthis.setMuted = function (muted) {\n\t\tthis.muted = muted;\n\t\tif (muted) {\n\t\t\tthis.setVolume(0);\n\t\t}\n\t}\n\n\tthis.play = function (name, volume, channel) {\n\t\tif (!this.canPlay(name)) { return; }\n\t\tif (this.muted) { return; }\n\t\tif (volume === undefined) {\n\t\t\tvolume = 1.0;\n\t\t}\n\t\tthis._soundPlaying = name;\n\t\tthis._map[name].setVolume(volume * 100 | 0);\n\t\tthis._map[name].play();\n\t}\n\n\tthis.pause = function () {\n\t\tthis._map[this._soundPlaying].pause();\n\t\tthis._soundPlaying = null;\n\t}\n\n\tthis.playBackgroundMusic = function (name, volume) {\n\t\tif (!this.canPlay(name)) { return; }\n\t\tif (this.muted) { return; }\n\t\tif (volume === undefined) {\n\t\t\tvolume = 1.0;\n\t\t}\n\t\tthis._backgroundSoundPlaying = name;\n\t\tthis._map[name].setVolume(volume * 100 | 0);\n\t\tthis._map[name].play();\n\t}\n\n\tthis.pauseBackgroundMusic = function () {\n\t\tif (!this._backgroundSoundPlaying) { return; }\n\t\tthis._map[this._backgroundSoundPlaying].pause();\n\t\tthis._backgroundSoundPlaying = null;\n\t}\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/SoundManager.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/SoundManager.js","friendlyPath":".SoundManager","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"SoundManager.js","src":"/*\r\n * @license\r\n * SoundManager 2: JavaScript Sound for the Web\r\n * ----------------------------------------------\r\n * http://schillmania.com/projects/soundmanager2/\r\n *\r\n * Copyright (c) 2007, Scott Schiller. All rights reserved.\r\n * Code provided under the BSD License:\r\n * http://schillmania.com/projects/soundmanager2/license.txt\r\n *\r\n * V2.97a.20110801\r\n*/\r\n\r\n/*global window, SM2_DEFER, sm2Debugger, console, document, navigator, setTimeout, setInterval, clearInterval, Audio */\r\n/*jslint regexp: true, sloppy: true, white: true, nomen: true, plusplus: true */\r\n\r\nvar SoundManager = exports = function SoundManager(smURL, smID) {\r\n\r\n  this.flashVersion = 8;             // version of flash to require, either 8 or 9. Some API features require Flash 9.\r\n  this.debugMode = true;             // enable debugging output (div#soundmanager-debug, OR console if available+configured)\r\n  this.debugFlash = false;           // enable debugging output inside SWF, troubleshoot Flash/browser issues\r\n  this.useConsole = true;            // use firebug/safari console.log()-type debug console if available\r\n  this.consoleOnly = false;          // if console is being used, do not create/write to #soundmanager-debug\r\n  this.waitForWindowLoad = false;    // force SM2 to wait for window.onload() before trying to call soundManager.onload()\r\n  this.nullURL = 'about:blank';      // path to \"null\" (empty) MP3 file, used to unload sounds (Flash 8 only)\r\n  this.allowPolling = true;          // allow flash to poll for status update (required for whileplaying() events, peak, sound spectrum functions to work.)\r\n  this.useFastPolling = false;       // uses lower flash timer interval for higher callback frequency, best combined with useHighPerformance\r\n  this.useMovieStar = true;          // enable support for Flash 9.0r115+ (codename \"MovieStar\") MPEG4 audio formats (AAC, M4V, FLV, MOV etc.)\r\n  this.bgColor = '#ffffff';          // movie (.swf) background color, eg. '#000000'\r\n  this.useHighPerformance = false;   // position:fixed flash movie can help increase js/flash speed, minimize lag\r\n  this.flashPollingInterval = null;  // msec for polling interval. Defaults to 50 unless useFastPolling = true.\r\n  this.flashLoadTimeout = 1000;      // msec to wait for flash movie to load before failing (0 = infinity)\r\n  this.wmode = null;                 // string: flash rendering mode - null, transparent, opaque (last two allow layering of HTML on top)\r\n  this.allowScriptAccess = 'always'; // for scripting the SWF (object/embed property), either 'always' or 'sameDomain'\r\n  this.useFlashBlock = false;        // *requires flashblock.css, see demos* - allow recovery from flash blockers. Wait indefinitely and apply timeout CSS to SWF, if applicable.\r\n  this.useHTML5Audio = true;         // Beta feature: Use HTML5 Audio() where API is supported (most Safari, Chrome versions), Firefox (no MP3/MP4.) Ideally, transparent vs. Flash API where possible.\r\n  this.html5Test = /^(probably|maybe)$/i; // HTML5 Audio() format support test. Use /^probably$/i; if you want to be more conservative.\r\n  this.preferFlash = true;           // (experimental) if true and flash support present, will try to use flash for MP3/MP4 as needed since HTML5 audio support is still quirky in browsers.\r\n\r\n  this.audioFormats = {\r\n    /*\r\n     * determines HTML5 support + flash requirements.\r\n     * if no support for a \"required\" format, SM2 will fail to start.\r\n     * flash fallback is used for MP3 or MP4 if HTML5 can't play it (or if preferFlash = true)\r\n     * multiple MIME types may be tested while trying to get a positive canPlayType() response.\r\n    */\r\n    'mp3': {\r\n      'type': ['audio/mpeg; codecs=\"mp3\"', 'audio/mpeg', 'audio/mp3', 'audio/MPA', 'audio/mpa-robust'],\r\n      'required': true\r\n    },\r\n    'mp4': {\r\n      'related': ['aac','m4a'], // additional formats under the MP4 container\r\n      'type': ['audio/mp4; codecs=\"mp4a.40.2\"', 'audio/aac', 'audio/x-m4a', 'audio/MP4A-LATM', 'audio/mpeg4-generic'],\r\n      'required': false\r\n    },\r\n    'ogg': {\r\n      'type': ['audio/ogg; codecs=vorbis'],\r\n      'required': false\r\n    },\r\n    'wav': {\r\n      'type': ['audio/wav; codecs=\"1\"', 'audio/wav', 'audio/wave', 'audio/x-wav'],\r\n      'required': false\r\n    }\r\n  };\r\n\r\n  this.defaultOptions = {\r\n    'autoLoad': false,             // enable automatic loading (otherwise .load() will be called on demand with .play(), the latter being nicer on bandwidth - if you want to .load yourself, you also can)\r\n    'stream': true,                // allows playing before entire file has loaded (recommended)\r\n    'autoPlay': false,             // enable playing of file as soon as possible (much faster if \"stream\" is true)\r\n    'loops': 1,                    // how many times to repeat the sound (position will wrap around to 0, setPosition() will break out of loop when >0)\r\n    'onid3': null,                 // callback function for \"ID3 data is added/available\"\r\n    'onload': null,                // callback function for \"load finished\"\r\n    'whileloading': null,          // callback function for \"download progress update\" (X of Y bytes received)\r\n    'onplay': null,                // callback for \"play\" start\r\n    'onpause': null,               // callback for \"pause\"\r\n    'onresume': null,              // callback for \"resume\" (pause toggle)\r\n    'whileplaying': null,          // callback during play (position update)\r\n    'onstop': null,                // callback for \"user stop\"\r\n    'onfailure': null,             // callback function for when playing fails\r\n    'onfinish': null,              // callback function for \"sound finished playing\"\r\n    'onbeforefinish': null,        // callback for \"before sound finished playing (at [time])\"\r\n    'onbeforefinishtime': 5000,    // offset (milliseconds) before end of sound to trigger beforefinish (eg. 1000 msec = 1 second)\r\n    'onbeforefinishcomplete': null,// function to call when said sound finishes playing\r\n    'onjustbeforefinish': null,    // callback for [n] msec before end of current sound\r\n    'onjustbeforefinishtime': 200, // [n] - if not using, set to 0 (or null handler) and event will not fire.\r\n    'multiShot': true,             // let sounds \"restart\" or layer on top of each other when played multiple times, rather than one-shot/one at a time\r\n    'multiShotEvents': false,      // fire multiple sound events (currently onfinish() only) when multiShot is enabled\r\n    'position': null,              // offset (milliseconds) to seek to within loaded sound data.\r\n    'pan': 0,                      // \"pan\" settings, left-to-right, -100 to 100\r\n    'type': null,                  // MIME-like hint for file pattern / canPlay() tests, eg. audio/mp3\r\n    'usePolicyFile': false,        // enable crossdomain.xml request for audio on remote domains (for ID3/waveform access)\r\n    'volume': 100                  // self-explanatory. 0-100, the latter being the max.\r\n  };\r\n\r\n  this.flash9Options = {      // flash 9-only options, merged into defaultOptions if flash 9 is being used\r\n    'isMovieStar': null,      // \"MovieStar\" MPEG4 audio mode. Null (default) = auto detect MP4, AAC etc. based on URL. true = force on, ignore URL\r\n    'usePeakData': false,     // enable left/right channel peak (level) data\r\n    'useWaveformData': false, // enable sound spectrum (raw waveform data) - WARNING: CPU-INTENSIVE: may set CPUs on fire.\r\n    'useEQData': false,       // enable sound EQ (frequency spectrum data) - WARNING: Also CPU-intensive.\r\n    'onbufferchange': null,   // callback for \"isBuffering\" property change\r\n    'ondataerror': null       // callback for waveform/eq data access error (flash playing audio in other tabs/domains)\r\n  };\r\n\r\n  this.movieStarOptions = { // flash 9.0r115+ MPEG4 audio options, merged into defaultOptions if flash 9+movieStar mode is enabled\r\n    'bufferTime': 3,        // seconds of data to buffer before playback begins (null = flash default of 0.1 seconds - if AAC playback is gappy, try increasing.)\r\n    'serverURL': null,      // rtmp: FMS or FMIS server to connect to, required when requesting media via RTMP or one of its variants\r\n    'onconnect': null,      // rtmp: callback for connection to flash media server\r\n    'duration': null        // rtmp: song duration (msec)\r\n  };\r\n\r\n  this.version = null;\r\n  this.versionNumber = 'V2.97a.20110801';\r\n  this.movieURL = null;\r\n  this.url = (smURL || null);\r\n  this.altURL = null;\r\n  this.swfLoaded = false;\r\n  this.enabled = false;\r\n  this.o = null;\r\n  this.movieID = 'sm2-container';\r\n  this.id = (smID || 'sm2movie');\r\n  this.swfCSS = {\r\n    'swfBox': 'sm2-object-box',\r\n    'swfDefault': 'movieContainer',\r\n    'swfError': 'swf_error', // SWF loaded, but SM2 couldn't start (other error)\r\n    'swfTimedout': 'swf_timedout',\r\n    'swfLoaded': 'swf_loaded',\r\n    'swfUnblocked': 'swf_unblocked', // or loaded OK\r\n    'sm2Debug': 'sm2_debug',\r\n    'highPerf': 'high_performance',\r\n    'flashDebug': 'flash_debug'\r\n  };\r\n  this.oMC = null;\r\n  this.sounds = {};\r\n  this.soundIDs = [];\r\n  this.muted = false;\r\n  this.debugID = 'soundmanager-debug';\r\n  this.debugURLParam = /([#?&])debug=1/i;\r\n  this.specialWmodeCase = false;\r\n  this.didFlashBlock = false;\r\n\r\n  this.filePattern = null;\r\n  this.filePatterns = {\r\n    'flash8': /\\.mp3(\\?.*)?$/i,\r\n    'flash9': /\\.mp3(\\?.*)?$/i\r\n  };\r\n\r\n  this.baseMimeTypes = /^\\s*audio\\/(?:x-)?(?:mp(?:eg|3))\\s*(?:$|;)/i; // mp3\r\n  this.netStreamMimeTypes = /^\\s*audio\\/(?:x-)?(?:mp(?:eg|3))\\s*(?:$|;)/i; // mp3, mp4, aac etc.\r\n  this.netStreamTypes = ['aac', 'flv', 'mov', 'mp4', 'm4v', 'f4v', 'm4a', 'mp4v', '3gp', '3g2']; // Flash v9.0r115+ \"moviestar\" formats\r\n  this.netStreamPattern = new RegExp('\\\\.(' + this.netStreamTypes.join('|') + ')(\\\\?.*)?$', 'i');\r\n  this.mimePattern = this.baseMimeTypes;\r\n\r\n  this.features = {\r\n    'buffering': false,\r\n    'peakData': false,\r\n    'waveformData': false,\r\n    'eqData': false,\r\n    'movieStar': false\r\n  };\r\n\r\n  this.sandbox = {\r\n    // <d>\r\n    'type': null,\r\n    'types': {\r\n      'remote': 'remote (domain-based) rules',\r\n      'localWithFile': 'local with file access (no internet access)',\r\n      'localWithNetwork': 'local with network (internet access only, no local access)',\r\n      'localTrusted': 'local, trusted (local+internet access)'\r\n    },\r\n    'description': null,\r\n    'noRemote': null,\r\n    'noLocal': null\r\n    // </d>\r\n  };\r\n\r\n  this.hasHTML5 = (typeof Audio !== 'undefined' && typeof new Audio().canPlayType !== 'undefined'); // switch for handling logic\r\n\r\n  // stores canPlayType() results, etc. treat as read-only.\r\n  this.html5 = {\r\n    // mp3: boolean\r\n    // mp4: boolean\r\n    'usingFlash': null // set if/when flash fallback is needed\r\n  };\r\n\r\n  // format support\r\n  this.flash = {\r\n    // mp3: boolean\r\n    // mp4: boolean\r\n  };\r\n\r\n  this.html5Only = false;   // determined at init time\r\n  this.ignoreFlash = false; // used for special cases (eg. iPad/iPhone/palm OS?)\r\n\r\n  /*\r\n   * a few private internals\r\n  */\r\n\r\n  var SMSound,\r\n  _s = this, _sm = 'soundManager', _smc = _sm+'::', _h5 = 'HTML5::', _id, _ua = navigator.userAgent, _win = window, _wl = _win.location.href.toString(), _fV = this.flashVersion, _doc = document, _doNothing, _init, _on_queue = [], _debugOpen = true, _debugTS, _didAppend = false, _appendSuccess = false, _didInit = false, _disabled = false, _windowLoaded = false, _wDS, _wdCount = 0, _initComplete, _mixin, _addOnEvent, _processOnEvents, _initUserOnload, _delayWaitForEI, _waitForEI, _setVersionInfo, _handleFocus, _strings, _initMovie, _dcLoaded, _didDCLoaded, _getDocument, _createMovie, _catchError, _setPolling, _initDebug, _debugLevels = ['log', 'info', 'warn', 'error'], _defaultFlashVersion = 8, _disableObject, _failSafely, _normalizeMovieURL, _oRemoved = null, _oRemovedHTML = null, _str, _flashBlockHandler, _getSWFCSS, _toggleDebug, _loopFix, _policyFix, _complain, _idCheck, _waitingForEI = false, _initPending = false, _smTimer, _onTimer, _startTimer, _stopTimer, _needsFlash = null, _featureCheck, _html5OK, _html5CanPlay, _html5Ext,  _dcIE, _testHTML5, _event, _slice = Array.prototype.slice, _useGlobalHTML5Audio = false, _hasFlash, _detectFlash, _badSafariFix, _html5_events, _showSupport,\r\n  _is_iDevice = _ua.match(/(ipad|iphone|ipod)/i), _likesHTML5 = (_ua.match(/(mobile|pre\\/|xoom)/i) || _is_iDevice), _isIE = _ua.match(/msie/i), _isWebkit = _ua.match(/webkit/i), _isSafari = (_ua.match(/safari/i) && !_ua.match(/chrome/i)), _isOpera = (_ua.match(/opera/i)), \r\n  _isBadSafari = (!_wl.match(/usehtml5audio/i) && !_wl.match(/sm2\\-ignorebadua/i) && _isSafari && _ua.match(/OS X 10_6_([3-7])/i)), // Safari 4 and 5 occasionally fail to load/play HTML5 audio on Snow Leopard 10.6.3 through 10.6.7 due to bug(s) in QuickTime X and/or other underlying frameworks. :/ Confirmed bug. https://bugs.webkit.org/show_bug.cgi?id=32159\r\n  _hasConsole = (typeof console !== 'undefined' && typeof console.log !== 'undefined'), _isFocused = (typeof _doc.hasFocus !== 'undefined'?_doc.hasFocus():null), _tryInitOnFocus = (_isSafari && typeof _doc.hasFocus === 'undefined'), _okToDisable = !_tryInitOnFocus, _flashMIME = /(mp3|mp4|mpa)/i,\r\n  _overHTTP = (_doc.location?_doc.location.protocol.match(/http/i):null),\r\n  _http = (!_overHTTP ? 'http:' : '');\r\n\r\n  this.useAltURL = !_overHTTP; // use altURL if not \"online\"\r\n  this._global_a = null;\r\n\r\n  if (_likesHTML5) {\r\n    // prefer HTML5 for mobile + tablet-like devices, probably more reliable vs. flash at this point.\r\n    _s.useHTML5Audio = true;\r\n    _s.preferFlash = false;\r\n    if (_is_iDevice) {\r\n      // by default, use global feature. iOS onfinish() -> next may fail otherwise.\r\n      _s.ignoreFlash = true;\r\n      _useGlobalHTML5Audio = true;\r\n    }\r\n  }\r\n\r\n  /*\r\n   * public soundManager API\r\n  */\r\n\r\n  this.ok = function () {\r\n    return (_needsFlash?(_didInit && !_disabled):(_s.useHTML5Audio && _s.hasHTML5));\r\n  };\r\n\r\n  this.supported = this.ok; // legacy\r\n\r\n  this.getMovie = function (smID) {\r\n    return _isIE?_win[smID]:(_isSafari?_id(smID) || _doc[smID]:_id(smID));\r\n  };\r\n\r\n  this.createSound = function (oOptions) {\r\n    var _cs = _sm+'.createSound(): ',\r\n    thisOptions = null, oSound = null, _tO = null;\r\n    if (!_didInit || !_s.ok()) {\r\n      _complain(_cs + _str(!_didInit?'notReady':'notOK'));\r\n      return false;\r\n    }\r\n    if (arguments.length === 2) {\r\n      // function overloading in JS! :) ..assume simple createSound(id,url) use case\r\n      oOptions = {\r\n        'id': arguments[0],\r\n        'url': arguments[1]\r\n      };\r\n    }\r\n    thisOptions = _mixin(oOptions); // inherit from defaultOptions\r\n    _tO = thisOptions; // alias\r\n    // <d>\r\n    if (_tO.id.toString().charAt(0).match(/^[0-9]$/)) {\r\n      _s._wD(_cs + _str('badID', _tO.id), 2);\r\n    }\r\n    _s._wD(_cs + _tO.id + ' (' + _tO.url + ')', 1);\r\n    // </d>\r\n    if (_idCheck(_tO.id, true)) {\r\n      _s._wD(_cs + _tO.id + ' exists', 1);\r\n      return _s.sounds[_tO.id];\r\n    }\r\n\r\n    function make() {\r\n      thisOptions = _loopFix(thisOptions);\r\n      _s.sounds[_tO.id] = new SMSound(_tO);\r\n      _s.soundIDs.push(_tO.id);\r\n      return _s.sounds[_tO.id];\r\n    }\r\n\r\n    if (_html5OK(_tO)) {\r\n      oSound = make();\r\n      _s._wD('Loading sound '+_tO.id+' via HTML5');\r\n      oSound._setup_html5(_tO);\r\n    } else {\r\n      if (_fV > 8 && _s.useMovieStar) {\r\n        if (_tO.isMovieStar === null) {\r\n          _tO.isMovieStar = ((_tO.serverURL || (_tO.type?_tO.type.match(_s.netStreamPattern):false)||_tO.url.match(_s.netStreamPattern))?true:false);\r\n        }\r\n        if (_tO.isMovieStar) {\r\n          _s._wD(_cs + 'using MovieStar handling');\r\n        }\r\n        if (_tO.isMovieStar) {\r\n          if (_tO.usePeakData) {\r\n            _wDS('noPeak');\r\n            _tO.usePeakData = false;\r\n          }\r\n          if (_tO.loops > 1) {\r\n            _wDS('noNSLoop');\r\n          }\r\n        }\r\n      }\r\n      _tO = _policyFix(_tO, _cs);\r\n      oSound = make();\r\n      if (_fV === 8) {\r\n        _s.o._createSound(_tO.id, _tO.onjustbeforefinishtime, _tO.loops||1, _tO.usePolicyFile);\r\n      } else {\r\n        _s.o._createSound(_tO.id, _tO.url, _tO.onjustbeforefinishtime, _tO.usePeakData, _tO.useWaveformData, _tO.useEQData, _tO.isMovieStar, (_tO.isMovieStar?_tO.bufferTime:false), _tO.loops||1, _tO.serverURL, _tO.duration||null, _tO.autoPlay, true, _tO.autoLoad, _tO.usePolicyFile);\r\n        if (!_tO.serverURL) {\r\n          // We are connected immediately\r\n          oSound.connected = true;\r\n          if (_tO.onconnect) {\r\n            _tO.onconnect.apply(oSound);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (!_tO.serverURL && (_tO.autoLoad || _tO.autoPlay)) {\r\n        oSound.load(_tO); // call load for non-rtmp streams\r\n      }\r\n    }\r\n    if (!_tO.serverURL && _tO.autoPlay) { // rtmp will play in onconnect\r\n      oSound.play();\r\n    }\r\n    return oSound;\r\n  };\r\n\r\n  this.destroySound = function (sID, _bFromSound) {\r\n    // explicitly destroy a sound before normal page unload, etc.\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    var oS = _s.sounds[sID], i;\r\n    oS._iO = {}; // Disable all callbacks while the sound is being destroyed\r\n    oS.stop();\r\n    oS.unload();\r\n    for (i = 0; i < _s.soundIDs.length; i++) {\r\n      if (_s.soundIDs[i] === sID) {\r\n        _s.soundIDs.splice(i, 1);\r\n        break;\r\n      }\r\n    }\r\n    if (!_bFromSound) {\r\n      // ignore if being called from SMSound instance\r\n      oS.destruct(true);\r\n    }\r\n    oS = null;\r\n    delete _s.sounds[sID];\r\n    return true;\r\n  };\r\n\r\n  this.load = function (sID, oOptions) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].load(oOptions);\r\n  };\r\n\r\n  this.unload = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].unload();\r\n  };\r\n\r\n  this.play = function (sID, oOptions) {\r\n    var fN = _sm+'.play(): ';\r\n    if (!_didInit || !_s.ok()) {\r\n      _complain(fN + _str(!_didInit?'notReady':'notOK'));\r\n      return false;\r\n    }\r\n    if (!_idCheck(sID)) {\r\n      if (!(oOptions instanceof Object)) {\r\n        oOptions = {\r\n          url: oOptions\r\n        }; // overloading use case: play('mySound','/path/to/some.mp3');\r\n      }\r\n      if (oOptions && oOptions.url) {\r\n        // overloading use case, create+play: .play('someID',{url:'/path/to.mp3'});\r\n        _s._wD(fN + 'attempting to create \"' + sID + '\"', 1);\r\n        oOptions.id = sID;\r\n        return _s.createSound(oOptions).play();\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n    return _s.sounds[sID].play(oOptions);\r\n  };\r\n\r\n  this.start = this.play; // just for convenience\r\n\r\n  this.setPosition = function (sID, nMsecOffset) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].setPosition(nMsecOffset);\r\n  };\r\n\r\n  this.stop = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    _s._wD(_sm+'.stop(' + sID + ')', 1);\r\n    return _s.sounds[sID].stop();\r\n  };\r\n\r\n  this.stopAll = function () {\r\n    var oSound;\r\n    _s._wD(_sm+'.stopAll()', 1);\r\n    for (oSound in _s.sounds) {\r\n      if (_s.sounds.hasOwnProperty(oSound)) {\r\n        _s.sounds[oSound].stop(); // apply only to sound objects\r\n      }\r\n    }\r\n  };\r\n\r\n  this.pause = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].pause();\r\n  };\r\n\r\n  this.pauseAll = function () {\r\n    var i;\r\n    for (i = _s.soundIDs.length; i--;) {\r\n      _s.sounds[_s.soundIDs[i]].pause();\r\n    }\r\n  };\r\n\r\n  this.resume = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].resume();\r\n  };\r\n\r\n  this.resumeAll = function () {\r\n    var i;\r\n    for (i = _s.soundIDs.length; i--;) {\r\n      _s.sounds[_s.soundIDs[i]].resume();\r\n    }\r\n  };\r\n\r\n  this.togglePause = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].togglePause();\r\n  };\r\n\r\n  this.setPan = function (sID, nPan) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].setPan(nPan);\r\n  };\r\n\r\n  this.setVolume = function (sID, nVol) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].setVolume(nVol);\r\n  };\r\n\r\n  this.mute = function (sID) {\r\n    var fN = _sm+'.mute(): ',\r\n    i = 0;\r\n    if (typeof sID !== 'string') {\r\n      sID = null;\r\n    }\r\n    if (!sID) {\r\n      _s._wD(fN + 'Muting all sounds');\r\n      for (i = _s.soundIDs.length; i--;) {\r\n        _s.sounds[_s.soundIDs[i]].mute();\r\n      }\r\n      _s.muted = true;\r\n    } else {\r\n      if (!_idCheck(sID)) {\r\n        return false;\r\n      }\r\n      _s._wD(fN + 'Muting \"' + sID + '\"');\r\n      return _s.sounds[sID].mute();\r\n    }\r\n    return true;\r\n  };\r\n\r\n  this.muteAll = function () {\r\n    _s.mute();\r\n  };\r\n\r\n  this.unmute = function (sID) {\r\n    var fN = _sm+'.unmute(): ', i;\r\n    if (typeof sID !== 'string') {\r\n      sID = null;\r\n    }\r\n    if (!sID) {\r\n      _s._wD(fN + 'Unmuting all sounds');\r\n      for (i = _s.soundIDs.length; i--;) {\r\n        _s.sounds[_s.soundIDs[i]].unmute();\r\n      }\r\n      _s.muted = false;\r\n    } else {\r\n      if (!_idCheck(sID)) {\r\n        return false;\r\n      }\r\n      _s._wD(fN + 'Unmuting \"' + sID + '\"');\r\n      return _s.sounds[sID].unmute();\r\n    }\r\n    return true;\r\n  };\r\n\r\n  this.unmuteAll = function () {\r\n    _s.unmute();\r\n  };\r\n\r\n  this.toggleMute = function (sID) {\r\n    if (!_idCheck(sID)) {\r\n      return false;\r\n    }\r\n    return _s.sounds[sID].toggleMute();\r\n  };\r\n\r\n  this.getMemoryUse = function () {\r\n    // flash-only\r\n    var ram = 0;\r\n    if (_s.o && _fV !== 8) {\r\n      ram = parseInt(_s.o._getMemoryUse(), 10);\r\n    }\r\n    return ram;\r\n  };\r\n\r\n  this.disable = function (bNoDisable) {\r\n    // destroy all functions\r\n    var i;\r\n    if (typeof bNoDisable === 'undefined') {\r\n      bNoDisable = false;\r\n    }\r\n    if (_disabled) {\r\n      return false;\r\n    }\r\n    _disabled = true;\r\n    _wDS('shutdown', 1);\r\n    for (i = _s.soundIDs.length; i--;) {\r\n      _disableObject(_s.sounds[_s.soundIDs[i]]);\r\n    }\r\n    _initComplete(bNoDisable); // fire \"complete\", despite fail\r\n    _event.remove(_win, 'load', _initUserOnload);\r\n    return true;\r\n  };\r\n\r\n  this.canPlayMIME = function (sMIME) {\r\n    var result;\r\n    if (_s.hasHTML5) {\r\n      result = _html5CanPlay({type:sMIME});\r\n    }\r\n    if (!_needsFlash || result) {\r\n      // no flash, or OK\r\n      return result;\r\n    } else {\r\n      return (sMIME?(sMIME.match(_s.mimePattern)?true:false):null);\r\n    }\r\n  };\r\n\r\n  this.canPlayURL = function (sURL) {\r\n    var result;\r\n    if (_s.hasHTML5) {\r\n      result = _html5CanPlay({url: sURL});\r\n    }\r\n    if (!_needsFlash || result) {\r\n      // no flash, or OK\r\n      return result;\r\n    } else {\r\n      return (sURL?(sURL.match(_s.filePattern)?true:false):null);\r\n    }\r\n  };\r\n\r\n  this.canPlayLink = function (oLink) {\r\n    if (typeof oLink.type !== 'undefined' && oLink.type) {\r\n      if (_s.canPlayMIME(oLink.type)) {\r\n        return true;\r\n      }\r\n    }\r\n    return _s.canPlayURL(oLink.href);\r\n  };\r\n\r\n  this.getSoundById = function (sID, suppressDebug) {\r\n    if (!sID) {\r\n      throw new Error(_sm+'.getSoundById(): sID is null/undefined');\r\n    }\r\n    var result = _s.sounds[sID];\r\n    if (!result && !suppressDebug) {\r\n      _s._wD('\"' + sID + '\" is an invalid sound ID.', 2);\r\n    }\r\n    return result;\r\n  };\r\n\r\n  this.onready = function (oMethod, oScope) {\r\n    var sType = 'onready';\r\n    if (oMethod && oMethod instanceof Function) {\r\n      if (_didInit) {\r\n        _s._wD(_str('queue', sType));\r\n      }\r\n      if (!oScope) {\r\n        oScope = _win;\r\n      }\r\n      _addOnEvent(sType, oMethod, oScope);\r\n      _processOnEvents();\r\n      return true;\r\n    } else {\r\n      throw _str('needFunction', sType);\r\n    }\r\n  };\r\n\r\n  this.ontimeout = function (oMethod, oScope) {\r\n    var sType = 'ontimeout';\r\n    if (oMethod && oMethod instanceof Function) {\r\n      if (_didInit) {\r\n        _s._wD(_str('queue', sType));\r\n      }\r\n      if (!oScope) {\r\n        oScope = _win;\r\n      }\r\n      _addOnEvent(sType, oMethod, oScope);\r\n      _processOnEvents({type:sType});\r\n      return true;\r\n    } else {\r\n      throw _str('needFunction', sType);\r\n    }\r\n  };\r\n\r\n  this._writeDebug = function (sText, sType, bTimestamp) {\r\n    // pseudo-private console.log()-style output\r\n    // <d>\r\n    var sDID = 'soundmanager-debug', o, oItem, sMethod;\r\n    if (!_s.debugMode) {\r\n      return false;\r\n    }\r\n    if (typeof bTimestamp !== 'undefined' && bTimestamp) {\r\n      sText = sText + ' | ' + new Date().getTime();\r\n    }\r\n    if (_hasConsole && _s.useConsole) {\r\n      sMethod = _debugLevels[sType];\r\n      if (typeof console[sMethod] !== 'undefined') {\r\n        console[sMethod](sText);\r\n      } else {\r\n        console.log(sText);\r\n      }\r\n      if (_s.useConsoleOnly) {\r\n        return true;\r\n      }\r\n    }\r\n    try {\r\n      o = _id(sDID);\r\n      if (!o) {\r\n        return false;\r\n      }\r\n      oItem = _doc.createElement('div');\r\n      if (++_wdCount % 2 === 0) {\r\n        oItem.className = 'sm2-alt';\r\n      }\r\n      if (typeof sType === 'undefined') {\r\n        sType = 0;\r\n      } else {\r\n        sType = parseInt(sType, 10);\r\n      }\r\n      oItem.appendChild(_doc.createTextNode(sText));\r\n      if (sType) {\r\n        if (sType >= 2) {\r\n          oItem.style.fontWeight = 'bold';\r\n        }\r\n        if (sType === 3) {\r\n          oItem.style.color = '#ff3333';\r\n        }\r\n      }\r\n      // o.appendChild(oItem); // top-to-bottom\r\n      o.insertBefore(oItem, o.firstChild); // bottom-to-top\r\n    } catch(e) {\r\n      // oh well\r\n    }\r\n    o = null;\r\n    // </d>\r\n    return true;\r\n  };\r\n  this._wD = this._writeDebug; // alias\r\n\r\n  this._debug = function () {\r\n    // <d>\r\n    var i, j;\r\n    _wDS('currentObj', 1);\r\n    for (i = 0, j = _s.soundIDs.length; i < j; i++) {\r\n      _s.sounds[_s.soundIDs[i]]._debug();\r\n    }\r\n    // </d>\r\n  };\r\n\r\n  this.reboot = function () {\r\n    // attempt to reset and init SM2\r\n    _s._wD(_sm+'.reboot()');\r\n    if (_s.soundIDs.length) {\r\n      _s._wD('Destroying ' + _s.soundIDs.length + ' SMSound objects...');\r\n    }\r\n    var i, j;\r\n    for (i = _s.soundIDs.length; i--;) {\r\n      _s.sounds[_s.soundIDs[i]].destruct();\r\n    }\r\n    // trash ze flash\r\n    try {\r\n      if (_isIE) {\r\n        _oRemovedHTML = _s.o.innerHTML;\r\n      }\r\n      _oRemoved = _s.o.parentNode.removeChild(_s.o);\r\n      _s._wD('Flash movie removed.');\r\n    } catch(e) {\r\n      // uh-oh.\r\n      _wDS('badRemove', 2);\r\n    }\r\n    // actually, force recreate of movie.\r\n    _oRemovedHTML = _oRemoved = _needsFlash = null;\r\n    _s.enabled = _didDCLoaded = _didInit = _waitingForEI = _initPending = _didAppend = _appendSuccess = _disabled = _s.swfLoaded = false;\r\n    _s.soundIDs = _s.sounds = [];\r\n    _s.o = null;\r\n    for (i in _on_queue) {\r\n      if (_on_queue.hasOwnProperty(i)) {\r\n        for (j = _on_queue[i].length; j--;) {\r\n          _on_queue[i][j].fired = false;\r\n        }\r\n      }\r\n    }\r\n    _s._wD(_sm + ': Rebooting...');\r\n    _win.setTimeout(_s.beginDelayedInit, 20);\r\n  };\r\n\r\n  this.getMoviePercent = function () {\r\n    return (_s.o && typeof _s.o.PercentLoaded !== 'undefined' ? _s.o.PercentLoaded() : null);\r\n  };\r\n\r\n  this.beginDelayedInit = function () {\r\n    _windowLoaded = true;\r\n    _dcLoaded();\r\n    setTimeout(function () {\r\n      if (_initPending) {\r\n        return false;\r\n      }\r\n      _createMovie();\r\n      _initMovie();\r\n      _initPending = true;\r\n      return true;\r\n    }, 20);\r\n    _delayWaitForEI();\r\n  };\r\n\r\n  this.destruct = function () {\r\n    _s._wD(_sm+'.destruct()');\r\n    _s.disable(true);\r\n  };\r\n\r\n  /*\r\n   * internal HTML5 event handling\r\n  */\r\n\r\n  function _html5_event(oFn) {\r\n    // wrap html5 event handlers so we don't call them on destroyed sounds\r\n    return function (e) {\r\n      if (!this._t || !this._t._a) {\r\n        if (this._t && this._t.sID) {\r\n          _s._wD(_h5+'ignoring '+e.type+': '+this._t.sID);\r\n        } else {\r\n          _s._wD(_h5+'ignoring '+e.type);\r\n        }\r\n        return null;\r\n      } else {\r\n        return oFn.call(this, e);\r\n      }\r\n    };\r\n  }\r\n\r\n  _html5_events = {\r\n\r\n    // HTML5 event-name-to-handler map\r\n    abort: _html5_event(function (e) {\r\n      _s._wD(_h5+'abort: '+this._t.sID);\r\n    }),\r\n\r\n    // enough has loaded to play\r\n    canplay: _html5_event(function (e) {\r\n      if (this._t._html5_canplay) {\r\n        // this event has already fired. ignore.\r\n        return true;\r\n      }\r\n      this._t._html5_canplay = true;\r\n      _s._wD(_h5+'canplay: '+this._t.sID+', '+this._t.url);\r\n      this._t._onbufferchange(0);\r\n      var position1K = (!isNaN(this._t.position)?this._t.position/1000:null);\r\n      // set the position if position was set before the sound loaded\r\n      if (this._t.position && this.currentTime !== position1K) {\r\n        _s._wD(_h5+'canplay: setting position to '+position1K);\r\n        try {\r\n          this.currentTime = position1K;\r\n        } catch(ee) {\r\n          _s._wD(_h5+'setting position failed: '+ee.message, 2);\r\n        }\r\n      }\r\n    }),\r\n\r\n    load: _html5_event(function (e) {\r\n      if (!this._t.loaded) {\r\n        this._t._onbufferchange(0);\r\n        // should be 1, and the same\r\n        this._t._whileloading(this._t.bytesTotal, this._t.bytesTotal, this._t._get_html5_duration());\r\n        this._t._onload(true);\r\n      }\r\n    }),\r\n\r\n    emptied: _html5_event(function (e) {\r\n      _s._wD(_h5+'emptied: '+this._t.sID);\r\n    }),\r\n\r\n    ended: _html5_event(function (e) {\r\n      _s._wD(_h5+'ended: '+this._t.sID);\r\n      this._t._onfinish();\r\n    }),\r\n\r\n    error: _html5_event(function (e) {\r\n      _s._wD(_h5+'error: '+this.error.code);\r\n      // call load with error state?\r\n      this._t._onload(false);\r\n    }),\r\n\r\n    loadeddata: _html5_event(function (e) {\r\n      var t = this._t,\r\n          bytesTotal = t.bytesTotal || 1; // at least 1 byte, so math works\r\n      _s._wD(_h5+'loadeddata: '+this._t.sID);\r\n      if (!t._loaded && !_isSafari) { // safari seems to nicely report progress events, eventually totalling 100%\r\n        t.duration = t._get_html5_duration();\r\n        // fire whileloading() with 100% values\r\n        t._whileloading(bytesTotal, bytesTotal, t._get_html5_duration());\r\n        t._onload(true);\r\n      }\r\n    }),\r\n\r\n    loadedmetadata: _html5_event(function (e) {\r\n      _s._wD(_h5+'loadedmetadata: '+this._t.sID);\r\n    }),\r\n\r\n    loadstart: _html5_event(function (e) {\r\n      _s._wD(_h5+'loadstart: '+this._t.sID);\r\n      // assume buffering at first\r\n      this._t._onbufferchange(1);\r\n    }),\r\n\r\n    play: _html5_event(function (e) {\r\n      _s._wD(_h5+'play: '+this._t.sID+', '+this._t.url);\r\n      // once play starts, no buffering\r\n      this._t._onbufferchange(0);\r\n    }),\r\n\r\n    // TODO: verify if this is actually implemented anywhere yet.\r\n    playing: _html5_event(function (e) {\r\n      _s._wD(_h5+'playing: '+this._t.sID+', '+this._t.url);\r\n      // once play starts, no buffering\r\n      this._t._onbufferchange(0);\r\n    }),\r\n\r\n    progress: _html5_event(function (e) {\r\n\r\n      if (this._t.loaded) {\r\n        return false;\r\n      }\r\n\r\n      var i, j, str, buffered = 0,\r\n          isProgress = (e.type === 'progress'),\r\n          ranges = e.target.buffered,\r\n          loaded = (e.loaded||0), // firefox 3.6 implements e.loaded/total (bytes)\r\n          total = (e.total||1);\r\n\r\n      if (ranges && ranges.length) {\r\n\r\n        // if loaded is 0, try TimeRanges implementation as % of load\r\n        // https://developer.mozilla.org/en/DOM/TimeRanges\r\n        for (i=ranges.length; i--;) {\r\n          buffered = (ranges.end(i) - ranges.start(i));\r\n        }\r\n\r\n        // linear case, buffer sum; does not account for seeking and HTTP partials / byte ranges\r\n        loaded = buffered/e.target.duration;\r\n\r\n        // <d>\r\n        if (isProgress && ranges.length > 1) {\r\n          str = [];\r\n          j = ranges.length;\r\n          for (i=0; i<j; i++) {\r\n            str.push(e.target.buffered.start(i) +'-'+ e.target.buffered.end(i));\r\n          }\r\n          _s._wD(_h5+'progress: timeRanges: '+str.join(', '));\r\n        }\r\n        // </d>\r\n\r\n        if (isProgress && !isNaN(loaded)) {\r\n          _s._wD(_h5+'progress: '+this._t.sID+': ' + Math.floor(loaded*100)+'% loaded');\r\n        }\r\n\r\n      }\r\n\r\n      if (!isNaN(loaded)) {\r\n\r\n        this._t._onbufferchange(0); // if progress, likely not buffering\r\n        this._t._whileloading(loaded, total, this._t._get_html5_duration());\r\n\r\n        if (loaded && total && loaded === total) {\r\n          // in case \"onload\" doesn't fire (eg. gecko 1.9.2)\r\n          _html5_events.load.call(this, e);\r\n        }\r\n\r\n      }\r\n\r\n    }),\r\n\r\n    ratechange: _html5_event(function (e) {\r\n      _s._wD(_h5+'ratechange: '+this._t.sID);\r\n    }),\r\n\r\n    suspend: _html5_event(function (e) {\r\n      // download paused/stopped, may have finished (eg. onload)\r\n      _s._wD(_h5+'suspend: '+this._t.sID);\r\n      _html5_events.progress.call(this, e);\r\n    }),\r\n\r\n    stalled: _html5_event(function (e) {\r\n      _s._wD(_h5+'stalled: '+this._t.sID);\r\n    }),\r\n\r\n    timeupdate: _html5_event(function (e) {\r\n      this._t._onTimer();\r\n    }),\r\n\r\n    waiting: _html5_event(function (e) { // see also: seeking\r\n      _s._wD(_h5+'waiting: '+this._t.sID);\r\n      // playback faster than download rate, etc.\r\n      this._t._onbufferchange(1);\r\n    })\r\n\r\n  };\r\n\r\n  /*\r\n   * SMSound() (sound object) instance\r\n  */\r\n\r\n  SMSound = function (oOptions) {\r\n\r\n    var _t = this, _resetProperties, _stop_html5_timer, _start_html5_timer;\r\n    this.sID = oOptions.id;\r\n    this.url = oOptions.url;\r\n    this.options = _mixin(oOptions);\r\n    this.instanceOptions = this.options; // per-play-instance-specific options\r\n    this._iO = this.instanceOptions; // short alias\r\n    // assign property defaults\r\n    this.pan = this.options.pan;\r\n    this.volume = this.options.volume;\r\n    this._lastURL = null;\r\n    this.isHTML5 = false;\r\n    this._a = null;\r\n\r\n    // --- public methods ---\r\n\r\n    this.id3 = {};\r\n\r\n    this._debug = function () {\r\n      // <d>\r\n      // pseudo-private console.log()-style output\r\n      if (_s.debugMode) {\r\n        var stuff = null, msg = [], sF, sfBracket, maxLength = 64;\r\n        for (stuff in _t.options) {\r\n          if (_t.options[stuff] !== null) {\r\n            if (_t.options[stuff] instanceof Function) {\r\n              // handle functions specially\r\n              sF = _t.options[stuff].toString();\r\n              sF = sF.replace(/\\s\\s+/g, ' '); // normalize spaces\r\n              sfBracket = sF.indexOf('{');\r\n              msg.push(' ' + stuff + ': {' + sF.substr(sfBracket + 1, (Math.min(Math.max(sF.indexOf('\\n') - 1, maxLength), maxLength))).replace(/\\n/g, '') + '... }');\r\n            } else {\r\n              msg.push(' ' + stuff + ': ' + _t.options[stuff]);\r\n            }\r\n          }\r\n        }\r\n        _s._wD('SMSound() merged options: {\\n' + msg.join(', \\n') + '\\n}');\r\n      }\r\n      // </d>\r\n    };\r\n\r\n    // <d>\r\n    this._debug();\r\n    // </d>\r\n\r\n    this.load = function (oOptions) {\r\n      var oS = null;\r\n      if (typeof oOptions !== 'undefined') {\r\n        _t._iO = _mixin(oOptions, _t.options);\r\n        _t.instanceOptions = _t._iO;\r\n      } else {\r\n        oOptions = _t.options;\r\n        _t._iO = oOptions;\r\n        _t.instanceOptions = _t._iO;\r\n        if (_t._lastURL && _t._lastURL !== _t.url) {\r\n          _wDS('manURL');\r\n          _t._iO.url = _t.url;\r\n          _t.url = null;\r\n        }\r\n      }\r\n      if (!_t._iO.url) {\r\n        _t._iO.url = _t.url;\r\n      }\r\n      _s._wD('SMSound.load(): ' + _t._iO.url, 1);\r\n      if (_t._iO.url === _t.url && _t.readyState !== 0 && _t.readyState !== 2) {\r\n        _wDS('onURL', 1);\r\n        return _t;\r\n      }\r\n      _t._lastURL = _t.url;\r\n      _t.loaded = false;\r\n      _t.readyState = 1;\r\n      _t.playState = 0;\r\n      if (_html5OK(_t._iO)) {\r\n        oS = _t._setup_html5(_t._iO);\r\n        if (!oS._called_load) {\r\n          _s._wD(_h5+'load: '+_t.sID);\r\n          _t._html5_canplay = false;\r\n          oS.load();\r\n          oS._called_load = true;\r\n          if (_t._iO.autoPlay) {\r\n            _t.play();\r\n          }\r\n        } else {\r\n          _s._wD(_h5+'ignoring request to load again: '+_t.sID);\r\n        }\r\n      } else {\r\n        try {\r\n          _t.isHTML5 = false;\r\n          _t._iO = _policyFix(_loopFix(_t._iO));\r\n          if (_fV === 8) {\r\n            _s.o._load(_t.sID, _t._iO.url, _t._iO.stream, _t._iO.autoPlay, (_t._iO.whileloading?1:0), _t._iO.loops||1, _t._iO.usePolicyFile);\r\n          } else {\r\n            _s.o._load(_t.sID, _t._iO.url, _t._iO.stream?true:false, _t._iO.autoPlay?true:false, _t._iO.loops||1, _t._iO.autoLoad?true:false, _t._iO.usePolicyFile);\r\n          }\r\n        } catch(e) {\r\n          _wDS('smError', 2);\r\n          _debugTS('onload', false);\r\n          _catchError({type:'SMSOUND_LOAD_JS_EXCEPTION', fatal:true});\r\n        }\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.unload = function () {\r\n      // Flash 8/AS2 can't \"close\" a stream - fake it by loading an empty MP3\r\n      // Flash 9/AS3: Close stream, preventing further load\r\n      if (_t.readyState !== 0) {\r\n        _s._wD('SMSound.unload(): \"' + _t.sID + '\"');\r\n        if (!_t.isHTML5) {\r\n          if (_fV === 8) {\r\n            _s.o._unload(_t.sID, _s.nullURL);\r\n          } else {\r\n            _s.o._unload(_t.sID);\r\n          }\r\n        } else {\r\n          _stop_html5_timer();\r\n          if (_t._a) {\r\n            // abort()-style method here, stop loading? (doesn't exist?)\r\n            _t._a.pause();\r\n            _t._a.src = ''; // https://developer.mozilla.org/En/Using_audio_and_video_in_Firefox#Stopping_the_download_of_media\r\n          }\r\n        }\r\n        // reset load/status flags\r\n        _resetProperties();\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.destruct = function (_bFromSM) {\r\n      _s._wD('SMSound.destruct(): \"' + _t.sID + '\"');\r\n      if (!_t.isHTML5) {\r\n        // kill sound within Flash\r\n        // Disable the onfailure handler\r\n        _t._iO.onfailure = null;\r\n        _s.o._destroySound(_t.sID);\r\n      } else {\r\n        _stop_html5_timer();\r\n        if (_t._a) {\r\n          // abort()-style method here, stop loading? (doesn't exist?)\r\n          _t._a.pause();\r\n          _t._a.src = ''; // https://developer.mozilla.org/En/Using_audio_and_video_in_Firefox#Stopping_the_download_of_media\r\n          if (!_useGlobalHTML5Audio) {\r\n            _t._remove_html5_events();\r\n          }\r\n          _t._a._t = null; // break potential circular reference\r\n          _t._a = null;\r\n        }\r\n      }\r\n      if (!_bFromSM) {\r\n        _s.destroySound(_t.sID, true); // ensure deletion from controller\r\n      }\r\n    };\r\n\r\n    this.play = function (oOptions, _updatePlayState) {\r\n      var fN = 'SMSound.play(): ', allowMulti, a;\r\n      _updatePlayState = _updatePlayState === undefined ? true : _updatePlayState; // default to true\r\n      if (!oOptions) {\r\n        oOptions = {};\r\n      }\r\n      _t._iO = _mixin(oOptions, _t._iO);\r\n      _t._iO = _mixin(_t._iO, _t.options);\r\n      _t.instanceOptions = _t._iO;\r\n      if (_t._iO.serverURL && !_t.connected) {\r\n        if (!_t.getAutoPlay()) {\r\n          _s._wD(fN+' Netstream not connected yet - setting autoPlay');\r\n          _t.setAutoPlay(true);\r\n        }\r\n        return _t; // play will be called in _onconnect()\r\n      }\r\n      if (_html5OK(_t._iO)) {\r\n        _t._setup_html5(_t._iO);\r\n        _start_html5_timer();\r\n      }\r\n      if (_t.playState === 1 && !_t.paused) {\r\n        allowMulti = _t._iO.multiShot;\r\n        if (!allowMulti) {\r\n          _s._wD(fN + '\"' + _t.sID + '\" already playing (one-shot)', 1);\r\n          return _t;\r\n        } else {\r\n          _s._wD(fN + '\"' + _t.sID + '\" already playing (multi-shot)', 1);\r\n        }\r\n      }\r\n      if (!_t.loaded) {\r\n        if (_t.readyState === 0) {\r\n          _s._wD(fN + 'Attempting to load \"' + _t.sID + '\"', 1);\r\n          // try to get this sound playing ASAP\r\n          if (!_t.isHTML5) {\r\n            _t._iO.autoPlay = true; // assign directly because setAutoPlay() increments the instanceCount\r\n          }\r\n          _t.load(_t._iO);\r\n        } else if (_t.readyState === 2) {\r\n          _s._wD(fN + 'Could not load \"' + _t.sID + '\" - exiting', 2);\r\n          return _t;\r\n        } else {\r\n          _s._wD(fN + '\"' + _t.sID + '\" is loading - attempting to play..', 1);\r\n        }\r\n      } else {\r\n        _s._wD(fN + '\"' + _t.sID + '\"');\r\n      }\r\n      if (!_t.isHTML5 && _fV === 9 && _t.position > 0 && _t.position === _t.duration) {\r\n        // flash 9 needs a position reset if play() is called while at the end of a sound.\r\n        _s._wD(fN + '\"' + _t.sID + '\": Sound at end, resetting to position:0');\r\n        _t._iO.position = 0;\r\n      }\r\n      /*\r\n       * Streams will pause when their buffer is full if they are being loaded.\r\n       * In this case paused is true, but the song hasn't started playing yet.\r\n       * If we just call resume() the onplay() callback will never be called.\r\n       * So only call resume() if the position is > 0.\r\n       * Another reason is because options like volume won't have been applied yet.\r\n      */\r\n      if (_t.paused && _t.position && _t.position > 0) { // https://gist.github.com/37b17df75cc4d7a90bf6\r\n        _s._wD(fN + '\"' + _t.sID + '\" is resuming from paused state',1);\r\n        _t.resume();\r\n      } else {\r\n        _s._wD(fN+'\"'+ _t.sID+'\" is starting to play');\r\n        _t.playState = 1;\r\n        _t.paused = false;\r\n        if (!_t.instanceCount || _t._iO.multiShotEvents || (!_t.isHTML5 && _fV > 8 && !_t.getAutoPlay())) {\r\n          _t.instanceCount++;\r\n        }\r\n        _t.position = (typeof _t._iO.position !== 'undefined' && !isNaN(_t._iO.position)?_t._iO.position:0);\r\n        if (!_t.isHTML5) {\r\n          _t._iO = _policyFix(_loopFix(_t._iO));\r\n        }\r\n        if (_t._iO.onplay && _updatePlayState) {\r\n          _t._iO.onplay.apply(_t);\r\n          _t._onplay_called = true;\r\n        }\r\n        _t.setVolume(_t._iO.volume, true);\r\n        _t.setPan(_t._iO.pan, true);\r\n        if (!_t.isHTML5) {\r\n          _s.o._start(_t.sID, _t._iO.loops || 1, (_fV === 9?_t._iO.position:_t._iO.position / 1000));\r\n        } else {\r\n          _start_html5_timer();\r\n          a = _t._setup_html5();\r\n          _t.setPosition(_t._iO.position);\r\n          a.play();\r\n        }\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.start = this.play; // just for convenience\r\n\r\n    this.stop = function (bAll) {\r\n      if (_t.playState === 1) {\r\n        _t._onbufferchange(0);\r\n        _t.resetOnPosition(0);\r\n        if (!_t.isHTML5) {\r\n          _t.playState = 0;\r\n        }\r\n        _t.paused = false;\r\n        if (_t._iO.onstop) {\r\n          _t._iO.onstop.apply(_t);\r\n        }\r\n        if (!_t.isHTML5) {\r\n          _s.o._stop(_t.sID, bAll);\r\n          // hack for netStream: just unload\r\n          if (_t._iO.serverURL) {\r\n            _t.unload();\r\n          }\r\n        } else {\r\n          if (_t._a) {\r\n            _t.setPosition(0); // act like Flash, though\r\n            _t._a.pause(); // html5 has no stop()\r\n            _t.playState = 0;\r\n            _t._onTimer(); // and update UI\r\n            _stop_html5_timer();\r\n            _t.unload();\r\n          }\r\n        }\r\n        _t.instanceCount = 0;\r\n        _t._iO = {};\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.setAutoPlay = function (autoPlay) {\r\n      _s._wD('sound '+_t.sID+' turned autoplay ' + (autoPlay ? 'on' : 'off'));\r\n      _t._iO.autoPlay = autoPlay;\r\n      if (!_t.isHTML5) {\r\n        _s.o._setAutoPlay(_t.sID, autoPlay);\r\n        if (autoPlay) {\r\n          // only increment the instanceCount if the sound isn't loaded (TODO: verify RTMP)\r\n          if (!_t.instanceCount && _t.readyState === 1) {\r\n            _t.instanceCount++;\r\n            _s._wD('sound '+_t.sID+' incremented instance count to '+_t.instanceCount);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this.getAutoPlay = function () {\r\n      return _t._iO.autoPlay;\r\n    };\r\n\r\n    this.setPosition = function (nMsecOffset) {\r\n      if (nMsecOffset === undefined) {\r\n        nMsecOffset = 0;\r\n      }\r\n      // Use the duration from the instance options, if we don't have a track duration yet.\r\n      var original_pos, position, position1K,\r\n          offset = (_t.isHTML5 ? Math.max(nMsecOffset,0) : Math.min(_t.duration || _t._iO.duration, Math.max(nMsecOffset, 0))); // position >= 0 and <= current available (loaded) duration\r\n      original_pos = _t.position;\r\n      _t.position = offset;\r\n      position1K = _t.position/1000;\r\n      _t.resetOnPosition(_t.position);\r\n      _t._iO.position = offset;\r\n      if (!_t.isHTML5) {\r\n        position = (_fV === 9 ? _t.position : position1K);\r\n        if (_t.readyState && _t.readyState !== 2) {\r\n          _s.o._setPosition(_t.sID, position, (_t.paused || !_t.playState)); // if paused or not playing, will not resume (by playing)\r\n        }\r\n      } else if (_t._a) {\r\n        // Set the position in the canplay handler if the sound is not ready yet\r\n        if (_t._html5_canplay) {\r\n          if (_t._a.currentTime !== position1K) {\r\n            /*\r\n             * DOM/JS errors/exceptions to watch out for:\r\n             * if seek is beyond (loaded?) position, \"DOM exception 11\"\r\n             * \"INDEX_SIZE_ERR\": DOM exception 1\r\n            */\r\n            _s._wD('setPosition('+position1K+'): setting position');\r\n            try {\r\n              _t._a.currentTime = position1K;\r\n              if (_t.playState === 0 || _t.paused) {\r\n                // allow seek without auto-play/resume\r\n                _t._a.pause();\r\n              }\r\n            } catch(e) {\r\n              _s._wD('setPosition('+position1K+'): setting position failed: '+e.message, 2);\r\n            }\r\n          }\r\n        } else {\r\n          _s._wD('setPosition('+position1K+'): delaying, sound not ready');\r\n        }\r\n      }\r\n      if (_t.isHTML5) {\r\n        if (_t.paused) { // if paused, refresh UI right away\r\n          _t._onTimer(true); // force update\r\n        }\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.pause = function (bCallFlash) {\r\n      if (_t.paused || (_t.playState === 0 && _t.readyState !== 1)) {\r\n        return _t;\r\n      }\r\n      _s._wD('SMSound.pause()');\r\n      _t.paused = true;\r\n      if (!_t.isHTML5) {\r\n        if (bCallFlash || bCallFlash === undefined) {\r\n          _s.o._pause(_t.sID);\r\n        }\r\n      } else {\r\n        _t._setup_html5().pause();\r\n        _stop_html5_timer();\r\n      }\r\n      if (_t._iO.onpause) {\r\n        _t._iO.onpause.apply(_t);\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    /*\r\n     * When auto-loaded streams pause on buffer full they have a playState of 0.\r\n     * We need to make sure that the playState is set to 1 when these streams \"resume\".\r\n     * When a paused stream is resumed, we need to trigger the onplay() callback if it\r\n     * hasn't been called already. In this case since the sound is being played for the\r\n     * first time, I think it's more appropriate to call onplay() rather than onresume().\r\n    */\r\n    this.resume = function () {\r\n      if (!_t.paused) {\r\n        return _t;\r\n      }\r\n      _s._wD('SMSound.resume()');\r\n      _t.paused = false;\r\n      _t.playState = 1;\r\n      if (!_t.isHTML5) {\r\n        if (_t._iO.isMovieStar) {\r\n          // Bizarre Webkit bug (Chrome reported via 8tracks.com dudes): AAC content paused for 30+ seconds(?) will not resume without a reposition.\r\n          _t.setPosition(_t.position);\r\n        }\r\n        _s.o._pause(_t.sID); // flash method is toggle-based (pause/resume)\r\n      } else {\r\n        _t._setup_html5().play();\r\n        _start_html5_timer();\r\n      }\r\n      if (!_t._onplay_called && _t._iO.onplay) {\r\n        _t._iO.onplay.apply(_t);\r\n        _t._onplay_called = true;\r\n      } else if (_t._iO.onresume) {\r\n        _t._iO.onresume.apply(_t);\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.togglePause = function () {\r\n      _s._wD('SMSound.togglePause()');\r\n      if (_t.playState === 0) {\r\n        _t.play({\r\n          position: (_fV === 9 && !_t.isHTML5 ? _t.position : _t.position / 1000)\r\n        });\r\n        return _t;\r\n      }\r\n      if (_t.paused) {\r\n        _t.resume();\r\n      } else {\r\n        _t.pause();\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.setPan = function (nPan, bInstanceOnly) {\r\n      if (typeof nPan === 'undefined') {\r\n        nPan = 0;\r\n      }\r\n      if (typeof bInstanceOnly === 'undefined') {\r\n        bInstanceOnly = false;\r\n      }\r\n      if (!_t.isHTML5) {\r\n        _s.o._setPan(_t.sID, nPan);\r\n      } // else { no HTML5 pan? }\r\n      _t._iO.pan = nPan;\r\n      if (!bInstanceOnly) {\r\n        _t.pan = nPan;\r\n        _t.options.pan = nPan;\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.setVolume = function (nVol, bInstanceOnly) {\r\n      if (typeof nVol === 'undefined') {\r\n        nVol = 100;\r\n      }\r\n      if (typeof bInstanceOnly === 'undefined') {\r\n        bInstanceOnly = false;\r\n      }\r\n      if (!_t.isHTML5) {\r\n        _s.o._setVolume(_t.sID, (_s.muted && !_t.muted) || _t.muted?0:nVol);\r\n      } else if (_t._a) {\r\n        _t._a.volume = Math.max(0, Math.min(1, nVol/100)); // valid range: 0-1\r\n      }\r\n      _t._iO.volume = nVol;\r\n      if (!bInstanceOnly) {\r\n        _t.volume = nVol;\r\n        _t.options.volume = nVol;\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.mute = function () {\r\n      _t.muted = true;\r\n      if (!_t.isHTML5) {\r\n        _s.o._setVolume(_t.sID, 0);\r\n      } else if (_t._a) {\r\n        _t._a.muted = true;\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.unmute = function () {\r\n      _t.muted = false;\r\n      var hasIO = typeof _t._iO.volume !== 'undefined';\r\n      if (!_t.isHTML5) {\r\n        _s.o._setVolume(_t.sID, hasIO?_t._iO.volume:_t.options.volume);\r\n      } else if (_t._a) {\r\n        _t._a.muted = false;\r\n      }\r\n      return _t;\r\n    };\r\n\r\n    this.toggleMute = function () {\r\n      return (_t.muted?_t.unmute():_t.mute());\r\n    };\r\n\r\n    this.onposition = function (nPosition, oMethod, oScope) {\r\n      // TODO: allow for ranges, too? eg. (nPosition instanceof Array)\r\n      _t._onPositionItems.push({\r\n        position: nPosition,\r\n        method: oMethod,\r\n        scope: (typeof oScope !== 'undefined'?oScope:_t),\r\n        fired: false\r\n      });\r\n      return _t;\r\n    };\r\n\r\n    this.processOnPosition = function () {\r\n      var i, item, j = _t._onPositionItems.length;\r\n      if (!j || !_t.playState || _t._onPositionFired >= j) {\r\n        return false;\r\n      }\r\n      for (i=j; i--;) {\r\n        item = _t._onPositionItems[i];\r\n        if (!item.fired && _t.position >= item.position) {\r\n          item.method.apply(item.scope,[item.position]);\r\n          item.fired = true;\r\n          _s._onPositionFired++;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n\r\n    this.resetOnPosition = function (nPosition) {\r\n      // reset \"fired\" for items interested in this position\r\n      var i, item, j = _t._onPositionItems.length;\r\n      if (!j) {\r\n        return false;\r\n      }\r\n      for (i=j; i--;) {\r\n        item = _t._onPositionItems[i];\r\n        if (item.fired && nPosition <= item.position) {\r\n          item.fired = false;\r\n          _s._onPositionFired--;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n\r\n    /*\r\n     * private internals\r\n    */\r\n\r\n    _start_html5_timer = function () {\r\n      if (_t.isHTML5) {\r\n        _startTimer(_t);\r\n      }\r\n    };\r\n\r\n    _stop_html5_timer = function () {\r\n      if (_t.isHTML5) {\r\n        _stopTimer(_t);\r\n      }\r\n    };\r\n\r\n    _resetProperties = function () {\r\n      _t._onPositionItems = [];\r\n      _t._onPositionFired = 0;\r\n      _t._hasTimer = null;\r\n      _t._onplay_called = false;\r\n      _t._a = null;\r\n      _t._html5_canplay = false;\r\n      _t.bytesLoaded = null;\r\n      _t.bytesTotal = null;\r\n      _t.position = null;\r\n      _t.duration = (_t._iO && _t._iO.duration?_t._iO.duration:null);\r\n      _t.durationEstimate = null;\r\n      _t.failures = 0;\r\n      _t.loaded = false;\r\n      _t.playState = 0;\r\n      _t.paused = false;\r\n      _t.readyState = 0; // 0 = uninitialised, 1 = loading, 2 = failed/error, 3 = loaded/success\r\n      _t.muted = false;\r\n      _t.didBeforeFinish = false;\r\n      _t.didJustBeforeFinish = false;\r\n      _t.isBuffering = false;\r\n      _t.instanceOptions = {};\r\n      _t.instanceCount = 0;\r\n      _t.peakData = {\r\n        left: 0,\r\n        right: 0\r\n      };\r\n      _t.waveformData = {\r\n        left: [],\r\n        right: []\r\n      };\r\n      _t.eqData = []; // legacy: 1D array\r\n      _t.eqData.left = [];\r\n      _t.eqData.right = [];\r\n    };\r\n\r\n    _resetProperties();\r\n\r\n    /*\r\n     * pseudo-private SMSound internals\r\n    */\r\n\r\n    this._onTimer = function (bForce) {\r\n      // HTML5-only _whileplaying() etc.\r\n      var time, x = {};\r\n      if (_t._hasTimer || bForce) {\r\n        if (_t._a && (bForce || ((_t.playState > 0 || _t.readyState === 1) && !_t.paused))) { // TODO: May not need to track readyState (1 = loading)\r\n          _t.duration = _t._get_html5_duration();\r\n          _t.durationEstimate = _t.duration;\r\n          time = _t._a.currentTime?_t._a.currentTime*1000:0;\r\n          _t._whileplaying(time,x,x,x,x);\r\n          return true;\r\n        } else {\r\n         _s._wD('_onTimer: Warn for \"'+_t.sID+'\": '+(!_t._a?'Could not find element. ':'')+(_t.playState === 0?'playState bad, 0?':'playState = '+_t.playState+', OK'));\r\n          return false;\r\n        }\r\n      }\r\n    };\r\n\r\n    this._get_html5_duration = function () {\r\n      var d = (_t._a ? _t._a.duration*1000 : (_t._iO ? _t._iO.duration : undefined)),\r\n          result = (d && !isNaN(d) && d !== Infinity ? d : (_t._iO ? _t._iO.duration : null));\r\n      return result;\r\n    };\r\n\r\n    this._setup_html5 = function (oOptions) {\r\n      var _iO = _mixin(_t._iO, oOptions), d = decodeURI,\r\n          _a = _useGlobalHTML5Audio ? _s._global_a : _t._a,\r\n          _dURL = d(_iO.url),\r\n          _oldIO = (_a && _a._t ? _a._t.instanceOptions : null);\r\n      if (_a) {\r\n        if (_a._t && _oldIO.url === _iO.url && (!_t._lastURL || (_t._lastURL === _oldIO.url))) {\r\n          return _a; // same url, ignore request\r\n        }\r\n        _s._wD('setting new URL on existing object: ' + _dURL + (_t._lastURL ? ', old URL: ' + _t._lastURL : ''));\r\n        /*\r\n         * \"First things first, I, Poppa..\" (reset the previous state of the old sound, if playing)\r\n         * Fixes case with devices that can only play one sound at a time\r\n         * Otherwise, other sounds in mid-play will be terminated without warning and in a stuck state\r\n        */\r\n        if (_useGlobalHTML5Audio && _a._t && _a._t.playState && _iO.url !== _oldIO.url) {\r\n          _a._t.stop();\r\n        }\r\n        _resetProperties(); // new URL, so reset load/playstate and so on\r\n        _a.src = _iO.url;\r\n        _t.url = _iO.url;\r\n        _t._lastURL = _iO.url;\r\n        _a._called_load = false;\r\n      } else {\r\n        _s._wD('creating HTML5 Audio() element with URL: '+_dURL);\r\n        _a = new Audio(_iO.url);\r\n        _a._called_load = false;\r\n        if (_useGlobalHTML5Audio) {\r\n          _s._global_a = _a;\r\n        }\r\n      }\r\n      _t.isHTML5 = true;\r\n      _t._a = _a; // store a ref on the track\r\n      _a._t = _t; // store a ref on the audio\r\n      _t._add_html5_events();\r\n      _a.loop = (_iO.loops>1?'loop':'');\r\n      if (_iO.autoLoad || _iO.autoPlay) {\r\n        _a.autobuffer = 'auto'; // early HTML5 implementation (non-standard)\r\n        _a.preload = 'auto'; // standard\r\n        _t.load();\r\n        _a._called_load = true;\r\n      } else {\r\n        _a.autobuffer = false; // early HTML5 implementation (non-standard)\r\n        _a.preload = 'none'; // standard\r\n      }\r\n      _a.loop = (_iO.loops>1?'loop':''); // boolean instead of \"loop\", for webkit? - spec says string. http://www.w3.org/TR/html-markup/audio.html#audio.attrs.loop\r\n      return _a;\r\n    };\r\n\r\n    this._add_html5_events = function () {\r\n\r\n      if (_t._a._added_events) {\r\n        return false;\r\n      }\r\n\r\n      var f;\r\n\r\n      function add(oEvt, oFn, bCapture) {\r\n        return _t._a ? _t._a.addEventListener(oEvt, oFn, bCapture||false) : null;\r\n      }\r\n\r\n      _s._wD(_h5+'adding event listeners: '+_t.sID);\r\n      _t._a._added_events = true;\r\n\r\n      for (f in _html5_events) {\r\n        if (_html5_events.hasOwnProperty(f)) {\r\n          add(f, _html5_events[f]);\r\n        }\r\n      }\r\n\r\n      return true;\r\n\r\n    };\r\n\r\n    this._remove_html5_events = function () {\r\n\r\n      // Remove event listeners\r\n\r\n      var f;\r\n\r\n      function remove(oEvt, oFn, bCapture) {\r\n        return (_t._a ? _t._a.removeEventListener(oEvt, oFn, bCapture||false) : null);\r\n      }\r\n\r\n      _s._wD(_h5+'removing event listeners: '+_t.sID);\r\n      _t._a._added_events = false;\r\n\r\n      for (f in _html5_events) {\r\n        if (_html5_events.hasOwnProperty(f)) {\r\n          remove(f, _html5_events[f]);\r\n        }\r\n      }\r\n\r\n    };\r\n\r\n    /*\r\n     * pseudo-private event internals\r\n    */\r\n\r\n    this._onload = function (nSuccess) {\r\n      var fN = 'SMSound._onload(): ', loadOK = (nSuccess?true:false);\r\n      _s._wD(fN + '\"' + _t.sID + '\"' + (loadOK?' loaded.':' failed to load? - ' + _t.url), (loadOK?1:2));\r\n      // <d>\r\n      if (!loadOK && !_t.isHTML5) {\r\n        if (_s.sandbox.noRemote === true) {\r\n          _s._wD(fN + _str('noNet'), 1);\r\n        }\r\n        if (_s.sandbox.noLocal === true) {\r\n          _s._wD(fN + _str('noLocal'), 1);\r\n        }\r\n      }\r\n      // </d>\r\n      _t.loaded = loadOK;\r\n      _t.readyState = loadOK?3:2;\r\n      _t._onbufferchange(0);\r\n      if (_t._iO.onload) {\r\n        _t._iO.onload.apply(_t, [loadOK]);\r\n      }\r\n      return true;\r\n    };\r\n\r\n    this._onbufferchange = function (nIsBuffering) {\r\n      var fN = 'SMSound._onbufferchange()';\r\n      if (_t.playState === 0) {\r\n        // ignore if not playing\r\n        return false;\r\n      }\r\n      if ((nIsBuffering && _t.isBuffering) || (!nIsBuffering && !_t.isBuffering)) {\r\n        return false;\r\n      }\r\n      _t.isBuffering = (nIsBuffering === 1);\r\n      if (_t._iO.onbufferchange) {\r\n        _s._wD(fN + ': ' + nIsBuffering);\r\n        _t._iO.onbufferchange.apply(_t);\r\n      }\r\n      return true;\r\n    };\r\n\r\n    /*\r\n     * flash-only method, should fire only once at most\r\n     * at this point we just recreate failed sounds rather than trying to reconnect\r\n    */\r\n    this._onfailure = function (msg, level, code) {\r\n      _t.failures++;\r\n      _s._wD('SMSound._onfailure(): \"'+_t.sID+'\" count '+_t.failures);\r\n      if (_t._iO.onfailure && _t.failures === 1) {\r\n        _t._iO.onfailure(_t, msg, level, code);\r\n      } else {\r\n        _s._wD('SMSound._onfailure(): ignoring');\r\n      }\r\n    };\r\n\r\n    this._onbeforefinish = function () {\r\n      if (!_t.didBeforeFinish) {\r\n        _t.didBeforeFinish = true;\r\n        if (_t._iO.onbeforefinish) {\r\n          _s._wD('SMSound._onbeforefinish(): \"' + _t.sID + '\"');\r\n          _t._iO.onbeforefinish.apply(_t);\r\n        }\r\n      }\r\n    };\r\n\r\n    this._onjustbeforefinish = function (msOffset) {\r\n      if (!_t.didJustBeforeFinish) {\r\n        _t.didJustBeforeFinish = true;\r\n        if (_t._iO.onjustbeforefinish) {\r\n          _s._wD('SMSound._onjustbeforefinish(): \"' + _t.sID + '\"');\r\n          _t._iO.onjustbeforefinish.apply(_t);\r\n        }\r\n      }\r\n    };\r\n\r\n    this._onfinish = function () {\r\n      var _io_onfinish = _t._iO.onfinish; // store local copy before it gets trashed..\r\n      _t._onbufferchange(0);\r\n      _t.resetOnPosition(0);\r\n      if (_t._iO.onbeforefinishcomplete) {\r\n        _t._iO.onbeforefinishcomplete.apply(_t);\r\n      }\r\n      // reset some state items\r\n      _t.didBeforeFinish = false;\r\n      _t.didJustBeforeFinish = false;\r\n      if (_t.instanceCount) {\r\n        _t.instanceCount--;\r\n        if (!_t.instanceCount) {\r\n          // reset instance options\r\n          _t.playState = 0;\r\n          _t.paused = false;\r\n          _t.instanceCount = 0;\r\n          _t.instanceOptions = {};\r\n          _t._iO = {};\r\n          _stop_html5_timer();\r\n        }\r\n        if (!_t.instanceCount || _t._iO.multiShotEvents) {\r\n          // fire onfinish for last, or every instance\r\n          if (_io_onfinish) {\r\n            _s._wD('SMSound._onfinish(): \"' + _t.sID + '\"');\r\n            _io_onfinish.apply(_t);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    this._whileloading = function (nBytesLoaded, nBytesTotal, nDuration, nBufferLength) {\r\n      _t.bytesLoaded = nBytesLoaded;\r\n      _t.bytesTotal = nBytesTotal;\r\n      _t.duration = Math.floor(nDuration);\r\n      _t.bufferLength = nBufferLength;\r\n      if (!_t._iO.isMovieStar) {\r\n        if (_t._iO.duration) {\r\n          // use options, if specified and larger\r\n          _t.durationEstimate = (_t.duration > _t._iO.duration) ? _t.duration : _t._iO.duration;\r\n        } else {\r\n          _t.durationEstimate = parseInt((_t.bytesTotal / _t.bytesLoaded) * _t.duration, 10);\r\n        }\r\n        if (_t.durationEstimate === undefined) {\r\n          _t.durationEstimate = _t.duration;\r\n        }\r\n        if (_t.readyState !== 3 && _t._iO.whileloading) {\r\n          _t._iO.whileloading.apply(_t);\r\n        }\r\n      } else {\r\n        _t.durationEstimate = _t.duration;\r\n        if (_t.readyState !== 3 && _t._iO.whileloading) {\r\n          _t._iO.whileloading.apply(_t);\r\n        }\r\n      }\r\n    };\r\n\r\n    this._whileplaying = function (nPosition, oPeakData, oWaveformDataLeft, oWaveformDataRight, oEQData) {\r\n      if (isNaN(nPosition) || nPosition === null) {\r\n        return false; // flash safety net\r\n      }\r\n      _t.position = nPosition;\r\n      _t.processOnPosition();\r\n      if (!_t.isHTML5 && _fV > 8) {\r\n        if (_t._iO.usePeakData && typeof oPeakData !== 'undefined' && oPeakData) {\r\n          _t.peakData = {\r\n            left: oPeakData.leftPeak,\r\n            right: oPeakData.rightPeak\r\n          };\r\n        }\r\n        if (_t._iO.useWaveformData && typeof oWaveformDataLeft !== 'undefined' && oWaveformDataLeft) {\r\n          _t.waveformData = {\r\n            left: oWaveformDataLeft.split(','),\r\n            right: oWaveformDataRight.split(',')\r\n          };\r\n        }\r\n        if (_t._iO.useEQData) {\r\n          if (typeof oEQData !== 'undefined' && oEQData && oEQData.leftEQ) {\r\n            var eqLeft = oEQData.leftEQ.split(',');\r\n            _t.eqData = eqLeft;\r\n            _t.eqData.left = eqLeft;\r\n            if (typeof oEQData.rightEQ !== 'undefined' && oEQData.rightEQ) {\r\n              _t.eqData.right = oEQData.rightEQ.split(',');\r\n            }\r\n          }\r\n        }\r\n      }\r\n      if (_t.playState === 1) {\r\n        // special case/hack: ensure buffering is false if loading from cache (and not yet started)\r\n        if (!_t.isHTML5 && _s.flashVersion === 8 && !_t.position && _t.isBuffering) {\r\n          _t._onbufferchange(0);\r\n        }\r\n        if (_t._iO.whileplaying) {\r\n          _t._iO.whileplaying.apply(_t); // flash may call after actual finish\r\n        }\r\n        if ((_t.loaded || (!_t.loaded && _t._iO.isMovieStar)) && _t._iO.onbeforefinish && _t._iO.onbeforefinishtime && !_t.didBeforeFinish && _t.duration - _t.position <= _t._iO.onbeforefinishtime) {\r\n          _t._onbeforefinish();\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n\r\n    this._onid3 = function (oID3PropNames, oID3Data) {\r\n      // oID3PropNames: string array (names)\r\n      // ID3Data: string array (data)\r\n      _s._wD('SMSound._onid3(): \"' + this.sID + '\" ID3 data received.');\r\n      var oData = [], i, j;\r\n      for (i = 0, j = oID3PropNames.length; i < j; i++) {\r\n        oData[oID3PropNames[i]] = oID3Data[i];\r\n      }\r\n      _t.id3 = _mixin(_t.id3, oData);\r\n      if (_t._iO.onid3) {\r\n        _t._iO.onid3.apply(_t);\r\n      }\r\n    };\r\n\r\n    // flash + RTMP\r\n    this._onconnect = function (bSuccess) {\r\n      var fN = 'SMSound._onconnect(): ';\r\n      bSuccess = (bSuccess === 1);\r\n      _s._wD(fN+'\"'+_t.sID+'\"'+(bSuccess?' connected.':' failed to connect? - '+_t.url), (bSuccess?1:2));\r\n      _t.connected = bSuccess;\r\n      if (bSuccess) {\r\n        _t.failures = 0;\r\n        if (_idCheck(_t.sID)) {\r\n          if (_t.getAutoPlay()) {\r\n            _t.play(undefined, _t.getAutoPlay()); // only update the play state if auto playing\r\n          } else if (_t._iO.autoLoad) {\r\n            _t.load();\r\n          }\r\n        }\r\n        if (_t._iO.onconnect) {\r\n          _t._iO.onconnect.apply(_t,[bSuccess]);\r\n        }\r\n      }\r\n    };\r\n\r\n    this._ondataerror = function (sError) {\r\n      // flash 9 wave/eq data handler\r\n      if (_t.playState > 0) { // hack: called at start, and end from flash at/after onfinish()\r\n        _s._wD('SMSound._ondataerror(): ' + sError);\r\n        if (_t._iO.ondataerror) {\r\n          _t._iO.ondataerror.apply(_t);\r\n        }\r\n      }\r\n    };\r\n\r\n  }; // SMSound()\r\n\r\n  /*\r\n   * private soundManager internals\r\n  */\r\n\r\n  _getDocument = function () {\r\n    return (_doc.body || _doc._docElement || _doc.getElementsByTagName('div')[0]);\r\n  };\r\n\r\n  _id = function (sID) {\r\n    return _doc.getElementById(sID);\r\n  };\r\n\r\n  _mixin = function (oMain, oAdd) {\r\n    // non-destructive merge\r\n    var o1 = {}, i, o2, o;\r\n    for (i in oMain) { // clone c1\r\n      if (oMain.hasOwnProperty(i)) {\r\n        o1[i] = oMain[i];\r\n      }\r\n    }\r\n    o2 = (typeof oAdd === 'undefined'?_s.defaultOptions:oAdd);\r\n    for (o in o2) {\r\n      if (o2.hasOwnProperty(o) && typeof o1[o] === 'undefined') {\r\n        o1[o] = o2[o];\r\n      }\r\n    }\r\n    return o1;\r\n  };\r\n\r\n  _event = (function () {\r\n\r\n    var old = (_win.attachEvent),\r\n    evt = {\r\n      add: (old?'attachEvent':'addEventListener'),\r\n      remove: (old?'detachEvent':'removeEventListener')\r\n    };\r\n\r\n    function getArgs(oArgs) {\r\n      var args = _slice.call(oArgs), len = args.length;\r\n      if (old) {\r\n        args[1] = 'on' + args[1]; // prefix\r\n        if (len > 3) {\r\n          args.pop(); // no capture\r\n        }\r\n      } else if (len === 3) {\r\n        args.push(false);\r\n      }\r\n      return args;\r\n    }\r\n\r\n    function apply(args, sType) {\r\n      var element = args.shift(),\r\n          method = [evt[sType]];\r\n      if (old) {\r\n        element[method](args[0], args[1]);\r\n      } else {\r\n        element[method].apply(element, args);\r\n      }\r\n    }\r\n\r\n    function add() {\r\n      apply(getArgs(arguments), 'add');\r\n    }\r\n\r\n    function remove() {\r\n      apply(getArgs(arguments), 'remove');\r\n    }\r\n\r\n    return {\r\n      'add': add,\r\n      'remove': remove\r\n    };\r\n\r\n  }());\r\n\r\n  _html5OK = function (iO) {\r\n    return (!iO.serverURL && (iO.type?_html5CanPlay({type:iO.type}):_html5CanPlay({url:iO.url})||_s.html5Only)); // Use type, if specified. If HTML5-only mode, no other options, so just give 'er\r\n  };\r\n\r\n  _html5CanPlay = function (o) {\r\n\r\n    /*\r\n     * try to find MIME, test and return truthiness\r\n     * o = {\r\n     *  url: '/path/to/an.mp3',\r\n     *  type: 'audio/mp3'\r\n     * }\r\n    */\r\n\r\n    if (!_s.useHTML5Audio || !_s.hasHTML5) {\r\n      return false;\r\n    }\r\n\r\n    var url = (o.url || null),\r\n        mime = (o.type || null),\r\n        aF = _s.audioFormats,\r\n        result,\r\n        offset,\r\n        fileExt,\r\n        item;\r\n\r\n    function preferFlashCheck(kind) {\r\n      // whether flash should play a given type\r\n      return (_s.preferFlash && _hasFlash && !_s.ignoreFlash && (typeof _s.flash[kind] !== 'undefined' && _s.flash[kind]));\r\n    }\r\n\r\n    // account for known cases like audio/mp3\r\n    if (mime && _s.html5[mime] !== 'undefined') {\r\n      return (_s.html5[mime] && !preferFlashCheck(mime));\r\n    }\r\n\r\n    if (!_html5Ext) {\r\n      _html5Ext = [];\r\n      for (item in aF) {\r\n        if (aF.hasOwnProperty(item)) {\r\n          _html5Ext.push(item);\r\n          if (aF[item].related) {\r\n            _html5Ext = _html5Ext.concat(aF[item].related);\r\n          }\r\n        }\r\n      }\r\n      _html5Ext = new RegExp('\\\\.('+_html5Ext.join('|')+')(\\\\?.*)?$','i');\r\n    }\r\n\r\n    fileExt = (url ? url.toLowerCase().match(_html5Ext) : null); // TODO: Strip URL queries, etc.\r\n\r\n    if (!fileExt || !fileExt.length) {\r\n      if (!mime) {\r\n        return false;\r\n      } else {\r\n        // audio/mp3 -> mp3, result should be known\r\n        offset = mime.indexOf(';');\r\n        fileExt = (offset !== -1?mime.substr(0,offset):mime).substr(6); // strip \"audio/X; codecs..\"\r\n      }\r\n    } else {\r\n      fileExt = fileExt[1]; // match the raw extension name - \"mp3\", for example\r\n    }\r\n\r\n    if (fileExt && typeof _s.html5[fileExt] !== 'undefined') {\r\n      // result known\r\n      return (_s.html5[fileExt] && !preferFlashCheck(fileExt));\r\n    } else {\r\n      mime = 'audio/'+fileExt;\r\n      result = _s.html5.canPlayType({type:mime});\r\n      _s.html5[fileExt] = result;\r\n      // _s._wD('canPlayType, found result: '+result);\r\n      return (result && _s.html5[mime] && !preferFlashCheck(mime));\r\n    }\r\n\r\n  };\r\n\r\n  _testHTML5 = function () {\r\n\r\n    if (!_s.useHTML5Audio || typeof Audio === 'undefined') {\r\n      return false;\r\n    }\r\n\r\n    // double-whammy: Opera 9.64 throws WRONG_ARGUMENTS_ERR if no parameter passed to Audio(), and Webkit + iOS happily tries to load \"null\" as a URL. :/\r\n    var a = (typeof Audio !== 'undefined' ? (_isOpera ? new Audio(null) : new Audio()) : null),\r\n        item, support = {}, aF, i;\r\n\r\n    function _cp(m) {\r\n      var canPlay, i, j, isOK = false;\r\n      if (!a || typeof a.canPlayType !== 'function') {\r\n        return false;\r\n      }\r\n      if (m instanceof Array) {\r\n        // iterate through all mime types, return any successes\r\n        for (i=0, j=m.length; i<j && !isOK; i++) {\r\n          if (_s.html5[m[i]] || a.canPlayType(m[i]).match(_s.html5Test)) {\r\n            isOK = true;\r\n            _s.html5[m[i]] = true;\r\n            // if flash can play and preferred, also mark it for use.\r\n            _s.flash[m[i]] = !!(_s.preferFlash && _hasFlash && m[i].match(_flashMIME));\r\n          }\r\n        }\r\n        return isOK;\r\n      } else {\r\n        canPlay = (a && typeof a.canPlayType === 'function' ? a.canPlayType(m) : false);\r\n        return !!(canPlay && (canPlay.match(_s.html5Test)));\r\n      }\r\n    }\r\n\r\n    // test all registered formats + codecs\r\n    aF = _s.audioFormats;\r\n    for (item in aF) {\r\n      if (aF.hasOwnProperty(item)) {\r\n        support[item] = _cp(aF[item].type);\r\n        support['audio/'+item] = support[item]; // write back generic type too, eg. audio/mp3\r\n        // assign flash\r\n        if (_s.preferFlash && !_s.ignoreFlash && item.match(_flashMIME)) {\r\n          _s.flash[item] = true;\r\n        } else {\r\n          _s.flash[item] = false;\r\n        }\r\n        // assign result to related formats, too\r\n        if (aF[item] && aF[item].related) {\r\n          for (i=aF[item].related.length; i--;) {\r\n            support['audio/'+aF[item].related[i]] = support[item]; // eg. audio/m4a\r\n            _s.html5[aF[item].related[i]] = support[item];\r\n            _s.flash[aF[item].related[i]] = support[item];\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    support.canPlayType = (a?_cp:null);\r\n    _s.html5 = _mixin(_s.html5, support);\r\n    return true;\r\n\r\n  };\r\n\r\n  _strings = {\r\n    // <d>\r\n    notReady: 'Not loaded yet - wait for soundManager.onload()/onready()',\r\n    notOK: 'Audio support is not available.',\r\n    domError: _smc + 'createMovie(): appendChild/innerHTML call failed. DOM not ready or other error.',\r\n    spcWmode: _smc + 'createMovie(): Removing wmode, preventing known SWF loading issue(s)',\r\n    swf404: _sm + ': Verify that %s is a valid path.',\r\n    tryDebug: 'Try ' + _sm + '.debugFlash = true for more security details (output goes to SWF.)',\r\n    checkSWF: 'See SWF output for more debug info.',\r\n    localFail: _sm + ': Non-HTTP page (' + _doc.location.protocol + ' URL?) Review Flash player security settings for this special case:\\nhttp://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\\nMay need to add/allow path, eg. c:/sm2/ or /users/me/sm2/',\r\n    waitFocus: _sm + ': Special case: Waiting for focus-related event..',\r\n    waitImpatient: _sm + ': Getting impatient, still waiting for Flash%s...',\r\n    waitForever: _sm + ': Waiting indefinitely for Flash (will recover if unblocked)...',\r\n    needFunction: _sm + ': Function object expected for %s',\r\n    badID: 'Warning: Sound ID \"%s\" should be a string, starting with a non-numeric character',\r\n    noMS: 'MovieStar mode not enabled. Exiting.',\r\n    currentObj: '--- ' + _sm + '._debug(): Current sound objects ---',\r\n    waitEI: _smc + 'initMovie(): Waiting for ExternalInterface call from Flash..',\r\n    waitOnload: _sm + ': Waiting for window.onload()',\r\n    docLoaded: _sm + ': Document already loaded',\r\n    onload: _smc + 'initComplete(): calling soundManager.onload()',\r\n    onloadOK: _sm + '.onload() complete',\r\n    init: _smc + 'init()',\r\n    didInit: _smc + 'init(): Already called?',\r\n    flashJS: _sm + ': Attempting to call Flash from JS..',\r\n    noPolling: _sm + ': Polling (whileloading()/whileplaying() support) is disabled.',\r\n    secNote: 'Flash security note: Network/internet URLs will not load due to security restrictions. Access can be configured via Flash Player Global Security Settings Page: http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html',\r\n    badRemove: 'Warning: Failed to remove flash movie.',\r\n    noPeak: 'Warning: peakData features unsupported for movieStar formats',\r\n    shutdown: _sm + '.disable(): Shutting down',\r\n    queue: _sm + ': Queueing %s handler',\r\n    smFail: _sm + ': Failed to initialise.',\r\n    smError: 'SMSound.load(): Exception: JS-Flash communication failed, or JS error.',\r\n    fbTimeout: 'No flash response, applying .'+_s.swfCSS.swfTimedout+' CSS..',\r\n    fbLoaded: 'Flash loaded',\r\n    fbHandler: _smc+'flashBlockHandler()',\r\n    manURL: 'SMSound.load(): Using manually-assigned URL',\r\n    onURL: _sm + '.load(): current URL already assigned.',\r\n    badFV: _sm + '.flashVersion must be 8 or 9. \"%s\" is invalid. Reverting to %s.',\r\n    as2loop: 'Note: Setting stream:false so looping can work (flash 8 limitation)',\r\n    noNSLoop: 'Note: Looping not implemented for MovieStar formats',\r\n    needfl9: 'Note: Switching to flash 9, required for MP4 formats.',\r\n    mfTimeout: 'Setting flashLoadTimeout = 0 (infinite) for off-screen, mobile flash case',\r\n    mfOn: 'mobileFlash::enabling on-screen flash repositioning',\r\n    policy: 'Enabling usePolicyFile for data access'\r\n    // </d>\r\n  };\r\n\r\n  _str = function () { // o [,items to replace]\r\n    // <d>\r\n    var args = _slice.call(arguments), // real array, please\r\n    o = args.shift(), // first arg\r\n    str = (_strings && _strings[o]?_strings[o]:''), i, j;\r\n    if (str && args && args.length) {\r\n      for (i = 0, j = args.length; i < j; i++) {\r\n        str = str.replace('%s', args[i]);\r\n      }\r\n    }\r\n    return str;\r\n    // </d>\r\n  };\r\n\r\n  _loopFix = function (sOpt) {\r\n    // flash 8 requires stream = false for looping to work\r\n    if (_fV === 8 && sOpt.loops > 1 && sOpt.stream) {\r\n      _wDS('as2loop');\r\n      sOpt.stream = false;\r\n    }\r\n    return sOpt;\r\n  };\r\n\r\n  _policyFix = function (sOpt, sPre) {\r\n    if (sOpt && !sOpt.usePolicyFile && (sOpt.onid3 || sOpt.usePeakData || sOpt.useWaveformData || sOpt.useEQData)) {\r\n      _s._wD((sPre || '') + _str('policy'));\r\n      sOpt.usePolicyFile = true;\r\n    }\r\n    return sOpt;\r\n  };\r\n\r\n  _complain = function (sMsg) {\r\n    if (typeof console !== 'undefined' && typeof console.warn !== 'undefined') {\r\n      console.warn(sMsg);\r\n    } else {\r\n      _s._wD(sMsg);\r\n    }\r\n  };\r\n\r\n  _doNothing = function () {\r\n    return false;\r\n  };\r\n\r\n  _disableObject = function (o) {\r\n    var oProp;\r\n    for (oProp in o) {\r\n      if (o.hasOwnProperty(oProp) && typeof o[oProp] === 'function') {\r\n        o[oProp] = _doNothing;\r\n      }\r\n    }\r\n    oProp = null;\r\n  };\r\n\r\n  _failSafely = function (bNoDisable) {\r\n    // general failure exception handler\r\n    if (typeof bNoDisable === 'undefined') {\r\n      bNoDisable = false;\r\n    }\r\n    if (_disabled || bNoDisable) {\r\n      _wDS('smFail', 2);\r\n      _s.disable(bNoDisable);\r\n    }\r\n  };\r\n\r\n  _normalizeMovieURL = function (smURL) {\r\n    var urlParams = null;\r\n    if (smURL) {\r\n      if (smURL.match(/\\.swf(\\?.*)?$/i)) {\r\n        urlParams = smURL.substr(smURL.toLowerCase().lastIndexOf('.swf?') + 4);\r\n        if (urlParams) {\r\n          return smURL; // assume user knows what they're doing\r\n        }\r\n      } else if (smURL.lastIndexOf('/') !== smURL.length - 1) {\r\n        smURL = smURL + '/';\r\n      }\r\n    }\r\n    return (smURL && smURL.lastIndexOf('/') !== - 1?smURL.substr(0, smURL.lastIndexOf('/') + 1):'./') + _s.movieURL;\r\n  };\r\n\r\n  _setVersionInfo = function () {\r\n\r\n    if (_fV !== 8 && _fV !== 9) {\r\n      _s._wD(_str('badFV', _fV, _defaultFlashVersion));\r\n      _s.flashVersion = _defaultFlashVersion;\r\n    }\r\n    var isDebug = (_s.debugMode || _s.debugFlash?'_debug.swf':'.swf'); // debug flash movie, if applicable\r\n    if (_s.useHTML5Audio && !_s.html5Only && _s.audioFormats.mp4.required && _s.flashVersion < 9) {\r\n      _s._wD(_str('needfl9'));\r\n      _s.flashVersion = 9;\r\n    }\r\n    _fV = _s.flashVersion; // short-hand for internal use\r\n    _s.version = _s.versionNumber + (_s.html5Only?' (HTML5-only mode)':(_fV === 9?' (AS3/Flash 9)':' (AS2/Flash 8)'));\r\n    // set up default options\r\n    if (_fV > 8) {\r\n      _s.defaultOptions = _mixin(_s.defaultOptions, _s.flash9Options);\r\n      _s.features.buffering = true;\r\n    }\r\n    if (_fV > 8 && _s.useMovieStar) {\r\n      // flash 9+ support for movieStar formats as well as MP3\r\n      _s.defaultOptions = _mixin(_s.defaultOptions, _s.movieStarOptions);\r\n      _s.filePatterns.flash9 = new RegExp('\\\\.(mp3|' + _s.netStreamTypes.join('|') + ')(\\\\?.*)?$', 'i');\r\n      _s.mimePattern = _s.netStreamMimeTypes;\r\n      _s.features.movieStar = true;\r\n    } else {\r\n      _s.useMovieStar = false;\r\n      _s.features.movieStar = false;\r\n    }\r\n    _s.filePattern = _s.filePatterns[(_fV !== 8?'flash9':'flash8')];\r\n    _s.movieURL = (_fV === 8?'soundmanager2.swf':'soundmanager2_flash9.swf').replace('.swf',isDebug);\r\n    _s.features.peakData = _s.features.waveformData = _s.features.eqData = (_fV > 8);\r\n  };\r\n\r\n  _setPolling = function (bPolling, bHighPerformance) {\r\n    if (!_s.o || !_s.allowPolling) {\r\n      return false;\r\n    }\r\n    _s.o._setPolling(bPolling, bHighPerformance);\r\n  };\r\n\r\n  _initDebug = function () {\r\n    if (_s.debugURLParam.test(_wl)) {\r\n      _s.debugMode = true; // allow force of debug mode via URL\r\n    }\r\n    // <d>\r\n    if (_id(_s.debugID)) {\r\n      return false;\r\n    }\r\n    var oD, oDebug, oTarget, oToggle, tmp;\r\n    if (_s.debugMode && !_id(_s.debugID) && ((!_hasConsole || !_s.useConsole) || (_s.useConsole && _hasConsole && !_s.consoleOnly))) {\r\n      oD = _doc.createElement('div');\r\n      oD.id = _s.debugID + '-toggle';\r\n      oToggle = {\r\n        'position': 'fixed',\r\n        'bottom': '0px',\r\n        'right': '0px',\r\n        'width': '1.2em',\r\n        'height': '1.2em',\r\n        'lineHeight': '1.2em',\r\n        'margin': '2px',\r\n        'textAlign': 'center',\r\n        'border': '1px solid #999',\r\n        'cursor': 'pointer',\r\n        'background': '#fff',\r\n        'color': '#333',\r\n        'zIndex': 10001\r\n      };\r\n      oD.appendChild(_doc.createTextNode('-'));\r\n      oD.onclick = _toggleDebug;\r\n      oD.title = 'Toggle SM2 debug console';\r\n      if (_ua.match(/msie 6/i)) {\r\n        oD.style.position = 'absolute';\r\n        oD.style.cursor = 'hand';\r\n      }\r\n      for (tmp in oToggle) {\r\n        if (oToggle.hasOwnProperty(tmp)) {\r\n          oD.style[tmp] = oToggle[tmp];\r\n        }\r\n      }\r\n      oDebug = _doc.createElement('div');\r\n      oDebug.id = _s.debugID;\r\n      oDebug.style.display = (_s.debugMode?'block':'none');\r\n      if (_s.debugMode && !_id(oD.id)) {\r\n        try {\r\n          oTarget = _getDocument();\r\n          oTarget.appendChild(oD);\r\n        } catch(e2) {\r\n          throw new Error(_str('domError')+' \\n'+e2.toString());\r\n        }\r\n        oTarget.appendChild(oDebug);\r\n      }\r\n    }\r\n    oTarget = null;\r\n    // </d>\r\n  };\r\n\r\n  _idCheck = this.getSoundById;\r\n\r\n  // <d>\r\n  _wDS = function (o, errorLevel) {\r\n    if (!o) {\r\n      return '';\r\n    } else {\r\n      return _s._wD(_str(o), errorLevel);\r\n    }\r\n  };\r\n\r\n  // last-resort debugging option\r\n  if (_wl.indexOf('sm2-debug=alert') + 1 && _s.debugMode) {\r\n    _s._wD = function (sText) {window.alert(sText);};\r\n  }\r\n\r\n  _toggleDebug = function () {\r\n    var o = _id(_s.debugID),\r\n    oT = _id(_s.debugID + '-toggle');\r\n    if (!o) {\r\n      return false;\r\n    }\r\n    if (_debugOpen) {\r\n      // minimize\r\n      oT.innerHTML = '+';\r\n      o.style.display = 'none';\r\n    } else {\r\n      oT.innerHTML = '-';\r\n      o.style.display = 'block';\r\n    }\r\n    _debugOpen = !_debugOpen;\r\n  };\r\n\r\n  _debugTS = function (sEventType, bSuccess, sMessage) {\r\n    // troubleshooter debug hooks\r\n    if (typeof sm2Debugger !== 'undefined') {\r\n      try {\r\n        sm2Debugger.handleEvent(sEventType, bSuccess, sMessage);\r\n      } catch(e) {\r\n        // oh well\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n  // </d>\r\n\r\n  _getSWFCSS = function () {\r\n    var css = [];\r\n    if (_s.debugMode) {\r\n      css.push(_s.swfCSS.sm2Debug);\r\n    }\r\n    if (_s.debugFlash) {\r\n      css.push(_s.swfCSS.flashDebug);\r\n    }\r\n    if (_s.useHighPerformance) {\r\n      css.push(_s.swfCSS.highPerf);\r\n    }\r\n    return css.join(' ');\r\n  };\r\n\r\n  _flashBlockHandler = function () {\r\n    // *possible* flash block situation.\r\n    var name = _str('fbHandler'),\r\n        p = _s.getMoviePercent(),\r\n        css = _s.swfCSS,\r\n        error = {type:'FLASHBLOCK'};\r\n    if (_s.html5Only) {\r\n      return false;\r\n    }\r\n    if (!_s.ok()) {\r\n      if (_needsFlash) {\r\n        // make the movie more visible, so user can fix\r\n        _s.oMC.className = _getSWFCSS() + ' ' + css.swfDefault + ' ' + (p === null?css.swfTimedout:css.swfError);\r\n        _s._wD(name+': '+_str('fbTimeout')+(p?' ('+_str('fbLoaded')+')':''));\r\n      }\r\n      _s.didFlashBlock = true;\r\n      _processOnEvents({type:'ontimeout', ignoreInit:true, error:error}); // fire onready(), complain lightly\r\n      _catchError(error);\r\n    } else {\r\n      // SM2 loaded OK (or recovered)\r\n      if (_s.didFlashBlock) {\r\n        _s._wD(name+': Unblocked');\r\n      }\r\n      if (_s.oMC) {\r\n        _s.oMC.className = [_getSWFCSS(), css.swfDefault, css.swfLoaded + (_s.didFlashBlock?' '+css.swfUnblocked:'')].join(' ');\r\n      }\r\n    }\r\n  };\r\n\r\n  _addOnEvent = function (sType, oMethod, oScope) {\r\n    if (typeof _on_queue[sType] === 'undefined') {\r\n      _on_queue[sType] = [];\r\n    }\r\n    _on_queue[sType].push({\r\n      'method': oMethod,\r\n      'scope': (oScope || null),\r\n      'fired': false\r\n    });\r\n  };\r\n\r\n  _processOnEvents = function (oOptions) {\r\n    if (!oOptions) { // assume onready, if unspecified\r\n      oOptions = {\r\n        type: 'onready'\r\n      };\r\n    }\r\n    if (!_didInit && oOptions && !oOptions.ignoreInit) {\r\n      // not ready yet.\r\n      return false;\r\n    }\r\n    if (oOptions.type === 'ontimeout' && _s.ok()) {\r\n      // invalid case\r\n      return false;\r\n    }\r\n    var status = {\r\n          success: (oOptions && oOptions.ignoreInit?_s.ok():!_disabled)\r\n        },\r\n        srcQueue = (oOptions && oOptions.type?_on_queue[oOptions.type]||[]:[]), // queue specified by type, or none\r\n        queue = [], i, j,\r\n        args = [status],\r\n        canRetry = (_needsFlash && _s.useFlashBlock && !_s.ok());\r\n    if (oOptions.error) {\r\n      args[0].error = oOptions.error;\r\n    }\r\n    for (i = 0, j = srcQueue.length; i < j; i++) {\r\n      if (srcQueue[i].fired !== true) {\r\n        queue.push(srcQueue[i]);\r\n      }\r\n    }\r\n    if (queue.length) {\r\n      _s._wD(_sm + ': Firing ' + queue.length + ' '+oOptions.type+'() item' + (queue.length === 1?'':'s'));\r\n      for (i = 0, j = queue.length; i < j; i++) {\r\n        if (queue[i].scope) {\r\n          queue[i].method.apply(queue[i].scope, args);\r\n        } else {\r\n          queue[i].method.apply(this, args);\r\n        }\r\n        if (!canRetry) { // flashblock case doesn't count here\r\n          queue[i].fired = true;\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  _initUserOnload = function () {\r\n    _win.setTimeout(function () {\r\n      if (_s.useFlashBlock) {\r\n        _flashBlockHandler();\r\n      }\r\n      _processOnEvents();\r\n      // call user-defined \"onload\", scoped to window\r\n      if (_s.onload instanceof Function) {\r\n        _wDS('onload', 1);\r\n        _s.onload.apply(_win);\r\n        _wDS('onloadOK', 1);\r\n      }\r\n      if (_s.waitForWindowLoad) {\r\n        _event.add(_win, 'load', _initUserOnload);\r\n      }\r\n    },1);\r\n  };\r\n\r\n  _detectFlash = function () {\r\n\r\n    // hat tip: Flash Detect library (BSD, (C) 2007) by Carl \"DocYes\" S. Yestrau - http://featureblend.com/javascript-flash-detection-library.html / http://featureblend.com/license.txt\r\n\r\n    if (_hasFlash !== undefined) {\r\n      // this work has already been done.\r\n      return _hasFlash;\r\n    }\r\n\r\n    var hasPlugin = false, n = navigator, nP = n.plugins, obj, type, types, AX = _win.ActiveXObject;\r\n\r\n    if (nP && nP.length) {\r\n\r\n      type = 'application/x-shockwave-flash';\r\n      types = n.mimeTypes;\r\n      if (types && types[type] && types[type].enabledPlugin && types[type].enabledPlugin.description) {\r\n        hasPlugin = true;\r\n      }\r\n\r\n    } else if (typeof AX !== 'undefined') {\r\n\r\n      try {\r\n        obj = new AX('ShockwaveFlash.ShockwaveFlash');\r\n      } catch(e) {\r\n        // oh well\r\n      }\r\n      hasPlugin = (!!obj);\r\n\r\n    }\r\n\r\n    _hasFlash = hasPlugin;\r\n\r\n    return hasPlugin;\r\n\r\n  };\r\n\r\n  _featureCheck = function () {\r\n\r\n    var needsFlash, item,\r\n        isSpecial = (_ua.match(/iphone os (1|2|3_0|3_1)/i)?true:false); // iPhone <= 3.1 has broken HTML5 audio(), but firmware 3.2 (iPad) + iOS4 works.\r\n\r\n    if (isSpecial) {\r\n      _s.hasHTML5 = false; // has Audio(), but is broken; let it load links directly.\r\n      _s.html5Only = true; // ignore flash case, however\r\n      if (_s.oMC) {\r\n        _s.oMC.style.display = 'none';\r\n      }\r\n      return false;\r\n    }\r\n\r\n    if (_s.useHTML5Audio) {\r\n      if (!_s.html5 || !_s.html5.canPlayType) {\r\n        _s._wD('SoundManager: No HTML5 Audio() support detected.');\r\n        _s.hasHTML5 = false;\r\n        return true;\r\n      } else {\r\n        _s.hasHTML5 = true;\r\n      }\r\n      if (_isBadSafari) {\r\n        _s._wD(_smc+'Note: Buggy HTML5 Audio in Safari on this OS X release, see https://bugs.webkit.org/show_bug.cgi?id=32159 - '+(!_hasFlash?' would use flash fallback for MP3/MP4, but none detected.':'will use flash fallback for MP3/MP4, if available'),1);\r\n        if (_detectFlash()) {\r\n          return true;\r\n        }\r\n      }\r\n    } else {\r\n      // flash needed (or, HTML5 needs enabling.)\r\n      return true;\r\n    }\r\n\r\n    for (item in _s.audioFormats) {\r\n      if (_s.audioFormats.hasOwnProperty(item)) {\r\n        if ( (_s.audioFormats[item].required && !_s.html5.canPlayType(_s.audioFormats[item].type)) || _s.flash[item] || _s.flash[_s.audioFormats[item].type]) {\r\n          // flash may be required, or preferred for this format\r\n          needsFlash = true;\r\n        }\r\n      }\r\n    }\r\n\r\n    // sanity check..\r\n    if (_s.ignoreFlash) {\r\n      needsFlash = false;\r\n    }\r\n\r\n    _s.html5Only = (_s.hasHTML5 && _s.useHTML5Audio && !needsFlash);\r\n\r\n    return (!_s.html5Only);\r\n\r\n  };\r\n\r\n  _startTimer = function (oSound) {\r\n    if (!oSound._hasTimer) {\r\n      oSound._hasTimer = true;\r\n    }\r\n  };\r\n\r\n  _stopTimer = function (oSound) {\r\n    if (oSound._hasTimer) {\r\n      oSound._hasTimer = false;\r\n    }\r\n  };\r\n\r\n  _catchError = function (options) {\r\n    options = (typeof options !== 'undefined' ? options : {});\r\n    if (_s.onerror instanceof Function) {\r\n      _s.onerror.apply(_win, [{type:(typeof options.type !== 'undefined' ? options.type : null)}]);\r\n    }\r\n    if (typeof options.fatal !== 'undefined' && options.fatal) {\r\n      _s.disable();\r\n    }\r\n  };\r\n\r\n  _badSafariFix = function () {\r\n    // special case: \"bad\" Safari (OS X 10.3 - 10.7) must fall back to flash for MP3/MP4\r\n    if (!_isBadSafari || !_detectFlash()) {\r\n      return false; // doesn't apply\r\n    }\r\n    var aF = _s.audioFormats, i, item;\r\n    for (item in aF) {\r\n      if (aF.hasOwnProperty(item)) {\r\n        if (item === 'mp3' || item === 'mp4') {\r\n          _s._wD(_sm+': Using flash fallback for '+item+' format');\r\n          _s.html5[item] = false;\r\n          // assign result to related formats, too\r\n          if (aF[item] && aF[item].related) {\r\n            for (i = aF[item].related.length; i--;) {\r\n              _s.html5[aF[item].related[i]] = false;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  /*\r\n   * pseudo-private flash/ExternalInterface methods\r\n  */\r\n\r\n  this._setSandboxType = function (sandboxType) {\r\n    // <d>\r\n    var sb = _s.sandbox;\r\n    sb.type = sandboxType;\r\n    sb.description = sb.types[(typeof sb.types[sandboxType] !== 'undefined'?sandboxType:'unknown')];\r\n    _s._wD('Flash security sandbox type: ' + sb.type);\r\n    if (sb.type === 'localWithFile') {\r\n      sb.noRemote = true;\r\n      sb.noLocal = false;\r\n      _wDS('secNote', 2);\r\n    } else if (sb.type === 'localWithNetwork') {\r\n      sb.noRemote = false;\r\n      sb.noLocal = true;\r\n    } else if (sb.type === 'localTrusted') {\r\n      sb.noRemote = false;\r\n      sb.noLocal = false;\r\n    }\r\n    // </d>\r\n  };\r\n\r\n  this._externalInterfaceOK = function (flashDate) {\r\n    // flash callback confirming flash loaded, EI working etc.\r\n    // flashDate = approx. timing/delay info for JS/flash bridge\r\n    if (_s.swfLoaded) {\r\n      return false;\r\n    }\r\n    var eiTime = new Date().getTime();\r\n    _s._wD(_smc+'externalInterfaceOK()' + (flashDate?' (~' + (eiTime - flashDate) + ' ms)':''));\r\n    _debugTS('swf', true);\r\n    _debugTS('flashtojs', true);\r\n    _s.swfLoaded = true;\r\n    _tryInitOnFocus = false;\r\n    if (_isBadSafari) {\r\n      _badSafariFix();\r\n    }\r\n    if (_isIE) {\r\n      // IE needs a timeout OR delay until window.onload - may need TODO: investigating\r\n      setTimeout(_init, 100);\r\n    } else {\r\n      _init();\r\n    }\r\n  };\r\n\r\n  /*\r\n   * private initialization helpers\r\n  */\r\n\r\n  _createMovie = function (smID, smURL) {\r\n\r\n    if (_didAppend && _appendSuccess) {\r\n      return false; // ignore if already succeeded\r\n    }\r\n\r\n    function _initMsg() {\r\n      _s._wD('-- SoundManager 2 ' + _s.version + (!_s.html5Only && _s.useHTML5Audio?(_s.hasHTML5?' + HTML5 audio':', no HTML5 audio support'):'') + (!_s.html5Only ? (_s.useMovieStar?', MovieStar mode':'') + (_s.useHighPerformance?', high performance mode, ':', ') + (( _s.flashPollingInterval ? 'custom (' + _s.flashPollingInterval + 'ms)' : (_s.useFastPolling?'fast':'normal')) + ' polling') + (_s.wmode?', wmode: ' + _s.wmode:'') + (_s.debugFlash?', flash debug mode':'') + (_s.useFlashBlock?', flashBlock mode':'') : '') + ' --', 1);\r\n    }\r\n\r\n    if (_s.html5Only) {\r\n      // 100% HTML5 mode\r\n      _setVersionInfo();\r\n      _initMsg();\r\n      _s.oMC = _id(_s.movieID);\r\n      _init();\r\n      // prevent multiple init attempts\r\n      _didAppend = true;\r\n      _appendSuccess = true;\r\n      return false;\r\n    }\r\n\r\n    // flash path\r\n    var remoteURL = (smURL || _s.url),\r\n    localURL = (_s.altURL || remoteURL),\r\n    swfTitle = 'JS/Flash audio component (SoundManager 2)',\r\n    oEmbed, oMovie, oTarget = _getDocument(), tmp, movieHTML, oEl, extraClass = _getSWFCSS(), s, x, sClass, side = 'auto', isRTL = null, html = _doc.getElementsByTagName('html')[0];\r\n\r\n    isRTL = (html && html.dir && html.dir.match(/rtl/i));\r\n    smID = (typeof smID === 'undefined'?_s.id:smID);\r\n\r\n    function param(name, value) {\r\n      return '<param name=\"'+name+'\" value=\"'+value+'\" />';\r\n    }\r\n\r\n    // safety check for legacy (change to Flash 9 URL)\r\n    _setVersionInfo();\r\n    _s.url = _normalizeMovieURL(_overHTTP?remoteURL:localURL);\r\n    smURL = _s.url;\r\n\r\n    _s.wmode = (!_s.wmode && _s.useHighPerformance && !_s.useMovieStar?'transparent':_s.wmode);\r\n\r\n    if (_s.wmode !== null && (_ua.match(/msie 8/i) || (!_isIE && !_s.useHighPerformance)) && navigator.platform.match(/win32|win64/i)) {\r\n      /*\r\n       * extra-special case: movie doesn't load until scrolled into view when using wmode = anything but 'window' here\r\n       * does not apply when using high performance (position:fixed means on-screen), OR infinite flash load timeout\r\n       * wmode breaks IE 8 on Vista + Win7 too in some cases, as of January 2011 (?)\r\n      */\r\n      _s.specialWmodeCase = true;\r\n      _wDS('spcWmode');\r\n      _s.wmode = null;\r\n    }\r\n\r\n    oEmbed = {\r\n      'name': smID,\r\n      'id': smID,\r\n      'src': smURL,\r\n      'width': side,\r\n      'height': side,\r\n      'quality': 'high',\r\n      'allowScriptAccess': _s.allowScriptAccess,\r\n      'bgcolor': _s.bgColor,\r\n      'pluginspage': _http+'//www.macromedia.com/go/getflashplayer',\r\n      'title': swfTitle,\r\n      'type': 'application/x-shockwave-flash',\r\n      'wmode': _s.wmode,\r\n      'hasPriority': 'true' // http://help.adobe.com/en_US/as3/mobile/WS4bebcd66a74275c36cfb8137124318eebc6-7ffd.html\r\n    };\r\n\r\n    if (_s.debugFlash) {\r\n      oEmbed.FlashVars = 'debug=1';\r\n    }\r\n\r\n    if (!_s.wmode) {\r\n      delete oEmbed.wmode; // don't write empty attribute\r\n    }\r\n\r\n    if (_isIE) {\r\n\r\n      // IE is \"special\".\r\n      oMovie = _doc.createElement('div');\r\n      movieHTML = [\r\n        '<object id=\"' + smID + '\" data=\"' + smURL + '\" type=\"' + oEmbed.type + '\" title=\"' + oEmbed.title +'\" classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" codebase=\"' + _http+'//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0\" width=\"' + oEmbed.width + '\" height=\"' + oEmbed.height + '\">',\r\n        param('movie', smURL),\r\n        param('AllowScriptAccess', _s.allowScriptAccess),\r\n        param('quality', oEmbed.quality),\r\n        (_s.wmode? param('wmode', _s.wmode): ''),\r\n        param('bgcolor', _s.bgColor),\r\n        param('hasPriority', 'true'),\r\n        (_s.debugFlash ? param('FlashVars', oEmbed.FlashVars) : ''),\r\n        '</object>'\r\n      ].join('');\r\n\r\n    } else {\r\n\r\n      oMovie = _doc.createElement('embed');\r\n      for (tmp in oEmbed) {\r\n        if (oEmbed.hasOwnProperty(tmp)) {\r\n          oMovie.setAttribute(tmp, oEmbed[tmp]);\r\n        }\r\n      }\r\n\r\n    }\r\n\r\n    _initDebug();\r\n    extraClass = _getSWFCSS();\r\n    oTarget = _getDocument();\r\n\r\n    if (oTarget) {\r\n\r\n      _s.oMC = (_id(_s.movieID) || _doc.createElement('div'));\r\n\r\n      if (!_s.oMC.id) {\r\n\r\n        _s.oMC.id = _s.movieID;\r\n        _s.oMC.className = _s.swfCSS.swfDefault + ' ' + extraClass;\r\n        s = null;\r\n        oEl = null;\r\n\r\n        if (!_s.useFlashBlock) {\r\n          if (_s.useHighPerformance) {\r\n            // on-screen at all times\r\n            s = {\r\n              'position': 'fixed',\r\n              'width': '8px',\r\n              'height': '8px',\r\n              // >= 6px for flash to run fast, >= 8px to start up under Firefox/win32 in some cases. odd? yes.\r\n              'bottom': '0px',\r\n              'left': '0px',\r\n              'overflow': 'hidden'\r\n            };\r\n          } else {\r\n            // hide off-screen, lower priority\r\n            s = {\r\n              'position': 'absolute',\r\n              'width': '6px',\r\n              'height': '6px',\r\n              'top': '-9999px',\r\n              'left': '-9999px'\r\n            };\r\n            if (isRTL) {\r\n              s.left = Math.abs(parseInt(s.left,10))+'px';\r\n            }\r\n          }\r\n        }\r\n\r\n        if (_isWebkit) {\r\n          _s.oMC.style.zIndex = 10000; // soundcloud-reported render/crash fix, safari 5\r\n        }\r\n\r\n        if (!_s.debugFlash) {\r\n          for (x in s) {\r\n            if (s.hasOwnProperty(x)) {\r\n              _s.oMC.style[x] = s[x];\r\n            }\r\n          }\r\n        }\r\n\r\n        try {\r\n          if (!_isIE) {\r\n            _s.oMC.appendChild(oMovie);\r\n          }\r\n          oTarget.appendChild(_s.oMC);\r\n          if (_isIE) {\r\n            oEl = _s.oMC.appendChild(_doc.createElement('div'));\r\n            oEl.className = _s.swfCSS.swfBox;\r\n            oEl.innerHTML = movieHTML;\r\n          }\r\n          _appendSuccess = true;\r\n        } catch(e) {\r\n          throw new Error(_str('domError')+' \\n'+e.toString());\r\n        }\r\n\r\n      } else {\r\n\r\n        // SM2 container is already in the document (eg. flashblock use case)\r\n        sClass = _s.oMC.className;\r\n        _s.oMC.className = (sClass?sClass+' ':_s.swfCSS.swfDefault) + (extraClass?' '+extraClass:'');\r\n        _s.oMC.appendChild(oMovie);\r\n        if (_isIE) {\r\n          oEl = _s.oMC.appendChild(_doc.createElement('div'));\r\n          oEl.className = _s.swfCSS.swfBox;\r\n          oEl.innerHTML = movieHTML;\r\n        }\r\n        _appendSuccess = true;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    _didAppend = true;\r\n    _initMsg();\r\n    _s._wD(_smc+'createMovie(): Trying to load ' + smURL + (!_overHTTP && _s.altURL?' (alternate URL)':''), 1);\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  _initMovie = function () {\r\n\r\n    if (_s.html5Only) {\r\n      _createMovie();\r\n      return false;\r\n    }\r\n\r\n    // attempt to get, or create, movie\r\n    if (_s.o) {\r\n      return false; // may already exist\r\n    }\r\n\r\n    _s.o = _s.getMovie(_s.id); // inline markup\r\n\r\n    if (!_s.o) {\r\n      if (!_oRemoved) {\r\n        // try to create\r\n        _createMovie(_s.id, _s.url);\r\n      } else {\r\n        // try to re-append removed movie after reboot()\r\n        if (!_isIE) {\r\n          _s.oMC.appendChild(_oRemoved);\r\n        } else {\r\n          _s.oMC.innerHTML = _oRemovedHTML;\r\n        }\r\n        _oRemoved = null;\r\n        _didAppend = true;\r\n      }\r\n      _s.o = _s.getMovie(_s.id);\r\n    }\r\n\r\n    if (_s.o) {\r\n      _wDS('waitEI');\r\n    }\r\n\r\n    if (_s.oninitmovie instanceof Function) {\r\n      setTimeout(_s.oninitmovie, 1);\r\n    }\r\n\r\n    return true;\r\n\r\n  };\r\n\r\n  _delayWaitForEI = function () {\r\n    setTimeout(_waitForEI, 1000);\r\n  };\r\n\r\n  _waitForEI = function () {\r\n\r\n    if (_waitingForEI) {\r\n      return false;\r\n    }\r\n\r\n    _waitingForEI = true;\r\n    _event.remove(_win, 'load', _delayWaitForEI);\r\n\r\n    if (_tryInitOnFocus && !_isFocused) {\r\n      // giant Safari 3.1 hack - assume mousemove = focus given lack of focus event\r\n      _wDS('waitFocus');\r\n      return false;\r\n    }\r\n\r\n    var p;\r\n    if (!_didInit) {\r\n      p = _s.getMoviePercent();\r\n      _s._wD(_str('waitImpatient', (p === 100?' (SWF loaded)':(p > 0?' (SWF ' + p + '% loaded)':''))));\r\n    }\r\n\r\n    setTimeout(function () {\r\n\r\n      p = _s.getMoviePercent();\r\n\r\n      if (!_didInit) {\r\n        _s._wD(_sm + ': No Flash response within expected time.\\nLikely causes: ' + (p === 0?'Loading ' + _s.movieURL + ' may have failed (and/or Flash ' + _fV + '+ not present?), ':'') + 'Flash blocked or JS-Flash security error.' + (_s.debugFlash?' ' + _str('checkSWF'):''), 2);\r\n        if (!_overHTTP && p) {\r\n          _wDS('localFail', 2);\r\n          if (!_s.debugFlash) {\r\n            _wDS('tryDebug', 2);\r\n          }\r\n        }\r\n        if (p === 0) {\r\n          // if 0 (not null), probably a 404.\r\n          _s._wD(_str('swf404', _s.url));\r\n        }\r\n        _debugTS('flashtojs', false, ': Timed out' + _overHTTP?' (Check flash security or flash blockers)':' (No plugin/missing SWF?)');\r\n      }\r\n\r\n      // give up / time-out, depending\r\n      if (!_didInit && _okToDisable) {\r\n        if (p === null) {\r\n          // SWF failed. Maybe blocked.\r\n          if (_s.useFlashBlock || _s.flashLoadTimeout === 0) {\r\n            if (_s.useFlashBlock) {\r\n              _flashBlockHandler();\r\n            }\r\n            _wDS('waitForever');\r\n          } else {\r\n            // old SM2 behaviour, simply fail\r\n            _failSafely(true);\r\n          }\r\n\r\n        } else {\r\n          // flash loaded? Shouldn't be a blocking issue, then.\r\n          if (_s.flashLoadTimeout === 0) {\r\n             _wDS('waitForever');\r\n          } else {\r\n            _failSafely(true);\r\n          }\r\n        }\r\n      }\r\n\r\n    }, _s.flashLoadTimeout);\r\n\r\n  };\r\n\r\n  _handleFocus = function () {\r\n    function cleanup() {\r\n      _event.remove(_win, 'focus', _handleFocus);\r\n      _event.remove(_win, 'load', _handleFocus);\r\n    }\r\n    if (_isFocused || !_tryInitOnFocus) {\r\n      cleanup();\r\n      return true;\r\n    }\r\n    _okToDisable = true;\r\n    _isFocused = true;\r\n    _s._wD(_smc+'handleFocus()');\r\n    if (_isSafari && _tryInitOnFocus) {\r\n      _event.remove(_win, 'mousemove', _handleFocus);\r\n    }\r\n    // allow init to restart\r\n    _waitingForEI = false;\r\n    cleanup();\r\n    return true;\r\n  };\r\n\r\n  _initComplete = function (bNoDisable) {\r\n    if (_didInit) {\r\n      return false;\r\n    }\r\n    if (_s.html5Only) {\r\n      // all good.\r\n      _s._wD('-- SoundManager 2: loaded --');\r\n      _didInit = true;\r\n      _initUserOnload();\r\n      _debugTS('onload', true);\r\n      return true;\r\n    }\r\n    var wasTimeout = (_s.useFlashBlock && _s.flashLoadTimeout && !_s.getMoviePercent()),\r\n        error;\r\n    if (!wasTimeout) {\r\n      _didInit = true;\r\n      if (_disabled) {\r\n        error = {type: (!_hasFlash && _needsFlash ? 'NO_FLASH' : 'INIT_TIMEOUT')};\r\n      }\r\n    }\r\n    _s._wD('-- SoundManager 2 ' + (_disabled?'failed to load':'loaded') + ' (' + (_disabled?'security/load error':'OK') + ') --', 1);\r\n    if (_disabled || bNoDisable) {\r\n      if (_s.useFlashBlock && _s.oMC) {\r\n        _s.oMC.className = _getSWFCSS() + ' ' + (_s.getMoviePercent() === null?_s.swfCSS.swfTimedout:_s.swfCSS.swfError);\r\n      }\r\n      _processOnEvents({type:'ontimeout', error:error});\r\n      _debugTS('onload', false);\r\n      _catchError(error);\r\n      return false;\r\n    } else {\r\n      _debugTS('onload', true);\r\n    }\r\n    _event.add(_win, 'unload', _doNothing); // prevent browser from showing cached state via back button, because flash will be dead\r\n    if (_s.waitForWindowLoad && !_windowLoaded) {\r\n      _wDS('waitOnload');\r\n      _event.add(_win, 'load', _initUserOnload);\r\n      return false;\r\n    } else {\r\n      if (_s.waitForWindowLoad && _windowLoaded) {\r\n        _wDS('docLoaded');\r\n      }\r\n      _initUserOnload();\r\n    }\r\n    return true;\r\n  };\r\n\r\n  _showSupport = function () {\r\n\r\n    var item, tests = [];\r\n    if (_s.useHTML5Audio && _s.hasHTML5) {\r\n      for (item in _s.audioFormats) {\r\n        if (_s.audioFormats.hasOwnProperty(item)) {\r\n          tests.push(item + ': ' + _s.html5[item] + (!_s.html5[item] && _hasFlash && _s.flash[item] ? ' (using flash)' : (_s.preferFlash && _s.flash[item] && _hasFlash ? ' (preferring flash)': (!_s.html5[item] ? ' (' + (_s.audioFormats[item].required ? 'required, ':'') + 'and no flash support)' : ''))));\r\n        }\r\n      }\r\n      _s._wD('-- SoundManager 2: HTML5 support tests ('+_s.html5Test+'): '+tests.join(', ')+' --',1);\r\n    }\r\n\r\n  };\r\n\r\n  _init = function () {\r\n\r\n    _wDS('init');\r\n\r\n    // called after onload()\r\n    if (_didInit) {\r\n      _wDS('didInit');\r\n      return false;\r\n    }\r\n\r\n    function _cleanup() {\r\n      _event.remove(_win, 'load', _s.beginDelayedInit);\r\n    }\r\n\r\n    if (_s.html5Only) {\r\n      if (!_didInit) {\r\n        // we don't need no steenking flash!\r\n        _cleanup();\r\n        _s.enabled = true;\r\n        _initComplete();\r\n      }\r\n      return true;\r\n    }\r\n\r\n    // flash path\r\n    _initMovie();\r\n\r\n    try {\r\n      _wDS('flashJS');\r\n      _s.o._externalInterfaceTest(false); // attempt to talk to Flash\r\n      if (!_s.allowPolling) {\r\n        _wDS('noPolling', 1);\r\n      } else {\r\n        _setPolling(true, (_s.flashPollingInterval || (_s.useFastPolling ? 10 : 50)));\r\n      }\r\n      if (!_s.debugMode) {\r\n        _s.o._disableDebug();\r\n      }\r\n      _s.enabled = true;\r\n      _debugTS('jstoflash', true);\r\n    } catch(e) {\r\n      _s._wD('js/flash exception: ' + e.toString());\r\n      _debugTS('jstoflash', false);\r\n      _catchError({type:'JS_TO_FLASH_EXCEPTION', fatal:true});\r\n      _failSafely(true); // don't disable, for reboot()\r\n      _initComplete();\r\n      return false;\r\n    }\r\n\r\n    _initComplete();\r\n    // event cleanup\r\n    _cleanup();\r\n    return true;\r\n\r\n  };\r\n\r\n  _dcLoaded = function () {\r\n    if (_didDCLoaded) {\r\n      return false;\r\n    }\r\n    _didDCLoaded = true;\r\n    _initDebug();\r\n\r\n    /*\r\n     * Temporary feature: allow force of HTML5 via URL params: sm2-usehtml5audio=0 or 1\r\n     * Ditto for sm2-preferFlash, too.\r\n    */\r\n    // <d>\r\n    (function () {\r\n      var a = 'sm2-usehtml5audio=', l = _wl.toLowerCase(), b = null,\r\n      a2 = 'sm2-preferflash=', b2 = null, hasCon = (typeof console !== 'undefined' && typeof console.log !== 'undefined');\r\n      if (l.indexOf(a) !== -1) {\r\n        b = (l.charAt(l.indexOf(a)+a.length) === '1');\r\n        if (hasCon) {\r\n          console.log((b?'Enabling ':'Disabling ')+'useHTML5Audio via URL parameter');\r\n        }\r\n        _s.useHTML5Audio = b;\r\n      }\r\n      if (l.indexOf(a2) !== -1) {\r\n        b2 = (l.charAt(l.indexOf(a2)+a2.length) === '1');\r\n        if (hasCon) {\r\n          console.log((b2?'Enabling ':'Disabling ')+'preferFlash via URL parameter');\r\n        }\r\n        _s.preferFlash = b2;\r\n      }\r\n    }());\r\n    // </d>\r\n\r\n    if (!_hasFlash && _s.hasHTML5) {\r\n      _s._wD('SoundManager: No Flash detected'+(!_s.useHTML5Audio?', enabling HTML5.':'. Trying HTML5-only mode.'));\r\n      _s.useHTML5Audio = true;\r\n      // make sure we aren't preferring flash, either\r\n      // TODO: preferFlash should not matter if flash is not installed. Currently, stuff breaks without the below tweak.\r\n      _s.preferFlash = false;\r\n    }\r\n\r\n    _testHTML5();\r\n    _s.html5.usingFlash = _featureCheck();\r\n    _needsFlash = _s.html5.usingFlash;\r\n\r\n    _showSupport();\r\n\r\n    if (!_hasFlash && _needsFlash) {\r\n      _s._wD('SoundManager: Fatal error: Flash is needed to play some required formats, but is not available.');\r\n      // TODO: Fatal here vs. timeout approach, etc.\r\n      _s.flashLoadTimeout = 1; // hack: fail sooner.\r\n    }\r\n\r\n    if (_doc.removeEventListener) {\r\n      _doc.removeEventListener('DOMContentLoaded', _dcLoaded, false);\r\n    }\r\n    _initMovie();\r\n    return true;\r\n  };\r\n\r\n  _dcIE = function () {\r\n    if (_doc.readyState === 'complete') {\r\n      _dcLoaded();\r\n      _doc.detachEvent('onreadystatechange', _dcIE);\r\n    }\r\n    return true;\r\n  };\r\n\r\n  // sniff up-front\r\n  _detectFlash();\r\n\r\n  // focus and window load, init (primarily flash-driven)\r\n  _event.add(_win, 'focus', _handleFocus);\r\n  _event.add(_win, 'load', _handleFocus);\r\n  _event.add(_win, 'load', _delayWaitForEI);\r\n  if (_isSafari && _tryInitOnFocus) {\r\n    _event.add(_win, 'mousemove', _handleFocus); // massive Safari 3.1 focus hack\r\n  }\r\n\r\n  if (_doc.addEventListener) {\r\n    _doc.addEventListener('DOMContentLoaded', _dcLoaded, false);\r\n  } else if (_doc.attachEvent) {\r\n    _doc.attachEvent('onreadystatechange', _dcIE);\r\n  } else {\r\n    // no add/attachevent support - safe to assume no JS -> Flash either\r\n    _debugTS('onload', false);\r\n    _catchError({type:'NO_DOM2_EVENTS', fatal:true});\r\n  }\r\n\r\n  if (_doc.readyState === 'complete') {\r\n    setTimeout(_dcLoaded,100);\r\n  }\r\n\r\n} // SoundManager()\r\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/underscore.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/underscore.js","friendlyPath":"util.underscore","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"underscore.js","src":"//     Underscore.js 1.6.0\n//     http://underscorejs.org\n//     (c) 2009-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n//     Underscore may be freely distributed under the MIT license.\n\n(function() {\n\n  // Baseline setup\n  // --------------\n\n  // Establish the root object, `window` in the browser, or `exports` on the server.\n  var root = this;\n\n  // Save the previous value of the `_` variable.\n  var previousUnderscore = root._;\n\n  // Establish the object that gets returned to break out of a loop iteration.\n  var breaker = {};\n\n  // Save bytes in the minified (but not gzipped) version:\n  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;\n\n  // Create quick reference variables for speed access to core prototypes.\n  var\n    push             = ArrayProto.push,\n    slice            = ArrayProto.slice,\n    concat           = ArrayProto.concat,\n    toString         = ObjProto.toString,\n    hasOwnProperty   = ObjProto.hasOwnProperty;\n\n  // All **ECMAScript 5** native function implementations that we hope to use\n  // are declared here.\n  var\n    nativeForEach      = ArrayProto.forEach,\n    nativeMap          = ArrayProto.map,\n    nativeReduce       = ArrayProto.reduce,\n    nativeReduceRight  = ArrayProto.reduceRight,\n    nativeFilter       = ArrayProto.filter,\n    nativeEvery        = ArrayProto.every,\n    nativeSome         = ArrayProto.some,\n    nativeIndexOf      = ArrayProto.indexOf,\n    nativeLastIndexOf  = ArrayProto.lastIndexOf,\n    nativeIsArray      = Array.isArray,\n    nativeKeys         = Object.keys,\n    nativeBind         = FuncProto.bind;\n\n  // Create a safe reference to the Underscore object for use below.\n  var _ = function(obj) {\n    if (obj instanceof _) return obj;\n    if (!(this instanceof _)) return new _(obj);\n    this._wrapped = obj;\n  };\n\n  // Export the Underscore object for **Node.js**, with\n  // backwards-compatibility for the old `require()` API. If we're in\n  // the browser, add `_` as a global object via a string identifier,\n  // for Closure Compiler \"advanced\" mode.\n  if (typeof exports !== 'undefined') {\n    if (typeof module !== 'undefined' && module.exports) {\n      exports = module.exports = _;\n    }\n    exports._ = _;\n  } else {\n    root._ = _;\n  }\n\n  // Current version.\n  _.VERSION = '1.6.0';\n\n  // Collection Functions\n  // --------------------\n\n  // The cornerstone, an `each` implementation, aka `forEach`.\n  // Handles objects with the built-in `forEach`, arrays, and raw objects.\n  // Delegates to **ECMAScript 5**'s native `forEach` if available.\n  var each = _.each = _.forEach = function(obj, iterator, context) {\n    if (obj == null) return obj;\n    if (nativeForEach && obj.forEach === nativeForEach) {\n      obj.forEach(iterator, context);\n    } else if (obj.length === +obj.length) {\n      for (var i = 0, length = obj.length; i < length; i++) {\n        if (iterator.call(context, obj[i], i, obj) === breaker) return;\n      }\n    } else {\n      var keys = _.keys(obj);\n      for (var i = 0, length = keys.length; i < length; i++) {\n        if (iterator.call(context, obj[keys[i]], keys[i], obj) === breaker) return;\n      }\n    }\n    return obj;\n  };\n\n  // Return the results of applying the iterator to each element.\n  // Delegates to **ECMAScript 5**'s native `map` if available.\n  _.map = _.collect = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeMap && obj.map === nativeMap) return obj.map(iterator, context);\n    each(obj, function(value, index, list) {\n      results.push(iterator.call(context, value, index, list));\n    });\n    return results;\n  };\n\n  var reduceError = 'Reduce of empty array with no initial value';\n\n  // **Reduce** builds up a single result from a list of values, aka `inject`,\n  // or `foldl`. Delegates to **ECMAScript 5**'s native `reduce` if available.\n  _.reduce = _.foldl = _.inject = function(obj, iterator, memo, context) {\n    var initial = arguments.length > 2;\n    if (obj == null) obj = [];\n    if (nativeReduce && obj.reduce === nativeReduce) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduce(iterator, memo) : obj.reduce(iterator);\n    }\n    each(obj, function(value, index, list) {\n      if (!initial) {\n        memo = value;\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, value, index, list);\n      }\n    });\n    if (!initial) throw new TypeError(reduceError);\n    return memo;\n  };\n\n  // The right-associative version of reduce, also known as `foldr`.\n  // Delegates to **ECMAScript 5**'s native `reduceRight` if available.\n  _.reduceRight = _.foldr = function(obj, iterator, memo, context) {\n    var initial = arguments.length > 2;\n    if (obj == null) obj = [];\n    if (nativeReduceRight && obj.reduceRight === nativeReduceRight) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduceRight(iterator, memo) : obj.reduceRight(iterator);\n    }\n    var length = obj.length;\n    if (length !== +length) {\n      var keys = _.keys(obj);\n      length = keys.length;\n    }\n    each(obj, function(value, index, list) {\n      index = keys ? keys[--length] : --length;\n      if (!initial) {\n        memo = obj[index];\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, obj[index], index, list);\n      }\n    });\n    if (!initial) throw new TypeError(reduceError);\n    return memo;\n  };\n\n  // Return the first value which passes a truth test. Aliased as `detect`.\n  _.find = _.detect = function(obj, predicate, context) {\n    var result;\n    any(obj, function(value, index, list) {\n      if (predicate.call(context, value, index, list)) {\n        result = value;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  // Return all the elements that pass a truth test.\n  // Delegates to **ECMAScript 5**'s native `filter` if available.\n  // Aliased as `select`.\n  _.filter = _.select = function(obj, predicate, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeFilter && obj.filter === nativeFilter) return obj.filter(predicate, context);\n    each(obj, function(value, index, list) {\n      if (predicate.call(context, value, index, list)) results.push(value);\n    });\n    return results;\n  };\n\n  // Return all the elements for which a truth test fails.\n  _.reject = function(obj, predicate, context) {\n    return _.filter(obj, function(value, index, list) {\n      return !predicate.call(context, value, index, list);\n    }, context);\n  };\n\n  // Determine whether all of the elements match a truth test.\n  // Delegates to **ECMAScript 5**'s native `every` if available.\n  // Aliased as `all`.\n  _.every = _.all = function(obj, predicate, context) {\n    predicate || (predicate = _.identity);\n    var result = true;\n    if (obj == null) return result;\n    if (nativeEvery && obj.every === nativeEvery) return obj.every(predicate, context);\n    each(obj, function(value, index, list) {\n      if (!(result = result && predicate.call(context, value, index, list))) return breaker;\n    });\n    return !!result;\n  };\n\n  // Determine if at least one element in the object matches a truth test.\n  // Delegates to **ECMAScript 5**'s native `some` if available.\n  // Aliased as `any`.\n  var any = _.some = _.any = function(obj, predicate, context) {\n    predicate || (predicate = _.identity);\n    var result = false;\n    if (obj == null) return result;\n    if (nativeSome && obj.some === nativeSome) return obj.some(predicate, context);\n    each(obj, function(value, index, list) {\n      if (result || (result = predicate.call(context, value, index, list))) return breaker;\n    });\n    return !!result;\n  };\n\n  // Determine if the array or object contains a given value (using `===`).\n  // Aliased as `include`.\n  _.contains = _.include = function(obj, target) {\n    if (obj == null) return false;\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) return obj.indexOf(target) != -1;\n    return any(obj, function(value) {\n      return value === target;\n    });\n  };\n\n  // Invoke a method (with arguments) on every item in a collection.\n  _.invoke = function(obj, method) {\n    var args = slice.call(arguments, 2);\n    var isFunc = _.isFunction(method);\n    return _.map(obj, function(value) {\n      return (isFunc ? method : value[method]).apply(value, args);\n    });\n  };\n\n  // Convenience version of a common use case of `map`: fetching a property.\n  _.pluck = function(obj, key) {\n    return _.map(obj, _.property(key));\n  };\n\n  // Convenience version of a common use case of `filter`: selecting only objects\n  // containing specific `key:value` pairs.\n  _.where = function(obj, attrs) {\n    return _.filter(obj, _.matches(attrs));\n  };\n\n  // Convenience version of a common use case of `find`: getting the first object\n  // containing specific `key:value` pairs.\n  _.findWhere = function(obj, attrs) {\n    return _.find(obj, _.matches(attrs));\n  };\n\n  // Return the maximum element or (element-based computation).\n  // Can't optimize arrays of integers longer than 65,535 elements.\n  // See [WebKit Bug 80797](https://bugs.webkit.org/show_bug.cgi?id=80797)\n  _.max = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {\n      return Math.max.apply(Math, obj);\n    }\n    var result = -Infinity, lastComputed = -Infinity;\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      if (computed > lastComputed) {\n        result = value;\n        lastComputed = computed;\n      }\n    });\n    return result;\n  };\n\n  // Return the minimum element (or element-based computation).\n  _.min = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {\n      return Math.min.apply(Math, obj);\n    }\n    var result = Infinity, lastComputed = Infinity;\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      if (computed < lastComputed) {\n        result = value;\n        lastComputed = computed;\n      }\n    });\n    return result;\n  };\n\n  // Shuffle an array, using the modern version of the\n  // [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher–Yates_shuffle).\n  _.shuffle = function(obj) {\n    var rand;\n    var index = 0;\n    var shuffled = [];\n    each(obj, function(value) {\n      rand = _.random(index++);\n      shuffled[index - 1] = shuffled[rand];\n      shuffled[rand] = value;\n    });\n    return shuffled;\n  };\n\n  // Sample **n** random values from a collection.\n  // If **n** is not specified, returns a single random element.\n  // The internal `guard` argument allows it to work with `map`.\n  _.sample = function(obj, n, guard) {\n    if (n == null || guard) {\n      if (obj.length !== +obj.length) obj = _.values(obj);\n      return obj[_.random(obj.length - 1)];\n    }\n    return _.shuffle(obj).slice(0, Math.max(0, n));\n  };\n\n  // An internal function to generate lookup iterators.\n  var lookupIterator = function(value) {\n    if (value == null) return _.identity;\n    if (_.isFunction(value)) return value;\n    return _.property(value);\n  };\n\n  // Sort the object's values by a criterion produced by an iterator.\n  _.sortBy = function(obj, iterator, context) {\n    iterator = lookupIterator(iterator);\n    return _.pluck(_.map(obj, function(value, index, list) {\n      return {\n        value: value,\n        index: index,\n        criteria: iterator.call(context, value, index, list)\n      };\n    }).sort(function(left, right) {\n      var a = left.criteria;\n      var b = right.criteria;\n      if (a !== b) {\n        if (a > b || a === void 0) return 1;\n        if (a < b || b === void 0) return -1;\n      }\n      return left.index - right.index;\n    }), 'value');\n  };\n\n  // An internal function used for aggregate \"group by\" operations.\n  var group = function(behavior) {\n    return function(obj, iterator, context) {\n      var result = {};\n      iterator = lookupIterator(iterator);\n      each(obj, function(value, index) {\n        var key = iterator.call(context, value, index, obj);\n        behavior(result, key, value);\n      });\n      return result;\n    };\n  };\n\n  // Groups the object's values by a criterion. Pass either a string attribute\n  // to group by, or a function that returns the criterion.\n  _.groupBy = group(function(result, key, value) {\n    _.has(result, key) ? result[key].push(value) : result[key] = [value];\n  });\n\n  // Indexes the object's values by a criterion, similar to `groupBy`, but for\n  // when you know that your index values will be unique.\n  _.indexBy = group(function(result, key, value) {\n    result[key] = value;\n  });\n\n  // Counts instances of an object that group by a certain criterion. Pass\n  // either a string attribute to count by, or a function that returns the\n  // criterion.\n  _.countBy = group(function(result, key) {\n    _.has(result, key) ? result[key]++ : result[key] = 1;\n  });\n\n  // Use a comparator function to figure out the smallest index at which\n  // an object should be inserted so as to maintain order. Uses binary search.\n  _.sortedIndex = function(array, obj, iterator, context) {\n    iterator = lookupIterator(iterator);\n    var value = iterator.call(context, obj);\n    var low = 0, high = array.length;\n    while (low < high) {\n      var mid = (low + high) >>> 1;\n      iterator.call(context, array[mid]) < value ? low = mid + 1 : high = mid;\n    }\n    return low;\n  };\n\n  // Safely create a real, live array from anything iterable.\n  _.toArray = function(obj) {\n    if (!obj) return [];\n    if (_.isArray(obj)) return slice.call(obj);\n    if (obj.length === +obj.length) return _.map(obj, _.identity);\n    return _.values(obj);\n  };\n\n  // Return the number of elements in an object.\n  _.size = function(obj) {\n    if (obj == null) return 0;\n    return (obj.length === +obj.length) ? obj.length : _.keys(obj).length;\n  };\n\n  // Array Functions\n  // ---------------\n\n  // Get the first element of an array. Passing **n** will return the first N\n  // values in the array. Aliased as `head` and `take`. The **guard** check\n  // allows it to work with `_.map`.\n  _.first = _.head = _.take = function(array, n, guard) {\n    if (array == null) return void 0;\n    if ((n == null) || guard) return array[0];\n    if (n < 0) return [];\n    return slice.call(array, 0, n);\n  };\n\n  // Returns everything but the last entry of the array. Especially useful on\n  // the arguments object. Passing **n** will return all the values in\n  // the array, excluding the last N. The **guard** check allows it to work with\n  // `_.map`.\n  _.initial = function(array, n, guard) {\n    return slice.call(array, 0, array.length - ((n == null) || guard ? 1 : n));\n  };\n\n  // Get the last element of an array. Passing **n** will return the last N\n  // values in the array. The **guard** check allows it to work with `_.map`.\n  _.last = function(array, n, guard) {\n    if (array == null) return void 0;\n    if ((n == null) || guard) return array[array.length - 1];\n    return slice.call(array, Math.max(array.length - n, 0));\n  };\n\n  // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.\n  // Especially useful on the arguments object. Passing an **n** will return\n  // the rest N values in the array. The **guard**\n  // check allows it to work with `_.map`.\n  _.rest = _.tail = _.drop = function(array, n, guard) {\n    return slice.call(array, (n == null) || guard ? 1 : n);\n  };\n\n  // Trim out all falsy values from an array.\n  _.compact = function(array) {\n    return _.filter(array, _.identity);\n  };\n\n  // Internal implementation of a recursive `flatten` function.\n  var flatten = function(input, shallow, output) {\n    if (shallow && _.every(input, _.isArray)) {\n      return concat.apply(output, input);\n    }\n    each(input, function(value) {\n      if (_.isArray(value) || _.isArguments(value)) {\n        shallow ? push.apply(output, value) : flatten(value, shallow, output);\n      } else {\n        output.push(value);\n      }\n    });\n    return output;\n  };\n\n  // Flatten out an array, either recursively (by default), or just one level.\n  _.flatten = function(array, shallow) {\n    return flatten(array, shallow, []);\n  };\n\n  // Return a version of the array that does not contain the specified value(s).\n  _.without = function(array) {\n    return _.difference(array, slice.call(arguments, 1));\n  };\n\n  // Split an array into two arrays: one whose elements all satisfy the given\n  // predicate, and one whose elements all do not satisfy the predicate.\n  _.partition = function(array, predicate) {\n    var pass = [], fail = [];\n    each(array, function(elem) {\n      (predicate(elem) ? pass : fail).push(elem);\n    });\n    return [pass, fail];\n  };\n\n  // Produce a duplicate-free version of the array. If the array has already\n  // been sorted, you have the option of using a faster algorithm.\n  // Aliased as `unique`.\n  _.uniq = _.unique = function(array, isSorted, iterator, context) {\n    if (_.isFunction(isSorted)) {\n      context = iterator;\n      iterator = isSorted;\n      isSorted = false;\n    }\n    var initial = iterator ? _.map(array, iterator, context) : array;\n    var results = [];\n    var seen = [];\n    each(initial, function(value, index) {\n      if (isSorted ? (!index || seen[seen.length - 1] !== value) : !_.contains(seen, value)) {\n        seen.push(value);\n        results.push(array[index]);\n      }\n    });\n    return results;\n  };\n\n  // Produce an array that contains the union: each distinct element from all of\n  // the passed-in arrays.\n  _.union = function() {\n    return _.uniq(_.flatten(arguments, true));\n  };\n\n  // Produce an array that contains every item shared between all the\n  // passed-in arrays.\n  _.intersection = function(array) {\n    var rest = slice.call(arguments, 1);\n    return _.filter(_.uniq(array), function(item) {\n      return _.every(rest, function(other) {\n        return _.contains(other, item);\n      });\n    });\n  };\n\n  // Take the difference between one array and a number of other arrays.\n  // Only the elements present in just the first array will remain.\n  _.difference = function(array) {\n    var rest = concat.apply(ArrayProto, slice.call(arguments, 1));\n    return _.filter(array, function(value){ return !_.contains(rest, value); });\n  };\n\n  // Zip together multiple lists into a single array -- elements that share\n  // an index go together.\n  _.zip = function() {\n    var length = _.max(_.pluck(arguments, 'length').concat(0));\n    var results = new Array(length);\n    for (var i = 0; i < length; i++) {\n      results[i] = _.pluck(arguments, '' + i);\n    }\n    return results;\n  };\n\n  // Converts lists into objects. Pass either a single array of `[key, value]`\n  // pairs, or two parallel arrays of the same length -- one of keys, and one of\n  // the corresponding values.\n  _.object = function(list, values) {\n    if (list == null) return {};\n    var result = {};\n    for (var i = 0, length = list.length; i < length; i++) {\n      if (values) {\n        result[list[i]] = values[i];\n      } else {\n        result[list[i][0]] = list[i][1];\n      }\n    }\n    return result;\n  };\n\n  // If the browser doesn't supply us with indexOf (I'm looking at you, **MSIE**),\n  // we need this function. Return the position of the first occurrence of an\n  // item in an array, or -1 if the item is not included in the array.\n  // Delegates to **ECMAScript 5**'s native `indexOf` if available.\n  // If the array is large and already in sort order, pass `true`\n  // for **isSorted** to use binary search.\n  _.indexOf = function(array, item, isSorted) {\n    if (array == null) return -1;\n    var i = 0, length = array.length;\n    if (isSorted) {\n      if (typeof isSorted == 'number') {\n        i = (isSorted < 0 ? Math.max(0, length + isSorted) : isSorted);\n      } else {\n        i = _.sortedIndex(array, item);\n        return array[i] === item ? i : -1;\n      }\n    }\n    if (nativeIndexOf && array.indexOf === nativeIndexOf) return array.indexOf(item, isSorted);\n    for (; i < length; i++) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Delegates to **ECMAScript 5**'s native `lastIndexOf` if available.\n  _.lastIndexOf = function(array, item, from) {\n    if (array == null) return -1;\n    var hasIndex = from != null;\n    if (nativeLastIndexOf && array.lastIndexOf === nativeLastIndexOf) {\n      return hasIndex ? array.lastIndexOf(item, from) : array.lastIndexOf(item);\n    }\n    var i = (hasIndex ? from : array.length);\n    while (i--) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Generate an integer Array containing an arithmetic progression. A port of\n  // the native Python `range()` function. See\n  // [the Python documentation](http://docs.python.org/library/functions.html#range).\n  _.range = function(start, stop, step) {\n    if (arguments.length <= 1) {\n      stop = start || 0;\n      start = 0;\n    }\n    step = arguments[2] || 1;\n\n    var length = Math.max(Math.ceil((stop - start) / step), 0);\n    var idx = 0;\n    var range = new Array(length);\n\n    while(idx < length) {\n      range[idx++] = start;\n      start += step;\n    }\n\n    return range;\n  };\n\n  // Function (ahem) Functions\n  // ------------------\n\n  // Reusable constructor function for prototype setting.\n  var ctor = function(){};\n\n  // Create a function bound to a given object (assigning `this`, and arguments,\n  // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if\n  // available.\n  _.bind = function(func, context) {\n    var args, bound;\n    if (nativeBind && func.bind === nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));\n    if (!_.isFunction(func)) throw new TypeError;\n    args = slice.call(arguments, 2);\n    return bound = function() {\n      if (!(this instanceof bound)) return func.apply(context, args.concat(slice.call(arguments)));\n      ctor.prototype = func.prototype;\n      var self = new ctor;\n      ctor.prototype = null;\n      var result = func.apply(self, args.concat(slice.call(arguments)));\n      if (Object(result) === result) return result;\n      return self;\n    };\n  };\n\n  // Partially apply a function by creating a version that has had some of its\n  // arguments pre-filled, without changing its dynamic `this` context. _ acts\n  // as a placeholder, allowing any combination of arguments to be pre-filled.\n  _.partial = function(func) {\n    var boundArgs = slice.call(arguments, 1);\n    return function() {\n      var position = 0;\n      var args = boundArgs.slice();\n      for (var i = 0, length = args.length; i < length; i++) {\n        if (args[i] === _) args[i] = arguments[position++];\n      }\n      while (position < arguments.length) args.push(arguments[position++]);\n      return func.apply(this, args);\n    };\n  };\n\n  // Bind a number of an object's methods to that object. Remaining arguments\n  // are the method names to be bound. Useful for ensuring that all callbacks\n  // defined on an object belong to it.\n  _.bindAll = function(obj) {\n    var funcs = slice.call(arguments, 1);\n    if (funcs.length === 0) throw new Error('bindAll must be passed function names');\n    each(funcs, function(f) { obj[f] = _.bind(obj[f], obj); });\n    return obj;\n  };\n\n  // Memoize an expensive function by storing its results.\n  _.memoize = function(func, hasher) {\n    var memo = {};\n    hasher || (hasher = _.identity);\n    return function() {\n      var key = hasher.apply(this, arguments);\n      return _.has(memo, key) ? memo[key] : (memo[key] = func.apply(this, arguments));\n    };\n  };\n\n  // Delays a function for the given number of milliseconds, and then calls\n  // it with the arguments supplied.\n  _.delay = function(func, wait) {\n    var args = slice.call(arguments, 2);\n    return setTimeout(function(){ return func.apply(null, args); }, wait);\n  };\n\n  // Defers a function, scheduling it to run after the current call stack has\n  // cleared.\n  _.defer = function(func) {\n    return _.delay.apply(_, [func, 1].concat(slice.call(arguments, 1)));\n  };\n\n  // Returns a function, that, when invoked, will only be triggered at most once\n  // during a given window of time. Normally, the throttled function will run\n  // as much as it can, without ever going more than once per `wait` duration;\n  // but if you'd like to disable the execution on the leading edge, pass\n  // `{leading: false}`. To disable execution on the trailing edge, ditto.\n  _.throttle = function(func, wait, options) {\n    var context, args, result;\n    var timeout = null;\n    var previous = 0;\n    options || (options = {});\n    var later = function() {\n      previous = options.leading === false ? 0 : _.now();\n      timeout = null;\n      result = func.apply(context, args);\n      context = args = null;\n    };\n    return function() {\n      var now = _.now();\n      if (!previous && options.leading === false) previous = now;\n      var remaining = wait - (now - previous);\n      context = this;\n      args = arguments;\n      if (remaining <= 0) {\n        clearTimeout(timeout);\n        timeout = null;\n        previous = now;\n        result = func.apply(context, args);\n        context = args = null;\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n  };\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds. If `immediate` is passed, trigger the function on the\n  // leading edge, instead of the trailing.\n  _.debounce = function(func, wait, immediate) {\n    var timeout, args, context, timestamp, result;\n\n    var later = function() {\n      var last = _.now() - timestamp;\n      if (last < wait) {\n        timeout = setTimeout(later, wait - last);\n      } else {\n        timeout = null;\n        if (!immediate) {\n          result = func.apply(context, args);\n          context = args = null;\n        }\n      }\n    };\n\n    return function() {\n      context = this;\n      args = arguments;\n      timestamp = _.now();\n      var callNow = immediate && !timeout;\n      if (!timeout) {\n        timeout = setTimeout(later, wait);\n      }\n      if (callNow) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n\n      return result;\n    };\n  };\n\n  // Returns a function that will be executed at most one time, no matter how\n  // often you call it. Useful for lazy initialization.\n  _.once = function(func) {\n    var ran = false, memo;\n    return function() {\n      if (ran) return memo;\n      ran = true;\n      memo = func.apply(this, arguments);\n      func = null;\n      return memo;\n    };\n  };\n\n  // Returns the first function passed as an argument to the second,\n  // allowing you to adjust arguments, run code before and after, and\n  // conditionally execute the original function.\n  _.wrap = function(func, wrapper) {\n    return _.partial(wrapper, func);\n  };\n\n  // Returns a function that is the composition of a list of functions, each\n  // consuming the return value of the function that follows.\n  _.compose = function() {\n    var funcs = arguments;\n    return function() {\n      var args = arguments;\n      for (var i = funcs.length - 1; i >= 0; i--) {\n        args = [funcs[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  };\n\n  // Returns a function that will only be executed after being called N times.\n  _.after = function(times, func) {\n    return function() {\n      if (--times < 1) {\n        return func.apply(this, arguments);\n      }\n    };\n  };\n\n  // Object Functions\n  // ----------------\n\n  // Retrieve the names of an object's properties.\n  // Delegates to **ECMAScript 5**'s native `Object.keys`\n  _.keys = function(obj) {\n    if (!_.isObject(obj)) return [];\n    if (nativeKeys) return nativeKeys(obj);\n    var keys = [];\n    for (var key in obj) if (_.has(obj, key)) keys.push(key);\n    return keys;\n  };\n\n  // Retrieve the values of an object's properties.\n  _.values = function(obj) {\n    var keys = _.keys(obj);\n    var length = keys.length;\n    var values = new Array(length);\n    for (var i = 0; i < length; i++) {\n      values[i] = obj[keys[i]];\n    }\n    return values;\n  };\n\n  // Convert an object into a list of `[key, value]` pairs.\n  _.pairs = function(obj) {\n    var keys = _.keys(obj);\n    var length = keys.length;\n    var pairs = new Array(length);\n    for (var i = 0; i < length; i++) {\n      pairs[i] = [keys[i], obj[keys[i]]];\n    }\n    return pairs;\n  };\n\n  // Invert the keys and values of an object. The values must be serializable.\n  _.invert = function(obj) {\n    var result = {};\n    var keys = _.keys(obj);\n    for (var i = 0, length = keys.length; i < length; i++) {\n      result[obj[keys[i]]] = keys[i];\n    }\n    return result;\n  };\n\n  // Return a sorted list of the function names available on the object.\n  // Aliased as `methods`\n  _.functions = _.methods = function(obj) {\n    var names = [];\n    for (var key in obj) {\n      if (_.isFunction(obj[key])) names.push(key);\n    }\n    return names.sort();\n  };\n\n  // Extend a given object with all the properties in passed-in object(s).\n  _.extend = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      if (source) {\n        for (var prop in source) {\n          obj[prop] = source[prop];\n        }\n      }\n    });\n    return obj;\n  };\n\n  // Return a copy of the object only containing the whitelisted properties.\n  _.pick = function(obj) {\n    var copy = {};\n    var keys = concat.apply(ArrayProto, slice.call(arguments, 1));\n    each(keys, function(key) {\n      if (key in obj) copy[key] = obj[key];\n    });\n    return copy;\n  };\n\n   // Return a copy of the object without the blacklisted properties.\n  _.omit = function(obj) {\n    var copy = {};\n    var keys = concat.apply(ArrayProto, slice.call(arguments, 1));\n    for (var key in obj) {\n      if (!_.contains(keys, key)) copy[key] = obj[key];\n    }\n    return copy;\n  };\n\n  // Fill in a given object with default properties.\n  _.defaults = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      if (source) {\n        for (var prop in source) {\n          if (obj[prop] === void 0) obj[prop] = source[prop];\n        }\n      }\n    });\n    return obj;\n  };\n\n  // Create a (shallow-cloned) duplicate of an object.\n  _.clone = function(obj) {\n    if (!_.isObject(obj)) return obj;\n    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);\n  };\n\n  // Invokes interceptor with the obj, and then returns obj.\n  // The primary purpose of this method is to \"tap into\" a method chain, in\n  // order to perform operations on intermediate results within the chain.\n  _.tap = function(obj, interceptor) {\n    interceptor(obj);\n    return obj;\n  };\n\n  // Internal recursive comparison function for `isEqual`.\n  var eq = function(a, b, aStack, bStack) {\n    // Identical objects are equal. `0 === -0`, but they aren't identical.\n    // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).\n    if (a === b) return a !== 0 || 1 / a == 1 / b;\n    // A strict comparison is necessary because `null == undefined`.\n    if (a == null || b == null) return a === b;\n    // Unwrap any wrapped objects.\n    if (a instanceof _) a = a._wrapped;\n    if (b instanceof _) b = b._wrapped;\n    // Compare `[[Class]]` names.\n    var className = toString.call(a);\n    if (className != toString.call(b)) return false;\n    switch (className) {\n      // Strings, numbers, dates, and booleans are compared by value.\n      case '[object String]':\n        // Primitives and their corresponding object wrappers are equivalent; thus, `\"5\"` is\n        // equivalent to `new String(\"5\")`.\n        return a == String(b);\n      case '[object Number]':\n        // `NaN`s are equivalent, but non-reflexive. An `egal` comparison is performed for\n        // other numeric values.\n        return a != +a ? b != +b : (a == 0 ? 1 / a == 1 / b : a == +b);\n      case '[object Date]':\n      case '[object Boolean]':\n        // Coerce dates and booleans to numeric primitive values. Dates are compared by their\n        // millisecond representations. Note that invalid dates with millisecond representations\n        // of `NaN` are not equivalent.\n        return +a == +b;\n      // RegExps are compared by their source patterns and flags.\n      case '[object RegExp]':\n        return a.source == b.source &&\n               a.global == b.global &&\n               a.multiline == b.multiline &&\n               a.ignoreCase == b.ignoreCase;\n    }\n    if (typeof a != 'object' || typeof b != 'object') return false;\n    // Assume equality for cyclic structures. The algorithm for detecting cyclic\n    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.\n    var length = aStack.length;\n    while (length--) {\n      // Linear search. Performance is inversely proportional to the number of\n      // unique nested structures.\n      if (aStack[length] == a) return bStack[length] == b;\n    }\n    // Objects with different constructors are not equivalent, but `Object`s\n    // from different frames are.\n    var aCtor = a.constructor, bCtor = b.constructor;\n    if (aCtor !== bCtor && !(_.isFunction(aCtor) && (aCtor instanceof aCtor) &&\n                             _.isFunction(bCtor) && (bCtor instanceof bCtor))\n                        && ('constructor' in a && 'constructor' in b)) {\n      return false;\n    }\n    // Add the first object to the stack of traversed objects.\n    aStack.push(a);\n    bStack.push(b);\n    var size = 0, result = true;\n    // Recursively compare objects and arrays.\n    if (className == '[object Array]') {\n      // Compare array lengths to determine if a deep comparison is necessary.\n      size = a.length;\n      result = size == b.length;\n      if (result) {\n        // Deep compare the contents, ignoring non-numeric properties.\n        while (size--) {\n          if (!(result = eq(a[size], b[size], aStack, bStack))) break;\n        }\n      }\n    } else {\n      // Deep compare objects.\n      for (var key in a) {\n        if (_.has(a, key)) {\n          // Count the expected number of properties.\n          size++;\n          // Deep compare each member.\n          if (!(result = _.has(b, key) && eq(a[key], b[key], aStack, bStack))) break;\n        }\n      }\n      // Ensure that both objects contain the same number of properties.\n      if (result) {\n        for (key in b) {\n          if (_.has(b, key) && !(size--)) break;\n        }\n        result = !size;\n      }\n    }\n    // Remove the first object from the stack of traversed objects.\n    aStack.pop();\n    bStack.pop();\n    return result;\n  };\n\n  // Perform a deep comparison to check if two objects are equal.\n  _.isEqual = function(a, b) {\n    return eq(a, b, [], []);\n  };\n\n  // Is a given array, string, or object empty?\n  // An \"empty\" object has no enumerable own-properties.\n  _.isEmpty = function(obj) {\n    if (obj == null) return true;\n    if (_.isArray(obj) || _.isString(obj)) return obj.length === 0;\n    for (var key in obj) if (_.has(obj, key)) return false;\n    return true;\n  };\n\n  // Is a given value a DOM element?\n  _.isElement = function(obj) {\n    return !!(obj && obj.nodeType === 1);\n  };\n\n  // Is a given value an array?\n  // Delegates to ECMA5's native Array.isArray\n  _.isArray = nativeIsArray || function(obj) {\n    return toString.call(obj) == '[object Array]';\n  };\n\n  // Is a given variable an object?\n  _.isObject = function(obj) {\n    return obj === Object(obj);\n  };\n\n  // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp.\n  each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp'], function(name) {\n    _['is' + name] = function(obj) {\n      return toString.call(obj) == '[object ' + name + ']';\n    };\n  });\n\n  // Define a fallback version of the method in browsers (ahem, IE), where\n  // there isn't any inspectable \"Arguments\" type.\n  if (!_.isArguments(arguments)) {\n    _.isArguments = function(obj) {\n      return !!(obj && _.has(obj, 'callee'));\n    };\n  }\n\n  // Optimize `isFunction` if appropriate.\n  if (typeof (/./) !== 'function') {\n    _.isFunction = function(obj) {\n      return typeof obj === 'function';\n    };\n  }\n\n  // Is a given object a finite number?\n  _.isFinite = function(obj) {\n    return isFinite(obj) && !isNaN(parseFloat(obj));\n  };\n\n  // Is the given value `NaN`? (NaN is the only number which does not equal itself).\n  _.isNaN = function(obj) {\n    return _.isNumber(obj) && obj != +obj;\n  };\n\n  // Is a given value a boolean?\n  _.isBoolean = function(obj) {\n    return obj === true || obj === false || toString.call(obj) == '[object Boolean]';\n  };\n\n  // Is a given value equal to null?\n  _.isNull = function(obj) {\n    return obj === null;\n  };\n\n  // Is a given variable undefined?\n  _.isUndefined = function(obj) {\n    return obj === void 0;\n  };\n\n  // Shortcut function for checking if an object has a given property directly\n  // on itself (in other words, not on a prototype).\n  _.has = function(obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  // Utility Functions\n  // -----------------\n\n  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its\n  // previous owner. Returns a reference to the Underscore object.\n  _.noConflict = function() {\n    root._ = previousUnderscore;\n    return this;\n  };\n\n  // Keep the identity function around for default iterators.\n  _.identity = function(value) {\n    return value;\n  };\n\n  _.constant = function(value) {\n    return function () {\n      return value;\n    };\n  };\n\n  _.property = function(key) {\n    return function(obj) {\n      return obj[key];\n    };\n  };\n\n  // Returns a predicate for checking whether an object has a given set of `key:value` pairs.\n  _.matches = function(attrs) {\n    return function(obj) {\n      if (obj === attrs) return true; //avoid comparing an object to itself.\n      for (var key in attrs) {\n        if (attrs[key] !== obj[key])\n          return false;\n      }\n      return true;\n    }\n  };\n\n  // Run a function **n** times.\n  _.times = function(n, iterator, context) {\n    var accum = Array(Math.max(0, n));\n    for (var i = 0; i < n; i++) accum[i] = iterator.call(context, i);\n    return accum;\n  };\n\n  // Return a random integer between min and max (inclusive).\n  _.random = function(min, max) {\n    if (max == null) {\n      max = min;\n      min = 0;\n    }\n    return min + Math.floor(Math.random() * (max - min + 1));\n  };\n\n  // A (possibly faster) way to get the current timestamp as an integer.\n  _.now = Date.now || function() { return new Date().getTime(); };\n\n  // List of HTML entities for escaping.\n  var entityMap = {\n    escape: {\n      '&': '&amp;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '\"': '&quot;',\n      \"'\": '&#x27;'\n    }\n  };\n  entityMap.unescape = _.invert(entityMap.escape);\n\n  // Regexes containing the keys and values listed immediately above.\n  var entityRegexes = {\n    escape:   new RegExp('[' + _.keys(entityMap.escape).join('') + ']', 'g'),\n    unescape: new RegExp('(' + _.keys(entityMap.unescape).join('|') + ')', 'g')\n  };\n\n  // Functions for escaping and unescaping strings to/from HTML interpolation.\n  _.each(['escape', 'unescape'], function(method) {\n    _[method] = function(string) {\n      if (string == null) return '';\n      return ('' + string).replace(entityRegexes[method], function(match) {\n        return entityMap[method][match];\n      });\n    };\n  });\n\n  // If the value of the named `property` is a function then invoke it with the\n  // `object` as context; otherwise, return it.\n  _.result = function(object, property) {\n    if (object == null) return void 0;\n    var value = object[property];\n    return _.isFunction(value) ? value.call(object) : value;\n  };\n\n  // Add your own custom functions to the Underscore object.\n  _.mixin = function(obj) {\n    each(_.functions(obj), function(name) {\n      var func = _[name] = obj[name];\n      _.prototype[name] = function() {\n        var args = [this._wrapped];\n        push.apply(args, arguments);\n        return result.call(this, func.apply(_, args));\n      };\n    });\n  };\n\n  // Generate a unique integer id (unique within the entire client session).\n  // Useful for temporary DOM ids.\n  var idCounter = 0;\n  _.uniqueId = function(prefix) {\n    var id = ++idCounter + '';\n    return prefix ? prefix + id : id;\n  };\n\n  // By default, Underscore uses ERB-style template delimiters, change the\n  // following template settings to use alternative delimiters.\n  _.templateSettings = {\n    evaluate    : /<%([\\s\\S]+?)%>/g,\n    interpolate : /<%=([\\s\\S]+?)%>/g,\n    escape      : /<%-([\\s\\S]+?)%>/g\n  };\n\n  // When customizing `templateSettings`, if you don't want to define an\n  // interpolation, evaluation or escaping regex, we need one that is\n  // guaranteed not to match.\n  var noMatch = /(.)^/;\n\n  // Certain characters need to be escaped so that they can be put into a\n  // string literal.\n  var escapes = {\n    \"'\":      \"'\",\n    '\\\\':     '\\\\',\n    '\\r':     'r',\n    '\\n':     'n',\n    '\\t':     't',\n    '\\u2028': 'u2028',\n    '\\u2029': 'u2029'\n  };\n\n  var escaper = /\\\\|'|\\r|\\n|\\t|\\u2028|\\u2029/g;\n\n  // JavaScript micro-templating, similar to John Resig's implementation.\n  // Underscore templating handles arbitrary delimiters, preserves whitespace,\n  // and correctly escapes quotes within interpolated code.\n  _.template = function(text, data, settings) {\n    var render;\n    settings = _.defaults({}, settings, _.templateSettings);\n\n    // Combine delimiters into one regular expression via alternation.\n    var matcher = new RegExp([\n      (settings.escape || noMatch).source,\n      (settings.interpolate || noMatch).source,\n      (settings.evaluate || noMatch).source\n    ].join('|') + '|$', 'g');\n\n    // Compile the template source, escaping string literals appropriately.\n    var index = 0;\n    var source = \"__p+='\";\n    text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {\n      source += text.slice(index, offset)\n        .replace(escaper, function(match) { return '\\\\' + escapes[match]; });\n\n      if (escape) {\n        source += \"'+\\n((__t=(\" + escape + \"))==null?'':_.escape(__t))+\\n'\";\n      }\n      if (interpolate) {\n        source += \"'+\\n((__t=(\" + interpolate + \"))==null?'':__t)+\\n'\";\n      }\n      if (evaluate) {\n        source += \"';\\n\" + evaluate + \"\\n__p+='\";\n      }\n      index = offset + match.length;\n      return match;\n    });\n    source += \"';\\n\";\n\n    // If a variable is not specified, place data values in local scope.\n    if (!settings.variable) source = 'with(obj||{}){\\n' + source + '}\\n';\n\n    source = \"var __t,__p='',__j=Array.prototype.join,\" +\n      \"print=function(){__p+=__j.call(arguments,'');};\\n\" +\n      source + \"return __p;\\n\";\n\n    try {\n      render = new Function(settings.variable || 'obj', '_', source);\n    } catch (e) {\n      e.source = source;\n      throw e;\n    }\n\n    if (data) return render(data, _);\n    var template = function(data) {\n      return render.call(this, data, _);\n    };\n\n    // Provide the compiled function source as a convenience for precompilation.\n    template.source = 'function(' + (settings.variable || 'obj') + '){\\n' + source + '}';\n\n    return template;\n  };\n\n  // Add a \"chain\" function, which will delegate to the wrapper.\n  _.chain = function(obj) {\n    return _(obj).chain();\n  };\n\n  // OOP\n  // ---------------\n  // If Underscore is called as a function, it returns a wrapped object that\n  // can be used OO-style. This wrapper holds altered versions of all the\n  // underscore functions. Wrapped objects may be chained.\n\n  // Helper function to continue chaining intermediate results.\n  var result = function(obj) {\n    return this._chain ? _(obj).chain() : obj;\n  };\n\n  // Add all of the Underscore functions to the wrapper object.\n  _.mixin(_);\n\n  // Add all mutator Array functions to the wrapper.\n  each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      var obj = this._wrapped;\n      method.apply(obj, arguments);\n      if ((name == 'shift' || name == 'splice') && obj.length === 0) delete obj[0];\n      return result.call(this, obj);\n    };\n  });\n\n  // Add all accessor Array functions to the wrapper.\n  each(['concat', 'join', 'slice'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      return result.call(this, method.apply(this._wrapped, arguments));\n    };\n  });\n\n  _.extend(_.prototype, {\n\n    // Start chaining a wrapped Underscore object.\n    chain: function() {\n      this._chain = true;\n      return this;\n    },\n\n    // Extracts the result from a wrapped and chained object.\n    value: function() {\n      return this._wrapped;\n    }\n\n  });\n\n  // AMD registration happens at the end for compatibility with AMD loaders\n  // that may not enforce next-turn semantics on modules. Even though general\n  // practice for AMD registration is to be anonymous, underscore registers\n  // as a named module because, like jQuery, it is a base library that is\n  // popular enough to be bundled in a third party lib, but not be part of\n  // an AMD load request. Those cases could generate an error when an\n  // anonymous define() is called outside of a loader request.\n  if (typeof define === 'function' && define.amd) {\n    define('underscore', [], function() {\n      return _;\n    });\n  }\n}).call(this);\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/FontBuffer.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/FontBuffer.js","friendlyPath":".FontBuffer","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"FontBuffer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package env.browser.FontBuffer;\n *\n * ??? What the hell is this\n */\n\njsio('import device');\n\nvar randomColorElement = function () {\n\tvar e = Math.floor(Math.random() * 255).toString(16);\n\treturn ((e.length === 1) ? '0' : '') + e;\n};\n\nvar randomColor = function () {\n\treturn '#' + randomColorElement() + randomColorElement() + randomColorElement();\n};\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_FontBuffer=__class__;var FontBuffer = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_FontBuffer(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_FontBuffer(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (opts) {\n\t\t// 8 * 24\n\t\t// 10 * 32\n\t\t// 8 * 64\n\t\tvar lineSizes = [{size: 24, count: 8}, {size: 32, count: 10}, {size: 64, count: 8}],\n\t\t\tlineSize,\n\t\t\tlines,\n\t\t\titem,\n\t\t\ty = 0,\n\t\t\ti, j;\n\n\t\tthis._canvas = document.createElement('canvas');\n\t\tthis._canvas.width = 1024;\n\t\tthis._canvas.height = 1024;\n\t\tthis._ctx = this._canvas.getContext('2d');\n\n\t\tthis._list = [];\n\t\tfor (i = 0; i < lineSizes.length; i++) {\n\t\t\tlines = [];\n\t\t\tlineSize = lineSizes[i];\n\n\t\t\tfor (j = 0; j < lineSize.count; j++) {\n\t\t\t\titem = {\n\t\t\t\t\tprevious: null,\n\t\t\t\t\tnext: null,\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: y,\n\t\t\t\t\twidth: 1024,\n\t\t\t\t\theight: 0,\n\t\t\t\t\thash: null,\n\t\t\t\t\tframe: 0,\n\t\t\t\t\trefresh: true,\n\t\t\t\t\tctx: this._ctx\n\t\t\t\t};\n\t\t\t\tlines.push(item);\n\t\t\t\ty += lineSize.size;\n\t\t\t}\n\n\t\t\tthis._list.push({\n\t\t\t\tsize: lineSize.size,\n\t\t\t\tlines: lines\n\t\t\t});\n\t\t}\n\n\t\tthis._hashMap = {};\n\n\t\tthis._currentFrame = 0;\n\t\tthis._frameTimeout = 3;\n\n\t\tjsio('import ui.Engine').get().subscribe('Tick', this, this._onTick);\n\t};\n\n\tthis._onTick = function (dt) {\n\t\tthis._currentFrame++;\n\n\t\tvar remove,\n\t\t\tcurrentFrame = this._currentFrame,\n\t\t\tframeTimeout = this._frameTimeout,\n\t\t\tlist = this._list,\n\t\t\tlines,\n\t\t\titem,\n\t\t\ti, j, k, l;\n\n\t\tfor (i = 0, j = list.length; i < j; i++) {\n\t\t\tlines = list[i].lines;\n\t\t\tfor (k = 0, l = lines.length; k < l; k++) {\n\t\t\t\titem = lines[k];\n\t\t\t\twhile (item) {\n\t\t\t\t\tif (item.hash === null) {\n\t\t\t\t\t\tif (item.next && (item.next.hash === null)) {\n\t\t\t\t\t\t\titem.width += item.next.width;\n\t\t\t\t\t\t\titem.next = item.next.next;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (currentFrame > item.frame + frameTimeout) {\n\t\t\t\t\t\tthis._ctx.fillStyle = randomColor();\n\t\t\t\t\t\tthis._ctx.fillRect(item.x, item.y, item.width, item.height);\n\t\t\t\t\t\t// Remove old item...\n\t\t\t\t\t\tdelete(this._hashMap[item.hash]);\n\t\t\t\t\t\titem.hash = null;\n\t\t\t\t\t}\n\t\t\t\t\titem = item.next;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.alloc = function (opts) {\n\t\tvar requestHeight = opts.height,\n\t\t\trequestWidth = opts.width + 3, // Add some extra pixels to allow color bleeding...\n\n\t\t\tstrokeStyle = opts.strokeStyle || '',\n\t\t\tfillStyle = opts.fillStyle || '',\n\t\t\tfont = opts.font || '',\n\t\t\thash = strokeStyle + '_' + fillStyle + '_' + font + '_' + opts.text,\n\n\t\t\tlist = this._list,\n\t\t\tlines,\n\t\t\titem = this._hashMap[hash],\n\t\t\ti, j, k, l;\n\n\t\tif (item) {\n\t\t\titem.frame = this._currentFrame;\n\t\t\titem.refresh = false;\n\t\t\treturn item;\n\t\t}\n\n\t\tfor (i = 0, j = list.length; i < j; i++) {\n\t\t\tif (requestHeight <= list[i].size) {\n\t\t\t\tlines = list[i].lines;\n\t\t\t\tfor (k = 0, l = lines.length; k < l; k++) {\n\t\t\t\t\titem = lines[k];\n\t\t\t\t\twhile (item) {\n\t\t\t\t\t\tif ((requestWidth <= item.width) && (item.hash === null)) {\n\t\t\t\t\t\t\tif (requestWidth !== item.width) {\n\t\t\t\t\t\t\t\t//console.log('request:', requestWidth, 'width:', item.width, 'rest:', item.width - requestWidth);\n\t\t\t\t\t\t\t\titem.next = {\n\t\t\t\t\t\t\t\t\tprevious: item,\n\t\t\t\t\t\t\t\t\tnext: item.next,\n\t\t\t\t\t\t\t\t\tx: item.x + requestWidth,\n\t\t\t\t\t\t\t\t\ty: item.y,\n\t\t\t\t\t\t\t\t\twidth: item.width - requestWidth,\n\t\t\t\t\t\t\t\t\thash: null,\n\t\t\t\t\t\t\t\t\tframe: 0,\n\t\t\t\t\t\t\t\t\tctx: this._ctx\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\titem.frame = this._currentFrame;\n\t\t\t\t\t\t\titem.hash = hash;\n\t\t\t\t\t\t\titem.width = requestWidth;\n\t\t\t\t\t\t\titem.height = requestHeight;\n\t\t\t\t\t\t\titem.refresh = true;\n\n\t\t\t\t\t\t\tthis._ctx.clearRect(item.x, item.y, requestWidth, requestHeight);\n\n\t\t\t\t\t\t\tthis._hashMap[hash] = item;\n\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t}\n\t\t\t\t\t\titem = item.next;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tthis.getCanvas = function () {\n\t\treturn this._canvas;\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/initialize.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/initialize.js","friendlyPath":"platforms.browser.initialize","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"initialize.js","baseMod":"platforms","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/modules/timestep/src/platforms","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\njsio('from util.browser import $');\n\ndevice.registerDevice('browser', 'platforms.browser');\nexports.init = function () {\n\n\tvar onResize;\n\n\tif (device.isMobileBrowser) {\n\t\tdevice.setUseDOM(true);\n\n\t\tvar screen = device.screen;\n\t\tif (device.isIOS || device.isAndroid) {\n\t\t\t\n\t\t\tvar _isFocused = false;\n\t\t\twindow.addEventListener('focus', function (e) {\n\t\t\t\tvar tag = e.target.tagName;\n\t\t\t\tif (tag == 'TEXTAREA' || tag == 'INPUT') {\n\t\t\t\t\t_isFocused = true;\n\t\t\t\t}\n\t\t\t}, true);\n\t\t\t\n\t\t\tdocument.addEventListener('blur', function (e) {\n\t\t\t\tif (_isFocused) {\n\t\t\t\t\t_isFocused = false;\n\t\t\t\t}\n\t\t\t}, true);\n\t\t\t\n\t\t\tdevice.hideAddressBar = function () {\n\t\t\t\tif (_isFocused || !device.isMobileBrowser || !(device.isIOS || device.isAndroid)) { return; }\n\t\t\t\tif (device.isIOS) {\n\t\t\t\t\twindow.scrollTo(0, 1);\n\t\t\t\t\twindow.scrollTo(0, 0);\n\t\t\t\t} else {\n\t\t\t\t\twindow.scrollTo(0, -1);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (!CONFIG.unlockViewport) {\n\t\t\t\twindow.addEventListener('touchstart', bind(device, 'hideAddressBar'), true);\n\t\t\t}\n\t\t}\n\t\t\n\t\tvar lastWidth, lastHeight, lastOrientation;\n\t\tonResize = function () {\n\t\t\tif (device.isIOS) {\n\t\t\t\tdevice.hideAddressBar();\n\t\t\t}\n\t\t\t\n\t\t\tvar w = window.outerWidth;\n\t\t\tvar h = window.outerHeight;\n\t\t\tvar o = window.orientation;\n\t\t\tif (lastWidth == w && lastHeight == h && lastOrientation == o) { return; }\n\t\t\t\n\t\t\tlastWidth = w;\n\t\t\tlastHeight = h;\n\t\t\tlastOrientation = o;\n\t\t\t\n\t\t\tvar isPortrait = screen.isPortrait = (h > w);\n\t\t\tvar isLandscape = screen.isLandscape = !screen.isPortrait;\n\t\t\t\n\t\t\tvar totalW = (isPortrait ? screen.width : screen.height);\n\t\t\tvar totalH = (isPortrait ? screen.height : screen.width);\n\n\t\t\t// in iOS 7 landscape, use full-screen dimensions?\n\t\t\t// TODO: this is actually a bad idea because any tap on the screen\n\t\t\t// will bring up the bottom bar\n\t\t\tif (device.iosVersion >= 7 && (o == 90 || o == -90)) {\n\t\t\t\t// screen width/height is not always rotated, so swap for landscape\n\t\t\t\tw = screen.width;\n\t\t\t\th = screen.height;\n\t\t\t\tif (w < h) {\n\t\t\t\t\tw = h;\n\t\t\t\t\th = screen.width;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// otherwise use available width/height\n\t\t\t\tw = window.innerWidth;\n\t\t\t\th = window.innerHeight;\n\t\t\t}\n\n\t\t\tif (device.width != w || device.height != h || device.orientation != o) {\n\t\t\t\tdevice.width = w;\n\t\t\t\tdevice.height = h;\n\t\t\t\tdevice.orientation = o;\n\t\t\t\tdevice.screen.publish('Resize', device.width, device.height, device.orientation);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tonResize = function () {\n\t\t\tvar doc = window.document,\n\t\t\t\twidth = window.innerWidth || (doc.clientWidth || doc.clientWidth),\n\t\t\t\theight = window.innerHeight || (doc.clientHeight || doc.clientHeight);\n\t\t\t\n\t\t\tif (width != device.width || height != device.height) {\n\t\t\t\tdevice.width = width;\n\t\t\t\tdevice.height = height;\n\t\t\t\tdevice.screen.width = width;\n\t\t\t\tdevice.screen.height = height;\n\n\t\t\t\tif (width > height) {\n\t\t\t\t\tdevice.screen.isPortrait = false;\n\t\t\t\t\tdevice.screen.isLandscape = true;\n\t\t\t\t\tdevice.screen.orientation = 'landscape';\n\t\t\t\t} else {\n\t\t\t\t\tdevice.screen.isPortrait = true;\n\t\t\t\t\tdevice.screen.isLandscape = false;\n\t\t\t\t\tdevice.screen.orientation = 'portrait';\n\t\t\t\t}\n\n\t\t\t\tdevice.screen.publish('Resize', width, height);\n\t\t\t}\n\t\t}\n\t}\n\n\t$.onEvent(window, 'resize', onResize, false);\n\t$.onEvent(window, 'orientationchange', onResize, false);\n\n\tonResize();\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/Input.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/Input.js","friendlyPath":".Input","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"Input.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package timestep.env.browser.Input;\n *\n * This is imported as timestep.input.InputListener. This binds touch or mouse\n * events on the document (depending on what's specified in device).\n * Additionally, if a canvas option is passed in or setElement(el) is called,\n * mouse over/out and start events are attached to the element. Used on the\n * canvas as well as DOM bindings.\n */\n\njsio('import device');\njsio('from util.browser import $');\n\njsio('import event.input.dispatch as input');\nvar eventTypes = input.eventTypes;\n\n// import ...FPSCounter;\n\nvar UID = -1;\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_Input=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_Input(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_Input(){return this.init&&this.init.apply(this,arguments)},function () {\n\n  this.init = function (opts) {\n\n    if (device.simulatingMobileNative || device.simulatingMobileBrowser) { this._simulateMobile = true; }\n\n    this._evtQueue = [];\n    this._rootView = opts.rootView;\n\n    if (opts.el) {\n      if (device.isMobileBrowser) {\n        this._toggleNode = $({parent:document.body});\n      }\n      this.setElement(opts.el);\n    }\n\n    // Mouseover/out events do not fire for mobile browsers\n    // that are driven solely by touch events, so in mobile\n    // browsers, assume the canvas should always handle events.\n    // Otherwise, only handle events if the mouse is over the\n    // canvas.\n    this._isOver = false;\n\n    // disable the key listener on focus of input elements\n    this._keyListener = opts.keyListener;\n\n    if (device.useDOM) {\n      $.onEvent(document, device.events.start, this, 'handleMouse', eventTypes.START);\n    }\n\n    this.enable();\n\n    // this._evtFps = new FPSCounter({name: \"mouse events\"});\n\n    this._hasFocus = false;\n    if (document.addEventListener) {\n      document.addEventListener('focus', bind(this, 'onFocusCapture'), true);\n      document.addEventListener('blur', bind(this, 'onBlurCapture'), true);\n    }\n  };\n\n  this.enable = function () {\n    if (this._isEnabled) { return; }\n    this._isEnabled = true;\n\n    this._handleMove = $.onEvent(document, device.events.move, this, 'handleMouse', eventTypes.MOVE);\n    this._handleSelect = $.onEvent(document, device.events.end, this, 'handleMouse', eventTypes.SELECT);\n    this._handleScroll = $.onEvent(window, 'DOMMouseScroll', this, 'handleMouse', eventTypes.SCROLL); // FF\n    this._handleWheel = $.onEvent(window, 'mousewheel', this, 'handleMouse', eventTypes.SCROLL); // webkit\n\n    this._addElEvents();\n  };\n\n  this.disable = function () {\n    if (!this._isEnabled) { return; }\n    this._isEnabled = false;\n\n    if (this._handleMove) {\n      this._handleMove();\n      this._handleMove = false;\n    }\n    if (this._handleSelect) {\n      this._handleSelect();\n      this._handleSelect = false;\n    }\n    if (this._handleScroll) {\n      this._handleScroll();\n      this._handleScroll = false;\n    }\n    if (this._handleWheel) {\n      this._handleWheel();\n      this._handleWheel = false;\n    }\n\n    this._removeElEvents();\n  };\n\n  this.onFocusCapture = function (e) {\n    var tag = e.target.tagName;\n    if (tag == 'TEXTAREA' || tag == 'INPUT') {\n      this._hasFocus = e.target;\n      this._keyListener && this._keyListener.setEnabled(false);\n    }\n  };\n\n  this.onBlurCapture = function (e) {\n    if (this._hasFocus) {\n      this._hasFocus = null;\n      this._keyListener && this._keyListener.setEnabled(true);\n    }\n  };\n\n  this._removeElEvents = function () {\n    if (this._elEvents) {\n      for(var i = 0, detach; detach = this._elEvents[i]; ++i) {\n        detach();\n      }\n    }\n  };\n\n  this._addElEvents = function () {\n\n    this._removeElEvents();\n\n    var el = this._el;\n    el.ondragstart = function () { return false; };\n    el.onselectstart = function () { return false; };\n\n    this._elEvents = [];\n\n    if (!device.useDOM) {\n      this._elEvents.push($.onEvent(el, device.events.start, this, 'handleMouse', eventTypes.START));\n    }\n\n    if (!device.isMobileBrowser && !device.isNative) {\n      this._elEvents.push($.onEvent(el, 'mouseover', this, 'onMouseOver'));\n      this._elEvents.push($.onEvent(el, 'mouseout', this, 'onMouseOut'));\n    }\n  };\n\n  this.setElement = function (el) {\n    this._removeElEvents();\n    this._el = el;\n    this._addElEvents();\n  };\n\n  this.onMouseOver = function () { this._isOver = true; };\n  this.onMouseOut = function () { this._isOver = false; };\n  this.onMouseDown = function () { this._isMouseDown = true; };\n  this.onMouseUp = function () { this._isMouseUp = true; };\n\n  // for native-compatibility, always returns an empty array in the browser\n  this.getEvents = function () { return this._evtQueue; };\n\n  this.allowScrollEvents = function (allowScrollEvents) { this._allowScrollEvents = allowScrollEvents; };\n\n  this.handleMouse = function (type, evt, recursive) {\n    var target = evt.target;\n    if (!device.useDOM && !this._isDown && this._el && evt.target != this._el) { return; }\n\n    var isMobileBrowser = device.isMobileBrowser;\n\n    // Cancel all events that occur on the canvas.  Optionally, pass scroll events\n    // through to the page (apps that don't care about handling scroll events may\n    // want to pass them through for easier browser debugging).\n    if (isMobileBrowser) {\n      $.stopEvent(evt);\n      evt.returnValue = false;\n    } else if (this._isOver && (!this._allowScrollEvents || type != eventTypes.SCROLL)) {\n      if (evt.stopPropagation) { evt.stopPropagation(); }\n      if (type != eventTypes.START) {\n        $.stopEvent(evt);\n        evt.returnValue = false;\n      }\n    }\n\n    // On ios devices, this event could correspond to multiple touches.  We recall\n    // ourselves with each changed touch independently.\n    if (evt.touches) {\n      for (var i = 0, t; t = evt.changedTouches[i]; ++i) {\n        this.handleMouse(type, t, true);\n      }\n      return;\n    }\n\n    var x, y;\n    // Figure out where in the canvas the event fired.\n    // if (isMobileBrowser) {\n    //  pt = {\n    //    x: evt.pageX,\n    //    y: evt.pageY\n    //  };\n    // } else\n    if ('offsetX' in evt && !device.useDOM) {\n      // Chrome makes life easy.  offsetX/offsetY is w.r.t. the target, which\n      // for us should be the canvas.\n      x = evt.offsetX;\n      y = evt.offsetY;\n    } else if (this._el.getBoundingClientRect) {\n      // It's not too hard in other browsers that support getBoundingClientRect.\n      // Get the absolute position of the canvas and do the math.\n      var rect = this._el.getBoundingClientRect();\n      x = evt.pageX - rect.left;\n      y = evt.pageY - rect.top;\n    } else {\n      // Without boundingClientRect, life is hard.  This is the general\n      // idea, but we need to loop for offsetParent/scrollLeft/scrollTop\n      // to be at least partially complete.  Other libraries handle this\n      // better, but the code complexity for that is huge.\n      //\n      // TODO: older browsers will fail cause this code is buggy and untested?\n      var offsetX, offsetY, parent = this._el;\n      while (parent) {\n        offsetX += parent.offsetTop;\n        offsetY += parent.offsetLeft;\n        parent = parent.parentNode;\n      }\n\n      x = evt.pageX - offsetX;\n      y = evt.pageY - offsetY;\n    }\n\n    var id = evt.identifier || UID;\n\n    if (this._simulateMobile) {\n      switch (type) {\n        case eventTypes.START:\n          this._moveOK = true;\n          break;\n        case eventTypes.MOVE:\n          if (!this._moveOK) { return; }\n          break;\n        case eventTypes.SELECT:\n          this._moveOK = false;\n          break;\n      }\n    }\n\n    if (type == eventTypes.START) {\n      this._isDown = true;\n    } else if (type == eventTypes.SELECT) {\n      this._isDown = false;\n\n      if (this._toggleNode) {\n        document.body.removeChild(this._toggleNode);\n        document.body.appendChild(this._toggleNode);\n      }\n    }\n\n    var inputEvent = new input.InputEvent(id, type, x, y);\n    if (device.useDOM) {\n      while (target && !target._view) {\n        target = target.parentNode;\n      }\n      if (!target) { return; }\n      inputEvent.target = target._view;\n    }\n\n    if (type == eventTypes.SCROLL) {\n      // try to normalize scroll events! :-(\n\n      // some browsers send both horizontal and vertical offsets in one event! nice!\n      // other browsers don't. This is awful, since this is the least common denominator!\n      // so we have to send two events even if the browser only sends one.\n      if ('wheelDeltaX' in evt) {\n        // default to Y\n        inputEvent.scrollDelta = evt.wheelDeltaY / 120;\n        inputEvent.scrollAxis = input.VERTICAL_AXIS;\n\n        // if we also have X, then send it as a separate event\n        if (evt.wheelDeltaX && evt.wheelDeltaY) {\n          var e = inputEvent.clone();\n          e.scrollDelta = evt.wheelDeltaX / 120;\n          e.scrollAxis = input.HORIZONTAL_AXIS;\n\n          input.dispatchEvent(this._rootView, e);\n        } else if (evt.wheelDeltaX) {\n          // we only have one of (X, Y) and it's X, so use X\n          inputEvent.scrollDelta = evt.wheelDeltaX / 120;\n          inputEvent.scrollAxis = input.HORIZONTAL_AXIS;\n        }\n\n      } else if (evt.detail) {\n        inputEvent.scrollDelta = -evt.detail;\n        inputEvent.scrollAxis = 'axis' in evt ? evt.axis == evt.VERTICAL_AXIS ? input.VERTICAL_AXIS : input.HORIZONTAL_AXIS : input.VERTICAL_AXIS;\n      } else if (evt.wheelDelta) { // IE/Opera\n        inputEvent.scrollDelta = (window.opera ? 1 : -1) * evt.wheelDelta / 120;\n        inputEvent.scrollAxis = input.VERTICAL_AXIS;\n      }\n    }\n\n    input.dispatchEvent(this._rootView, inputEvent);\n  };\n\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/inputDialog.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/inputDialog.js","friendlyPath":".inputDialog","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"inputDialog.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package timestep.env.browser.InputPrompt;\n *\n * Prompt the user manually for input.\n */\n\njsio('import device');\njsio('from util.browser import $');\njsio('import ...ui.keyboardTypes as keyboardTypes');\njsio('import .dom');\n\nexports.show = function (controller, opts) {\n  new InputDialog(controller, opts);\n};\n\nvar css = {\n  classes: {\n    base: 'timestep-native-dialog',\n    dialog: 'dialog',\n    title: 'title',\n    hasMessage: 'has-message',\n    message: 'message',\n    buttons: 'buttons',\n    input: 'input'\n  },\n  getStylesheet: function () {\n    var prefix = dom.getCSSPrefix();\n    return new dom.Stylesheet('.' + this.classes.base)\n      .add('', 'position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; z-index: 9999999; background: rgba(0, 0, 0, 0.5);')\n      .add('*', prefix + 'box-sizing: border-box; font: 12px Helvetica')\n      .add('.' + this.classes.dialog, 'position: absolute; color: #444; background: rgba(255, 255, 255, 0.93); border-radius: 5px; text-align: left; ' + prefix + 'box-shadow: 0px 3px 40px rgba(0, 0, 0, 0.2)')\n      .add('.' + this.classes.hasMessage, 'margin-bottom: 16px')\n      .add('.' + this.classes.title, 'padding: 16px; font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap')\n      .add('.' + this.classes.message, 'padding: 0px 16px; color: #888')\n      .add('.' + this.classes.buttons, 'margin: 16px 0px 0px 0px; height: 34px; border-top: 1px solid #CCC')\n      .add('.' + this.classes.input, 'padding: 0px 8px')\n      .add('button', 'position: relative; border: 0px; margin: 0px; width: 50%; height: 100%; cursor: pointer; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; font-weight: bold; background: transparent; outline: none')\n      .add('button:active', 'background: #FFF')\n      .add('button:first-child', 'border-bottom-left-radius: 5px')\n      .add('button:last-child', 'border-bottom-right-radius: 5px')\n      .add('button:only-child', 'width: 100%; border-bottom-right-radius: 5px')\n      .add('button:nth-child(2):before', 'content:\"\"; position: absolute; left: 0px; top: 0px; width: 1px; height: 100%; border-left: 1px solid #CCC')\n      .add('input', 'margin: 0px; border: 1px solid #ccc; padding: 4px 8px; text-align: left; width: 100%');\n  },\n  sizeAndPositionDialog: function (dialog, contents) {\n    var scale = device.devicePixelRatio;\n    var windowSize = $.size(window);\n    contents.style.overflow = 'auto';\n    contents.style.maxHeight = Math.min(200 * scale, Math.floor(windowSize.height / 3)) + 'px';\n    dialog.style.maxWidth = Math.min(300 * scale, Math.floor(windowSize.width - 40)) + 'px';\n    dialog.style.left = Math.max(0, (windowSize.width - dialog.offsetWidth) / 2) + 'px';\n    dialog.style.top = Math.max(0, (windowSize.height - dialog.offsetHeight) / 2) + 'px';\n  }\n};\n\nvar dialogStylesheet;\n\nInputDialog=__class__;var InputDialog=InputDialog(function InputDialog(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function (controller, opts) {\n\n    var addClasses = opts.defaultBrowserStyles;\n    if (!dialogStylesheet && addClasses) {\n      dialogStylesheet = css.getStylesheet()\n        .scale(device.devicePixelRatio)\n        .insert();\n    }\n\n    // at least one button must be visible\n    if (!opts.okText && !opts.cancelText) {\n      opts.okText = 'ok';\n    }\n\n    // create buttons\n    this._buttons = [];\n\n    if (opts.cancelText) {\n      this._createButton(opts.cancelText, opts.onCancel);\n    }\n\n    if (opts.okText) {\n      this._createButton(opts.okText, opts.onSubmit);\n    }\n\n    if (opts.isPassword) { opts.keyboardType = 'password'; }\n    this._createInputField(opts.value, opts.keyboardType, opts.onChange);\n\n    // create dialog\n    var body = $({\n        className: opts.message && addClasses && css.classes.hasMessage,\n        children: [\n          {\n            className: addClasses && css.classes.title,\n            text: opts.title\n          }, {\n            className: opts.message && addClasses && css.classes.message,\n            text: opts.message\n          }\n        ]\n      });\n\n    var dialog = $({\n        className: addClasses && css.classes.dialog,\n        children: [body, {\n          className: addClasses && css.classes.input,\n          children: [this._input]\n        }, {\n          className: addClasses && css.classes.buttons,\n          children: this._buttons\n        }]\n      });\n\n    this._el = $({\n        parent: document.body,\n        className: addClasses && css.classes.base,\n        children: [dialog]\n      });\n\n    $.onEvent(this._el, device.events.move, function (e) {\n      var target = e.target;\n      while (target && target != document.body)  {\n        if (target == dialog) { return; }\n        target = target.parentNode;\n      }\n\n      e.preventDefault();\n    });\n\n    if (addClasses) {\n      css.sizeAndPositionDialog(dialog, body);\n    }\n\n    if (opts.autoFocus) {\n      this._input.focus();\n    }\n\n    if (opts.onShow) {\n      opts.onShow(dialog);\n    }\n  };\n\n  this.close = function () {\n    $.remove(this._el);\n  };\n\n  this._createButton = function (text, cb) {\n    var btn = $({\n          tag: 'button',\n          text: text,\n          attrs: {noCapture: true}\n        });\n\n    $.onEvent(btn, device.events.end, function () {\n      this.close();\n      if (cb) {\n        cb && cb(this.getValue());\n      }\n    }.bind(this));\n\n    this._buttons.push(btn);\n  };\n\n  this._createInputField = function (value, type, cb) {\n    var input = $({\n        tag: 'input',\n        value: value,\n        attrs: {\n          noCapture: true,\n          type: keyboardTypes.getHTMLType(type)\n        }\n      });\n\n    if (cb) {\n      if (value === undefined) { value = ''; }\n\n      var listener = function (evt) {\n        var _value = this.getValue();\n        if (value !== _value) {\n          value = _value;\n\n          cb(_value, evt);\n        }\n      }.bind(this);\n\n      $.onEvent(input, 'keyup', listener);\n      $.onEvent(input, 'change', listener);\n    }\n\n    this._input = input;\n  };\n\n  this.getValue = function () {\n    return this._input && this._input.value;\n  };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/keyboardTypes.js":{"path":"modules/devkit-core/modules/timestep/src/ui/keyboardTypes.js","friendlyPath":"...ui.keyboardTypes","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"keyboardTypes.js","src":"jsio('import device');\n\n// map input types to native constants\nexports.nativeTypes = {\n    // legacy native names\n    Default: 0,                // Default type for the current input method.\n    NumbersAndPunctuation: 2,  // Numbers and assorted punctuation.\n    URL: 3,                    // A type optimized for URL entry (shows . / .com prominently).\n    NumberPad: 4,              // A number pad (0-9). Suitable for PIN entry.\n    PhonePad: 5,               // A phone pad (1-9, *, 0, #, with letters under the numbers).\n    EmailAddress: 7,           // A type optimized for multiple email address entry (shows space @ . prominently).\n    DecimalPad: 8,\n\n    // html5 names\n    url: 3,\n    number: device.isIOS ? 2 : 4, // ios/android mobile are different\n    tel: 5,\n    email: 7,\n  };\n\n// map input types to html5 type names\nexports.htmlTypes = {\n    // legacy native mapping\n    Default: 'text',\n    NumbersAndPunctuation: 'number', // note: android won't show punctuation\n    URL: 'url',\n    NumberPad: 'number',\n    PhonePad: 'tel',\n    EmailAddress: 'email',\n    DecimalPad: 'number',\n\n    // html5 types supported on both native/browser\n    number: 'number',\n    url: 'url',\n    tel: 'tel',\n    email: 'email',\n\n    // html5 types only supported in the browser\n    // TODO: add to native\n    date: 'date',\n    time: 'time',\n    datetime: 'datetime',\n    month: 'month'\n  };\n\nexports.types = {};\n\nfor (var type in exports.nativeTypes) {\n  exports.types[type.toLowerCase()] = exports.nativeTypes[type];\n}\n\nfor (var type in exports.htmlTypes) {\n  exports.htmlTypes[type.toLowerCase()] = exports.htmlTypes[type];\n}\n\nexports.has = function (type) {\n  return type.toLowerCase() in exports.types;\n};\n\nexports.getNativeType = function (type) {\n  return exports.types[type.toLowerCase()] || 0;\n};\n\nexports.getHTMLType = function (type) {\n  return exports.htmlTypes[type.toLowerCase()] || type;\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/dom.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/dom.js","friendlyPath":".dom","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"dom.js","src":"jsio('from util.browser import $');\n\nvar _cssPrefix;\nexports.getCSSPrefix = function () {\n  if (_cssPrefix === undefined) {\n    var styles = window.getComputedStyle(document.documentElement, '');\n    if (styles.OLink === '') {\n      _cssPrefix = '-o-';\n    } else {\n      var match = Array.prototype.join.call(styles, '')\n          .match(/-(moz|webkit|ms)-/);\n\n      if (match) {\n        _cssPrefix = '-' + match[1] + '-';\n      } else {\n        _cssPrefix = '';\n      }\n    }\n  }\n\n  return _cssPrefix;\n};\n\nexports.Stylesheet=__class__;exports.Stylesheet=exports.Stylesheet(function exports_Stylesheet(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function (base) {\n    this._base = base ? base + ' ' : '';\n    this._rules = [];\n  };\n\n  this.add = function (selector, value) {\n    this._rules.push({\n      selector: selector,\n      value: value\n    });\n    return this;\n  };\n\n  this.scale = function (scale) {\n    this._rules.forEach(function (rule) {\n      rule.value = rule.value.replace(/([^;:]+:)(.*?)(;|$)/g, function (match, property, value, postfix) {\n        // skip border, but not border*radius\n        if (/border(?!.*?radius)/.test(property)) { return match; }\n        return property + value.replace(/\\d\\S*px/g, function (match) {\n          var value = parseFloat(match);\n          if (isNaN(value)) { return match; }\n          return parseFloat(value) * scale + 'px';\n        }) + postfix;\n      });\n    });\n\n    if (this._el) {\n      this.insert();\n    }\n\n    return this;\n  };\n\n  this.getValue = function () {\n    return this._rules.map(function (rule) {\n        return this._base + rule.selector + '{' + rule.value + '}';\n      }, this)\n      .join('');\n  };\n\n  this.insert = function () {\n    if (!this._el) {\n      this._el = $({\n        parent: document.getElementsByTagName('head')[0],\n        tag: 'style'\n      });\n    }\n    \n    $.setText(this._el, this.getValue());\n  };\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/KeyListener.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/KeyListener.js","friendlyPath":".KeyListener","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"KeyListener.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package timestep.env.browser.KeyListener;\n *\n * Listen to pressed keys and expose them using a altogether too public API.\n * An independent KeyListener is exposed for the Application Engine and any\n * Views with a Focus Manager.\n */\n\njsio('import lib.PubSub as PubSub');\njsio('import lib.Enum');\n\njsio('import event.input.keys as keyConstants');\njsio('import device');\njsio('import timer');\n\njsio('from util.browser import $');\n\nvar gListenerSingleton = null;\nvar gCancelKeys = lib.Enum(keyConstants.SPACE, keyConstants.LEFT, keyConstants.RIGHT, keyConstants.UP, keyConstants.DOWN);\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_KeyListener=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_KeyListener(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_KeyListener(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (el, events) {\n\t\tif (gListenerSingleton) { return gListenerSingleton; }\n\t\tgListenerSingleton = this;\n\t\t\n\t\tthis._el = el = el || document;\n\t\tthis._events = [];\n\t\tthis._shortcuts = [];\n\t\tthis._isEnabled = true;\n\t\tthis._keyMap = {};\n\t\t\n\t\t$.onEvent(el, 'keydown', this, 'onKeyDown');\n\t\t$.onEvent(el, 'keypress', this, 'onKeyPress');\n\t\t$.onEvent(el, 'keyup', this, 'onKeyUp');\n\t\t$.onEvent(window, 'blur', this, 'liftAll');\n\t}\n\t\n\tthis.setEnabled = function (isEnabled) { this._isEnabled = isEnabled; }\n\n\tthis.captureShortcut = function (shortcut) {\n\t\tthis._shortcuts.push(shortcut);\n\t}\n\t\n\tthis.getPressed = function () { return this._keyMap; }\n\n\tthis.onKeyDown = function (e) {\n\t\t\n\t\tif (!this._isEnabled) { return; }\n\t\t\n\t\tvar evt = {\n\t\t\tcode: e.keyCode,\n\t\t\tctrl: e.ctrlKey,\n\t\t\tshift: e.shiftKey,\n\t\t\talt: e.altKey,\n\t\t\tmeta: e.metaKey, // for mac keyboards\n\t\t\tlifted: false,\n\t\t\tdt: timer.getTickProgress()\n\t\t};\n\t\t\n\t\tif (evt.ctrl || evt.shift || evt.alt || evt.meta) {\n\t\t\tvar captured = false;\n\t\t\tfor (var i = 0, s; s = this._shortcuts[i]; ++i) {\n\t\t\t\tif (s.compare(evt)) {\n\t\t\t\t\ts.publish('Down', evt);\n\t\t\t\t\tcaptured = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tif (captured) { $.stopEvent(e); }\n\t\t\treturn;\n\t\t} else {\n\t\t\t// MUST cancel event if we're enabled to prevent browser\n\t\t\t// default behaviors (e.g. scrolling)\n\t\t\t$.stopEvent(e);\n\t\t}\n\t\t\n\t\t// We already know that key is down; ignore repeat events.\n\t\tif (e.keyCode in this._keyMap) { return; }\n\t\t\n\t\tthis._events.push(evt);\n\t\tthis._keyMap[e.keyCode] = +new Date();\n\t}\n\t\n\tthis.liftAll = function () {\n\t\tvar progressDt = timer.getTickProgress();\n\t\tfor (var code in this._keyMap) {\n\t\t\tthis._events.push({\n\t\t\t\tcode: code,\n\t\t\t\tlifted: true,\n\t\t\t\tdt: progressDt\n\t\t\t});\n\t\t}\n\t\tthis._keyMap = {};\n\t}\n\t\n\tthis.onKeyUp = function (e) {\n\t\tvar progressDt = timer.getTickProgress();\n\t\tdelete this._keyMap[e.keyCode];\n\t\tthis._events.push({\n\t\t\tcode: e.keyCode,\n\t\t\tlifted: true,\n\t\t\tdt: progressDt\n\t\t});\n\t\t$.stopEvent(e);\n\t}\n\t\n\tthis.onKeyPress = function (e) {\n\t\tif (!this._isEnabled) { return; }\n\t\tif (e.keyCode in gCancelKeys) {\n\t\t\t$.stopEvent(e);\n\t\t}\n\t}\n\t\n\tthis.peekEvents = function () { return this._events; }\n\tthis.popEvents = function () { return this._events.splice(0, this._events.length); }\n});\n\n// TODO: for maximum compatibility, especially with foreign keyboards, this needs to be inferred from the browser.  I think we can rely on a single DOM key event to get the constants in most browsers.\nmerge(exports.prototype, keyConstants);\n\nexports.Shortcut=__class__;exports.Shortcut=exports.Shortcut(function exports_Shortcut(){return this.init&&this.init.apply(this,arguments)},PubSub, function () {\n\tthis.init = function (keyCode, ctrl, shift, alt, meta) {\n\t\tthis.ctrl = !!ctrl;\n\t\tthis.shift = !!shift;\n\t\tthis.alt = !!alt;\n\t\tthis.meta = !!meta;\n\t\tthis.code = !!keyCode;\n\t}\n\t\n\tthis.compare = function (shortcut) {\n\t\treturn this.ctrl == shortcut.ctrl \n\t\t\t&& this.alt == shortcut.alt\n\t\t\t&& this.meta == shortcut.meta\n\t\t\t&& this.shift == shortcut.shift\n\t\t\t&& this.code == shortcut.code;\n\t}\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/event/input/keys.js":{"path":"modules/devkit-core/modules/timestep/src/event/input/keys.js","friendlyPath":"event.input.keys","directory":"modules/devkit-core/modules/timestep/src/event/input/","filename":"keys.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @module event.input.keys\n * Map browser keycodes to corresponding keys.\n */\n\nexports = {\n\tBACKSPACE: 8,\n\tTAB: 9,\n\tENTER: 13,\n\tSHIFT: 16,\n\tCTRL: 17,\n\tALT: 18,\n\tPAUSE: 19,\n\tBREAK: 19,\n\tCAPS: 20,\n\tCAPS_LOCK: 20,\n\tESCAPE: 27,\n\tSPACE: 32,\n\tPAGE_UP: 33,\n\tPAGE_DOWN: 34,\n\tEND: 35,\n\tHOME: 36,\n\tLEFT: 37,\n\tUP: 38,\n\tRIGHT: 39,\n\tDOWN: 40,\n\tPRINT_SCREEN: 44,\n\tINSERT: 45,\n\tDELETE: 46,\n\tMETA_LEFT: 91,\n\tWIN_LEFT: 91,\n\tMETA_RIGHT: 92,\n\tWIN_RIGHT: 92,\n\tSELECT: 93,\n\tEQUAL: 187,\n\tMINUS: 189,\n\tF1: 112,\n\tF2: 113,\n\tF3: 114,\n\tF4: 115,\n\tF5: 116,\n\tF6: 117,\n\tF7: 118,\n\tF8: 119,\n\tF9: 120,\n\tF10: 121,\n\tF11: 122,\n\tF12: 123,\n\tMUTE: 173,\n\tVOL_DOWN: 174,\n\tVOL_UP: 175,\n\tFORWARD: 176,\n\tBACK: 177,\n\tSTOP: 178,\n\tPLAY_PAUSE: 179\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/MobileBrowserAPI.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/MobileBrowserAPI.js","friendlyPath":".MobileBrowserAPI","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"MobileBrowserAPI.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.PubSub');\njsio('import device');\njsio('from util.underscore import _');\n\n/**\n * @extends lib.PubSub\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_MobileBrowserAPI=__class__;var AudioAPI = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_MobileBrowserAPI(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_MobileBrowserAPI(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function (supr) {\n\n\tvar defaults = {\n\t\toneChannelOnly: device.isMobileBrowser,\n\t\tcompiledFilename: 'compiled'\n\t};\n\n\tthis.init = function (opts) {\n\t\topts = merge(opts, defaults);\n\t\tsupr(this, 'init', [opts]);\n\t\tthis._opts = opts;\n\t\tthis._map = opts.map;\n\t\tthis._audios = {};\n\t\tthis.oneChannelOnly = opts.oneChannelOnly;\n\n\t\tsetInterval(bind(this, '_ontimeupdate'), 200);\n\t\t\n\t\tif (!this.oneChannelOnly) {\n\t\t\t_.each(opts.background, function (name) {\n\t\t\t\topts.map[name] = {'name': name}\n\t\t\t}, this);\n\t\t}\n\n\t\t// Install the event listener right away. Set usecapture=true so that\n\t\t// nothing else will affect us from intercepting this event.\n\n\t\tthis._load();\n\t\tif (this.oneChannelOnly) {\n\t\t\tthis._boundLoadHandler = bind(this, '_playFirst');\n\t\t\tdocument.body.addEventListener(device.events.start, \n\t\t\t\t\t\t\t\t\t\t   this._boundLoadHandler, true);\n\t\t}\n\t\twindow.addEventListener('pagehide', bind(this, 'pause'), false);\n\t}\n\n\tthis._createChannel = function (name, src) {\n\t\tvar audio = new Audio(src);\n\t\tthis._audios[name] = audio;\n\n\t\taudio.addEventListener('error', bind(this, '_onerror'));\n\t\taudio.addEventListener('timeupdate', bind(this, '_ontimeupdate'));\n\n\t\taudio.load();\n\t}\n\n\tthis.setMuted = function (muted) {\n\t\tthis.muted = muted;\n\t\tif (muted) {\n\t\t\tthis.setVolume(0);\n\t\t}\n\t}\n\t\n\tthis.setVolume = function (volume) {\n\t\t_.each(this._audios, function (audio, key) {\n\t\t\taudio.volume = volume;\n\t\t});\n\t}\n\n\tthis.unload = function () {\n\t\tthis.pause();\n\t\t_.each(this._audios, function (audio, key) {\n\t\t\taudio.src = '';\n\t\t}, this);\n\t\t// TODO remove event listeners\n\t}\n\n\tthis._load = function () {\n\t\n\t\tthis._audios = {};\n\t\tvar path = this._opts.path.replace(/\\/$/, '');\n\t\tif (this.oneChannelOnly) {\n\t\t\tthis._createChannel('AUDIO', path + '/' + this._opts.compiledFilename + '.m4a');\n\t\t} else {\n\t\t\tfor (var key in this._map) if (this._map.hasOwnProperty(key)) {\n\t\t\t\tif (key == 'SILENCE') { continue; }\n\t\t\t\tthis._createChannel(key, path + '/' + key + '.mp3');\n\t\t\t}\n\t\t}\n\n\t\tlogger.INFO&&console.info(\"INFO\",\".MobileBrowserAPI\",'now loading', this._opts.src);\n\n\t\tif (!this._publishedReady) {\n\t\t\tthis.publish('Ready'); // this is as close as we'll get with multiple sounds\n\t\t\tthis._publishedReady = true;\n\t\t}\n\t}\n\n\tthis._playFirst = function () {\n\t\tdocument.body.removeEventListener(device.events.start, \n\t\t\t\t\t\t\t\t\t\t  this._boundLoadHandler, true);\n\t\t\n\t\tthis._audios['AUDIO'].play();\n\t}\n\n\tthis._ontimeupdate = function (evt) {\n\t\t_.each(this._audios, function (audio, key) {\n\t\t\tif (audio.paused && !audio._pausedOnce) {\n\t\t\t\taudio.pause();\n\t\t\t\taudio._pausedOnce = true;\n\t\t\t\taudio._ready = true;\n\t\t\t}\n\n\t\t\tif (this.oneChannelOnly) {\n\t\t\t\tif (!this._nowPlaying || audio.currentTime >= this._nowPlaying.end) {\n\t\t\t\t\tthis.play('SILENCE');\n\t\t\t\t}\n\t\t\t}\n\t\t}, this);\n\n\t}\n\t\n\tthis._onerror = function (event) {\n\t\tvar s = '';\n\t\tfor (var key in event) {\n\t\t\ts += event[key] + ' ';\n\t\t}\n\t\tlogger.INFO&&console.info(\"INFO\",\".MobileBrowserAPI\",'ERROR', s);\n\t\t// this.unload();\n\t\t// this.publish('AudioError', event);\n\t\t// this._status = 'error';\n\t}\n\n\tthis.canPlay = function (name) {\n\t\tif (!this._map[name]) { return false; }\n\n\t\tvar requiredEnd = null;\n\t\tif (this.oneChannelOnly) {\n\t\t\trequiredEnd = this._map[name].end;\n\t\t\tname = 'AUDIO';\n\t\t}\n\t\tvar audio = this._audios[name];\n\t\tif (!audio) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// if (!audio._ready) {\n\t\t// \treturn; // try downloading the whole file...\n\t\t// }\n\t\tif (audio._ready || !requiredEnd) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tvar end = audio.seekable.end()\n\t\t\t\treturn (requiredEnd <= end);\n\t\t\t} catch(e) {\n\t\t\t\tlogger.LOG&&console.log(\"LOG\",\".MobileBrowserAPI\",e);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.play = function (name, volume, loop) {\t\t\n\t\tif (this.muted) { return; }\n\n\t\tif (volume === undefined) {\n\t\t\tvolume = 1.0;\n\t\t}\n\t\tif (!this.canPlay(name)) {\n\t\t\tlogger.INFO&&console.info(\"INFO\",\".MobileBrowserAPI\",'Not ready yet');\n\t\t\treturn;\n\t\t}\n\n\t\tvar audio = this._audios[this.oneChannelOnly ? 'AUDIO' : name];\n\t\ttry {\n\t\t\tif (!audio.paused) {\n\t\t\t\taudio.pause(); // it glitches if you move currentTime while playing?\n\t\t\t}\n\t\t\tvar startTime = 0;\n\t\t\tif (this.oneChannelOnly && this._map[name].start != null) {\n\t\t\t\tstartTime = this._map[name].start;\n\t\t\t}\n\t\t\tif (audio.currentTime != startTime) {\n\t\t\t\t// logger.LOG&&console.log(\"LOG\",\".MobileBrowserAPI\",'SEEK to play',name, startTime, 'from',audio.currentTime); // \n\t\t\t\taudio.currentTime = startTime;\n\t\t\t}\n\t\t\taudio.volume = volume;\n\t\t\taudio.play();\n\t\t\tthis._nowPlaying = this._map[name];\n\t\t} catch(e) {\n\t\t\t\n\t\t}\n\t}\n\t\n\tthis.pause = function () {\n\t\t_.each(this._audios, function (audio, key) {\n\t\t\taudio.pause();\n\t\t}, this);\n\t}\n\n\tthis.playBackgroundMusic = function (name, volume) {\n\t\tif (this.muted) { return; }\n\n\t\tif (this.oneChannelOnly) {\n\t\t\treturn false; // cannot play bg music here.\n\t\t}\n\n\t\tthis._backgroundSoundPlaying = name;\n\t\tthis.play(name, volume);\n\t}\n\n\tthis.pauseBackgroundMusic = function () {\n\t\tif (!this._backgroundSoundPlaying) { return; }\n\t\tthis._audios[this._backgroundSoundPlaying].pause();\n\t}\n\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/StatusBar.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/StatusBar.js","friendlyPath":".StatusBar","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"StatusBar.js","src":"exports.show = function () {\n\n}\n\nexports.hide = function () {\n\n}\n\nexports.getHeight = function () {\n\treturn 0;\n}","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/TextBox.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/TextBox.js","friendlyPath":".TextBox","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"TextBox.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package timestep.env.browser.TextBox;\n *\n * A textbox for inputting user data.\n */\n\njsio('from util.browser import $');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_TextBox=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_TextBox(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_TextBox(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tvar defaultStyle = {\n\t\tpadding: 0,\n\t\tlineHeight: 1.4,\n\t\tborder: 'none',\n\t\tdisplay: 'none',\n\t\ttextAlign: 'center',\n\t\tverticalAlign: 'middle',\n\t\tfontSize: 16,\n\t\tfontFamily: null,\n\t\tfontWeight: '',\n\t\topacity: 1,\n\t\tposition: \"absolute\",\n\t\tbackgroundColor: \"transparent\",\n\t\ttop: 0,\n\t\tleft: 0\n\t};\n\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\tcolor: 'black',\n\t\t\theight: 20\n\t\t});\n\n\t\tvar style = merge({}, defaultStyle);\n\t\tif (opts.color) { style.color = opts.color; }\n\n\t\tthis._el = $({\n\t\t\ttag: opts.multiLine ? \"textarea\" : \"input\",\n\t\t\tattrs: {type: \"text\"},\n\t\t\tstyle: style\n\t\t});\n\n\t\t$.onEvent(this._el, 'blur', this, 'onBlur');\n\t\t$.onEvent(this._el, 'focus', this, 'onFocus');\n\t\t$.onEvent(this._el, 'change', this, 'onChange');\n\t\t$.onEvent(this._el, 'click', this, 'onClick');\n\t}\n\n\tthis.onBlur =\n\tthis.onFocus =\n\tthis.onChange =\n\tthis.onClick = function () {}\n\n\tthis.destroy = function () {\n\t\t$.remove(this._el);\n\t\tthis._el = null;\n\t}\n\n\tthis.setApp = function (app) {\n\t\tif (app != this._app || !this._el.parentNode) {\n\t\t\tthis._app = app;\n\t\t\tvar canvas = app._ctx.canvas;\n\t\t\tlogger.LOG&&console.log(\"LOG\",\".TextBox\",'setting parent', this._el);\n\t\t\tcanvas.parentNode.appendChild(this._el);\n\t\t}\n\t}\n\n\tthis.change = function () {\n\n\t}\n\n\tthis.click = function () {\n\t}\n\n\tthis.selectAll = function () {\n\t\tthis._el.focus();\n\t\tthis._el.select();\n\t}\n\n\tthis.show = function () { $.show(this._el); }\n\tthis.hide = function () { $.hide(this._el); }\n\n\tthis.setValue = function (value) { this._el.value = value; return this; }\n\tthis.setOpacity = function (o) { this._el.style.opacity = o; return this; }\n\tthis.setType = function (type) { this._el.type = type; return this; }\n\tthis.setVisible = function (isVisible) { return this[isVisible ? 'show': ' hide'](); }\n\tthis.getX = function () { return parseInt(this._el.style.left); }\n\tthis.getY = function () { return parseInt(this._el.style.top); }\n\tthis.getWidth = function () { return this._el.offsetWidth; }\n\tthis.getHeight = function () { return this._el.offsetHeight; }\n\tthis.getValue = function () { return this._el.value; }\n\tthis.getOpacity = function () { return this._el.style.opacity; }\n\tthis.getType = function () { return this._el.type; }\n\tthis.getVisible = function () { return this._el.parentNode && this._el.style.display == 'block'; }\n\n\tthis.setPosition = function (p) { this._el.style.top = p.y + 'px'; this._el.style.left = p.x + 'px'; }\n\tthis.getPosition = function () { return {x: this.getX(), y: this.getY()}; }\n\n\tthis.setDimensions = function (d) { this._el.style.width = d.width + 'px'; this._el.style.height = d.height + 'px'; return this; }\n\tthis.getDimensions = function () { return {width: this.getWidth(), height: this.getHeight()}; }\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/TextInput.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/TextInput.js","friendlyPath":".TextInput","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"TextInput.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package timestep.env.browser.TextInput;\n *\n * A textbox for inputting user data.\n */\n\njsio('import lib.PubSub');\njsio('from util.browser import $');\n\n/**\n * @extends lib.PubSub\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_TextInput=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_TextInput(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_TextInput(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\tthis.init = function (opts) {\n\t\tthis._el = $({\n\t\t\ttag: 'input',\n\t\t\tparent: document.body,\n\t\t\tstyle: {\n\t\t\t\tposition: 'absolute',\n\t\t\t\tleft: '-100px',\n\t\t\t\ttop: '-100px'\n\t\t\t},\n\t\t\tattrs: {\n\t\t\t\ttype: 'text',\n\t\t\t\tvalue: opts && opts.value || ''\n\t\t\t}\n\t\t});\n\t\tthis._value = this._el.value;\n\t\tthis._selectionStart = 0;\n\t\tthis._selectionEnd = 0;\n\n\t\t$.onEvent(this._el, 'keydown', this, 'checkValue');\n\t\t$.onEvent(this._el, 'keyup', this, 'checkValue');\n\t\t$.onEvent(this._el, 'keypress', this, 'checkValue');\n\t\t$.onEvent(this._el, 'focus', this, 'onFocus');\n\t\t$.onEvent(this._el, 'blur', this, 'onBlur');\n\t}\n\n\tthis.onFocus = function () { this.publish('Focus'); }\n\tthis.onBlur = function () { this.publish('Blur'); }\n\n\tthis.checkValue = function (evt) {\n\t\tvar target = evt.target,\n\t\t\tstart = target.selectionStart,\n\t\t\tend = target.selectionEnd;\n\n\t\tvar value = this._el.value;\n\n\t\tif (value != this._value) {\n\t\t\tthis.publish('ChangeValue', value);\n\t\t\tthis._value = value;\n\t\t}\n\n\t\tif (start != this._selectionStart) {\n\t\t\tthis._selectionStart = start;\n\t\t\tthis.publish('ChangeSelectionStart', start);\n\t\t}\n\n\t\tif (end != this._selectionEnd) {\n\t\t\tthis._selectionEnd = end;\n\t\t\tthis.publish('ChangeSelectionEnd', end);\n\t\t}\n\t}\n\n\tthis.focus = function () { logger.LOG&&console.log(\"LOG\",\".TextInput\",'focus'); this._el.focus(); }\n\tthis.blur = function () { this._el.blur(); }\n});\n\n\n// Set desired tab- defaults to four space softtab\nvar tab = '    ',\n\ttabLength = 4;\n\nArray.prototype.map.call(document.getElementsByTagName('textarea'), function (el) {\n\tel.addEventListener('keydown', checkTab, false);\n});\n\nfunction checkTab(evt) {\n\tvar t = evt.target;\n\tvar ss = t.selectionStart;\n\tvar se = t.selectionEnd;\n\n\t// Tab key - insert tab expansion\n\tif (evt.keyCode == 9) {\n\t\tevt.preventDefault();\n\n\t\tif (evt.shiftKey) {\n\t\t\t// Special case of multi line selection\n\t\t\tif (ss != se && t.value.slice(ss,se).indexOf('\\n') != -1) {\n\t\t\t\t// In case selection was not of entire lines (e.g. selection begins in the middle of a line)\n\t\t\t\t// we ought to tab at the beginning as well as at the start of every following line.\n\t\t\t\tvar i = ss;\n\t\t\t\twhile(i && t.value.charAt(i - 1) != '\\n') { --i; }\n\t\t\t\tvar pre = t.value.slice(0, i);\n\t\t\t\tvar post = t.value.slice(se, t.value.length);\n\t\t\t\tvar sel = t.value.slice(i, se).replace(\n\t\t\t\t\tnew RegExp('(^|\\n)' + tab, 'g'),\n\t\t\t\t\tfunction (match) {\n\t\t\t\t\t\tse -= tab.length;\n\t\t\t\t\t\tif (match.charAt(0) == '\\n') {\n\t\t\t\t\t\t\treturn '\\n';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tss -= tab.length;\n\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\tt.value = pre.concat(sel).concat(post);\n\n\t\t\t\tt.selectionStart = ss;\n\t\t\t\tt.selectionEnd = se;\n\t\t\t} else {\n\t\t\t\t// \"Normal\" case (no selection or selection on one line only)\n\n\t\t\t\tvar i = ss;\n\t\t\t\twhile(i && t.value.charAt(i - 1) != '\\n') { --i; }\n\t\t\t\tif (t.value.substring(i, i + tab.length) == tab) {\n\t\t\t\t\tt.value = t.value.slice(0, i).concat(t.value.slice(i + tab.length, t.value.length));\n\t\t\t\t\tif (ss == se) {\n\t\t\t\t\t\tt.selectionStart = t.selectionEnd = ss - (ss == i ? 0 : tab.length);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tt.selectionStart = ss - (ss == i ? 0 : tab.length);\n\t\t\t\t\t\tt.selectionEnd = se - tab.length;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Special case of multi line selection\n\t\t\tif (ss != se && t.value.slice(ss,se).indexOf(\"\\n\") != -1) {\n\t\t\t\t// In case selection was not of entire lines (e.g. selection begins in the middle of a line)\n\t\t\t\t// we ought to tab at the beginning as well as at the start of every following line.\n\t\t\t\tvar i = ss;\n\t\t\t\twhile(i && t.value.charAt(i - 1) != '\\n') { --i; }\n\t\t\t\tvar pre = t.value.slice(0, i);\n\t\t\t\tvar post = t.value.slice(se, t.value.length);\n\t\t\t\tvar sel = t.value.slice(i, se).replace(/\\n/g, function () {\n\t\t\t\t\tse += tab.length;\n\t\t\t\t\treturn '\\n' + tab;\n\t\t\t\t});\n\t\t\t\tt.value = pre.concat(tab).concat(sel).concat(post);\n\n\t\t\t\tt.selectionStart = ss + tab.length;\n\t\t\t\tt.selectionEnd = se + tab.length;\n\t\t\t} else {\n\t\t\t\t// \"Normal\" case (no selection or selection on one line only)\n\n\t\t\t\tvar i = ss;\n\t\t\t\twhile(i && t.value.charAt(i - 1) != '\\n') { --i; }\n\n\t\t\t\tt.value = t.value.slice(0, i).concat(tab).concat(t.value.slice(i, t.value.length));\n\n\t\t\t\tif (ss == se) {\n\t\t\t\t\tt.selectionStart = t.selectionEnd = ss + tab.length;\n\t\t\t\t} else {\n\t\t\t\t\tt.selectionStart = ss + tab.length;\n\t\t\t\t\tt.selectionEnd = se + tab.length;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (evt.shiftKey || evt.metaKey || evt.ctrlKey) {\n\t\treturn;\n\t} else if (evt.keyCode == 8 && t.value.slice(ss - tabLength, ss) == tab) {\n\t\t// Backspace key - delete preceding tab expansion, if exists\n\t\tevt.preventDefault();\n\n\t\tt.value = t.value.slice(0,ss - tabLength).concat(t.value.slice(ss,t.value.length));\n\t\tt.selectionStart = t.selectionEnd = ss - tab.length;\n\t} else if (evt.keyCode == 46 && t.value.slice(se, se + tabLength) == tab) {\n\t\t// Delete key - delete following tab expansion, if exists\n\t\tevt.preventDefault();\n\n\t\tt.value = t.value.slice(0,ss).concat(t.value.slice(ss + tabLength,t.value.length));\n\t\tt.selectionStart = t.selectionEnd = ss;\n\t} else if (evt.keyCode == 37 && t.value.slice(ss - tabLength, ss) == tab) {\n\t\t// Left/right arrow keys - move across the tab in one go\n\t\tevt.preventDefault();\n\t\tt.selectionStart = t.selectionEnd = ss - tabLength;\n\t} else if (evt.keyCode == 39 && t.value.slice(ss, ss + tabLength) == tab) {\n\t\tevt.preventDefault();\n\t\tt.selectionStart = t.selectionEnd = ss + tabLength;\n\t}\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/Timer.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/Timer.js","friendlyPath":".Timer","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"Timer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package timestep.env.browser.Timer;\n *\n * System timer exposed to the device.\n */\n\nvar _onTick = null,\n\tdisableRequestAnimFrame = false,\n\tdisablePostMessage = true,\n\tasFastAsPossible = false,\n\tMIN_DT = 16;\n\nif (window.postMessage) {\n\tfunction postMessageCb(evt) { if (evt.data == 'timestep.TICK') { onFrame(); }}\n\t\n\tif (window.addEventListener) {\n\t\twindow.addEventListener('message', postMessageCb, false);\n\t} else {\n\t\twindow.attachEvent('onmessage', postMessageCb);\n\t}\n} else {\n\tdisablePostMessage = true;\n\ttickNow = sendTimeoutNow;\n}\n\nfunction sendPostMessage() { window.postMessage('timestep.TICK', '*'); }\nfunction sendTimeout() { setTimeout(onFrame, MIN_DT); }\nfunction sendTimeoutNow() { setTimeout(onFrame, 0); }\n\nvar fastDriver = sendTimeoutNow,\n\tmainDriver = sendTimeout,\n\tcancelDriver,\n\tdriverId;\n\nif (asFastAsPossible) {\n\tif (!disablePostMessage) {\n\t\tfastDriver = mainDriver = sendPostMessage;\n\t} else {\n\t\tmainDriver = sendTimeoutNow;\n\t}\n} else {\n\tvar reqAnim = window.requestAnimationFrame;\n\tvar cancelAnim = window.cancelAnimationFrame;\n\tvar prefixes = ['', 'webkit', 'moz', 'o', 'ms'];\n\n\tif (!disableRequestAnimFrame) {\n\t\tfor (var i = 0; i < prefixes.length && !reqAnim; ++i) {\n\t\t\treqAnim = window[prefixes[i] + 'RequestAnimationFrame'];\n\t\t\tcancelAnim = window[prefixes[i] + 'CancelAnimationFrame'] || window[prefixes[i] + 'CancelRequestAnimationFrame'];\n\t\t}\n\t}\n\n\tif (reqAnim) {\n\t\tfastDriver = mainDriver = reqAnim;\n\t\tcancelDriver = cancelAnim;\n\t} else if (!disablePostMessage) {\n\t\tfastDriver = sendPostMessage;\n\t}\n}\n\n/*\nvar frameDts = [];\nvar print = false, frames = 0, lastPrint = 0;\nsetInterval(function () { print = true; }, 1000)\n\nvar slow = 0, fast = 0;\n*/\n\nfunction onFrame() {\n\tif (_onTick) {\n\t\tvar now = Date.now(),\n\t\t\tdt = now - (exports.last || now);\n\t\t\n\t\texports.last = now;\n\t\t\n\t\t//try {\n\t\t\t_onTick(dt);\n\t\t/*} catch (e) {\n\t\t\tif (window.DEV_MODE) {\n\t\t\t\tvar err = '.dev_error';\n\t\t\t\tjsio('import ' + err).render(e);\n\t\t\t\texports.stop();\n\t\t\t}\n\t\t}*/\n\n\t\t/*\n\t\tframeDts.push(dt);\n\t\tvar delay = +new Date() - now;\n\t\t++frames;\n\t\tif (print) {\n\t\t\tlogger.LOG&&console.log(\"LOG\",\".Timer\",fast, slow, JSON.stringify(frameDts), now - lastPrint, dt, frames, delay);\n\t\t\tframeDts = [];\n\t\t\tlastPrint = now;\n\t\t\tprint = false;\n\t\t\tframes = 0;\n\t\t\tslow = 0;\n\t\t\tfast = 0;\n\t\t}\n\t\t*/\n\n\t\tif (dt > MIN_DT) {\n\t\t//\t++fast;\n\t\t\tdriverId = fastDriver.call(window, onFrame);\n\t\t} else {\n\t\t//\t++slow;\n\t\t\tdriverId = mainDriver.call(window, onFrame);\n\t\t}\n\t}\n}\n\nexports.last = null;\n\nexports.start = function (onTick) {\n\t_onTick = onTick;\n\tdriverId = mainDriver.call(window, onFrame);\n}\n\nexports.stop = function () {\n\t_onTick = null;\n\tif (driverId) {\n\t\tcancelDriver.call(window, driverId);\n\t\tdriverId = null;\n\t}\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/platforms/browser/EditText.js":{"path":"modules/devkit-core/modules/timestep/src/platforms/browser/EditText.js","friendlyPath":".EditText","directory":"modules/devkit-core/modules/timestep/src/platforms/browser/","filename":"EditText.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('from util.browser import $');\njsio('import squill.Widget');\njsio('import device');\n\nvar __keyboardIsOpen = false;\n\nInputField=__class__;var InputField=InputField(function InputField(){return this.init&&this.init.apply(this,arguments)},squill.Widget, function (supr) {\n\n\tthis._def = {\n\t\ttag: 'input',\n\t\tparent: document.body,\n\t\tstyle: {\n\t\t\tposition: 'absolute',\n\t\t\tbackground: 'transparent',\n\t\t\tborder: 'none',\n\t\t\toutline: 'none',\n\t\t\tzIndex: '990000',\n\t\t\tleft: '0px',\n\t\t\ttop: '0px'\n\t\t}\n\t}\n\n\tthis.buildWidget = function () {\n\t\tthis.initKeyEvents();\n\t\tthis.initFocusEvents();\n\t}\n\n\tthis.setValue = function (value) {\n\t\tthis._el.value = value;\n\t\tthis._prevValue = value;\n\t}\n\n\tthis.setCursor = function (cursorPos) {\n\t\tthis._el.selectionStart = this._el.selectionEnd = cursorPos;\n\t}\n\n\tthis.setPlaceholder = function (placeholder) {\n\t\tthis._el.placeholder = placeholder;\n\t}\n\n\tthis.setMaxLength = function (maxLength) {\n\t\tthis._el.maxlength = maxLength;\n\t}\n\n\tthis.show = function () {\n\t\tsupr(this, 'show', arguments);\n\n\t\tthis._el.focus();\n\t}\n\n\tthis.onKeyUp = function (evt) {\n\t\tvar el = this._el;\n\t\t_focused && _focused.onChange(el.value, this._prevValue, el.selectionStart, el.selectionEnd);\n\t\tthis._prevValue = el.value;\n\t\tif (evt.keyCode == 13) {\n\t\t\t_focused && _focused.closeEditField();\n\t\t}\n\t}\n\n\tthis.getValue = function () { return this._el.value; }\n\n\tthis.onBlur = function (evt) {\n\t\tthis.hide();\n\t\tif (__keyboardIsOpen) {\n\t\t\t__keyboardIsOpen = false;\n\t\t\tvar ev = new Event('keyboardClosed');\n\t\t\tev.height = device.screen.height;\n\t\t\twindow.dispatchEvent(ev);\n\t\t}\n\t\t_focused && _focused.closeEditField();\n\t\t_focused = null;\n\t}\n\n\tthis.setFontColor = function (color) {\n\t\tthis._el.style.color = color;\n\t}\n\n\tthis.setHorizontalPadding = function (left, right) {\n\t\tthis._el.style.paddingLeft = left + 'px';\n\t\tthis._el.style.paddingRight = right + 'px';\n\t}\n\n\tthis.setFontSize = function (fontSize) {\n\t\tthis._el.style.fontSize = fontSize + 'px';\n\t}\n\n\tthis.setFontFamily = function (fontFamily) {\n\t\tthis._el.style.fontFamily = fontFamily;\n\t}\n\n\tthis.setPosition = function (x, y, width, height) {\n\t\tvar style = this._el.style;\n\t\tstyle.top = (y - 1) + 'px';\n\t\tstyle.left = x + 'px';\n\t\tstyle.width = width + 'px';\n\t\tstyle.height = height + 'px';\n\t}\n});\n\nvar _input = new InputField();\n_input.hide();\n\nvar _focused = null;\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_EditText=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_EditText(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_platforms_browser_EditText(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tvar defaults = {\n\t\thint: '',\n\t\tinputType: 'default', // default | number | phone | password | capital\n\t\tmaxLength: -1\n\t}\n\n\tthis.init = function (opts) {\n\t\tthis._opts = merge(opts, defaults);\n\n\t\tthis._textEditView = opts.textEditView;\n\t\tthis.onFocusChange = opts.onFocusChange || function() {};\n\t\tthis.onSubmit = opts.onSubmit || function () {}\n\t}\n\n\tthis.onChange = function (value, prevValue, cursorPos, selectionEnd) {\n\t\tthis._value = value;\n\t\tif (this._opts.onChange) {\n\t\t\tthis._opts.onChange(value, prevValue, cursorPos);\n\t\t}\n\t}\n\n\tthis.getValue = function () {\n\t\treturn this._value;\n\t}\n\n\tthis.setValue = function (value) {\n\t\tthis._value = value;\n\t\tthis.onChange(value);\n\t}\n\n\tthis.requestFocus = function(noSubmit) {\n\t\tif (_focused !== this) {\n\t\t\tif (_focused != null) {\n\t\t\t\t_focused.removeFocus(noSubmit);\n\t\t\t}\n\n\t\t\tthis.onFocusChange(true);\n\t\t}\n\n\t\t_focused = this;\n\t}\n\n\tthis.closeEditField = function(noSubmit) {\n\t\tconsole.log(\"TextEditView editText removeFocus\");\n\t\tif (_focused != null) {\n\t\t\t_focused.removeFocus(noSubmit);\n\t\t}\n\n\t\tthis._showTextBox();\n\t\t_input.hide();\n\t\t// NATIVE.inputPrompt.hideSoftKeyboard();\n\n\t\tif (__keyboardIsOpen) {\n\t\t\t__keyboardIsOpen = false;\n\t\t\tvar ev = new Event('keyboardClosed');\n\t\t\tev.height = device.screen.height;\n\t\t\twindow.dispatchEvent(ev);\n\t\t}\n\t }\n\n\tthis._hideTextBox = function () {\n\t\tvar textBox = this._textEditView._textBox;\n\t\ttextBox.style.visible = false;\n\t}\n\n\tthis._showTextBox = function () {\n\t\tvar textBox = this._textEditView._textBox;\n\t\ttextBox.style.visible = true;\n\t}\n\n\tthis.refresh = function(value, hasBack, hasForward, cursorPos) {\n\n\t\tthis._hideTextBox();\n\n\t\tvar textBox = this._textEditView._textBox;\n\t\tvar pos = this._textEditView.getPosition();\n\t\tvar scale = pos.width / this._textEditView.style.width;\n\n\t\t_input.setCursor(cursorPos);\n\t\t_input.setValue(value);\n\t\t_input.setPlaceholder(this._opts.hint);\n\t\t_input.setMaxLength(this._opts.maxLength);\n\t\t_input.setFontColor(this._opts.color);\n\t\t_input.setHorizontalPadding(this._opts.paddingLeft * scale, this._opts.paddingRight * scale);\n\t\t_input.setFontSize(textBox.getOpts().size * scale);\n\t\t_input.setFontFamily(textBox.getOpts().fontFamily)\n\t\t_input.setPosition(pos.x, pos.y, pos.width, pos.height);\n\t\t_input.show();\n\n\t\tif (!__keyboardIsOpen) {\n\t\t\t__keyboardIsOpen = true;\n\t\t\tvar ev = new Event('keyboardOpened');\n\t\t\tev.height = device.screen.height * .6;\n\t\t\twindow.dispatchEvent(ev);\n\t\t}\n\n\t\t/*\n\t\tif (hasBack) {\n\t\t\t_backButton.onSelect = bind(this, function () {\n\t\t\t\tthis._textEditView.focusPrevious());\n\t\t\t});\n\t\t\t_backButton.disabled = false;\n\t\t} else {\n\t\t\t_backButton.disabled = true;\n\t\t}\n\n\t\tif (hasForward) {\n\t\t\t_forwardButton.onSelect = bind(this, function () {\n\t\t\t\tthis._textEditView.focusNext());\n\t\t\t});\n\t\t\t_forwardButton.disabled = false;\n\t\t} else {\n\t\t\t_forwardButton.disabled = true;\n\t\t}\n\n\t\t*/\n\t}\n\n\tthis.hasFocus = function() {\n\t\treturn this == _focused;\n\t}\n\n\tthis.removeFocus = function(noSubmit) {\n\t\tthis.onFocusChange(false);\n\t\tif(!noSubmit) {\n\t\t\tthis.onSubmit(_input.getValue());\n\t\t}\n\t\tif (_focused == this) {\n\t\t\t_focused = null;\n\t\t}\n\t}\n\n\tthis.setHint = function(hint) {\n\t\tthis._opts.hint = hint;\n\t}\n});\n","pre":true},"modules/devkit-core/modules/squill/Alpha.js":{"path":"modules/devkit-core/modules/squill/Alpha.js","friendlyPath":".Alpha","directory":"modules/devkit-core/modules/squill/","filename":"Alpha.js","src":"jsio('from util.browser import $');\njsio('import .Widget');\n\njsio('import .jscolor.jscolor as jscolor');\n\nvar alphaSelect = false,\n\talphaIndicator;\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Alpha=__class__;var Alpha = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Alpha(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Alpha(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._css = 'lph';\n\tthis._type = 'text';\n\n\tthis.init = function(params) {\n\t\tparams = merge(params, {tag: 'input'});\n\t\tsupr(this, 'init', [params]);\n\t};\n\n\tthis.buildWidget = function() {\n\t\tvar el = this._el;\n\n\t\tel.widget = this;\n\n\t\t$.onEvent(el, 'focus', this, '_onFocus');\n\t\t$.onEvent(el, 'blur', this, '_onBlur');\n\t\t$.onEvent(el, 'change', this, '_onChange');\n\n\t\tvar alphaGradient,\n\t\t\tctx,\n\t\t\tstyle,\n\t\t\trect;\n\n\t\tif (!alphaSelect) {\n\t\t\talphaSelect = document.createElement('div');\n\t\t\talphaSelect.style.display = 'none';\n\t\t\talphaSelect.className = 'colorMenu';\n\t\t\tdocument.body.appendChild(alphaSelect);\n\n\t\t\t$.onEvent(alphaSelect, 'mousedown', this, '_onSelect');\n\n\t\t\talphaGradient = document.createElement('canvas');\n\t\t\talphaGradient.width = 20;\n\t\t\talphaGradient.height = 100;\n\t\t\talphaSelect.appendChild(alphaGradient);\n\n\t\t\t$.style(\n\t\t\t\talphaGradient,\n\t\t\t\t{\n\t\t\t\t\t'float': 'left',\n\t\t\t\t\twidth: '20px',\n\t\t\t\t\theight: '100px',\n\t\t\t\t\tmargin: '8px 0 0 12px',\n\t\t\t\t\tborder: '1px solid #000',\n\t\t\t\t\tborderColor: 'ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow',\n\t\t\t\t\tbackgroundColor: 'red'\n\t\t\t\t}\n\t\t\t);\n\t\t\t$.onEvent(alphaGradient, 'mousedown', this, '_onMouseDown');\n\t\t\t$.onEvent(alphaGradient, 'mousemove', this, '_onMouseMove');\n\t\t\t$.onEvent(alphaGradient, 'mouseup', this, '_onMouseUp');\n\t\t\t$.onEvent(alphaGradient, 'mouseout', this, '_onMouseOut');\n\n\t\t\talphaIndicator = document.createElement('img');\n\t\t\talphaIndicator.src = 'img/colorpicker/arrow.gif';\n\t\t\talphaSelect.appendChild(alphaIndicator);\n\n\t\t\t$.style(\n\t\t\t\talphaIndicator,\n\t\t\t\t{\n\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\tleft: '4px',\n\t\t\t\t\ttop: '2px',\n\t\t\t\t\tborder: '0px hidden'\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tctx = alphaGradient.getContext('2d');\n\t\t\tlinearGradient = ctx.createLinearGradient(0, 0, 0, 100);\n\t\t\tlinearGradient.addColorStop(0, '#FFFFFF');\n\t\t\tlinearGradient.addColorStop(1, '#000000');\n\t\t\tctx.fillStyle = linearGradient;\n\t\t\tctx.fillRect(0, 0, 20, 100);\n\t\t}\n\t};\n\n\tthis._showIndicator = function(alpha) {\n\t\tif (alpha < 0) {\n\t\t\talpha = 0;\n\t\t}\n\t\tif (alpha > 100) {\n\t\t\talpha = 100;\n\t\t}\n\n\t\t$.style(\n\t\t\talphaIndicator,\n\t\t\t{\n\t\t\t\tposition: 'absolute',\n\t\t\t\tleft: '4px',\n\t\t\t\ttop: (2 + alpha) + 'px',\n\t\t\t\tborder: '0px hidden'\n\t\t\t}\n\t\t);\n\n\t\treturn alpha;\n\t};\n\n\tthis._showMouseAlpha = function(evt) {\n\t\talphaSelect.target.value = 100 - this._showIndicator(evt.offsetY);\n\t\talphaSelect.widget.publish('Change', parseInt(alphaSelect.target.value, 10));\n\t};\n\n\tthis._onChange = function(evt) {\n\t\tvar value = this._el.value;\n\t\tif (!isNaN(value)) {\n\t\t\tvalue = parseInt(value, 10);\n\t\t\tif ((value >= 0) && (value <= 100)) {\n\t\t\t\talphaSelect.widget.publish('Change', value);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._onFocus = function(evt) {\n\t\tvar alpha,\n\t\t\tstyle = alphaSelect.style,\n\t\t\trect = this._el.getBoundingClientRect(),\n\t\t\tx = rect.right + 4,\n\t\t\ty = rect.top;\n\n\t\tif (y + 122 > window.innerHeight) {\n\t\t\ty = rect.bottom - 122;\n\t\t}\n\t\tif (x + 44 > window.innerWidth) {\n\t\t\tx = rect.left - 48;\n\t\t}\n\n\t\t$.style(\n\t\t\talphaSelect,\n\t\t\t{\n\t\t\t\tposition: 'absolute',\n\t\t\t\twidth: '44px',\n\t\t\t\theight: '122px',\n\t\t\t\tzIndex: '1000000',\n\t\t\t\tleft: x + 'px',\n\t\t\t\ttop: y + 'px',\n\t\t\t\tdisplay: 'block'\n\t\t\t}\n\t\t);\n\n\t\talphaSelect.widget = evt.target.widget;\n\t\talphaSelect.target = evt.target;\n\n\t\tif (isNaN(alphaSelect.target.value)) {\n\t\t\talpha = 0;\n\t\t} else {\n\t\t\talpha = parseInt(alphaSelect.target.value, 10);\n\t\t}\n\t\tthis._showIndicator(100 - alpha);\n\t};\n\n\tthis._onBlur = function(evt) {\n\t\talphaSelect.style.display = 'none';\n\t};\n\n\tthis._onSelect = function(evt) {\n\t\t$.stopEvent(evt);\n\t};\n\n\tthis._onMouseDown = function(evt) {\n\t\t$.stopEvent(evt);\n\t\tthis._showMouseAlpha(evt);\n\t\tthis._mouseDown = true;\n\t};\n\n\tthis._onMouseMove = function(evt) {\n\t\tif (this._mouseDown) {\n\t\t\tthis._showMouseAlpha(evt);\n\t\t}\n\t\t$.stopEvent(evt);\n\t};\n\n\tthis._onMouseOut = function(evt) {\n\t\tthis._mouseDown = false;\n\t\t$.stopEvent(evt);\n\t};\n\n\tthis._onMouseUp = function(evt) {\n\t\tthis._mouseDown = false;\n\t\t$.stopEvent(evt);\n\t};\n\n\tthis.setValue = function(value) {\n\t\tthis._el.value = value;\n\t};\n\n\tthis.getValue = function() {\n\t\treturn this._el.value;\n\t};\n});\n\n","pre":true},"modules/devkit-core/modules/squill/Widget.js":{"path":"modules/devkit-core/modules/squill/Widget.js","friendlyPath":"squill.Widget","directory":"modules/devkit-core/modules/squill/","filename":"Widget.js","src":"jsio('from util.browser import $');\njsio('import .Element, .Events, .global');\njsio('import .i18n');\njsio('import .Delegate');\njsio('import .models.Model as Model');\njsio('import .models.bindings as bindings');\n\njsio('from .__imports__ import classes as WIDGET_CLASSES');\n\nvar uid = 0;\n\nfunction shallowCopy(p) {\n\tvar o = {};\n\tfor(var i in p) {\n\t\tif(p.hasOwnProperty(i)) {\n\t\t\to[i] = p[i];\n\t\t}\n\t}\n\treturn o;\n}\n\nWidgetSet=__class__;var WidgetSet=WidgetSet(function WidgetSet(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init = function (target) {\n\t\tthis._target = target;\n\t\tthis.events = [];\n\t}\n\n\tthis.getTarget = function () { return this._target; }\n\n\tthis.hasWidget = function (id) { return !!this._target[id]; };\n\n\tthis.addWidget = function (id, widget) {\n\t\tthis._target[id] = widget;\n\t};\n\n\tthis.addSubscription  = function(widget, signal /* ... args */) {\n\t\tif (this._target.dispatchEvent) {\n\t\t\twidget.subscribe.apply(widget, [signal, this._target,\n\t\t\t\t'dispatchEvent', widget.getId()]\n\t\t\t\t\t.concat(Array.prototype.slice.call(arguments, 2)));\n\t\t}\n\t}\n});\n\nvar modules_devkit_core_modules_squill_Widget=__class__;var Widget = exports=modules_devkit_core_modules_squill_Widget(function modules_devkit_core_modules_squill_Widget(){return this.init&&this.init.apply(this,arguments)},[Element, Events], function() {\n\tthis._css = 'widget';\n\tthis._name = '';\n\n\tthis.__getDef__ = function () {\n\t\tvar cls = this.constructor;\n\t\tvar def = {};\n\n\t\tdo {\n\t\t\tif (cls.prototype.hasOwnProperty('_def')) {\n\t\t\t\tcopyDef(cls.prototype._def);\n\t\t\t}\n\t\t} while ((cls = cls.prototype.__parentClass__));\n\n\t\t// handle base _def\n\t\tif (this.hasOwnProperty('_def')) {\n\t\t\tcopyDef(this._def);\n\t\t}\n\n\t\tfunction copyDef (src) {\n\t\t\tfor (var key in src) {\n\t\t\t\tif (key == 'attrs' || key == 'style') {\n\t\t\t\t\tdef[key] = merge(def[key], src[key]);\n\t\t\t\t} else if (key == 'className' && def.className) {\n\t\t\t\t\tdef.className = src.className + ' ' + def.className;\n\t\t\t\t} else if (key == 'children') {\n\t\t\t\t\tif (!def.children) {\n\t\t\t\t\t\tdef.children = [src.children];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdef.children.push(src.children);\n\t\t\t\t\t}\n\t\t\t\t} else if (!def.hasOwnProperty(key)) {\n\t\t\t\t\tdef[key] = src[key];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn def;\n\t}\n\n\tthis.init = function(opts) {\n\t\topts = opts || {};\n\n\t\tthis._children = [];\n\n\t\t// ===\n\t\t// merge this._def and opts\n\n\t\tvar def = this._def = this.__getDef__();\n\n\t\tthis._id = def.id;\n\n\t\tthis.__model = new Model(def.model);\n\n\t\t// className merges\n\t\tif (def.className) {\n\t\t\topts.className = opts.className ? opts.className + \" \" + def.className : def.className;\n\t\t}\n\n\t\tif (def.attrs) {\n\t\t\topts.attrs = merge(opts.attrs, def.attrs);\n\t\t}\n\n\t\tif (def.style) {\n\t\t\topts.style = merge(opts.style, def.style);\n\t\t}\n\n\t\t// opts take precedence over def\n\t\tthis._opts = opts;\n\t\tfor (var name in def) {\n\t\t\tif (name != 'children' && !opts.hasOwnProperty(name) && def.hasOwnProperty(name)) {\n\t\t\t\topts[name] = def[name];\n\t\t\t}\n\t\t}\n\n\t\t// delete opts.children;\n\n\t\t// end merge\n\t\t// ===\n\n\t\tif (opts.name) { this._name = opts.name; }\n\t\tif (opts.delegate) { this.delegate = opts.delegate; }\n\n\t\tvar widgetParent;\n\t\tvar buildNow = false;\n\t\tif (opts.widgetParent) {\n\t\t\twidgetParent = opts.widgetParent;\n\t\t}\n\n\t\tthis.controller = opts.controller || widgetParent;\n\n\t\tif (opts.parent) {\n\t\t\tvar parent = opts.parent;\n\t\t\tvar isWidgetParent = parent instanceof Widget;\n\t\t\tif (isWidgetParent) {\n\t\t\t\tif (!widgetParent) {\n\t\t\t\t\twidgetParent = opts.parent;\n\t\t\t\t}\n\n\t\t\t\topts.parent = parent.getContainer();\n\t\t\t} else if (!parent.appendChild) {\n\t\t\t\tdelete opts.parent;\n\t\t\t}\n\t\t}\n\n\t\tif (widgetParent) {\n\t\t\twidgetParent.addWidget(this);\n\t\t} else if (opts.parent || opts.el) {\n\t\t\tthis.build(opts.el);\n\t\t}\n\t};\n\n\tthis.getOpts = function () { return this._opts; }\n\n\tthis.getId = function () {\n\t\treturn this._id || (this._el && this._el.id);\n\t}\n\n\tthis.build = function (el) {\n\t\tif (!this._el || this._el != el) {\n\t\t\tvar opts = this._opts;\n\t\t\tvar children = opts.children;\n\n\t\t\tif (children) { delete opts.children; }\n\t\t\tthis._el = $.create(this._opts);\n\t\t\tif (children) { opts.children = children; }\n\n\t\t\tthis.buildContent();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tthis.getParent = function() { return this._el && this._el.parentNode; };\n\tthis.getWidgetParent = function () { return this._widgetParent; }\n\n\tthis.setWidgetParent = function (parent) {\n\t\tif (this._widgetParent != parent) {\n\t\t\tthis._widgetParent.removeWidget(this);\n\t\t\tparent.addWidget(this);\n\t\t\tthis._widgetParent = parent;\n\t\t}\n\t}\n\n\tthis.getChildren = function() {\n\t\treturn this._children;\n\t};\n\n\tthis.forEachDescend = function (cb, ctx) {\n\t\tvar n = this._children.length;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tvar child = this._children[i];\n\t\t\tcb.call(ctx, child);\n\t\t\tif (child.forEachDescend) {\n\t\t\t\tchild.forEachDescend(cb, ctx);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getFirstChild = function() {\n\t\treturn (this._children && this._children.length) ? this._children[0] : null;\n\t};\n\n\tthis.dispatchEvent = function (id, evt) {\n\t\tthis.delegate.call(this, id, evt);\n\t};\n\n\tthis.addElement = function (el) {\n\t\tthis._el.appendChild(el);\n\t}\n\n\tthis.addWidget = function(def, parent, result) {\n\t\tif (!this._el) { this.build(); }\n\n\t\tparent = def.parent || parent || this.getContainer() || this._el;\n\n\t\t// def is either a Widget or a definition for a Widget\n\t\tif (!(def instanceof Widget)) {\n\t\t\t// if it is not yet a widget, make it (or make a DOM node)\n\t\t\tvar opts = merge({}, def, {parent: parent, __result: result});\n\t\t\tif (opts.children) {\n\t\t\t\tvar children = opts.children;\n\t\t\t\tdelete opts.children;\n\t\t\t}\n\n\t\t\tvar el;\n\t\t\tif ('type' in opts && !opts.type) {\n\t\t\t\tlogger.WARN&&console.warn(\"WARN\",\"squill.Widget\",'Did you forget to provide a type?', opts);\n\t\t\t}\n\n\t\t\tif (!opts.type || typeof opts.type == 'string') {\n\t\t\t\tif (WIDGET_CLASSES[opts.type]) {\n\t\t\t\t\tvar Constructor = jsio('import ' + WIDGET_CLASSES[opts.type]);\n\t\t\t\t\tel = new Constructor(opts);\n\t\t\t\t} else if (!result) {\n\t\t\t\t\tel = new Widget(opts);\n\t\t\t\t} else {\n\t\t\t\t\tif (opts.type == 'image') {\n\t\t\t\t\t\topts = merge({tag: 'img'}, opts);\n\t\t\t\t\t}\n\t\t\t\t\tel = $(opts);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tel = new opts.type(opts);\n\t\t\t}\n\n\t\t\tif (result && opts.id && !result.hasWidget(opts.id)) {\n\t\t\t\tresult.addWidget(opts.id, el);\n\t\t\t}\n\t\t} else {\n\t\t\tel = def;\n\t\t}\n\n\t\tif (el instanceof Widget) {\n\t\t\tif (el.getWidgetParent() != this) {\n\t\t\t\tvar prevParent = el.getWidgetParent();\n\t\t\t\tif (prevParent) {\n\t\t\t\t\tprevParent.removeWidget(this);\n\t\t\t\t}\n\n\t\t\t\tel._widgetParent = this;\n\t\t\t\tif (!el.controller) {\n\t\t\t\t\tel.controller = this;\n\t\t\t\t}\n\n\t\t\t\tthis._children.push(el);\n\t\t\t}\n\n\t\t\tif (el.getParent() != parent) {\n\t\t\t\tel.setParent(parent);\n\t\t\t}\n\t\t}\n\n\t\tif (children) {\n\t\t\tif (el.buildChildren) {\n\t\t\t\tif (!result) { result = new WidgetSet(el); }\n\t\t\t\tel.buildChildren(children, null, result);\n\t\t\t} else {\n\t\t\t\tfor (var i = 0, c; c = children[i]; ++i) {\n\t\t\t\t\tthis.addWidget(c, el, result);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn el;\n\t};\n\n\tthis.removeWidget = function (widget) {\n\t\tvar index = this._children.indexOf(widget);\n\t\tif (index >= 0) {\n\t\t\tthis._children.splice(index, 1);\n\t\t}\n\t}\n\n\tthis.getContainer = function () { return this._el; };\n\tthis.getName = function () { return this._name; };\n\tthis.setName = function (name) { this._name = name; };\n\n\tthis.buildContent = function() {\n\t\tvar opts = this._opts;\n\n\t\tif (global.getWidgetPrefix() !== null) {\n\t\t\t$.addClass(this._el, global.getWidgetPrefix() + this._css);\n\t\t}\n\n\t\tif (!this.delegate) { this.delegate = new Delegate(); }\n\n\t\t// TODO: what's this doing here?\n\t\tif (opts.errorLabel) {\n\t\t\tthis._errorLabel = $.create({html: opts.errorLabel, className: global.getWidgetPrefix() + 'textInputErrorLabel', parent: this._el});\n\t\t}\n\n\t\t// def items always go on the widget\n\t\tvar def = this._def;\n\n\t\t// build each set of children separately so the parent container can\n\t\t// be checked/recomputed after each set\n\t\tif (def.children) {\n\t\t\tvar localRes = new WidgetSet(this);\n\t\t\tfor (var i = def.children.length - 1; i >= 0; --i) {\n\t\t\t\tthis.buildChildren(def.children[i], null, localRes);\n\t\t\t}\n\t\t}\n\n\t\t// primary target for opts children is the result passed in\n\t\tvar result = opts.__result || localRes || new WidgetSet(this);\n\n\t\t// opts items sometimes go on the widget\n\t\tif (opts.children) {\n\t\t\tthis.buildChildren(opts.children, null, result);\n\t\t}\n\n\t\tif (opts.data && this.setData) { bindings.parseData(this, opts.data); }\n\n\t\tthis.buildWidget(this._el, result);\n\t};\n\n\tthis.buildChildren = function (children, parent, result) {\n\t\tif (!parent) { parent = this.getContainer() || this._el; }\n\n\t\tfor (var i = 0, n = children.length; i < n; ++i) {\n\t\t\tthis.addWidget(children[i], parent, result);\n\t\t}\n\t};\n\n\tthis.buildWidget = function() {};\n\n\t// TODO: what's this doing here?\n\tthis.errors = function() {\n\t\treturn this.validators.map(function(item){\n\t\t\tif (item.isValid == false){\n\t\t\t\treturn item.message;\n\t\t\t}\n\t\t});\n\t};\n\n\t// TODO: what's this doing here?\n\tthis.validate = function() {\n\t\tvar isValid = true;\n\t\tfor (var i = 0, len = this.validators.length; i < len; ++i) {\n\t\t\tvar v = this.validators[i];\n\t\t\tisValid = isValid && (v.isValid = v.call(this));\n\t\t}\n\t\treturn (this._isValid = isValid);\n\t};\n\n\t// TODO: what's this doing here?\n\tthis._isValid = true;\n\tthis.isValid = function() { return this._isValid; }\n\tthis.validators = [];\n\n\tthis.getI18n = function(key, id) {\n\t\tvar src = key in this._opts\n\t\t\t? this._opts\n\t\t\t: i18n.get(id || this._opts.id);\n\n\t\treturn src && src[key] || '';\n\t};\n\n\tthis.getElement = function() {\n\t\tif (!this._el) { this.build(); }\n\t\treturn this._el;\n\t};\n\n\tthis.addClass = function (cls) { $.addClass(this._el, cls); }\n\tthis.removeClass = function (cls) { $.removeClass(this._el, cls); }\n\tthis.hasClass = function (cls) {\n\t\treturn (' ' + this._el.className + ' ').indexOf(cls) >= 0;\n\t}\n\tthis.toggleClass = function (cls, isToggled) {\n\t\tif (isToggled === undefined) {\n\t\t\tisToggled = !this.hasClass(cls);\n\t\t}\n\n\t\tif (isToggled) {\n\t\t\tthis.addClass(cls);\n\t\t} else {\n\t\t\tthis.removeClass(cls);\n\t\t}\n\t}\n\n\tthis.onBeforeShow = function() {\n\t\tfor (var i = 0, child; child = this._children[i]; ++i) {\n\t\t\tchild.onBeforeShow.apply(child, arguments);\n\t\t}\n\t};\n\n\tthis.onShow = function() {\n\t\tthis._isShowing = true;\n\t\tfor (var i = 0, child; child = this._children[i]; ++i) {\n\t\t\tchild.onShow.apply(child, arguments);\n\t\t}\n\t};\n\n\tthis.onBeforeHide = function() {\n\t\tfor (var i = 0, child; child = this._children[i]; ++i) {\n\t\t\tchild.onBeforeHide.apply(child, arguments);\n\t\t}\n\t};\n\n\tthis.onHide = function() {\n\t\tthis._isShowing = false;\n\t\tfor (var i = 0, child; child = this._children[i]; ++i) {\n\t\t\tchild.onHide.apply(child, arguments);\n\t\t}\n\t};\n\n\tthis.isShowing = function() { return this._isShowing; }\n\n\tthis.show = function() {\n\t\tthis.onBeforeShow();\n\n\t\tvar style = this._opts && this._opts.style;\n\t\tvar display = style && style.display != 'none' && style.display || 'block';\n\t\tif (this._el) {\n\t\t\tthis._el.style.display = display;\n\t\t}\n\n\t\tthis.onShow();\n\t};\n\n\tthis.hide = function() {\n\t\tthis.onBeforeHide();\n\t\t$.hide(this.getElement());\n\t\tthis.onHide();\n\t\treturn this;\n\t};\n\n\tthis.removeChildren = function () {\n\t\tthis._children.forEach(function (child) { child.remove(); });\n\t}\n\n\tthis.remove = function() {\n\t\tthis.onBeforeHide();\n\t\t$.remove(this.getElement());\n\t\tthis.onHide();\n\t};\n\n\tthis.getModel = function () {\n\t\treturn this.__model;\n\t}\n\n\tthis.setModel = function (path, value) {\n\t\tif (arguments.length == 1) {\n\t\t\tthis.__model.setObject(path);\n\t\t} else {\n\t\t\tthis.__model.set(path, value);\n\t\t}\n\t}\n\n\tthis.putHere = function() {\n\t\tif(!this._el) { this.build(); }\n\n\t\tvar id = 'jsioWidgetId' + (++uid);\n\t\tglobal.getTargetDocument().write('<div id=\"'+id+'\"></div>');\n\t\tsetTimeout(bind(this, _replaceNode, id), 0);\n\n\t\treturn this;\n\t};\n\n\tfunction _replaceNode(id) {\n\t\tvar el = $.id(id);\n\t\tel.parentNode.insertBefore(this._el, el);\n\t\tel.parentNode.removeChild(el);\n\t};\n\n\tthis.appendTo =\n\tthis.setParent = function(parent) {\n\t\tvar el = parent\n\t\t\t&& (parent.getContainer && parent.getContainer()\n\t\t\t\t\t|| parent.appendChild && parent\n\t\t\t\t\t|| $.id(parent));\n\n\t\tif (el) {\n\t\t\tif (!this._el) {\n\t\t\t\tthis._opts.parent = el;\n\t\t\t\tthis.build();\n\t\t\t} else {\n\t\t\t\tel.appendChild(this._el);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t};\n});\n\nvar map = {};\nvar lowerCaseMap = {}\nWidget.register = function(cls, name) {\n\tif (name in map) { throw Error(\"A widget with name '\" + name + \"' is already registered\"); }\n\tmap[name] = cls;\n\tlowerCaseMap[name.toLowerCase()] = cls;\n};\n\nWidget.get = function(name) {\n\treturn lowerCaseMap[name.toLowerCase()];\n}\n\nWidget.WidgetSet = WidgetSet;\n","pre":true},"modules/devkit-core/modules/squill/Element.js":{"path":"modules/devkit-core/modules/squill/Element.js","friendlyPath":".Element","directory":"modules/devkit-core/modules/squill/","filename":"Element.js","src":"jsio('import lib.PubSub');\njsio('from util.browser import $');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Element=__class__;var Element = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Element(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Element(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function(supr) {\n\tthis.init = function(opts) {\n\t\tthis._opts = JS.merge(opts, {\n\t\t\twin: window,\n\t\t\ttag: 'div'\n\t\t});\n\t}\n\n\tthis.build = function() {\n\t\tif (!this._el) {\n\t\t\tif (this._opts.el) {\n\t\t\t\tthis._el = this._opts.el;\n\t\t\t\t$.apply(this._el, this._opts);\n\t\t\t} else {\n\t\t\t\tthis._el = $.create(this._opts);\n\t\t\t}\n\n\t\t\tthis.buildContent();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tthis.getId = function() { return this._el && this._el.id || this._opts && this._opts.id; }\n\n\tthis.buildContent = function() {}\n\n\tthis.destroy = function() {\n\t\tif (!this._el) { return; }\n\t}\n\n\tthis.getElement = function() { return this._el || this.build()._el; }\n\n\tthis.appendChild = function(el) {\n\t\tif (!this._el) { this.build(); }\n\t\tthis._el.appendChild(el instanceof Element ? el._el : el);\n\n\t\treturn this;\n\t}\n\n\tthis.appendTo = function(el) {\n\t\tif (!this._el) { this.build(); }\n\n\t\tif (el instanceof Element) {\n\t\t\tel.appendChild(this);\n\t\t} else {\n\t\t\tel.appendChild(this._el);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tthis.setPos = function(x, y) {\n\t\tthis._el.style.x = x + 'px';\n\t\tthis._el.style.y = y + 'px';\n\t}\n\n\tthis.center = function() {\n\t\tvar dim = $(window);\n\t\tthis.setPos(Math.max(0, dim.width - this._el.offsetWidth) / 2, Math.max(0, dim.height - this._el.offsetHeight) / 2);\n\t}\n\n\tthis.remove = function() { $.remove(this._el); }\n});\n","pre":true},"modules/devkit-core/modules/squill/Events.js":{"path":"modules/devkit-core/modules/squill/Events.js","friendlyPath":".Events","directory":"modules/devkit-core/modules/squill/","filename":"Events.js","src":"jsio('from util.browser import $');\njsio('import .Drag');\njsio('import lib.PubSub');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Events=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Events(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Events(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function() {\n\tvar SLICE = Array.prototype.slice;\n\n\tvar isMobile = /(iPod|iPhone|iPad|Android)/i.test(navigator.userAgent);\n\n\tthis.event = function(el, name, handler) {\n\t\tif (!this._eventEnabled) { this._eventEnabled = {}; }\n\t\tvar args = [this, handler].concat(SLICE.call(arguments, 3)),\n\t\t\thandler = bind.apply(this, args),\n\t\t\tevents = this._eventEnabled;\n\n\t\tevents[name] = true;\n\t\t$.onEvent(el, name, function() {\n\t\t\tif (events[name]) {\n\t\t\t\treturn handler.apply(this, arguments);\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.isDragging = function() {\n\t\treturn this._isDragging || false;\n\t};\n\n\tthis.initDragEvents = function(el) {\n\t\tif (!this.__drag) {\n\t\t\tvar d = this.__drag = new Drag();\n\t\t\td.subscribe('DragStart', this, 'onDragStart');\n\t\t\td.subscribe('Drag', this, 'onDrag');\n\t\t\td.subscribe('DragStop', this, 'onDragStop');\n\t\t}\n\n\t\tvar startDrag = bind(this.__drag, 'startDrag');\n\t\tif (!el) { el = this._el; }\n\t\tif (el.addEventListener) { el.addEventListener('touchstart', startDrag, true); }\n\t\t$.onEvent(el, 'mousedown', startDrag);\n\t};\n\n\tthis.initMouseEvents = function(el) {\n\t\tel = el || this._el;\n\n\t\tif (isMobile) {\n\t\t\tthis.event(el, 'touchstart', '_onTouchStart');\n\t\t\tthis.event(el, 'touchend', '_onTouchEnd');\n\t\t} else {\n\t\t\tthis.event(el, 'mouseover', 'onMouseOver');\n\t\t\tthis.event(el, 'mousemove', 'onMouseMove');\n\t\t\tthis.event(el, 'mouseout', 'onMouseOut');\n\t\t\tthis.event(el, 'mousedown', 'onMouseDown');\n\t\t\tthis.event(el, 'mouseup', 'onMouseUp');\n\t\t\tthis.event(el, 'click', 'onClick');\n\t\t}\n\n\t\tvar opts = this._opts;\n\t\tif (opts && opts.__result) {\n\t\t\topts.__result.addSubscription(this, 'Select');\n\t\t}\n\n\t\treturn this;\n\t};\n\n\tthis.initFocusEvents = function(el) {\n\t\tel = el || this._el;\n\t\tthis.event(el, 'focus', 'onFocus');\n\t\tthis.event(el, 'blur', 'onBlur');\n\t\treturn this;\n\t};\n\n\tthis.initKeyEvents = function(el) {\n\t\tel = el || this._el;\n\t\tthis.event(el, 'keydown', 'onKeyDown');\n\t\tthis.event(el, 'keypress', 'onKeyPress');\n\t\tthis.event(el, 'keyup', 'onKeyUp');\n\t\treturn this;\n\t}\n\n\tthis._onTouchStart = function(e) {\n\t\tthis.onMouseOver(e);\n\t\tthis.onMouseDown(e);\n\t};\n\n\tthis._onTouchEnd = function(e) {\n\t\tthis.onMouseUp(e);\n\t\tthis.onClick(e);\n\t\tthis.onMouseOut(e);\n\t};\n\n\tthis.onMouseOver = function(e) {\n\t\tif (!this._enableMouseEvents)\n\t\tthis._isOver = true;\n\t\tthis.publish('Over', e);\n\t};\n\n\tthis.onMouseMove = function(e) {\n\t\tif (!this._enableMouseEvents)\n\t\tthis.publish('Move', e);\n\t};\n\n\tthis.onMouseOut = function(e) {\n\t\tthis._isOver = false;\n\t\tthis.publish('Out', e);\n\t};\n\n\tthis.onMouseDown = function(e) {\n\t\tthis._isDown = true;\n\t\tthis.publish('Down', e);\n\t\treturn false;\n\t};\n\n\tthis.onMouseUp = function(e) {\n\t\tthis._isDown = false;\n\t\tthis.publish('Up', e);\n\t\treturn false;\n\t};\n\n\tthis.onClick = function(e) {\n\t\tthis.publish('Select', e);\n\t\tthis.emit('click', e);\n\t\treturn false;\n\t};\n\n\tthis.onFocus = function(e) {\n\t\tthis._isFocused = true;\n\t\tthis.publish('Focus', e);\n\t};\n\n\tthis.onBlur = function(e) {\n\t\tthis._isFocused = false;\n\t\tthis.publish('Blur', e);\n\t};\n\n\tthis.onKeyUp = function(e) {\n\t\tthis.publish('KeyUp', e);\n\t};\n\n\tthis.onKeyPress = function(e) {\n\t\tthis.publish('KeyPress', e);\n\t};\n\n\tthis.onKeyDown = function(e) {\n\t\tthis.publish('KeyDown', e);\n\t};\n\n\tthis.onDragStart = function(dragEvt) {};\n\tthis.onDrag = function(dragEvt, moveEvt) {};\n\tthis.onDragStop = function(dragEvt, upEvt) {};\n});\n","pre":true},"modules/devkit-core/modules/squill/Drag.js":{"path":"modules/devkit-core/modules/squill/Drag.js","friendlyPath":".Drag","directory":"modules/devkit-core/modules/squill/","filename":"Drag.js","src":"jsio('import lib.PubSub');\njsio('import math.geom.Point as Point');\njsio('from util.browser import $');\n\nvar gCurrentDrag = [],\n\tgCurrentMouse = {x: 0, y: 0};\n\nfunction resolveMouse(e) {\n\tif (e.touches) { return resolveMouse(e.touches[0]); }\n\t\n\tif ('pageX' in e) {\n\t\tgCurrentMouse.x = e.pageX;\n\t\tgCurrentMouse.y = e.pageY;\n\t} else { // looks like IE\n\t\tvar doc = document.documentElement,\n\t\t\tbody = document.body;\n\t\t\n\t\tgCurrentMouse.x = e.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);\n\t\tgCurrentMouse.y = e.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop  || body && body.clientTop  || 0);\n\t}\n}\n\nvar _active = false;\n\nfunction gAddItem(item) {\n\tgRemoveItem(item);\n\tgCurrentDrag.push(item);\n\t_active = true;\n}\n\nfunction gRemoveItem(item) {\n\tfor (var i = 0; i < gCurrentDrag.length; ++i) {\n\t\tif (gCurrentDrag[i] == item) {\n\t\t\tgCurrentDrag.splice(i, 1);\n\t\t\t--i;\n\t\t}\n\t}\n\n\tif (!gCurrentDrag[0]) { _active = false; }\n}\n\nfunction onMove(e) {\n\tif (!_active) { return; }\n\n\tresolveMouse(e);\n\tfor (var i = 0; i < gCurrentDrag.length; ++i) {\n\t\tgCurrentDrag[i].onMouseMove(e);\n\t}\n\n}\n\nfunction onUp(e) {\n\tif (!_active) { return; }\n\n\tfor (var i = 0; i < gCurrentDrag.length; ++i) {\n\t\tgCurrentDrag[i].onMouseUp(e);\n\t}\n}\n\nfunction registerWindow(win) {\n\tvar doc = win.document;\n\tif ('ontouchstart' in win) {\n\t\tdoc.addEventListener('touchstart', resolveMouse, true);\n\t\tdoc.addEventListener('touchmove', onMove, true);\n\t\tdoc.addEventListener('touchend', onUp, true);\n\t} else {\n\t\tdoc.addEventListener('mousedown', resolveMouse, true);\n\t\tdoc.addEventListener('mousemove', onMove, true);\n\t\tdoc.addEventListener('mouseup', onUp, true);\n\t}\n}\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Drag=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Drag(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Drag(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function(supr) {\n\n\tthis.init = function(params) {\n\t\tthis._isActive = false;\n\t}\n\n\t// data is an optional object that will be added to dragEvt.data.\n\t// This allows the caller of startDrag to pass along arbitrary objects\n\t// to the DragStart, Drag, and DragStop events, since the receiver\n\t// can just read data off of the event object (first argument).\n\tthis.startDrag = function(params, data) {\n\t\tvar e = this._evt = new exports.DragEvent();\n\t\tthis._evt.data = data;\n\t\tthis._evt.params = merge(params, {\n\t\t\t/* addInScroll: true, */ // TODO?\n\t\t\tthreshold: 5\n\t\t});\n\n\t\te.srcPt = new Point(gCurrentMouse);\n\t\te.currPt = new Point(gCurrentMouse);\n\t\tgAddItem(this);\n\t}\n\n\tthis.onMouseMove = function (moveEvt) {\n\n\t\tvar dragEvt = this._evt;\n\t\tvar absDelta = Point.subtract(gCurrentMouse, dragEvt.srcPt);\n\n\t\tif (!this._isActive && absDelta.getMagnitude() > dragEvt.params.threshold) {\n\t\t\tthis._isActive = true;\n\n\t\t\tvar doc = moveEvt.target && (moveEvt.target.ownerDocument || moveEvt.target.nodeType == 9 && moveEvt.target);\n\t\t\tthis.disableIframes(doc);\n\t\t\tthis.publish('DragStart', dragEvt);\n\t\t}\n\n\t\tif (this._isActive) {\n\t\t\t$.stopEvent(moveEvt);\n\n\t\t\tdragEvt.prevPt = dragEvt.currPt;\n\t\t\tdragEvt.currPt = new Point(gCurrentMouse);\n\t\t\tthis.publish('Drag', dragEvt, moveEvt, Point.subtract(dragEvt.currPt, dragEvt.prevPt));\n\t\t}\n\t}\n\n\tthis.onMouseUp = function(upEvt) {\n\t\tgRemoveItem(this);\n\t\tif (this._isActive) {\n\n\t\t\t$.stopEvent(upEvt);\n\t\t\tthis._isActive = false;\n\t\t\tthis.enableIframes();\n\t\t\tthis.publish('DragStop', this._evt, upEvt);\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tthis.disableIframes = function (doc) {\n\t\tif (!this._disabledFrames) {\n\t\t\tthis._disabledFrames = [];\n\t\t}\n\n\t\t$(\"iframe\", doc).forEach(function (iframe) {\n\t\t\ttry {\n\t\t\t\tthis._disabledFrames.push({\n\t\t\t\t\tframe: iframe,\n\t\t\t\t\tpointerEvents: iframe.style.pointerEvents\n\t\t\t\t});\n\n\t\t\t\tiframe.style.pointerEvents = 'none';\n\t\t\t} catch (e) {}\n\t\t}, this);\n\t}\n\n\tthis.enableIframes = function () {\n\t\tthis._disabledFrames.splice(0, this._disabledFrames.length).forEach(function (item) {\n\t\t\titem.frame.style.pointerEvents = item.pointerEvents;\n\t\t});\n\t}\n});\n\nexports.registerWindow = registerWindow;\n\nexports.DragEvent=__class__;exports.DragEvent=exports.DragEvent(function exports_DragEvent(){return this.init&&this.init.apply(this,arguments)},function() {});\n\nvar win = window;\nregisterWindow(win);\nwhile (win.parent != win) {\n\twin = win.parent;\n\ttry {\n\t\tregisterWindow(win);\n\t} catch (e) {}\n}\n","pre":true},"modules/devkit-core/modules/squill/global.js":{"path":"modules/devkit-core/modules/squill/global.js","friendlyPath":".global","directory":"modules/devkit-core/modules/squill/","filename":"global.js","src":"var gWidgetPrefix = 'squill-';\nvar gWin = window;\nvar gDoc = document;\n\nexports.setTargetWindow = function(w) { gWin = w; gDoc = w.document; }\nexports.getTargetWindow = function() { return gWin; }\nexports.getTargetDocument = function() { return gDoc; }\n\nexports.setWidgetPrefix = function(p) { gWidgetPrefix = p; }\nexports.getWidgetPrefix = function() { return gWidgetPrefix; }\n","pre":true},"modules/devkit-core/modules/squill/i18n.js":{"path":"modules/devkit-core/modules/squill/i18n.js","friendlyPath":".i18n","directory":"modules/devkit-core/modules/squill/","filename":"i18n.js","src":"var gLang = null;\n\nexports.setLang = function(lang) { gLang = lang; }\nexports.get = function(key) {\n\treturn gLang && gLang.get(key);\n}\n\nexports.Language=__class__;exports.Language=exports.Language(function exports_Language(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(dict) { this._dict = dict; }\n\tthis.add = function(key, value) { this._dict[key] = value; }\n\tthis.get = function(key) { return this._dict[key]; }\n});\n","pre":true},"modules/devkit-core/modules/squill/Delegate.js":{"path":"modules/devkit-core/modules/squill/Delegate.js","friendlyPath":".Delegate","directory":"modules/devkit-core/modules/squill/","filename":"Delegate.js","src":"var Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Delegate=__class__;var Delegate = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Delegate(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Delegate(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(def) {\n\t\tdef && def(this);\n\t}\n\t\n\tthis.extend = function(def) {\n\t\tvar delegate = new Delegate(def);\n\t\tdelegate.parent = this;\n\t\treturn delegate;\n\t}\n\t\n\tthis.call = function(ctx, name) {\n\t\tif (this[name]) {\n\t\t\treturn this[name].apply(ctx, Array.prototype.slice.call(arguments, 1));\n\t\t} else if (this.parent) {\n\t\t\tthis.parent.call(ctx, name);\n\t\t}\n\t}\n});\n","pre":true},"modules/devkit-core/modules/squill/models/Model.js":{"path":"modules/devkit-core/modules/squill/models/Model.js","friendlyPath":".models.Model","directory":"modules/devkit-core/modules/squill/models/","filename":"Model.js","src":"jsio('import lib.PubSub');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_models_Model=__class__;var Model = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_models_Model(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_models_Model(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function (supr) {\n\n  this.init = function (opts) {\n    var obj;\n\n    this._data = {};\n\n    if (opts && opts.localStorage) {\n      this._storageKey = opts.localStorage;\n      var raw = localStorage.getItem(this._storageKey);\n      if (raw) {\n        try {\n          obj = JSON.parse(raw);\n        } catch (e) {}\n      }\n    }\n\n    this.setObject(obj || {});\n\n    if (opts) {\n      // initial values\n      if (opts.values) {\n        Object.keys(opts.values).forEach(function (key) {\n          this.set(key, opts.values[key]);\n        }, this);\n      }\n\n      // default values\n      if (opts.defaults) {\n        Object.keys(opts.defaults).forEach(function (key) {\n          if (!this.has(key)) {\n            this.set(key, opts.defaults[key]);\n          }\n        }, this);\n      }\n    }\n  }\n\n  this.setObject = function (obj) {\n    this._data = obj;\n    this.emit();\n    this.persist();\n    return this;\n  }\n\n  this.toObject = function () {\n    return copy(this._data);\n  }\n\n  function copy(obj) {\n    return JSON.parse(JSON.stringify(obj));\n  }\n\n  this.clone = function () {\n    return new Model(this.getObject());\n  }\n\n  var PATH_SEP = /[\\[.,]/;\n  function parsePath(path) {\n    return path.split(PATH_SEP).map(function (piece) {\n      return piece[piece.length - 1] == ']' ? parseInt(piece) : piece;\n    });\n  }\n\n  function matchPath(p1, p2) {\n    return p1.indexOf(p2) == 0 || p2.indexOf(p1) == 0;\n  }\n\n  this.has = function (path) { return this.get(path) !== undefined; }\n\n  this.get = function (path) {\n    var segments = parsePath(path);\n    var n = segments.length;\n    var i = 0;\n    var o = this._data;\n    while (o && i < n) {\n      o = o[segments[i++]];\n    }\n\n    return o;\n  }\n\n  this.getObject = function (path) {\n    return copy(this.get(path) || {});\n  }\n\n  this.set = function (path, value) {\n    var segments = parsePath(path);\n    var n = segments.length - 1;\n    var i = 0;\n    var o = this._data;\n    while (o && i < n) {\n      var s = segments[i++];\n      if (!o[s]) {\n        o[s] = typeof segments[i] == 'number' ? [] : {};\n      }\n\n      o = o[s];\n    }\n\n    var prevValue = o[segments[n]];\n    if (value != prevValue) {\n      o[segments[n]] = value;\n      this.emit(path, value);\n    }\n\n    this.persist();\n    return this;\n  }\n\n  this.emit = function (path, value) {\n    if (path) {\n      supr(this, 'emit', arguments);\n    }\n\n    if (this._subscribers) {\n      Object.keys(this._subscribers).forEach(function (key) {\n        if (!path || key != path && matchPath(key, path)) {\n          supr(this, 'emit', [key, this.get(key)]);\n        }\n      }, this);\n    }\n    return this;\n  }\n\n  this.persist = function () {\n    if (this._storageKey) {\n      localStorage.setItem(this._storageKey, JSON.stringify(this._data));\n    }\n    return this;\n  }\n});\n","pre":true},"modules/devkit-core/modules/squill/models/bindings.js":{"path":"modules/devkit-core/modules/squill/models/bindings.js","friendlyPath":"squill.models.bindings","directory":"modules/devkit-core/modules/squill/models/","filename":"bindings.js","src":"var RE_BINDING = /(^|[^%])%\\((.*?)\\)([ +0-]?)(\\d*)(\\.?\\d*)([dfcs])/g;\n\nexports.parseFormat = function (widget, format) {\n  var subs = [];\n  format.replace(RE_BINDING, function (match, prefix, key, pad, minLength, decimal, type, index) {\n    subs.push({\n      index: index + prefix.length,\n      endIndex: index + match.length,\n      key: key,\n      pad: pad || ' ',\n      minLength: parseInt(minLength),\n      decimal: parseInt(decimal.substring(1)),\n      type: type,\n      value: ''\n    });\n  });\n\n  subs.reverse();\n  new Binding(widget, null, format, subs);\n}\n\nexports.parseData = function (widget, data) {\n  new Binding(widget, data);\n}\n\nBinding=__class__;var Binding=Binding(function Binding(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function (widget, key, src, subs) {\n\n    var res = widget.getOpts().__result;\n    var baseWidget = res && res.getTarget() || widget;\n\n    this._widget = widget;\n    this._key = key;\n    this._src = src;\n    this._subs = subs;\n\n    this._connect(baseWidget.getModel());\n\n    //  else if (widget.setEnabled && widget.isEnabled && widget.isEnabled()) {\n    //   // disable input until the model is backing it\n    //   this._isDisabled = true;\n    //   widget.setEnabled(false);\n    // }\n\n    widget.on('change', bind(this, '_updateModel'));\n    baseWidget.on('model', bind(this, '_connect'));\n  }\n\n  this._connect = function (model) {\n    if (this._model) { this._disconnect(); }\n    this._model = model;\n\n    // this._widget.setEnabled(true);\n\n    if (this._subs) {\n      this._subs.forEach(function (sub) {\n        sub.value = model.get(sub.key);\n        model.subscribe(sub.key, this, '_update', sub.key);\n      }, this);\n\n      this._update();\n    } else if (this._key) {\n      model.subscribe(this._key, this, '_updateKey');\n      this._updateKey(model.get(this._key));\n    }\n  }\n\n  this._disconnect = function () {\n    var model = this._model;\n    this._subs && this._subs.forEach(function (sub) {\n      model.unsubscribe(sub.key, this);\n    }, this);\n\n    this._key && model.unsubscribe(this._key, this);\n  }\n\n  this._update = function (key, value) {\n    var str = this._src;\n    this._subs.forEach(function (sub) {\n      if (key && sub.key == key) { sub.value = value; }\n      str = str.substring(0, sub.index) + sub.value + str.substring(sub.endIndex);\n    }, this);\n\n    this._widget.setData(str);\n  }\n\n  this._updateKey = function (value) {\n    this._widget.setData(value);\n  }\n\n  this._updateModel = function (value) {\n    if (this._model && this._key) {\n      this._model.set(this._key, value);\n    }\n  }\n});\n\n/*\n\nvar bindings = require('./bindings');\nbindings.parseFormat({}, \"Hello world %(format.this) 4d %(format.that)06.2f\")\n\n*/\n","pre":true},"modules/devkit-core/modules/squill/__imports__.js":{"path":"modules/devkit-core/modules/squill/__imports__.js","friendlyPath":".__imports__","directory":"modules/devkit-core/modules/squill/","filename":"__imports__.js","pre":true,"src":"exports.classes = {\n\talpha: '.Alpha',\n\tlabel: '.Label',\n\tlist: '.List',\n\tbutton: '.TextButton',\n\ttext: '.TextInput',\n\ttextarea: '.TextArea',\n\tpassword: '.TextInput',\n\tscroller: '.Scroller',\n\tcanvas: '.Canvas',\n\tcheckbox: '.CheckBox',\n\tmenu: '.Menu',\n\tslider: '.Slider',\n\tcolor: '.Color',\n\tvcenter: '.VerticalCenter',\n\ttreelist: '.TreeList',\n\tgraph: '.Graph',\n\tselect: '.SelectBox',\n\twidget: '.Widget'\n};\n\n\nexports.resolve = function(env, opts) {\n\tvar imports = [];\n\n\tif (env == 'browser') {\n\t\tfor (var key in exports.classes) {\n\t\t\timports.push(exports.classes[key]);\n\t\t}\n\t}\n\n\treturn imports;\n}\n"},"modules/devkit-core/modules/squill/jscolor/jscolor.js":{"path":"modules/devkit-core/modules/squill/jscolor/jscolor.js","friendlyPath":".jscolor.jscolor","directory":"modules/devkit-core/modules/squill/jscolor/","filename":"jscolor.js","src":"/**\n * jscolor, JavaScript Color Picker\n *\n * @version 1.3.11\n * @license GNU Lesser General Public License, http://www.gnu.org/copyleft/lesser.html\n * @author  Jan Odvarko, http://odvarko.cz\n * @created 2008-06-15\n * @updated 2011-11-07\n * @link    http://jscolor.com\n */\n\n\nvar jscolor = {\n\n\n\tdir : '', // location of jscolor directory (leave empty to autodetect)\n\tbindClass : 'color', // class name\n\tbinding : true, // automatic binding via <input class=\"...\">\n\tpreloading : true, // use image preloading?\n\n\n\tinstall : function() {\n\t\tjscolor.addEvent(window, 'load', jscolor.init);\n\t},\n\n\n\tinit : function() {\n\t\tif(jscolor.binding) {\n\t\t\tjscolor.bind();\n\t\t}\n\t\tif(jscolor.preloading) {\n\t\t\tjscolor.preload();\n\t\t}\n\t},\n\n\n\tgetDir : function() {\n\t\t/*\n\t\tif(!jscolor.dir) {\n\t\t\tvar detected = jscolor.detectDir();\n\t\t\tjscolor.dir = detected!==false ? detected : 'jscolor/';\n\t\t}\n\t\t*/\n\t\tjscolor.dir = 'images/colorpicker/'\n\t\treturn jscolor.dir;\n\t},\n\n\n\tdetectDir : function() {\n\t\tvar base = location.href;\n\n\t\tvar e = document.getElementsByTagName('base');\n\t\tfor(var i=0; i<e.length; i+=1) {\n\t\t\tif(e[i].href) { base = e[i].href; }\n\t\t}\n\n\t\tvar e = document.getElementsByTagName('script');\n\t\tfor(var i=0; i<e.length; i+=1) {\n\t\t\tif(e[i].src && /(^|\\/)jscolor\\.js([?#].*)?$/i.test(e[i].src)) {\n\t\t\t\tvar src = new jscolor.URI(e[i].src);\n\t\t\t\tvar srcAbs = src.toAbsolute(base);\n\t\t\t\tsrcAbs.path = srcAbs.path.replace(/[^\\/]+$/, ''); // remove filename\n\t\t\t\tsrcAbs.query = null;\n\t\t\t\tsrcAbs.fragment = null;\n\t\t\t\treturn srcAbs.toString();\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t},\n\n\n\tbind : function(element) {\n\t\t/*\n\t\tvar matchClass = new RegExp('(^|\\\\s)('+jscolor.bindClass+')\\\\s*(\\\\{[^}]*\\\\})?', 'i');\n\t\tvar e = document.getElementsByTagName('input');\n\t\tfor(var i=0; i<e.length; i+=1) {\n\t\t\tvar m;\n\t\t\tif(!e[i].color && e[i].className && (m = e[i].className.match(matchClass))) {\n\t\t\t\tvar prop = {};\n\t\t\t\tif(m[3]) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\teval('prop='+m[3]);\n\t\t\t\t\t} catch(eInvalidProp) {}\n\t\t\t\t}\n\t\t\t\te[i].color = new jscolor.color(e[i], prop);\n\t\t\t}\n\t\t}\n\t\t*/\n\t\telement.color = new jscolor.color(element, {});\n\t},\n\n\n\tpreload : function() {\n\t\tfor(var fn in jscolor.imgRequire) {\n\t\t\tif(jscolor.imgRequire.hasOwnProperty(fn)) {\n\t\t\t\tjscolor.loadImage(fn);\n\t\t\t}\n\t\t}\n\t},\n\n\n\timages : {\n\t\tpad : [ 181, 101 ],\n\t\tsld : [ 16, 101 ],\n\t\tcross : [ 15, 15 ],\n\t\tarrow : [ 7, 11 ]\n\t},\n\n\n\timgRequire : {},\n\timgLoaded : {},\n\n\n\trequireImage : function(filename) {\n\t\tjscolor.imgRequire[filename] = true;\n\t},\n\n\n\tloadImage : function(filename) {\n\t\tif(!jscolor.imgLoaded[filename]) {\n\t\t\tjscolor.imgLoaded[filename] = new Image();\n\t\t\tjscolor.imgLoaded[filename].src = jscolor.getDir()+filename;\n\t\t}\n\t},\n\n\n\tfetchElement : function(mixed) {\n\t\treturn typeof mixed === 'string' ? document.getElementById(mixed) : mixed;\n\t},\n\n\n\taddEvent : function(el, evnt, func) {\n\t\tif(el.addEventListener) {\n\t\t\tel.addEventListener(evnt, func, false);\n\t\t} else if(el.attachEvent) {\n\t\t\tel.attachEvent('on'+evnt, func);\n\t\t}\n\t},\n\n\n\tfireEvent : function(el, evnt) {\n\t\tif(!el) {\n\t\t\treturn;\n\t\t}\n\t\tif(document.createEvent) {\n\t\t\tvar ev = document.createEvent('HTMLEvents');\n\t\t\tev.initEvent(evnt, true, true);\n\t\t\tel.dispatchEvent(ev);\n\t\t} else if(document.createEventObject) {\n\t\t\tvar ev = document.createEventObject();\n\t\t\tel.fireEvent('on'+evnt, ev);\n\t\t} else if(el['on'+evnt]) { // alternatively use the traditional event model (IE5)\n\t\t\tel['on'+evnt]();\n\t\t}\n\t},\n\n\n\tgetElementPos : function(e) {\n\t\tvar e1=e, e2=e;\n\t\tvar x=0, y=0;\n\t\tif(e1.offsetParent) {\n\t\t\tdo {\n\t\t\t\tx += e1.offsetLeft;\n\t\t\t\ty += e1.offsetTop;\n\t\t\t} while(e1 = e1.offsetParent);\n\t\t}\n\t\twhile((e2 = e2.parentNode) && e2.nodeName.toUpperCase() !== 'BODY') {\n\t\t\tx -= e2.scrollLeft;\n\t\t\ty -= e2.scrollTop;\n\t\t}\n\t\treturn [x, y];\n\t},\n\n\n\tgetElementSize : function(e) {\n\t\treturn [e.offsetWidth, e.offsetHeight];\n\t},\n\n\n\tgetRelMousePos : function(e) {\n\t\tvar x = 0, y = 0;\n\t\tif (!e) { e = window.event; }\n\t\tif (typeof e.offsetX === 'number') {\n\t\t\tx = e.offsetX;\n\t\t\ty = e.offsetY;\n\t\t} else if (typeof e.layerX === 'number') {\n\t\t\tx = e.layerX;\n\t\t\ty = e.layerY;\n\t\t}\n\t\treturn { x: x, y: y };\n\t},\n\n\n\tgetViewPos : function() {\n\t\tif(typeof window.pageYOffset === 'number') {\n\t\t\treturn [window.pageXOffset, window.pageYOffset];\n\t\t} else if(document.body && (document.body.scrollLeft || document.body.scrollTop)) {\n\t\t\treturn [document.body.scrollLeft, document.body.scrollTop];\n\t\t} else if(document.documentElement && (document.documentElement.scrollLeft || document.documentElement.scrollTop)) {\n\t\t\treturn [document.documentElement.scrollLeft, document.documentElement.scrollTop];\n\t\t} else {\n\t\t\treturn [0, 0];\n\t\t}\n\t},\n\n\n\tgetViewSize : function() {\n\t\tif(typeof window.innerWidth === 'number') {\n\t\t\treturn [window.innerWidth, window.innerHeight];\n\t\t} else if(document.body && (document.body.clientWidth || document.body.clientHeight)) {\n\t\t\treturn [document.body.clientWidth, document.body.clientHeight];\n\t\t} else if(document.documentElement && (document.documentElement.clientWidth || document.documentElement.clientHeight)) {\n\t\t\treturn [document.documentElement.clientWidth, document.documentElement.clientHeight];\n\t\t} else {\n\t\t\treturn [0, 0];\n\t\t}\n\t},\n\n\n\tURI : function(uri) { // See RFC3986\n\n\t\tthis.scheme = null;\n\t\tthis.authority = null;\n\t\tthis.path = '';\n\t\tthis.query = null;\n\t\tthis.fragment = null;\n\n\t\tthis.parse = function(uri) {\n\t\t\tvar m = uri.match(/^(([A-Za-z][0-9A-Za-z+.-]*)(:))?((\\/\\/)([^\\/?#]*))?([^?#]*)((\\?)([^#]*))?((#)(.*))?/);\n\t\t\tthis.scheme = m[3] ? m[2] : null;\n\t\t\tthis.authority = m[5] ? m[6] : null;\n\t\t\tthis.path = m[7];\n\t\t\tthis.query = m[9] ? m[10] : null;\n\t\t\tthis.fragment = m[12] ? m[13] : null;\n\t\t\treturn this;\n\t\t};\n\n\t\tthis.toString = function() {\n\t\t\tvar result = '';\n\t\t\tif(this.scheme !== null) { result = result + this.scheme + ':'; }\n\t\t\tif(this.authority !== null) { result = result + '//' + this.authority; }\n\t\t\tif(this.path !== null) { result = result + this.path; }\n\t\t\tif(this.query !== null) { result = result + '?' + this.query; }\n\t\t\tif(this.fragment !== null) { result = result + '#' + this.fragment; }\n\t\t\treturn result;\n\t\t};\n\n\t\tthis.toAbsolute = function(base) {\n\t\t\tvar base = new jscolor.URI(base);\n\t\t\tvar r = this;\n\t\t\tvar t = new jscolor.URI;\n\n\t\t\tif(base.scheme === null) { return false; }\n\n\t\t\tif(r.scheme !== null && r.scheme.toLowerCase() === base.scheme.toLowerCase()) {\n\t\t\t\tr.scheme = null;\n\t\t\t}\n\n\t\t\tif(r.scheme !== null) {\n\t\t\t\tt.scheme = r.scheme;\n\t\t\t\tt.authority = r.authority;\n\t\t\t\tt.path = removeDotSegments(r.path);\n\t\t\t\tt.query = r.query;\n\t\t\t} else {\n\t\t\t\tif(r.authority !== null) {\n\t\t\t\t\tt.authority = r.authority;\n\t\t\t\t\tt.path = removeDotSegments(r.path);\n\t\t\t\t\tt.query = r.query;\n\t\t\t\t} else {\n\t\t\t\t\tif(r.path === '') { // TODO: == or === ?\n\t\t\t\t\t\tt.path = base.path;\n\t\t\t\t\t\tif(r.query !== null) {\n\t\t\t\t\t\t\tt.query = r.query;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tt.query = base.query;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(r.path.substr(0,1) === '/') {\n\t\t\t\t\t\t\tt.path = removeDotSegments(r.path);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif(base.authority !== null && base.path === '') { // TODO: == or === ?\n\t\t\t\t\t\t\t\tt.path = '/'+r.path;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tt.path = base.path.replace(/[^\\/]+$/,'')+r.path;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tt.path = removeDotSegments(t.path);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tt.query = r.query;\n\t\t\t\t\t}\n\t\t\t\t\tt.authority = base.authority;\n\t\t\t\t}\n\t\t\t\tt.scheme = base.scheme;\n\t\t\t}\n\t\t\tt.fragment = r.fragment;\n\n\t\t\treturn t;\n\t\t};\n\n\t\tfunction removeDotSegments(path) {\n\t\t\tvar out = '';\n\t\t\twhile(path) {\n\t\t\t\tif(path.substr(0,3)==='../' || path.substr(0,2)==='./') {\n\t\t\t\t\tpath = path.replace(/^\\.+/,'').substr(1);\n\t\t\t\t} else if(path.substr(0,3)==='/./' || path==='/.') {\n\t\t\t\t\tpath = '/'+path.substr(3);\n\t\t\t\t} else if(path.substr(0,4)==='/../' || path==='/..') {\n\t\t\t\t\tpath = '/'+path.substr(4);\n\t\t\t\t\tout = out.replace(/\\/?[^\\/]*$/, '');\n\t\t\t\t} else if(path==='.' || path==='..') {\n\t\t\t\t\tpath = '';\n\t\t\t\t} else {\n\t\t\t\t\tvar rm = path.match(/^\\/?[^\\/]*/)[0];\n\t\t\t\t\tpath = path.substr(rm.length);\n\t\t\t\t\tout = out + rm;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn out;\n\t\t}\n\n\t\tif(uri) {\n\t\t\tthis.parse(uri);\n\t\t}\n\n\t},\n\n\n\t/*\n\t * Usage example:\n\t * var myColor = new jscolor.color(myInputElement)\n\t */\n\n\tcolor : function(target, prop) {\n\n\n\t\tthis.required = true; // refuse empty values?\n\t\tthis.adjust = true; // adjust value to uniform notation?\n\t\tthis.hash = false; // prefix color with # symbol?\n\t\tthis.caps = true; // uppercase?\n\t\tthis.slider = true; // show the value/saturation slider?\n\t\tthis.valueElement = target; // value holder\n\t\tthis.styleElement = target; // where to reflect current color\n\t\tthis.onImmediateChange = null; // onchange callback (can be either string or function)\n\t\tthis.hsv = [0, 0, 1]; // read-only  0-6, 0-1, 0-1\n\t\tthis.rgb = [1, 1, 1]; // read-only  0-1, 0-1, 0-1\n\n\t\tthis.pickerOnfocus = true; // display picker on focus?\n\t\tthis.pickerMode = 'HSV'; // HSV | HVS\n\t\tthis.pickerPosition = 'bottom'; // left | right | top | bottom\n\t\tthis.pickerSmartPosition = true; // automatically adjust picker position when necessary\n\t\tthis.pickerButtonHeight = 20; // px\n\t\tthis.pickerClosable = false;\n\t\tthis.pickerCloseText = 'Close';\n\t\tthis.pickerButtonColor = 'ButtonText'; // px\n\t\tthis.pickerFace = 10; // px\n\t\tthis.pickerFaceColor = 'ThreeDFace'; // CSS color\n\t\tthis.pickerBorder = 1; // px\n\t\tthis.pickerBorderColor = 'ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight'; // CSS color\n\t\tthis.pickerInset = 1; // px\n\t\tthis.pickerInsetColor = 'ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow'; // CSS color\n\t\tthis.pickerZIndex = 10000;\n\n\n\t\tfor(var p in prop) {\n\t\t\tif(prop.hasOwnProperty(p)) {\n\t\t\t\tthis[p] = prop[p];\n\t\t\t}\n\t\t}\n\n\n\t\tthis.hidePicker = function() {\n\t\t\tif(isPickerOwner()) {\n\t\t\t\tremovePicker();\n\t\t\t}\n\t\t};\n\n\n\t\tthis.showPicker = function() {\n\t\t\tif(!isPickerOwner()) {\n\t\t\t\tvar tp = jscolor.getElementPos(target); // target pos\n\t\t\t\tvar ts = jscolor.getElementSize(target); // target size\n\t\t\t\tvar vp = jscolor.getViewPos(); // view pos\n\t\t\t\tvar vs = jscolor.getViewSize(); // view size\n\t\t\t\tvar ps = getPickerDims(this); // picker size\n\t\t\t\tvar a, b, c;\n\t\t\t\tswitch(this.pickerPosition.toLowerCase()) {\n\t\t\t\t\tcase 'left': a=1; b=0; c=-1; break;\n\t\t\t\t\tcase 'right':a=1; b=0; c=1; break;\n\t\t\t\t\tcase 'top':  a=0; b=1; c=-1; break;\n\t\t\t\t\tdefault:     a=0; b=1; c=1; break;\n\t\t\t\t}\n\t\t\t\tvar l = (ts[b]+ps[b])/2;\n\n\t\t\t\t// picker pos\n\t\t\t\tif (!this.pickerSmartPosition) {\n\t\t\t\t\tvar pp = [\n\t\t\t\t\t\ttp[a],\n\t\t\t\t\t\ttp[b]+ts[b]-l+l*c\n\t\t\t\t\t];\n\t\t\t\t} else {\n\t\t\t\t\tvar pp = [\n\t\t\t\t\t\t-vp[a]+tp[a]+ps[a] > vs[a] ?\n\t\t\t\t\t\t\t(-vp[a]+tp[a]+ts[a]/2 > vs[a]/2 && tp[a]+ts[a]-ps[a] >= 0 ? tp[a]+ts[a]-ps[a] : tp[a]) :\n\t\t\t\t\t\t\ttp[a],\n\t\t\t\t\t\t-vp[b]+tp[b]+ts[b]+ps[b]-l+l*c > vs[b] ?\n\t\t\t\t\t\t\t(-vp[b]+tp[b]+ts[b]/2 > vs[b]/2 && tp[b]+ts[b]-l-l*c >= 0 ? tp[b]+ts[b]-l-l*c : tp[b]+ts[b]-l+l*c) :\n\t\t\t\t\t\t\t(tp[b]+ts[b]-l+l*c >= 0 ? tp[b]+ts[b]-l+l*c : tp[b]+ts[b]-l-l*c)\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t\tdrawPicker(pp[a], pp[b]);\n\t\t\t}\n\t\t};\n\n\n\t\tthis.importColor = function() {\n\t\t\tif(!valueElement) {\n\t\t\t\tthis.exportColor();\n\t\t\t} else {\n\t\t\t\tif(!this.adjust) {\n\t\t\t\t\tif(!this.fromString(valueElement.value, leaveValue)) {\n\t\t\t\t\t\tstyleElement.style.backgroundColor = styleElement.jscStyle.backgroundColor;\n\t\t\t\t\t\tstyleElement.style.color = styleElement.jscStyle.color;\n\t\t\t\t\t\tthis.exportColor(leaveValue | leaveStyle);\n\t\t\t\t\t}\n\t\t\t\t} else if(!this.required && /^\\s*$/.test(valueElement.value)) {\n\t\t\t\t\tvalueElement.value = '';\n\t\t\t\t\tstyleElement.style.backgroundColor = styleElement.jscStyle.backgroundColor;\n\t\t\t\t\tstyleElement.style.color = styleElement.jscStyle.color;\n\t\t\t\t\tthis.exportColor(leaveValue | leaveStyle);\n\n\t\t\t\t} else if(this.fromString(valueElement.value)) {\n\t\t\t\t\t// OK\n\t\t\t\t} else {\n\t\t\t\t\tthis.exportColor();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\n\t\tthis.exportColor = function(flags) {\n\t\t\tif(!(flags & leaveValue) && valueElement) {\n\t\t\t\tvar value = this.toString();\n\t\t\t\tif(this.caps) { value = value.toUpperCase(); }\n\t\t\t\tif(this.hash) { value = '#'+value; }\n\t\t\t\tvalueElement.value = value;\n\t\t\t}\n\t\t\tif(!(flags & leaveStyle) && styleElement) {\n\t\t\t\tstyleElement.style.backgroundColor =\n\t\t\t\t\t'#'+this.toString();\n\t\t\t\tstyleElement.style.color =\n\t\t\t\t\t0.213 * this.rgb[0] +\n\t\t\t\t\t0.715 * this.rgb[1] +\n\t\t\t\t\t0.072 * this.rgb[2]\n\t\t\t\t\t< 0.5 ? '#FFF' : '#000';\n\t\t\t}\n\t\t\tif(!(flags & leavePad) && isPickerOwner()) {\n\t\t\t\tredrawPad();\n\t\t\t}\n\t\t\tif(!(flags & leaveSld) && isPickerOwner()) {\n\t\t\t\tredrawSld();\n\t\t\t}\n\t\t};\n\n\n\t\tthis.fromHSV = function(h, s, v, flags) { // null = don't change\n\t\t\th<0 && (h=0) || h>6 && (h=6);\n\t\t\ts<0 && (s=0) || s>1 && (s=1);\n\t\t\tv<0 && (v=0) || v>1 && (v=1);\n\t\t\tthis.rgb = HSV_RGB(\n\t\t\t\th===null ? this.hsv[0] : (this.hsv[0]=h),\n\t\t\t\ts===null ? this.hsv[1] : (this.hsv[1]=s),\n\t\t\t\tv===null ? this.hsv[2] : (this.hsv[2]=v)\n\t\t\t);\n\t\t\tthis.exportColor(flags);\n\t\t};\n\n\n\t\tthis.fromRGB = function(r, g, b, flags) { // null = don't change\n\t\t\tr<0 && (r=0) || r>1 && (r=1);\n\t\t\tg<0 && (g=0) || g>1 && (g=1);\n\t\t\tb<0 && (b=0) || b>1 && (b=1);\n\t\t\tvar hsv = RGB_HSV(\n\t\t\t\tr===null ? this.rgb[0] : (this.rgb[0]=r),\n\t\t\t\tg===null ? this.rgb[1] : (this.rgb[1]=g),\n\t\t\t\tb===null ? this.rgb[2] : (this.rgb[2]=b)\n\t\t\t);\n\t\t\tif(hsv[0] !== null) {\n\t\t\t\tthis.hsv[0] = hsv[0];\n\t\t\t}\n\t\t\tif(hsv[2] !== 0) {\n\t\t\t\tthis.hsv[1] = hsv[1];\n\t\t\t}\n\t\t\tthis.hsv[2] = hsv[2];\n\t\t\tthis.exportColor(flags);\n\t\t};\n\n\n\t\tthis.fromString = function(hex, flags) {\n\t\t\tvar m = hex.match(/^\\W*([0-9A-F]{3}([0-9A-F]{3})?)\\W*$/i);\n\t\t\tif(!m) {\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tif(m[1].length === 6) { // 6-char notation\n\t\t\t\t\tthis.fromRGB(\n\t\t\t\t\t\tparseInt(m[1].substr(0,2),16) / 255,\n\t\t\t\t\t\tparseInt(m[1].substr(2,2),16) / 255,\n\t\t\t\t\t\tparseInt(m[1].substr(4,2),16) / 255,\n\t\t\t\t\t\tflags\n\t\t\t\t\t);\n\t\t\t\t} else { // 3-char notation\n\t\t\t\t\tthis.fromRGB(\n\t\t\t\t\t\tparseInt(m[1].charAt(0)+m[1].charAt(0),16) / 255,\n\t\t\t\t\t\tparseInt(m[1].charAt(1)+m[1].charAt(1),16) / 255,\n\t\t\t\t\t\tparseInt(m[1].charAt(2)+m[1].charAt(2),16) / 255,\n\t\t\t\t\t\tflags\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t};\n\n\n\t\tthis.toString = function() {\n\t\t\treturn (\n\t\t\t\t(0x100 | Math.round(255*this.rgb[0])).toString(16).substr(1) +\n\t\t\t\t(0x100 | Math.round(255*this.rgb[1])).toString(16).substr(1) +\n\t\t\t\t(0x100 | Math.round(255*this.rgb[2])).toString(16).substr(1)\n\t\t\t);\n\t\t};\n\n\n\t\tfunction RGB_HSV(r, g, b) {\n\t\t\tvar n = Math.min(Math.min(r,g),b);\n\t\t\tvar v = Math.max(Math.max(r,g),b);\n\t\t\tvar m = v - n;\n\t\t\tif(m === 0) { return [ null, 0, v ]; }\n\t\t\tvar h = r===n ? 3+(b-g)/m : (g===n ? 5+(r-b)/m : 1+(g-r)/m);\n\t\t\treturn [ h===6?0:h, m/v, v ];\n\t\t}\n\n\n\t\tfunction HSV_RGB(h, s, v) {\n\t\t\tif(h === null) { return [ v, v, v ]; }\n\t\t\tvar i = Math.floor(h);\n\t\t\tvar f = i%2 ? h-i : 1-(h-i);\n\t\t\tvar m = v * (1 - s);\n\t\t\tvar n = v * (1 - s*f);\n\t\t\tswitch(i) {\n\t\t\t\tcase 6:\n\t\t\t\tcase 0: return [v,n,m];\n\t\t\t\tcase 1: return [n,v,m];\n\t\t\t\tcase 2: return [m,v,n];\n\t\t\t\tcase 3: return [m,n,v];\n\t\t\t\tcase 4: return [n,m,v];\n\t\t\t\tcase 5: return [v,m,n];\n\t\t\t}\n\t\t}\n\n\n\t\tfunction removePicker() {\n\t\t\tdelete jscolor.picker.owner;\n\t\t\tdocument.getElementsByTagName('body')[0].removeChild(jscolor.picker.boxB);\n\t\t}\n\n\n\t\tfunction drawPicker(x, y) {\n\t\t\tif(!jscolor.picker) {\n\t\t\t\tjscolor.picker = {\n\t\t\t\t\tbox : document.createElement('div'),\n\t\t\t\t\tboxB : document.createElement('div'),\n\t\t\t\t\tpad : document.createElement('div'),\n\t\t\t\t\tpadB : document.createElement('div'),\n\t\t\t\t\tpadM : document.createElement('div'),\n\t\t\t\t\tsld : document.createElement('div'),\n\t\t\t\t\tsldB : document.createElement('div'),\n\t\t\t\t\tsldM : document.createElement('div'),\n\t\t\t\t\tbtn : document.createElement('div'),\n\t\t\t\t\tbtnS : document.createElement('span'),\n\t\t\t\t\tbtnT : document.createTextNode(THIS.pickerCloseText)\n\t\t\t\t};\n\t\t\t\tfor(var i=0,segSize=4; i<jscolor.images.sld[1]; i+=segSize) {\n\t\t\t\t\tvar seg = document.createElement('div');\n\t\t\t\t\tseg.style.height = segSize+'px';\n\t\t\t\t\tseg.style.fontSize = '1px';\n\t\t\t\t\tseg.style.lineHeight = '0';\n\t\t\t\t\tjscolor.picker.sld.appendChild(seg);\n\t\t\t\t}\n\t\t\t\tjscolor.picker.sldB.appendChild(jscolor.picker.sld);\n\t\t\t\tjscolor.picker.box.appendChild(jscolor.picker.sldB);\n\t\t\t\tjscolor.picker.box.appendChild(jscolor.picker.sldM);\n\t\t\t\tjscolor.picker.padB.appendChild(jscolor.picker.pad);\n\t\t\t\tjscolor.picker.box.appendChild(jscolor.picker.padB);\n\t\t\t\tjscolor.picker.box.appendChild(jscolor.picker.padM);\n\t\t\t\tjscolor.picker.btnS.appendChild(jscolor.picker.btnT);\n\t\t\t\tjscolor.picker.btn.appendChild(jscolor.picker.btnS);\n\t\t\t\tjscolor.picker.box.appendChild(jscolor.picker.btn);\n\t\t\t\tjscolor.picker.boxB.appendChild(jscolor.picker.box);\n\t\t\t}\n\n\t\t\tvar p = jscolor.picker;\n\n\t\t\t// controls interaction\n\t\t\tp.box.onmouseup =\n\t\t\tp.box.onmouseout = function() { target.focus(); };\n\t\t\tp.box.onmousedown = function() { abortBlur=true; };\n\t\t\tp.box.onmousemove = function(e) {\n\t\t\t\tif (holdPad || holdSld) {\n\t\t\t\t\tholdPad && setPad(e);\n\t\t\t\t\tholdSld && setSld(e);\n\t\t\t\t\tif (document.selection) {\n\t\t\t\t\t\tdocument.selection.empty();\n\t\t\t\t\t} else if (window.getSelection) {\n\t\t\t\t\t\twindow.getSelection().removeAllRanges();\n\t\t\t\t\t}\n\t\t\t\t\tdispatchImmediateChange();\n\t\t\t\t}\n\t\t\t};\n\t\t\tp.padM.onmouseup =\n\t\t\tp.padM.onmouseout = function() { if(holdPad) { holdPad=false; jscolor.fireEvent(valueElement,'change'); } };\n\t\t\tp.padM.onmousedown = function(e) {\n\t\t\t\tholdPad=true;\n\t\t\t\tsetPad(e);\n\t\t\t\tdispatchImmediateChange();\n\t\t\t};\n\t\t\tp.sldM.onmouseup =\n\t\t\tp.sldM.onmouseout = function() { if(holdSld) { holdSld=false; jscolor.fireEvent(valueElement,'change'); } };\n\t\t\tp.sldM.onmousedown = function(e) {\n\t\t\t\tholdSld=true;\n\t\t\t\tsetSld(e);\n\t\t\t\tdispatchImmediateChange();\n\t\t\t};\n\n\t\t\t// picker\n\t\t\tvar dims = getPickerDims(THIS);\n\t\t\tp.box.style.width = dims[0] + 'px';\n\t\t\tp.box.style.height = dims[1] + 'px';\n\n\t\t\t// picker border\n\t\t\tp.boxB.style.position = 'absolute';\n\t\t\tp.boxB.style.clear = 'both';\n\t\t\tp.boxB.style.left = x+'px';\n\t\t\tp.boxB.style.top = y+'px';\n\t\t\tp.boxB.style.zIndex = THIS.pickerZIndex;\n\t\t\t//p.boxB.style.border = THIS.pickerBorder+'px solid';\n\t\t\t//p.boxB.style.borderColor = THIS.pickerBorderColor;\n\t\t\t//p.boxB.style.background = THIS.pickerFaceColor;\n\t\t\tp.boxB.className = 'colorMenu';\n\n\t\t\t// pad image\n\t\t\tp.pad.style.width = jscolor.images.pad[0]+'px';\n\t\t\tp.pad.style.height = jscolor.images.pad[1]+'px';\n\n\t\t\t// pad border\n\t\t\tp.padB.style.position = 'absolute';\n\t\t\tp.padB.style.left = THIS.pickerFace+'px';\n\t\t\tp.padB.style.top = THIS.pickerFace+'px';\n\t\t\tp.padB.style.border = THIS.pickerInset+'px solid';\n\t\t\tp.padB.style.borderColor = THIS.pickerInsetColor;\n\n\t\t\t// pad mouse area\n\t\t\tp.padM.style.position = 'absolute';\n\t\t\tp.padM.style.left = '0';\n\t\t\tp.padM.style.top = '0';\n\t\t\tp.padM.style.width = THIS.pickerFace + 2*THIS.pickerInset + jscolor.images.pad[0] + jscolor.images.arrow[0] + 'px';\n\t\t\tp.padM.style.height = p.box.style.height;\n\t\t\tp.padM.style.cursor = 'crosshair';\n\n\t\t\t// slider image\n\t\t\tp.sld.style.overflow = 'hidden';\n\t\t\tp.sld.style.width = jscolor.images.sld[0]+'px';\n\t\t\tp.sld.style.height = jscolor.images.sld[1]+'px';\n\n\t\t\t// slider border\n\t\t\tp.sldB.style.display = THIS.slider ? 'block' : 'none';\n\t\t\tp.sldB.style.position = 'absolute';\n\t\t\tp.sldB.style.right = THIS.pickerFace+'px';\n\t\t\tp.sldB.style.top = THIS.pickerFace+'px';\n\t\t\tp.sldB.style.border = THIS.pickerInset+'px solid';\n\t\t\tp.sldB.style.borderColor = THIS.pickerInsetColor;\n\n\t\t\t// slider mouse area\n\t\t\tp.sldM.style.display = THIS.slider ? 'block' : 'none';\n\t\t\tp.sldM.style.position = 'absolute';\n\t\t\tp.sldM.style.right = '0';\n\t\t\tp.sldM.style.top = '0';\n\t\t\tp.sldM.style.width = jscolor.images.sld[0] + jscolor.images.arrow[0] + THIS.pickerFace + 2*THIS.pickerInset + 'px';\n\t\t\tp.sldM.style.height = p.box.style.height;\n\t\t\ttry {\n\t\t\t\tp.sldM.style.cursor = 'pointer';\n\t\t\t} catch(eOldIE) {\n\t\t\t\tp.sldM.style.cursor = 'hand';\n\t\t\t}\n\n\t\t\t// \"close\" button\n\t\t\tfunction setBtnBorder() {\n\t\t\t\tvar insetColors = THIS.pickerInsetColor.split(/\\s+/);\n\t\t\t\tvar pickerOutsetColor = insetColors.length < 2 ? insetColors[0] : insetColors[1] + ' ' + insetColors[0] + ' ' + insetColors[0] + ' ' + insetColors[1];\n\t\t\t\tp.btn.style.borderColor = pickerOutsetColor;\n\t\t\t}\n\t\t\tp.btn.style.display = THIS.pickerClosable ? 'block' : 'none';\n\t\t\tp.btn.style.position = 'absolute';\n\t\t\tp.btn.style.left = THIS.pickerFace + 'px';\n\t\t\tp.btn.style.bottom = THIS.pickerFace + 'px';\n\t\t\tp.btn.style.padding = '0 15px';\n\t\t\tp.btn.style.height = '18px';\n\t\t\tp.btn.style.border = THIS.pickerInset + 'px solid';\n\t\t\tsetBtnBorder();\n\t\t\tp.btn.style.color = THIS.pickerButtonColor;\n\t\t\tp.btn.style.font = '12px sans-serif';\n\t\t\tp.btn.style.textAlign = 'center';\n\t\t\ttry {\n\t\t\t\tp.btn.style.cursor = 'pointer';\n\t\t\t} catch(eOldIE) {\n\t\t\t\tp.btn.style.cursor = 'hand';\n\t\t\t}\n\t\t\tp.btn.onmousedown = function () {\n\t\t\t\tTHIS.hidePicker();\n\t\t\t};\n\t\t\tp.btnS.style.lineHeight = p.btn.style.height;\n\n\t\t\t// load images in optimal order\n\t\t\tswitch(modeID) {\n\t\t\t\tcase 0: var padImg = 'hs.png'; break;\n\t\t\t\tcase 1: var padImg = 'hv.png'; break;\n\t\t\t}\n\t\t\tp.padM.style.backgroundImage = \"url('\"+jscolor.getDir()+\"cross.gif')\";\n\t\t\tp.padM.style.backgroundRepeat = \"no-repeat\";\n\t\t\tp.sldM.style.backgroundImage = \"url('\"+jscolor.getDir()+\"arrow.gif')\";\n\t\t\tp.sldM.style.backgroundRepeat = \"no-repeat\";\n\t\t\tp.pad.style.backgroundImage = \"url('\"+jscolor.getDir()+padImg+\"')\";\n\t\t\tp.pad.style.backgroundRepeat = \"no-repeat\";\n\t\t\tp.pad.style.backgroundPosition = \"0 0\";\n\n\t\t\t// place pointers\n\t\t\tredrawPad();\n\t\t\tredrawSld();\n\n\t\t\tjscolor.picker.owner = THIS;\n\t\t\tdocument.getElementsByTagName('body')[0].appendChild(p.boxB);\n\t\t}\n\n\n\t\tfunction getPickerDims(o) {\n\t\t\tvar dims = [\n\t\t\t\t2*o.pickerInset + 2*o.pickerFace + jscolor.images.pad[0] +\n\t\t\t\t\t(o.slider ? 2*o.pickerInset + 2*jscolor.images.arrow[0] + jscolor.images.sld[0] : 0),\n\t\t\t\to.pickerClosable ?\n\t\t\t\t\t4*o.pickerInset + 3*o.pickerFace + jscolor.images.pad[1] + o.pickerButtonHeight :\n\t\t\t\t\t2*o.pickerInset + 2*o.pickerFace + jscolor.images.pad[1]\n\t\t\t];\n\t\t\treturn dims;\n\t\t}\n\n\n\t\tfunction redrawPad() {\n\t\t\t// redraw the pad pointer\n\t\t\tswitch(modeID) {\n\t\t\t\tcase 0: var yComponent = 1; break;\n\t\t\t\tcase 1: var yComponent = 2; break;\n\t\t\t}\n\t\t\tvar x = Math.round((THIS.hsv[0]/6) * (jscolor.images.pad[0]-1));\n\t\t\tvar y = Math.round((1-THIS.hsv[yComponent]) * (jscolor.images.pad[1]-1));\n\t\t\tjscolor.picker.padM.style.backgroundPosition =\n\t\t\t\t(THIS.pickerFace+THIS.pickerInset+x - Math.floor(jscolor.images.cross[0]/2)) + 'px ' +\n\t\t\t\t(THIS.pickerFace+THIS.pickerInset+y - Math.floor(jscolor.images.cross[1]/2)) + 'px';\n\n\t\t\t// redraw the slider image\n\t\t\tvar seg = jscolor.picker.sld.childNodes;\n\n\t\t\tswitch(modeID) {\n\t\t\t\tcase 0:\n\t\t\t\t\tvar rgb = HSV_RGB(THIS.hsv[0], THIS.hsv[1], 1);\n\t\t\t\t\tfor(var i=0; i<seg.length; i+=1) {\n\t\t\t\t\t\tseg[i].style.backgroundColor = 'rgb('+\n\t\t\t\t\t\t\t(rgb[0]*(1-i/seg.length)*100)+'%,'+\n\t\t\t\t\t\t\t(rgb[1]*(1-i/seg.length)*100)+'%,'+\n\t\t\t\t\t\t\t(rgb[2]*(1-i/seg.length)*100)+'%)';\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tvar rgb, s, c = [ THIS.hsv[2], 0, 0 ];\n\t\t\t\t\tvar i = Math.floor(THIS.hsv[0]);\n\t\t\t\t\tvar f = i%2 ? THIS.hsv[0]-i : 1-(THIS.hsv[0]-i);\n\t\t\t\t\tswitch(i) {\n\t\t\t\t\t\tcase 6:\n\t\t\t\t\t\tcase 0: rgb=[0,1,2]; break;\n\t\t\t\t\t\tcase 1: rgb=[1,0,2]; break;\n\t\t\t\t\t\tcase 2: rgb=[2,0,1]; break;\n\t\t\t\t\t\tcase 3: rgb=[2,1,0]; break;\n\t\t\t\t\t\tcase 4: rgb=[1,2,0]; break;\n\t\t\t\t\t\tcase 5: rgb=[0,2,1]; break;\n\t\t\t\t\t}\n\t\t\t\t\tfor(var i=0; i<seg.length; i+=1) {\n\t\t\t\t\t\ts = 1 - 1/(seg.length-1)*i;\n\t\t\t\t\t\tc[1] = c[0] * (1 - s*f);\n\t\t\t\t\t\tc[2] = c[0] * (1 - s);\n\t\t\t\t\t\tseg[i].style.backgroundColor = 'rgb('+\n\t\t\t\t\t\t\t(c[rgb[0]]*100)+'%,'+\n\t\t\t\t\t\t\t(c[rgb[1]]*100)+'%,'+\n\t\t\t\t\t\t\t(c[rgb[2]]*100)+'%)';\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\n\t\tfunction redrawSld() {\n\t\t\t// redraw the slider pointer\n\t\t\tswitch(modeID) {\n\t\t\t\tcase 0: var yComponent = 2; break;\n\t\t\t\tcase 1: var yComponent = 1; break;\n\t\t\t}\n\t\t\tvar y = Math.round((1-THIS.hsv[yComponent]) * (jscolor.images.sld[1]-1));\n\t\t\tjscolor.picker.sldM.style.backgroundPosition =\n\t\t\t\t'0 ' + (THIS.pickerFace+THIS.pickerInset+y - Math.floor(jscolor.images.arrow[1]/2)) + 'px';\n\t\t}\n\n\n\t\tfunction isPickerOwner() {\n\t\t\treturn jscolor.picker && jscolor.picker.owner === THIS;\n\t\t}\n\n\n\t\tfunction blurTarget() {\n\t\t\tif(valueElement === target) {\n\t\t\t\tTHIS.importColor();\n\t\t\t}\n\t\t\tif(THIS.pickerOnfocus) {\n\t\t\t\tTHIS.hidePicker();\n\t\t\t}\n\t\t}\n\n\n\t\tfunction blurValue() {\n\t\t\tif(valueElement !== target) {\n\t\t\t\tTHIS.importColor();\n\t\t\t}\n\t\t}\n\n\n\t\tfunction setPad(e) {\n\t\t\tvar mpos = jscolor.getRelMousePos(e);\n\t\t\tvar x = mpos.x - THIS.pickerFace - THIS.pickerInset;\n\t\t\tvar y = mpos.y - THIS.pickerFace - THIS.pickerInset;\n\t\t\tswitch(modeID) {\n\t\t\t\tcase 0: THIS.fromHSV(x*(6/(jscolor.images.pad[0]-1)), 1 - y/(jscolor.images.pad[1]-1), null, leaveSld); break;\n\t\t\t\tcase 1: THIS.fromHSV(x*(6/(jscolor.images.pad[0]-1)), null, 1 - y/(jscolor.images.pad[1]-1), leaveSld); break;\n\t\t\t}\n\t\t}\n\n\n\t\tfunction setSld(e) {\n\t\t\tvar mpos = jscolor.getRelMousePos(e);\n\t\t\tvar y = mpos.y - THIS.pickerFace - THIS.pickerInset;\n\t\t\tswitch(modeID) {\n\t\t\t\tcase 0: THIS.fromHSV(null, null, 1 - y/(jscolor.images.sld[1]-1), leavePad); break;\n\t\t\t\tcase 1: THIS.fromHSV(null, 1 - y/(jscolor.images.sld[1]-1), null, leavePad); break;\n\t\t\t}\n\t\t}\n\n\n\t\tfunction dispatchImmediateChange() {\n\t\t\tif (THIS.onImmediateChange) {\n\t\t\t\tif (typeof THIS.onImmediateChange === 'string') {\n\t\t\t\t\teval(THIS.onImmediateChange);\n\t\t\t\t} else {\n\t\t\t\t\tTHIS.onImmediateChange(THIS);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tvar THIS = this;\n\t\tvar modeID = this.pickerMode.toLowerCase()==='hvs' ? 1 : 0;\n\t\tvar abortBlur = false;\n\t\tvar\n\t\t\tvalueElement = jscolor.fetchElement(this.valueElement),\n\t\t\tstyleElement = jscolor.fetchElement(this.styleElement);\n\t\tvar\n\t\t\tholdPad = false,\n\t\t\tholdSld = false;\n\t\tvar\n\t\t\tleaveValue = 1<<0,\n\t\t\tleaveStyle = 1<<1,\n\t\t\tleavePad = 1<<2,\n\t\t\tleaveSld = 1<<3;\n\n\t\t// target\n\t\tjscolor.addEvent(target, 'focus', function() {\n\t\t\tif(THIS.pickerOnfocus) { THIS.showPicker(); }\n\t\t});\n\t\tjscolor.addEvent(target, 'blur', function() {\n\t\t\tif(!abortBlur) {\n\t\t\t\twindow.setTimeout(function(){ abortBlur || blurTarget(); abortBlur=false; }, 0);\n\t\t\t} else {\n\t\t\t\tabortBlur = false;\n\t\t\t}\n\t\t});\n\n\t\t// valueElement\n\t\tif(valueElement) {\n\t\t\tvar updateField = function() {\n\t\t\t\tTHIS.fromString(valueElement.value, leaveValue);\n\t\t\t\tdispatchImmediateChange();\n\t\t\t};\n\t\t\tjscolor.addEvent(valueElement, 'keyup', updateField);\n\t\t\tjscolor.addEvent(valueElement, 'input', updateField);\n\t\t\tjscolor.addEvent(valueElement, 'blur', blurValue);\n\t\t\tvalueElement.setAttribute('autocomplete', 'off');\n\t\t}\n\n\t\t// styleElement\n\t\tif(styleElement) {\n\t\t\tstyleElement.jscStyle = {\n\t\t\t\tbackgroundColor : styleElement.style.backgroundColor,\n\t\t\t\tcolor : styleElement.style.color\n\t\t\t};\n\t\t}\n\n\t\t// require images\n\t\tswitch(modeID) {\n\t\t\tcase 0: jscolor.requireImage('hs.png'); break;\n\t\t\tcase 1: jscolor.requireImage('hv.png'); break;\n\t\t}\n\t\tjscolor.requireImage('cross.gif');\n\t\tjscolor.requireImage('arrow.gif');\n\n\t\tthis.importColor();\n\t}\n\n};\n\n//jscolor.install();\nexports = jscolor;\n","pre":true},"modules/devkit-core/modules/squill/Label.js":{"path":"modules/devkit-core/modules/squill/Label.js","friendlyPath":".Label","directory":"modules/devkit-core/modules/squill/","filename":"Label.js","src":"jsio('from util.browser import $');\njsio('import squill.Widget');\njsio('import squill.models.bindings as bindings');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Label=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Label(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Label(){return this.init&&this.init.apply(this,arguments)},squill.Widget, function() {\n\tthis._css = 'label';\n\tthis._def = {\n\t\tchildren: [{\n\t\t\tid: '_labelSpan',\n\t\t\ttag: 'span'\n\t\t}]\n\t}\n\n\tthis.buildWidget = function() {\n\t\tthis.setLabel(this.getI18n('label'));\n\n\t\tvar opts = this._opts;\n\t\tif (opts.format) {\n\t\t\tbindings.parseFormat(this, opts.format);\n\t\t}\n\t}\n\n\tthis.setData =\n\tthis.setValue =\n\tthis.setLabel =\n\tthis.setText = function(text) { if (/object/i.test(text)) debugger; $.setText(this._labelSpan, text); }\n\tthis.setHTML = function(html) { this._labelSpan.innerHTML = html; }\n});\n","pre":true},"modules/devkit-core/modules/squill/List.js":{"path":"modules/devkit-core/modules/squill/List.js","friendlyPath":".List","directory":"modules/devkit-core/modules/squill/","filename":"List.js","src":"jsio('import .Window');\njsio('import .Widget');\njsio('from util.browser import $');\njsio('import .models.DataSource as DataSource');\njsio('import .Selection');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_List=__class__;var List = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_List(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_List(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\n\tthis._css = 'list';\n\n\tthis.init = function(opts) {\n\t\topts = merge(opts, {\n\t\t\tcontainSelf: true,\n\t\t\tcellSpacing: 0,\n\t\t\tisTiled: false,\n\t\t\tpreserveCells: false,\n\t\t\trenderAll: true,\n\t\t\tisFixedHeight: true,\n\t\t\tabsolutePosition: true,\n\t\t\tfilter: null\n\t\t});\n\n\t\tthis.needsRender = delay(this.render);\n\n\t\tif (opts.cellCtor) { this.setCellCtor(opts.cellCtor); }\n\t\tif (opts.dataSource) { this.setDataSource(opts.dataSource); }\n\t\tif (opts.sorter) { this.setSorter(opts.sorter); }\n\n\t\tthis._lastFilter = null;\n\n\t\tthis._filter = opts.filter;\n\t\tthis._cellsByID = {};\n\t\tthis._removed = {};\n\t\tthis._containSelf = opts.containSelf;\n\t\tthis._containerTag = opts.containerTag;\n\t\tthis._applyNodeOrder = opts.applyNodeOrder;\n\n\t\tthis._renderOpts = {\n\t\t\tcellSpacing: opts.cellSpacing || 0\n\t\t};\n\n\t\tthis.updateFilter = delay(function() {\n\t\t\tthis._lastFilter = null;\n\t\t\tthis.needsRender();\n\t\t}, 100);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tif (opts.__result) {\n\t\t\topts.__result.addSubscription(this, 'select');\n\t\t}\n\n\t\tWindow.get().on('ViewportChange', bind(this, 'needsRender'));\n\t};\n\n\t// cells go in _container\n\tthis.getContainer = function() {\n\t\treturn this._container;\n\t};\n\n\tthis.getDataSource = function() {\n\t\treturn this._dataSource;\n\t};\n\n\tthis.setModel = function (path, value) {\n\t\tif (arguments.length == 1) {\n\t\t\tthis.setDataSource(arguments[0]);\n\t\t} else {\n\t\t\treturn supr(this, 'setModel', arguments);\n\t\t}\n\t};\n\n\tthis.setData = function (data) {\n\t\tif (!this._dataSource) {\n\t\t\tthis.setDataSource(new DataSource({sorter: this._sorter}));\n\t\t} else {\n\t\t\tthis._dataSource.clear();\n\t\t}\n\n\t\tif (data) {\n\t\t\tvar items;\n\t\t\tif (Array.isArray(data)) {\n\t\t\t\titems = data.map(function (data, index) { return {id: index, data: data}; });\n\t\t\t} else {\n\t\t\t\titems = Object.keys(data).map(function (key) {\n\t\t\t\t\treturn {id: key, data: data[key]};\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis._dataSource.add(items);\n\t\t}\n\n\t\tthis.needsRender();\n\t};\n\n\tthis.setDataSource = function(dataSource) {\n\t\tif (this._dataSource == dataSource) { return; }\n\n\t\tif (this._dataSource) {\n\t\t\tthis._dataSource.unsubscribe('Update', this);\n\t\t\tthis._dataSource.unsubscribe('Remove', this);\n\t\t\tthis.clear();\n\t\t}\n\n\t\tthis._dataSource = dataSource;\n\t\tthis._dataSource.subscribe('Update', this, 'onUpdateItem');\n\t\tthis._dataSource.subscribe('Remove', this, 'onRemoveItem');\n\n\t\tthis.needsRender();\n\t};\n\n\tthis.onUpdateItem = function(id, item) {\n\t\tvar cell = this._cellsByID[id];\n\t\tif (cell && cell.getItem() != item) { cell.setItem(item); }\n\t\tthis.updateFilter();\n\t};\n\n\tthis.onRemoveItem = function(id) {\n\t\tthis._removed[id] = true;\n\t\tthis.updateFilter();\n\t};\n\n\tthis.buildWidget = function() {\n\n\t\tthis._container = $({parent: this._el, className: this._opts.containerClassName, tag: this._containerTag || 'div'});\n\t\tif (this._containSelf && !this._applyNodeOrder) {\n\t\t\tthis._container.style.position = 'relative';\n\t\t}\n\n\t\tif (this._opts.selection || this._opts.selectable) {\n\t\t\tthis.setSelectable(this._opts.selection || this._opts.selectable);\n\t\t}\n\n\t\tthis.render();\n\t};\n\n\tthis.setValue = function (value) {\n\t\tif (this.selection) {\n\t\t\tthis.selection.select(value);\n\t\t}\n\t}\n\n\tthis.getValue = function () {\n\t\tif (this.selection) {\n\t\t\treturn this.selection.get();\n\t\t}\n\t}\n\n\tthis.setSelectable = function(selectable) {\n\t\tthis.selection = new Selection({\n\t\t\tparent: this,\n\t\t\ttype: selectable\n\t\t})\n\t\t\t.subscribe('Select', this, '_onSelected', true)\n\t\t\t.subscribe('Deselect', this, '_onSelected', false)\n\n\t\tthis.selection;\n\t};\n\n\tthis._onSelected = function(isSelected, item, id) {\n\t\tif (this._cellsByID[id] !== undefined) {\n\t\t\tthis._cellsByID[id].updateSelected();\n\n\t\t\tif (isSelected) {\n\t\t\t\tthis.publish('select', id);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.setCellCtor = function(cellCtor) {\n\t\tif (cellCtor == this._cellCtor) { return; }\n\n\t\tthis._cellCtor = cellCtor;\n\t\tthis.clear();\n\t}\n\n\tthis.clear = function() {\n\t\tfor (var id in this._cellsByID) {\n\t\t\tvar cell = this._cellsByID[id];\n\t\t\tcell.remove();\n\t\t}\n\n\t\tthis._cellsByID = {};\n\t\tthis._renderedDataSource = null;\n\t\tthis._cellDim = null;\n\t};\n\n\tthis.getCellById = function(id) {\n\t\treturn this._cellsByID[id];\n\t};\n\n\tthis.setCellForId = function (id, cell) {\n\t\tthis._cellsByID[id] = cell;\n\t}\n\n\tthis.getCells = function() {\n\t\treturn this._cellsByID;\n\t};\n\n\tthis.setSorter = function(sorter) {\n\t\tthis._sorter = sorter;\n\t\tif (this._renderedDataSource) {\n\t\t\tthis._renderedDataSource.setSorter(sorter);\n\t\t}\n\t};\n\n\t// Filter moved to DataSource...\n\tthis.setFilter = function(filter) {\n\t\tthis._filter = filter;\n\t\tthis.needsRender();\n\t};\n\n\tthis.setFixedHeight = function(isFixedHeight) {\n\t\tthis._opts.isFixedHeight = isFixedHeight;\n\t};\n\n\tthis._applyDataSource = function() {\n\t\tif (this._filter != this._lastFilter) {\n\t\t\tthis._lastFilter = this._filter;\n\t\t\tthis._renderedDataSource = this._dataSource.getFilteredDataSource(bind(this, this._filter));\n\n\t\t\tthis._lastSorter = this._sorter;\n\t\t\tthis._renderedDataSource.setSorter(this._sorter);\n\t\t} else if (this._sorter != this._lastSorter) {\n\t\t\tif (!this._renderedDataSource || this._renderedDataSource == this._dataSource) {\n\t\t\t\tthis._filter = function () { return true; };\n\t\t\t\treturn this._applyDataSource();\n\t\t\t} else {\n\t\t\t\tthis._lastSorter = this._sorter;\n\t\t\t\tthis._renderedDataSource.setSorter(this._sorter);\n\t\t\t}\n\t\t}\n\n\t\tif (!this._renderedDataSource) {\n\t\t\tthis._renderedDataSource = this._dataSource;\n\t\t}\n\t};\n\n\tthis.onShow = function() { supr(this, 'onShow', arguments); this.needsRender(); }\n\n\t// just render all cells for now\n\tthis.render = function() {\n\t\tif (!this._dataSource) { return; }\n\t\tthis._applyDataSource();\n\t\tthis._renderedDataSource.sort();\n\n\t\tif (this._opts.renderAll) {\n\t\t\tthis.renderAllDelayed();\n\t\t} else if (this._opts.isFixedHeight) {\n\t\t\tthis.renderFixedHeight();\n\t\t} else {\n\t\t\tthis.renderDynamicHeight();\n\t\t}\n\n\t\tthis._removed = {};\n\t};\n\n\tthis.setCellDim = function(cellDim) {\n\t\tthis._cellDim = cellDim;\n\t};\n\n\tthis.getCellDim = function() {\n\t\tif (this._cellDim) { return this._cellDim; }\n\n\t\tif (this._opts.isFixedHeight) {\n\t\t\tvar item = this._renderedDataSource.getItemForIndex(0);\n\t\t\tif (!item) { return false; }\n\t\t\tvar key = item[this._renderedDataSource.getKey()],\n\t\t\t\tcell = this._cellsByID[key] || (this._cellsByID[key] = this._createCell(item)),\n\t\t\t\tdim = $.size(cell.getElement());\n\t\t\tif (dim.width == 0 || dim.height == 0) { return null; }\n\n\t\t\tvar cellSpacing = this._opts.cellSpacing;\n\t\t\tif (cellSpacing) {\n\t\t\t\tdim.width += cellSpacing;\n\t\t\t\tdim.height += cellSpacing;\n\t\t\t}\n\n\t\t\tthis._cellDim = dim;\n\t\t\treturn dim;\n\t\t} else {\n\t\t\tthrow 'unimplemented'\n\t\t}\n\t};\n\n\tthis._createCell = function(item) {\n\t\tvar key = this._dataSource.getKey(),\n\t\t\tcell = new this._cellCtor({\n\t\t\t\tparent: this,\n\t\t\t\tcontroller: this,\n\t\t\t\tkey: key,\n\t\t\t\titem: item\n\t\t\t});\n\n\t\tcell.getElement().setAttribute('squill-data-id', item[key]);\n\t\tcell.render();\n\t\treturn cell;\n\t};\n\n\tthis._nodeOrder = function() {\n\t\tvar container = this._container;\n\t\tvar src = this._renderedDataSource;\n\t\tvar key = src.key;\n\t\tvar dummy;\n\t\tvar cell;\n\t\tvar element;\n\t\tvar item;\n\t\tvar i;\n\n\t\tif (!container.childNodes.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tdummy = document.createElement('div');\n\n\t\tcontainer.insertBefore(dummy, container.childNodes[0]);\n\t\tfor (i = 0; i < src.length; i++) {\n\t\t\titem = src.getItemForIndex(i);\n\t\t\tcell = this._cellsByID[item[key]];\n\t\t\telement = cell.getElement();\n\t\t\tif (cell && element.parentNode) {\n\t\t\t\tcontainer.insertBefore(container.removeChild(element), dummy);\n\t\t\t}\n\t\t}\n\n\t\tcontainer.removeChild(dummy);\n\t};\n\n\tthis.renderAllDelayed = function() {\n\t\tvar src = this._renderedDataSource;\n\t\tif (!src) { return; }\n\n\t\tthis.updateRenderOpts();\n\t\tvar i = 0;\n\t\tfunction renderOne() {\n\t\t\tvar item = src.getItemForIndex(i);\n\t\t\tif (!item) { return false; }\n\n\t\t\tvar id = item[src.getKey()];\n\t\t\tvar cell = this._cellsByID[id];\n\t\t\tif (!cell) {\n\t\t\t\tcell = this._cellsByID[id] = this._createCell(item);\n\t\t\t} else {\n\t\t\t\tcell.render();\n\t\t\t}\n\t\t\t!this._applyNodeOrder && this.positionCell(cell, i);\n\t\t\t++i;\n\t\t\treturn true;\n\t\t}\n\n\t\tfunction renderMany() {\n\t\t\tvar THRESHOLD = 50; // ms to render\n\t\t\tvar n = 0, t = +new Date();\n\t\t\twhile (n++ < 10 || +new Date() - t < THRESHOLD) {\n\t\t\t\tif (!renderOne.call(this)) {\n\t\t\t\t\tthis._applyNodeOrder && this._nodeOrder();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tsetTimeout(bind(this, renderMany), 100);\n\t\t}\n\n\t\tvar removed = this._removed;\n\t\tfor (var id in removed) {\n\t\t\tif (!src.getItemForID(id)) {\n\t\t\t\tvar cell = this._cellsByID[id];\n\t\t\t\tif (cell) {\n\t\t\t\t\tcell.remove();\n\t\t\t\t\tdelete this._cellsByID[id];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\trenderMany.call(this);\n\t}\n\n\tthis.setOffsetParent = function(offsetParent) {\n\t\tthis._opts.offsetParent = offsetParent;\n\t};\n\n\tthis.setTiled = function(tiled) {\n\t\tthis._opts.isTiled = tiled;\n\t\tthis._isTiled = tiled;\n\t};\n\n\tthis.updateRenderOpts = function() {\n\t\tvar r = this._renderOpts;\n\n\t\tr.offsetTop = this._containSelf ? 0 : this._container.offsetTop;\n\t\tr.offsetLeft = this._containSelf ? 0 : this._container.offsetLeft;\n\n\t\tvar parent = this._offsetParent || this.getOffsetParent();\n\t\tr.top = (parent.getAttribute('squill-scroller-top') || parent.scrollTop) - r.offsetTop;\n\t\tr.height = parent.offsetHeight;\n\t\tr.bottom = r.top + r.height;\n\n\t\tif (this._opts.isFixedHeight) {\n\t\t\tvar cellDim = this.getCellDim();\n\t\t\tif (!cellDim) { return false; }\n\t\t\tr.cellWidth = cellDim.width;\n\t\t\tr.cellHeight = cellDim.height;\n\t\t}\n\n\t\tvar n = r.numRows = this._renderedDataSource.length;\n\t\tif (this._opts.isFixedHeight) {\n\t\t\tif (this._opts.isTiled) {\n\t\t\t\tr.maxWidth = parent.offsetWidth - r.offsetLeft;\n\t\t\t\tr.numPerRow = Math.max(1, r.maxWidth / r.cellWidth | 0);\n\t\t\t\tr.numRows = Math.ceil(n / r.numPerRow);\n\t\t\t\tr.start = Math.max(0, (r.top / r.cellHeight | 0) * r.numPerRow);\n\t\t\t\tr.end = Math.ceil(r.bottom / r.cellHeight) * r.numPerRow;\n\t\t\t} else {\n\t\t\t\tr.start = Math.max(0, r.top / r.cellHeight | 0);\n\t\t\t\tr.end = (r.bottom / r.cellHeight + 1) | 0;\n\t\t\t}\n\t\t}\n\n\t\tif (!this._applyNodeOrder) {\n\t\t\tif (this._opts.absolutePosition) {\n\t\t\t\tthis._container.style.height = r.numRows * r.cellHeight + 'px';\n\t\t\t} else {\n\t\t\t\tthis._container.style.height = 'auto';\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t};\n\n\tthis.positionCell = function(cell, i) {\n\t\tif (!this._opts.absolutePosition) { return; }\n\n\t\tvar r = this._renderOpts;\n\t\tvar el = cell.getElement();\n\t\tvar x, y;\n\n\t\tif (this._opts.isTiled) {\n\t\t\tx = i % r.numPerRow;\n\t\t\ty = (i / r.numPerRow) | 0;\n\t\t\tel.style.left = x * r.cellWidth + r.offsetLeft + 'px';\n\t\t\tel.style.top = y * r.cellHeight + r.offsetTop + 'px';\n\t\t} else {\n\t\t\tel.style.top = (i * r.cellHeight || 0) + r.offsetTop + 'px';\n\t\t}\n\t};\n\n\tthis.getOffsetParent = function() {\n\t\t// the list might be contained in some other scrolling div\n\t\treturn this._opts.offsetParent || (this._containSelf ? this._container : this._container.offsetParent) || document.body;\n\t};\n\n\tthis.renderFixedHeight = function() {\n\t\tvar parent = this.getOffsetParent();\n\t\tif (!parent) { return; }\n\t\tif (parent != this._offsetParent) {\n\t\t\tif (this._removeScrollEvt) { this._removeScrollEvt(); }\n\t\t\tthis._offsetParent = parent;\n\t\t\tthis._removeScrollEvt = $.onEvent(parent, 'scroll', this, 'needsRender');\n\t\t}\n\n\t\t// render data\n\t\tvar src = this._renderedDataSource,\n\t\t\tkey = src.getKey(),\n\t\t\tn = src.length;\n\n\t\tif (n && !this.updateRenderOpts()) { return; }\n\n\t\t// swap lists\n\t\tvar oldCellsByID = this._cellsByID;\n\t\tthis._cellsByID = {};\n\n\t\t// render new items\n\t\tif (n) {\n\t\t\tvar isTiled = this._isTiled;\n\t\t\tvar r = this._renderOpts;\n\t\t\tfor (var i = r.start; i < r.end; ++i) {\n\t\t\t\tvar item = src.getItemForIndex(i);\n\t\t\t\tif (!item) { break; }\n\n\t\t\t\tvar id = item[key];\n\t\t\t\tvar cell = oldCellsByID[id];\n\t\t\t\tif (!cell) {\n\t\t\t\t\tcell = this._createCell(item);\n\t\t\t\t} else {\n\t\t\t\t\tdelete(oldCellsByID[id]);\n\t\t\t\t\tcell.render();\n\t\t\t\t}\n\n\t\t\t\tthis.positionCell(cell, i);\n\t\t\t\tthis._cellsByID[id] = cell;\n\t\t\t}\n\t\t};\n\n\t\t// remove old items\n\t\tif (!this._opts.preserveCells) {\n\t\t\tfor (var id in oldCellsByID) {\n\t\t\t\toldCellsByID[id].remove();\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var id in oldCellsByID) {\n\t\t\t\tvar cell = oldCellsByID[id];\n\t\t\t\tif (!src.getItemForID(id)) {\n\t\t\t\t\tcell.remove();\n\t\t\t\t} else {\n\t\t\t\t\tthis._cellsByID[id] = cell;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n});\n","pre":true},"modules/devkit-core/modules/squill/Window.js":{"path":"modules/devkit-core/modules/squill/Window.js","friendlyPath":".Window","directory":"modules/devkit-core/modules/squill/","filename":"Window.js","src":"jsio('import lib.PubSub');\njsio('import std.uri');\njsio('from util.browser import $');\n\nvar UNIQUE_ID = '__squill__window_id';\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Window=__class__;var Window = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Window(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Window(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function() {\n\tthis.init = function(win) {\n\t\tthis._win = win || window;\n\t\tthis._location = new std.uri(this._win.location);\n\t\tthis._dim = $(this._win);\n\t\t$.onEvent(this._win, 'resize', this, 'onViewportChange');\n\t\t$.onEvent(this._win, 'scroll', this, 'onViewportChange');\n\t}\n\n\tthis.onViewportChange = function(e) {\n\t\tthis._dim = $(this._win);\n\t\tthis.publish('ViewportChange', e, this._dim);\n\t}\n\n\tthis.getDim =\n\tthis.getViewport = function() { return this._dim; }\n\n\tthis.query = function(key) {\n\t\treturn this._location.query(key);\n\t}\n\n\tthis.hash = function(key) {\n\t\treturn this._location.query(key);\n\t}\n\n\tthis.center = function(el, opts) {\n\t\topts = merge(opts, {subscribe: true});\n\n\t\tvar width = 'width' in opts ? opts.width : el.offsetWidth,\n\t\t\theight = 'height' in opts ? opts.height : el.offsetHeight;\n\n\t\tel.style.left = (this._dim.width - width) / 2 + 'px';\n\t\tel.style.top = (this._dim.height - height) / 2 + 'px';\n\n\t\tif (opts.subscribe) {\n\t\t\tthis.subscribe('ViewportChange', this, 'center', el, merge({subscribe: false}, opts));\n\t\t}\n\t}\n});\n\nvar gWin = {};\nexports.get = function(win) {\n\tif (!win) { win = window; }\n\n\tif (win[UNIQUE_ID]) {\n\t\treturn gWin[win[UNIQUE_ID]];\n\t} else {\n\t\treturn gWin[win[UNIQUE_ID]] = new Window(win);\n\t}\n}\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/std/uri.js":{"path":"modules/devkit-core/node_modules/jsio/packages/std/uri.js","friendlyPath":"std.uri","directory":"modules/devkit-core/node_modules/jsio/packages/std/","filename":"uri.js","baseMod":"std","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/node_modules/jsio/packages/std","src":"jsio('import util.path');\n\nvar attrs = [\n\t\"source\",\n\t\"protocol\",\n\t\"authority\",\n\t\"userInfo\",\n\t\"user\",\n\t\"password\",\n\t\"host\",\n\t\"port\",\n\t\"relative\",\n\t\"path\",\n\t\"directory\",\n\t\"file\",\n\t\"query\",\n\t\"anchor\"\n];\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_std_uri=__class__;var URI = module.exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_std_uri(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_std_uri(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function(url, isStrict) {\n\t\tif (url instanceof URI) {\n\t\t\tfor (var i = 0, attr; attr = attrs[i]; ++i) {\n\t\t\t\tthis['_' + attr] = url['_' + attr];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isStrict = isStrict;\n\n\t\tvar uriData = URI.parse(url, isStrict);\n\t\tfor (var attr in uriData) {\n\t\t\tthis['_' + attr] = uriData[attr];\n\t\t}\n\t};\n\n\tfor (var i = 0, attr; attr = attrs[i]; ++i) {\n\t\t(function(attr) {\n\t\t\tvar fNameSuffix = attr.charAt(0).toUpperCase() + attr.slice(1);\n\t\t\tthis['get' + fNameSuffix] = function() {\n\t\t\t\treturn this['_' + attr];\n\t\t\t};\n\t\t\tthis['set' + fNameSuffix] = function(val) {\n\t\t\t\tthis['_' + attr] = val;\n\t\t\t\treturn this;\n\t\t\t};\n\t\t}).call(this, attr);\n\t}\n\n\tthis.query = function(key) { return URI.parseQuery(this._query)[key]; };\n\tthis.hash = function(key) { return URI.parseQuery(this._anchor)[key]; };\n\n\tthis.addHash = function(kvp) {\n\t\tvar hash = URI.parseQuery(this._anchor);\n\t\tfor (var i in kvp) { hash[i] = kvp[i]; }\n\t\tthis._anchor = URI.buildQuery(hash);\n\t\treturn this;\n\t};\n\n\tthis.setPath = function (path) {\n\t\tvar pieces = util.path.splitPath(path);\n\t\tthis._file = pieces.filename;\n\t\tthis._directory = pieces.directory;\n\t\tthis._path = path;\n\t\treturn this;\n\t};\n\n\tthis.setFile = function (file) {\n\t\treturn this.setPath(util.path.join(this._directory, file));\n\t};\n\n\tthis.setDirectory = function (directory) {\n\t\treturn this.setPath(util.path.join(directory, this._file));\n\t};\n\n\tthis.push = function(path) {\n\t\tif (path) {\n\t\t\tthis._path = (this._path + '/' + path).replace(/\\/\\/+/g, '/');\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.addQuery = function(kvp) {\n\t\tvar query = URI.parseQuery(this._query);\n\t\tfor (var i in kvp) { query[i] = kvp[i]; }\n\t\tthis._query = URI.buildQuery(query);\n\t\treturn this;\n\t};\n\n\tthis.removeQuery = function(keys) {\n\t\tvar query = URI.parseQuery(this._query);\n\t\tif (Array.isArray(keys)) {\n\t\t\tfor (var i = 0, n = keys.length; i < n; ++i) {\n\t\t\t\tdelete query[keys[i]];\n\t\t\t}\n\t\t} else {\n\t\t\tdelete query[keys];\n\t\t}\n\t\tthis._query = URI.buildQuery(query);\n\t\treturn this;\n\t};\n\n\tthis.toJSON = function() { return this.toString(false); };\n\n\tthis.toString = function(onlyBase) {\n\t\t// XXX TODO: This is vaguely reasonable, but not complete. fix it...\n\t\tvar a = this._protocol ? this._protocol + \"://\" : \"\";\n\t\tvar b = this._host ? this._host + ((this._port || 80) == 80 ? \"\" : \":\" + this._port) : \"\";\n\n\t\tif (onlyBase) {\n\t\t\treturn a + b;\n\t\t}\n\n\t\tvar c = this._path;\n\t\tvar d = this._query ? '?' + this._query : '';\n\t\tvar e = this._anchor ? '#' + this._anchor : '';\n\t\treturn a + b + c + d + e;\n\t};\n});\n\nURI.relativeTo = function(url, base) {\n\tvar url = String(url);\n\tif (base && !/^http(s?):\\/\\//.test(url)) {\n\t\tvar baseURI = new URI(base)\n\t\t\t.setAnchor('')\n\t\t\t.setQuery('')\n\t\t\t.setFile('')\n\t\t\t.toString(url.charAt(0) == '/');\n\n\t\turl = URI.resolveRelative(baseURI + url);\n\t}\n\n\treturn new URI(url);\n};\n\nURI.resolveRelative = function(url) {\n\tvar prevUrl;\n\n\t// remove ../ with preceeding folder\n\twhile((prevUrl = url) != (url = url.replace(/(^|\\/)([^\\/]+)\\/\\.\\.\\//g, '/'))) {};\n\n\t// remove ./ if it isn't preceeded by a .\n\treturn url.replace(/[^.]\\.\\//g, '');\n};\n\nURI.buildQuery = function(kvp) {\n\tvar pairs = [];\n\tfor (var key in kvp) {\n\t\tpairs.push(encodeURIComponent(key) + '=' + encodeURIComponent(kvp[key]));\n\t}\n\treturn pairs.join('&');\n};\n\nURI.parseQuery = function(str) {\n\tvar pairs = str.split('&'),\n\t\tn = pairs.length,\n\t\tdata = {};\n\tfor (var i = 0; i < n; ++i) {\n\t\tvar pair = pairs[i].split('='),\n\t\t\tkey = decodeURIComponent(pair[0]);\n\t\tif (key) { data[key] = decodeURIComponent(pair[1]); }\n\t}\n\treturn data;\n};\n\n// Regexs are based on parseUri 1.2.2\n// Original: (c) Steven Levithan <stevenlevithan.com>\n// Original: MIT License\n\nvar strictRegex = /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nvar looseRegex = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nvar queryStringRegex = /(?:^|&)([^&=]*)=?([^&]*)/g;\n\nURI.parse = function(str, isStrict) {\n\tvar regex = isStrict ? strictRegex : looseRegex;\n\tvar result = {};\n\tvar match = regex.exec(str);\n\tfor (var i = 0, attr; attr = attrs[i]; ++i) {\n\t\tresult[attr] = match[i] || \"\";\n\t}\n\n\tvar qs = result['queryKey'] = {};\n\tresult['query'].replace(queryStringRegex, function(check, key, val) {\n\t\tif (check) {\n\t\t\tqs[key] = val;\n\t\t}\n\t});\n\n\treturn result;\n};\n\nURI.isSameDomain = function(urlA, urlB) {\n\tvar a = URI.parse(urlA);\n\tvar b = URI.parse(urlB);\n\treturn ((a.port == b.port ) && (a.host == b.host) && (a.protocol == b.protocol));\n};\n","pre":true},"modules/devkit-core/modules/squill/models/DataSource.js":{"path":"modules/devkit-core/modules/squill/models/DataSource.js","friendlyPath":"squill.models.DataSource","directory":"modules/devkit-core/modules/squill/models/","filename":"DataSource.js","src":"jsio('import lib.Callback');\njsio('import .BasicDataSource as BasicDataSource');\n\nvar modules_devkit_core_modules_squill_models_DataSource=__class__;var DataSource = exports=modules_devkit_core_modules_squill_models_DataSource(function modules_devkit_core_modules_squill_models_DataSource(){return this.init&&this.init.apply(this,arguments)},BasicDataSource, function(supr) {\n\n\tvar defaults = {\n\t\tkey: 'id'\n\t};\n\n\tthis.init = function(opts) {\n\t\tthis._opts = opts = merge(opts, defaults);\n\n\t\tsupr(this, 'init', [opts]);\n\n\t\tthis._byIndex = [];\n\t\tthis._byID = {};\n\t\tthis._ctor = opts.ctor;\n\t\tthis._reverse = opts.reverse;\n\n\t\tthis.length = 0;\n\n\t\tthis.onLoad = new lib.Callback();\n\n\t\tthis.setSorter(opts.sorter);\n\t\tthis.setPersistence(opts.persistence);\n\n\t\tthis._changeDataSave = false;\n\t\tthis._changeData = {\n\t\t\tupdated: [],\n\t\t\tupdatedHash: {},\n\t\t\tremoved: [],\n\t\t\tremovedHash: {}\n\t\t};\n\t};\n\n\tthis.setPersistence = function(persistence) {\n\t\tthis._persistence = persistence;\n\t\tif (persistence) {\n\t\t\tthis.onLoad.clear();\n\t\t\tpersistence.load(this, this.onLoad.chain());\n\t\t}\n\t}\n\n\tthis._saveChanges = function(type, key) {\n\t\tif (this._changeDataSave && !this._changeData[type + 'Hash'][key]) {\n\t\t\tthis._changeData[type + 'Hash'][key] = true;\n\t\t\tthis._changeData[type].push(key);\n\t\t}\n\t};\n\n\tthis.getFilteredDataSource = function(filterFn) {\n\t\tvar ds = new DataSource(this._opts);\n\t\tthis.forEach(function (item) {\n\t\t\tif (filterFn(item)) {\n\t\t\t\tds.add(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.subscribe('Update', function (id, item) {\n\t\t\tif (filterFn(item)) {\n\t\t\t\tds.add(item);\n\t\t\t} else {\n\t\t\t\tds.remove(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.subscribe('Remove', function (id, item) { ds.remove(item); });\n\t\treturn ds;\n\t};\n\n\tthis.signalUpdate = function(type, item, id) {\n\t\tif (item[this.key] === undefined) {\n\t\t\treturn;\n\t\t}\n\t\tswitch (type) {\n\t\t\tcase 'UPDATE':\n\t\t\t\tthis._saveChanges('updated', item[this.key]);\n\t\t\t\tthis.publish('Update', item[this.key], item);\n\t\t\t\tbreak;\n\n\t\t\tcase 'REMOVE':\n\t\t\t\tthis._saveChanges('removed', item[this.key]);\n\t\t\t\tthis.publish('Remove', id, item);\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\tvar toStringSort = function() {\n\t\treturn this._sortKey;\n\t};\n\t// NEVER CHANGE THE ID OF AN ITEM WITHOUT REMOVING IT FROM THE DATASOURCE FIRST.\n\t// Love, Jeff Hubbard and Marcus Cavanaugh\n\n\tthis.updated =\n\tthis.add = function(item) {\n\t\tif (isArray(item)) {\n\t\t\tvar res = [];\n\t\t\tfor (var i = 0, len = item.length; i < len; ++i) {\n\t\t\t\tif (item[i]) {\n\t\t\t\t\tvar obj = this.add(item[i]);\n\t\t\t\t\tif (obj) {\n\t\t\t\t\t\tres.push(obj);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn res;\n\t\t} else {\n\t\t\tvar id = item[this.key];\n\n\t\t\t// note: not the same as `if (!id) { ... }`\n\t\t\tif (id == null) { return; }\n\n\t\t\tvar index = null;\n\t\t\tif (this._byID[id]) {\n\t\t\t\tfor (var i = 0, _item; _item = this._byIndex[i]; ++i) {\n\t\t\t\t\tif (_item[this.key] == id) {\n\t\t\t\t\t\tif (typeof _item.update == 'function') {\n\t\t\t\t\t\t\t_item.update(item);\n\t\t\t\t\t\t\titem = _item;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tindex = this.length++;\n\t\t\t}\n\n\t\t\t// if we're adding it to the array:\n\t\t\tif (index !== null) {\n\n\t\t\t\t// make sure it's an instance of the specified class\n\t\t\t\tif (this._ctor && !(item instanceof this._ctor)) {\n\t\t\t\t\titem = new this._ctor(item);\n\t\t\t\t}\n\n\t\t\t\tthis._byIndex[index] = item;\n\t\t\t}\n\n\t\t\tthis._byID[id] = item;\n\n\t\t\tthis.signalUpdate('UPDATE', item);\n\n\t\t\tif (this._sorter) {\n\t\t\t\titem._sortKey = this._sorter(item);\n\t\t\t\titem.toString = toStringSort;\n\t\t\t}\n\t\t}\n\n\t\treturn item;\n\t};\n\n\tthis.remove = function(id) {\n\t\tif (typeof id == 'object') { id = id[this.key]; }\n\t\tif (id == null) { return; }\n\n\t\tif (this._byID[id]) {\n\t\t\tthis.signalUpdate('REMOVE', this._byID[id], id);\n\t\t\tdelete this._byID[id];\n\t\t\tfor (var i = 0, item; item = this._byIndex[i]; ++i) {\n\t\t\t\tif (item[this.key] == id) {\n\t\t\t\t\t--this.length;\n\t\t\t\t\treturn this._byIndex.splice(i, 1)[0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.keepOnly = function(list) {\n\t\tthis.compare(list, function(dataSource, local, remote) {\n\t\t\tif (!remote) {\n\t\t\t\tdataSource.remove(local);\n\t\t\t}\n\t\t});\n\t};\n\n\tthis.clear = function() {\n\t\tvar index = this._byIndex;\n\n\t\tthis._byIndex = [];\n\t\tthis._byID = {};\n\t\tthis.length = 0;\n\n\t\tfor (var i = 0, item; item = index[i]; ++i) {\n\t\t\tthis.signalUpdate('REMOVE', item, item[this.key]);\n\t\t}\n\t};\n\n\tthis.getCount = function() {\n\t\treturn this.length;\n\t};\n\n\tthis.setSorter = function(sorter) {\n\t\tthis._sorter = sorter;\n\t\tif (sorter) {\n\t\t\tfor (var i = 0, item; item = this._byIndex[i]; ++i) {\n\t\t\t\titem._sortKey = sorter(item);\n\t\t\t\titem.toString = toStringSort;\n\t\t\t}\n\t\t}\n\t\tthis.sort();\n\t\treturn this;\n\t};\n\n\tthis.getIDs = function () {\n\t\treturn this._byIndex.map(function (item) {\n\t\t\treturn item[this.key];\n\t\t}, this);\n\t};\n\n\tthis.contains = function(id) {\n\t\treturn !!this._byID[id];\n\t};\n\n\tthis.getKey = function() {\n\t\treturn this.key;\n\t}\n\n\tthis.get = this.getItemForID = function(id) {\n\t\treturn this._byID[id] || null;\n\t};\n\n\tthis.indexOf = function (item) {\n\t\treturn this._byIndex.indexOf(item);\n\t};\n\n\tthis.getItemForIndex = function(index) {\n\t\treturn this._byIndex[index];\n\t};\n\n\tthis.sort = function() {\n\t\tthis._byIndex.sort();\n\t\tthis._reverse && this._byIndex.reverse();\n\t};\n\n\tthis.forEach = this.each = function(cb, context) {\n\t\tfor (var i = 0; i < this.length; ++i) {\n\t\t\tif (cb.call(context, this._byIndex[i], i)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.toJSON = function() {\n\t\treturn {\n\t\t\tkey: this.key,\n\t\t\titems: this._byIndex\n\t\t};\n\t};\n\n\tthis.fromJSON = function(data) {\n\t\tthis.clear();\n\t\tvar key = this.key = data.key;\n\t\tthis.add(data.items);\n\t};\n\n\tthis.toArray = function() { return this._byIndex.slice(0); }\n\n\tthis.beginChanges = function() {\n\t\tthis._changeDataSave = true;\n\t\tthis._changeData = {\n\t\t\tupdated: [],\n\t\t\tupdatedHash: {},\n\t\t\tremoved: [],\n\t\t\tremovedHash: {}\n\t\t};\n\t};\n\n\tthis.saveChanges = function() {\n\t\tthis._changeDataSave = false;\n\t\tif (this._persistence) {\n\t\t\tvar changeData = this._changeData,\n\t\t\t\ti, j;\n\n\t\t\tthis._persistence.remove(changeData.removed);\n\n\t\t\tif (changeData.updated.length) {\n\t\t\t\tvar updateList = [];\n\t\t\t\tfor (i = 0, j = changeData.updated.length; i < j; i++) {\n\t\t\t\t\tupdateList.push(this._byID[changeData.updated[i]]);\n\t\t\t\t}\n\t\t\t\tthis._persistence.update(updateList);\n\t\t\t}\n\n\t\t\tthis._persistence.commit();\n\t\t}\n\t};\n\n\tthis.load = function(cb) {\n\t\tif (this._persistence) {\n\t\t\tthis._persistence.load(this, function(err) {\n\t\t\t\tif (err) {\n\t\t\t\t\tlogger.LOG&&console.log(\"LOG\",\"squill.models.DataSource\",'error loading', JSON.stringify(err));\n\t\t\t\t}\n\t\t\t\tcb && cb(err);\n\t\t\t});\n\t\t}\n\t};\n\n\tthis.save = function() {\n\t\tif (this._persistence) {\n\t\t\tthis._persistence.save(this);\n\t\t}\n\t}\n\n\tthis.compare = function(dict, cb) {\n\t\tvar key = this.key;\n\n\t\t// create a key-indexed copy of dict to run the comparison against\n\t\tvar compareTo = {};\n\t\tif (isArray(dict)) {\n\t\t\tfor (var i = 0, n = dict.length; i < n; ++i) {\n\t\t\t\tcompareTo[dict[i][key]] = dict[i];\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var k in dict) {\n\t\t\t\tcompareTo[k] = dict[k];\n\t\t\t}\n\t\t}\n\n\t\t// first, compare all items in the index to the dict items\n\t\tvar items = this._byIndex.slice(0);\n\t\tfor (var i = 0, item; item = items[i]; ++i) {\n\t\t\tvar k = item[key];\n\t\t\tcb.call(this, this, item, compareTo[k]);\n\t\t\tdelete compareTo[k];\n\t\t}\n\n\t\t// then, for any remaining dict items, they don't exist in the local version\n\t\tfor (var k in compareTo) {\n\t\t\tcb.call(this, this, null, compareTo[k]);\n\t\t}\n\t}\n\n\tthis.filter = function(filter) {\n\t\tvar result = new DataSource({key: this.key});\n\t\tvar key;\n\t\tvar item;\n\t\tvar match;\n\t\tvar i;\n\t\tvar j = this.length;\n\n\t\tresult.key = this.key;\n\t\tfor (i = 0; i < j; ++i) {\n\t\t\titem = this._byIndex[i];\n\t\t\tmatch = true;\n\t\t\tfor (key in filter) {\n\t\t\t\tif ((typeof item[key] == 'string') && (item[key].toLowerCase().indexOf(filter[key]) == -1)) {\n\t\t\t\t\tmatch = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (match) {\n\t\t\t\tresult.add(item);\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t};\n});\n","pre":true},"modules/devkit-core/modules/squill/models/BasicDataSource.js":{"path":"modules/devkit-core/modules/squill/models/BasicDataSource.js","friendlyPath":".BasicDataSource","directory":"modules/devkit-core/modules/squill/models/","filename":"BasicDataSource.js","src":"jsio('import lib.PubSub as PubSub');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_models_BasicDataSource=__class__;var BasicDataSource = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_models_BasicDataSource(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_models_BasicDataSource(){return this.init&&this.init.apply(this,arguments)},PubSub, function(supr) {\n\tthis.init = function(opts) {\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis.key = this._key = opts.key;\n\t\tthis._channel = opts.channel;\n\t\tthis._hasRemote = opts.hasRemote;\n\t};\n\n\tthis.getKey = function() {\n\t\treturn this._key;\n\t};\n});\n","pre":true},"modules/devkit-core/modules/squill/Selection.js":{"path":"modules/devkit-core/modules/squill/Selection.js","friendlyPath":".Selection","directory":"modules/devkit-core/modules/squill/","filename":"Selection.js","src":"jsio('import lib.PubSub');\n\n/**\n * The Selection class connects a selection storage to a UI element.\n *\n * A selection storage is very simple class that maintains the data layer of\n * a selection. It is entirely based on item ID, exposing the methods:\n *   isSelected(id) -> bool\n *   select(id)\n *   deselect(id)\n * You may, for example, want to implement a selection store that persists\n * the current selection over a network. The base implementation of a selection\n * storage is exports.LocalStore, which simply wraps an in-memory object.\n *\n * The Selection class handles logic such as how many items can be selected\n * at once, and provides the API that UI widgets can interact with.  For example,\n * the squill.List class contains a public proprty .selection that is an\n * instance of a Selection instance.\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Selection=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Selection(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Selection(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function() {\n\n\tthis.init = function(opts) {\n\t\tthis._parent = opts.parent;\n\t\tthis._type = opts.type || false;\n\t\tthis._selection = opts.selectionStore || new exports.LocalStore();\n\t\tthis._maxSelections = opts.maxSelections || 1;\n\t\tthis._currentSelectionCount = 0;\n\t\tthis._lastSelected = null;\n\t};\n\n\tthis.getType = function() { return this._type; };\n\n\tthis.isSelected = function(id) {\n\t\tif (typeof id == 'object') {\n\t\t\tid = id[this._parent.getDataSource().key];\n\t\t}\n\t\treturn this._selection.isSelected(id);\n\t};\n\n\tthis.toggle = function(item) {\n\t\tthis._setSelected(item, !this.isSelected(item[this._parent.getDataSource().key]));\n\t};\n\n\tthis.select = function(item) {\n\t\tif((this._currentSelectionCount < this._maxSelections) || this._type == 'single') {\n\t\t\tthis._setSelected(item, true);\n\t\t}\n\t};\n\n\tthis.deselect = function(item) {\n\t\tthis._setSelected(item, false);\n\t};\n\n\tthis.clear =\n\tthis.deselectAll = function() {\n\t\tthis._selection.deselectAll();\n\t\tthis._currentSelectionCount = 0;\n\t};\n\n\tthis.get = function() {\n\t\tif (this._maxSelections == 1) {\n\t\t\treturn Object.keys(this._selection.get())[0];\n\t\t} else {\n\t\t\treturn Object.keys(this._selection.get());\n\t\t}\n\t};\n\n\tthis.getSelectionCount = function() {\n\t\treturn this._currentSelectionCount;\n\t};\n\n\tthis._setSelected = function(item, isSelected) {\n\t\tif (!item) { return; }\n\n\t\tvar dataSource = this._parent.getDataSource(),\n\t\t\tkey = dataSource.key;\n\t\tif (typeof item == 'string') {\n\t\t\titem = dataSource.get(item);\n\t\t\tif (!item) { return; }\n\t\t}\n\t\tvar id = item[key];\n\n\t\tif (this._selection.isSelected(id) != isSelected) {\n\t\t\tif (isSelected) {\n\t\t\t\tif (this._lastSelected && this._type == 'single') {\n\t\t\t\t\tvar lastID = this._lastSelected[key];\n\t\t\t\t\tthis._selection.deselect(lastID);\n\t\t\t\t\tthis._currentSelectionCount--;\n\t\t\t\t\tthis.publish('Deselect', this._lastSelected, lastID);\n\t\t\t\t}\n\n\t\t\t\tthis._lastSelected = item;\n\t\t\t\tthis._selection.select(id);\n\t\t\t\tthis._currentSelectionCount++;\n\t\t\t} else {\n\t\t\t\tthis._selection.deselect(id);\n\t\t\t\tthis._currentSelectionCount--;\n\t\t\t}\n\n\t\t\tthis.publish(isSelected ? 'Select' : 'Deselect', item, id);\n\t\t}\n\t};\n});\n\nexports.LocalStore=__class__;exports.LocalStore=exports.LocalStore(function exports_LocalStore(){return this.init&&this.init.apply(this,arguments)},function() {\n\tthis.init = function() {\n\t\tthis._store = {};\n\t}\n\n\tthis.get = function() {\n\t\treturn merge({}, this._store);\n\t}\n\n\tthis.select = function(id) {\n\t\tthis._store[id] = true;\n\t}\n\n\tthis.deselect = function(id) {\n\t\tdelete this._store[id];\n\t}\n\n\tthis.deselectAll = function(id) {\n\t\tthis._store = {};\n\t}\n\n\tthis.isSelected = function(id) {\n\t\tif (id !== undefined) {\n\t\t\treturn !!this._store[id];\n\t\t} else {\n\t\t\tfor (var key in this._store) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t}\n});\n\n","pre":true},"modules/devkit-core/modules/squill/TextButton.js":{"path":"modules/devkit-core/modules/squill/TextButton.js","friendlyPath":".TextButton","directory":"modules/devkit-core/modules/squill/","filename":"TextButton.js","src":"jsio('import .Button, .Widget');\njsio('from util.browser import $');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TextButton=__class__;var TextButton = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TextButton(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TextButton(){return this.init&&this.init.apply(this,arguments)},Button, function(supr) {\n\tthis._type = 'text-button';\n\n\tthis.buildWidget = function() {\n\t\tvar el = this._el;\n\t\t$.setText(el, this.getI18n('label') || this.getI18n('text'));\n\n\t\tthis.initMouseEvents(el);\n\t\tthis.initKeyEvents(el);\n\t}\n\n\tthis.setLabel = function(label) {\n\t\tthis._opts.label = label;\n\t\tif(this._el) { $.setText(this._el, label); }\n\t}\n});\n\nWidget.register(TextButton, 'TextButton');\n","pre":true},"modules/devkit-core/modules/squill/Button.js":{"path":"modules/devkit-core/modules/squill/Button.js","friendlyPath":".Button","directory":"modules/devkit-core/modules/squill/","filename":"Button.js","src":"jsio('from util.browser import $');\njsio('import .Widget');\n\njsio('import .hint as hint');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Button=__class__;var Button = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Button(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Button(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._css = 'btn';\n\tthis._type = 'button';\n\n\tthis.init = function(params) {\n\t\tparams = merge(params, {tag: 'button', isEnabled: true});\n\t\tthis._isEnabled = params.isEnabled;\n\t\tsupr(this, 'init', [params]);\n\t\tthis._hint = params.hint;\n\t};\n\n\tthis.create = function() {\n\t\tthis._opts.style = JS.merge(this._opts.style, {\n\t\t\t\twhiteSpace: 'nowrap',\n\t\t\t\tdisplay: 'block'\n\t\t\t});\n\n\t\tsupr(this, 'create', arguments);\n\t};\n\n\tthis.buildWidget = function() {\n\t\tvar el = this._el;\n\n\t\tthis.initMouseEvents(el);\n\t\tthis.initKeyEvents(el);\n\n\t\tel.style.userSelect = 'none';\n\t\tel.style.MozUserSelect = 'none'; // Mozilla\n\t\tel.style.KhtmlUserSelect = 'none'; // Safari\n\t\tel.unselectable = 'on'; // IE\n\t};\n\n\tthis._setHintTimeout = function(e) {\n\t\tif (!this._hint) {\n\t\t\treturn;\n\t\t}\n\t\tthis._hintTimeout && clearTimeout(this._hintTimeout);\n\t\tthis._hintTimeout = setTimeout(\n\t\t\tbind(\n\t\t\t\tthis,\n\t\t\t\tfunction() {\n\t\t\t\t\thint.show(e.pageX + 12, e.pageY + 14, this._hint);\n\t\t\t\t}\n\t\t\t),\n\t\t\t300\n\t\t);\n\t};\n\n\tthis.onMouseOver = function(e) {\n\t\tthis._setHintTimeout(e);\n\t};\n\n\tthis.onMouseMove = function(e) {\n\t\tthis._setHintTimeout(e);\n\t};\n\n\tthis.onMouseOut = function(e) {\n\t\thint.hide();\n\t\tthis._hintTimeout && clearTimeout(this._hintTimeout);\n\t};\n\n\tthis.onClick = function(e) {\n\t\t$.stopEvent(e);\n\t\tif (!this._isEnabled) { return; }\n\n\t\tif (this._opts.onClick) {\n\t\t\tthis._opts.onClick(e, this);\n\t\t}\n\n\t\tsupr(this, 'onClick', arguments);\n\t};\n\n\tthis.captureOnEnter = function(widget) {\n\t\twidget.subscribe('KeyDown', this, 'onKeyDown');\n\t\twidget.subscribe('KeyUp', this, 'onKeyUp');\n\t};\n\n\tthis.onKeyDown = function(e) {\n\t\tif (e.keyCode == 13) { $.stopEvent(e); this.onMouseDown(); }\n\t};\n\n\tthis.onKeyUp = function(e) {\n\t\tif (e.keyCode == 13) { $.stopEvent(e); this.onMouseUp(); this.onClick(e); }\n\t};\n\n\tthis.show = function() {\n\t\tthis.onBeforeShow();\n\t\tthis.getElement().style.display = 'inline-block';\n\t\tthis.onShow();\n\t};\n\n\tthis.blur = function () { this._el && this._el.blur(); }\n\tthis.focus = function () { this._el && this._el.focus(); }\n\n\tthis.setEnabled = function(isEnabled) {\n\t\tif (this._isEnabled != isEnabled) {\n\t\t\tthis._isEnabled = isEnabled;\n\t\t\tif (!isEnabled) {\n\t\t\t\t$.addClass(this._el, 'disabled')\n\t\t\t} else {\n\t\t\t\t$.removeClass(this._el, 'disabled')\n\t\t\t}\n\t\t}\n\t};\n});\n\n","pre":true},"modules/devkit-core/modules/squill/hint.js":{"path":"modules/devkit-core/modules/squill/hint.js","friendlyPath":".hint","directory":"modules/devkit-core/modules/squill/","filename":"hint.js","src":"jsio('from util.browser import $');\n\nvar hint = $({parent: document.body, className: 'hint'});\n\nexports.show = function(x, y, text) {\n\thint.innerHTML = text;\n\thint.style.left = x + 'px';\n\thint.style.top = y + 'px';\n\thint.style.display = 'block';\n\n\tconsole.log(text);\n\tif (x + hint.offsetWidth >= document.width) {\n\t\thint.style.left = (x - hint.offsetWidth) + 'px';\n\t}\n};\n\nexports.hide = function() {\n\thint = hint || $({\n\t\tparent: document.body,\n\t\tclassName: 'graphHint'\n\t});\n\n\thint.style.display = 'none';\n};\n\nvar setHintTimeout = function(evt) {\n\tevt.target.hintTimeout && clearTimeout(evt.target.hintTimeout);\n\tevt.target.hintTimeout = setTimeout(\n\t\tbind(\n\t\t\tthis,\n\t\t\tfunction() {\n\t\t\t\texports.show(evt.pageX + 12, evt.pageY + 14, evt.target.hintText);\n\t\t\t}\n\t\t),\n\t\t300\n\t);\n};\n\nexports.add = function(el, text) {\n\tel.hintText = text;\n\n\t$.onEvent(el, 'mouseover', setHintTimeout);\n\t$.onEvent(el, 'mousemove', setHintTimeout);\n\t$.onEvent(\n\t\tel,\n\t\t'mouseout',\n\t\tfunction(evt) {\n\t\t\texports.hide();\n\t\t\tevt.target.hintTimeout && clearTimeout(evt.target.hintTimeout);\n\t\t}\n\t);\n}\n","pre":true},"modules/devkit-core/modules/squill/TextInput.js":{"path":"modules/devkit-core/modules/squill/TextInput.js","friendlyPath":".TextInput","directory":"modules/devkit-core/modules/squill/","filename":"TextInput.js","src":"jsio('from util.browser import $');\njsio('import .Widget');\njsio('import squill.models.bindings as bindings');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TextInput=__class__;var TextInput = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TextInput(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TextInput(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._type = 'text';\n\tthis._css = 'textInput';\n\n\tthis.init = function(opts) {\n\t\topts = merge(opts, {\n\t\t\tname: '',\n\t\t\tvalue: '',\n\t\t\tmultiline: false\n\t\t});\n\n\t\tthis._def = {\n\t\t\tchildren: [\n\t\t\t\t{tag: opts.multiline ? 'textarea' : 'input', id: '_input', attrs: {\n\t\t\t\t\ttype: 'text',\n\t\t\t\t\tvalue: opts.value,\n\t\t\t\t\tname: opts.name\n\t\t\t\t}, style: merge(opts.textStyle, {\n\t\t\t\t\tMozBoxSizing: 'border-box',\n\t\t\t\t\tWebkitBoxSizing: 'border-box',\n\t\t\t\t\tMsBoxSizing: 'border-box',\n\t\t\t\t\tboxSizing: 'border-box'\n\t\t\t\t})}\n\t\t\t],\n\t\t\tstyle: {position: 'relative'}\n\t\t};\n\n\t\tif (opts.prefixLabel) {\n\t\t\tthis._def.children.unshift({id: '_label', text: opts.label});\n\t\t}\n\n\t\tsupr(this, 'init', [opts]);\n\t}\n\n\tthis.buildWidget = function() {\n\t\tvar el = this._el;\n\t\tvar type = this._opts.type;\n\t\tif ('ontouchstart' in this._el) {\n\t\t\tthis._overlay = $({\n\t\t\t\tparent: this._el,\n\t\t\t\tattrs: {\n\t\t\t\t\tnoCapture: true\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\ttop: '0px',\n\t\t\t\t\tleft: '0px',\n\t\t\t\t\twidth: '100%',\n\t\t\t\t\theight: '100%',\n\t\t\t\t\tzIndex: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._overlay.addEventListener('click', bind(this, function() {\n\t\t\t\t$.hide(this._overlay);\n\t\t\t\tthis._input.focus();\n\t\t\t}), true);\n\t\t}\n\n\t\tvar opts = this._opts\n\t\tif (!opts.prefixLabel || opts.placeholder) {\n\t\t\tvar label = this.getI18n('label');\n\t\t\tif (this._input.getAttribute('placeholder') === null) {\n\t\t\t\tthis._input.setAttribute('placeholder', opts.placeholder || label);\n\t\t\t} else {\n\t\t\t\tthis._placeholder = $.create({\n\t\t\t\t\ttag: 'button',\n\t\t\t\t\ttext: label,\n\t\t\t\t\tstyle: {position: 'absolute'},\n\t\t\t\t\tparent: el\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.initMouseEvents(el);\n\t\tthis.initFocusEvents(this._input);\n\t\tthis.initKeyEvents(this._input);\n\t}\n\n\tthis.focus = function () { this._input.focus(); }\n\tthis.blur = function () { this._input.blur(); }\n\n\tthis.getInputElement = function () { return this._input; }\n\n\tthis.setName = function(name) {\n\t\tsupr(this, 'setName', arguments);\n\n\t\tif (this._input) { this._input.name = name; }\n\t}\n\n\tthis.setValue = function (value) {\n\t\tif (value === undefined) { value = \"\"; }\n\n\t\tthis.saveSelection();\n\t\tthis._value = this._input.value = value;\n\t\tthis.restoreSelection();\n\t}\n\n\tthis.getValue = function() { return this._input.value; }\n\n\tthis.onKeyDown = function() {\n\t\tsupr(this, 'onKeyDown', arguments);\n\t\tif (this._placeholder) { $.hide(this._placeholder); }\n\t}\n\n\tthis.onKeyUp = function() {\n\t\tsupr(this, 'onKeyUp', arguments);\n\t\tthis.checkLabel();\n\t\tthis.checkValue();\n\t}\n\n\tthis.onMouseDown = function(evt) {\n\t\tsupr(this, 'onMouseDown', arguments);\n\n\t\tevt.stopPropagation();\n//\t\t$.stopEvent(evt);\n\t}\n\n\tthis.onKeyPress = function(e) {\n\t\tsupr(this, 'onKeyPress', arguments);\n\t\tif (e.keyCode == 13) {\n\t\t\tthis.publish('EnterPressed');\n\t\t}\n\t\tthis.checkValue();\n\t}\n\n\tthis.onBlur = function() {\n\t\tsupr(this, 'onBlur');\n\t\tthis.checkLabel();\n\n\t\tif (this._overlay) {\n\t\t\t$.show(this._overlay);\n\t\t}\n\t}\n\n\tthis.isValid = function () { return this._isValid; }\n\n\tthis.checkValue = function() {\n\t\tvar value = this._input.value;\n\t\tvar formatter = this._opts.formatter;\n\t\tif (formatter) {\n\t\t\tvalue = formatter(value);\n\t\t}\n\n\t\tif (value == INVALID_VALUE) {\n\t\t\tthis._isValid = false;\n\t\t\t$.addClass(this._el, 'invalid');\n\t\t\treturn;\n\t\t}\n\n\t\tthis._isValid = true;\n\t\t$.removeClass(this._el, 'invalid');\n\t\tif (this._value != value) {\n\t\t\tthis._value = value;\n\t\t\tvar input = this._input;\n\t\t\tif (value != input.value) {\n\t\t\t\tthis.saveSelection();\n\t\t\t\tinput.value = value;\n\t\t\t\tthis.restoreSelection();\n\t\t\t}\n\t\t\tthis.publish('change', this._value);\n\t\t\tthis.publish('ValueChange', this._value);\n\t\t}\n\t}\n\n\tthis.saveSelection = function () {\n\t\tthis._selection = {\n\t\t\tstart: this._input.selectionStart,\n\t\t\tend: this._input.selectionEnd\n\t\t};\n\t}\n\n\tthis.restoreSelection = function () {\n\t\tvar input = this._input;\n\t\tif (this._isFocused) {\n\t\t\tinput.selectionStart = this._selection.start;\n\t\t\tinput.selectionEnd = this._selection.end;\n\t\t}\n\t}\n\n\tthis.checkLabel = function() {\n\t\tif(this._placeholder && /^\\s*$/.test(this._input.value)) {\n\t\t\t$.show(this._placeholder);\n\t\t}\n\t}\n\n\tthis.onClick = function() {\n\t\tsupr(this, 'onClick');\n\n\t\t//setTimeout(bind(this._input, 'focus'), 100);\n\t}\n\n\tthis.setEnabled = function (isEnabled) {\n\t\tthis._isEnabled = isEnabled;\n\t\tif (isEnabled) {\n\t\t\tdelete this._input.disabled;\n\t\t\tthis.removeClass('disabled');\n\t\t} else {\n\t\t\tthis._input.disabled = true;\n\t\t\tthis.addClass('disabled');\n\t\t}\n\t}\n\n\tthis.isEnabled = function () { return this._isEnabled; }\n\n\tthis.disable = function () { this.setEnabled(false); }\n\tthis.enable = function () { this.setEnabled(true); }\n});\n\nvar INVALID_VALUE = exports.INVALID_VALUE = {};\n\nWidget.register(TextInput, 'TextInput');\n","pre":true},"modules/devkit-core/modules/squill/TextArea.js":{"path":"modules/devkit-core/modules/squill/TextArea.js","friendlyPath":".TextArea","directory":"modules/devkit-core/modules/squill/","filename":"TextArea.js","src":"jsio('from util.browser import $');\njsio('import .Widget');\njsio('import .TextInput');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TextArea=__class__;var TextArea = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TextArea(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TextArea(){return this.init&&this.init.apply(this,arguments)},TextInput, function(supr) {\n\tthis._tag = 'textarea';\n});\n\nWidget.register(TextArea, 'TextArea');\n","pre":true},"modules/devkit-core/modules/squill/Scroller.js":{"path":"modules/devkit-core/modules/squill/Scroller.js","friendlyPath":".Scroller","directory":"modules/devkit-core/modules/squill/","filename":"Scroller.js","src":"jsio('import .Drag');\njsio('import .Widget');\njsio('import .transforms');\njsio('from util.browser import $');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Scroller=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Scroller(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Scroller(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._css = 'scroller';\n\n\tthis.init = function(opts) {\n\t\topts = merge(opts, {\n\t\t\tmomentum: true\n\t\t});\n\n\t\tthis._scrollTop = 0;\n\t\tthis._lastDelta = {\n\t\t\tdiff: 0,\n\t\t\twhen: 0,\n\t\t\tduration: 0\n\t\t};\n\n\t\tthis._hasMomentum = opts.momentum;\n\n\t\tsupr(this, 'init', [opts]);\n\t}\n\n\tthis.buildContent = function() {\n\t\tvar el = this._el;\n\n\t\t$.style(el, {height: '100%'});\n\n\t\tthis._scrollPane = $({\n\t\t\tparent: el,\n\t\t\tclassName: 'squill-scrollPane',\n\t\t\tminHeight: '100%'\n\t\t});\n\n\t\tif ('ontouchstart' in el) {\n\t\t\tel.addEventListener('touchstart', bind(this, 'onTouchStart'), true);\n\t\t\tel.addEventListener('mousedown', this, 'start')\n\t\t\tthis.initDragEvents();\n\t\t\tthis._el.style.overflow = 'hidden';\n\t\t\ttransforms.setTop(this._scrollPane, 0);\n\t\t} else {\n\t\t\tthis._el.style.overflow = 'auto';\n\t\t}\n\n\t\tif (this._def) {\n\t\t\tvar def = this._def;\n\t\t\tthis._def = null; // don't handle it in the supr call\n\n\t\t\t// build children into the scroll pane\n\t\t\tthis.buildChildren(merge({el: this._scrollPane}, def));\n\t\t}\n\n\t\treturn supr(this, 'buildContent', arguments);\n\t}\n\n\tthis.getScrollTop = function() { return this._scrollTop; }\n\tthis.getContainer =\n\tthis.getScrollPane = function() { return this._scrollPane; }\n\n\tthis.onTouchStart = function() {\n\t\tif (this._momentum) { clearInterval(this._momentum); }\n\t}\n\n\tthis.onDragStart = function(dragEvt, mouseEvt) {\n\t\tthis._height = this._scrollPane.offsetHeight - this._el.offsetHeight;\n\t\tthis._lastDelta.when = +new Date();\n\t\tif (this._momentum) { clearInterval(this._momentum); }\n\t}\n\n\tthis.onDrag = function(dragEvt, moveEvt, delta) {\n\t\tvar now = +new Date(),\n\t\t\td = this._lastDelta;\n\n\t\td.diff = delta.y;\n\t\td.duration = d.when && (now - d.when) || 0;\n\t\td.when = now;\n\n\t\tthis.scrollTo(this._scrollTop + delta.y);\n\t}\n\n\tthis.scrollTo = function(y, animate) {\n\t\tthis._scrollTop = y;\n\t\tif (this._scrollTop < -this._height) { this._scrollTop = -this._height; }\n\t\tif (this._scrollTop > 0) { this._scrollTop = 0; }\n\n\t\tthis._el.setAttribute('squill-scroller-top', -this._scrollTop);\n\n\t\tvar onFinish = bind(this, function() {\n\t\t\tif (document.createEvent) {\n\t\t\t\tvar e = document.createEvent('HTMLEvents');\n\t\t\t\te.initEvent('scroll', true, false);\n\t\t\t\tthis._el.dispatchEvent(e);\n\t\t\t}\n\t\t});\n\n\t\tif (animate) {\n\t\t\ttransforms.move(this._scrollPane, 0, this._scrollTop, '0.5s ease-in-out', onFinish);\n\t\t} else {\n\t\t\ttransforms.move(this._scrollPane, 0, this._scrollTop);\n\t\t\tonFinish();\n\t\t}\n\t}\n\n\tthis.onDragStop = function(dragEvt, selectEvt) {\n\t\t$.stopEvent(selectEvt);\n\t\tif (this._hasMomentum && this._lastDelta.duration != 0) {\n\t\t\tvar d = this._lastDelta,\n\t\t\t\tspeed = d.diff / d.duration,\n\t\t\t\tstart = d.when,\n\t\t\t\ttime = d.when,\n\t\t\t\tdir = speed > 0 ? 1 : -1,\n\t\t\t\tdur = 2;\n\n\t\t\tthis._momentum = setInterval(bind(this, function() {\n\t\t\t\tvar now = +new Date(),\n\t\t\t\t\tdt = now - time,\n\t\t\t\t\tdistance = speed * dt;\n\n\t\t\t\tthis.scrollTo(this._scrollTop + distance);\n\n\t\t\t\t// TODO: this isn't based on dt which is bad!!!\n\t\t\t\tspeed *= 0.95;\n\t\t\t\tif (Math.abs(speed) < 0.01) {\n\t\t\t\t\tclearTimeout(this._momentum);\n\t\t\t\t\tthis._momentum = null;\n\t\t\t\t}\n\t\t\t\ttime = now;\n\t\t\t}), 10);\n\t\t}\n\t}\n});\n","pre":true},"modules/devkit-core/modules/squill/transforms.js":{"path":"modules/devkit-core/modules/squill/transforms.js","friendlyPath":".transforms","directory":"modules/devkit-core/modules/squill/","filename":"transforms.js","src":"jsio('from util.browser import $');\n\nvar vendor = (/webkit/i).test(navigator.appVersion) ? 'webkit' :\n\t(/firefox/i).test(navigator.userAgent) ? 'Moz' :\n\t'opera' in window ? 'O' : '',\n\thas3d = 'WebKitCSSMatrix' in window && 'm11' in new WebKitCSSMatrix(),\n\thasTransform = vendor + 'Transform' in document.documentElement.style,\n\ttranslateStart = 'translate' + (has3d ? '3d(' : '('),\n\ttranslateEnd = has3d ? ',0)' : ')';\n\nif (hasTransform) {\n\texports.setLeft = function(el, left) {\n\t\tel.style[vendor + 'Transform'] = translateStart + left + 'px,0' + translateEnd;\n\t}\n\n\texports.setTop = function(el, top) {\n\t\tel.style[vendor + 'Transform'] = translateStart + '0,' + top + 'px' + translateEnd;\n\t}\n} else {\n\texports.setLeft = function(el, left) {\n\t\tel.style.left = left + 'px';\n\t}\n\n\texports.setTop = function(el, top) {\n\t\tel.style.top = top + 'px';\n\t}\n}\n\nexports.onTransitionEnd = function(el, cb) {\n\tvar executed = false;\n\tvar finished = function() {\n\t\tif (executed) { return; }\n\t\texecuted = true;\n\t\tfor (var i = 0, remove; remove = evts[i]; ++i) {\n\t\t\tremove();\n\t\t}\n\t\tcb();\n\t}\n\n\tvar evts = [\n\t\t$.onEvent(el, 'webkitTransitionEnd', finished),\n\t\t$.onEvent(el, 'transitionend', finished),\n\t\t$.onEvent(el, 'oTransitionEnd', finished)\n\t];\n}\n\nexports.setTransition = function(el, transition, cb) {\n\tif (transition) {\n\t\tvar oldTransition = el.style[vendor + 'Transition'];\n\t\texports.onTransitionEnd(el, function() {\n\t\t\tel.style[vendor + 'Transition'] = oldTransition;\n\t\t\tcb && cb();\n\t\t});\n\t\tel.style[vendor + 'Transition'] = '-' + vendor + '-transform ' + transition;\n\t} else {\n\t\tel.style[vendor + 'Transition'] = 'none';\n\t}\n}\n\nexports.rotate = function(el, rotation, transition, cb) {\n\tif (!hasTransform) { cb && cb(); return; }\n\texports.setTransition(el, transition, cb);\n\n\tel.style[vendor + 'Transform'] = 'rotate(' + rotation + ')';\n\n\tif (cb && !transition) { cb(); }\n}\n\nexports.move = function(el, x, y, transition, cb) {\n\tif (!hasTransform) { cb && cb(); return; }\n\texports.setTransition(el, transition, cb);\n\tel.style[vendor + 'Transform'] = translateStart + x + 'px,' + y + 'px' + translateEnd;\n\tif (cb && !transition) { cb(); }\n}\n\nexports.hasTransform = hasTransform;\n","pre":true},"modules/devkit-core/modules/squill/Canvas.js":{"path":"modules/devkit-core/modules/squill/Canvas.js","friendlyPath":".Canvas","directory":"modules/devkit-core/modules/squill/","filename":"Canvas.js","src":"jsio('from util.browser import $');\njsio('import .Widget');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Canvas=__class__;var Canvas = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Canvas(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Canvas(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._css = 'cnvs';\n\tthis._type = 'canvas';\n\n\tthis.init = function(params) {\n\t\tparams = merge(params, {tag: 'canvas'});\n\t\tthis._isEnabled = params.isEnabled;\n\t\tsupr(this, 'init', [params]);\n\t}\n\n\tthis.create = function() {\n\t\tsupr(this, 'create', arguments);\n\t};\n\n\tthis.buildWidget = function() {\n\t\tvar el = this._el;\n\n\t\tel.width = this._opts.width;\n\t\tel.height = this._opts.height;\n\t\tif (this._opts.color) {\n\t\t\tel.style.backgroundColor = this._opts.color;\n\t\t}\n\n\t\tthis.initMouseEvents(el);\n\t\tthis.initKeyEvents(el);\n\t};\n});\n\n","pre":true},"modules/devkit-core/modules/squill/CheckBox.js":{"path":"modules/devkit-core/modules/squill/CheckBox.js","friendlyPath":".CheckBox","directory":"modules/devkit-core/modules/squill/","filename":"CheckBox.js","src":"\njsio('import .Widget');\njsio('from util.browser import $');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_CheckBox=__class__;var CheckBox = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_CheckBox(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_CheckBox(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\n\tthis._css = 'checkbox';\n\n\tthis._def = {\n\t\ttag: 'label',\n\t\tchildren: [\n\t\t\t{id: 'checkbox', tag: 'input', attrs: {type: 'checkbox'}},\n\t\t\t{tag: 'span', id: 'label', text: ''}\n\t\t]\n\t};\n\n\tthis.buildWidget = function() {\n\t\tthis.setLabel(this._opts.label || '');\n\t\tif (this._opts.name) {\n\t\t\tthis.setName(this._opts.name);\n\t\t}\n\n\t\tif (this._opts.value) {\n\t\t\tthis.setValue(this._opts.value);\n\t\t}\n\n\t\tthis.initMouseEvents(this.checkbox);\n\t\t$.onEvent(this.checkbox, 'change', this, '_onCheck');\n\n\t\tif (this._opts.__result) {\n\t\t\tthis._opts.__result.addSubscription(this, 'Select', this._opts.id);\n\t\t}\n\t}\n\n\tthis._onCheck = function() {\n\t\tthis.publish('Check', this.isChecked());\n\t\tthis.emit('change', this.isChecked());\n\t}\n\n\tthis.setLabel = function (label) { $.setText(this.label, label); }\n\tthis.setName = function (name) { this.checkbox.name = name; }\n\n\tthis.setData =\n\tthis.setValue = function (value) { this.checkbox.checked = !!value; }\n\n\tthis.isChecked = function () { return this.checkbox.checked; }\n\tthis.setChecked = function (isChecked) { this.checkbox.checked = isChecked; }\n\n\tthis.getValue = function () { return this.isChecked() ? this.checkbox.value : null; }\n});\n","pre":true},"modules/devkit-core/modules/squill/Menu.js":{"path":"modules/devkit-core/modules/squill/Menu.js","friendlyPath":".Menu","directory":"modules/devkit-core/modules/squill/","filename":"Menu.js","src":"jsio('import lib.PubSub');\njsio('import .Widget');\njsio('import .Delegate');\n\njsio('from util.browser import $');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Menu=__class__;var Menu = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Menu(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Menu(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n  // this.init = function(params) {\n  //  var params = JS.merge(params, {parent: $.id('wrapper')});\n  //  supr(this, 'init', [params]);\n  // }\n\n  this._css = 'menu';\n\n  this._def = {\n    children: [{id: 'container'}]\n  };\n\n  // the default menu delegate just forwards to the menu controller\n  this.delegate = new Delegate(function(on) {\n    on.call = function(ctx, name) {\n      var delegate = ctx.controller.delegate;\n      delegate.call.apply(delegate, [ctx.controller].concat(Array.prototype.slice.call(arguments, 1)));\n    }\n  });\n\n  this.getContainer = function () { return this.container; }\n\n  this.onBeforeShow = function() {}\n  this.onShow = function() {}\n  this.onBeforeHide = function() {}\n  this.onHide = function() {}\n\n  this.toggle = function () {\n    if (this._isShowing) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  }\n\n  this.show = function() {\n    this._isShowing = true;\n\n    var menuEl = this._el;\n    var eventHandler = bind(this, function (e) {\n      var el = e.target;\n      while (el) {\n        if (el == menuEl) {\n          return true;\n        }\n\n        if (/squill-checkbox/.test(el.className)) {\n          return false;\n        }\n\n        el = el.parentNode;\n      }\n\n      // close menu\n      e.preventDefault && e.preventDefault();\n      e.stopImmediatePropagation && e.stopImmediatePropagation();\n      e.stopPropagation && e.stopPropagation();\n      e.cancelBubble = true;\n      return true;\n    });\n\n    var clickHandler = bind(this, function (e) {\n      if (eventHandler(e)) {\n        this.hide();\n\n        untrapIframes();\n        document.body.removeEventListener('mousedown', eventHandler, true);\n        document.body.removeEventListener('mouseup', eventHandler, true);\n        document.body.removeEventListener('click', clickHandler, true);\n      }\n    });\n\n    trapIframes();\n    document.body.addEventListener('mousedown', eventHandler, true);\n    document.body.addEventListener('mouseup', eventHandler, true);\n    document.body.addEventListener('click', clickHandler, true);\n\n    $.show(menuEl);\n\n    this.emit('open');\n    Menu.emit('open', this);\n  }\n\n  this.hide = function() {\n    this._isShowing = false;\n\n    $.hide(this._el);\n\n    this.emit('close');\n    Menu.emit('close', this);\n  }\n});\n\nvar subs = new lib.PubSub();\nMenu.emit = bind(subs, 'emit');\nMenu.on = bind(subs, 'on');\nMenu.removeListener = bind(subs, 'removeListener');\n\nvar _trappedFrames = [];\nfunction trapIframes() {\n  if (_trappedFrames.length) {\n    untrapIframes();\n  }\n\n  _trappedFrames = Array.prototype.map.call(document.getElementsByTagName('iframe'), function (el) {\n    var retVal = {\n        el: el,\n        set: el.style.pointerEvents\n      };\n\n    el.style.pointerEvents = 'none';\n\n    return retVal;\n  });\n}\n\nfunction untrapIframes() {\n  _trappedFrames.forEach(function (item) {\n    item.el.style.pointerEvents = item.set;\n  });\n}\n","pre":true},"modules/devkit-core/modules/squill/Slider.js":{"path":"modules/devkit-core/modules/squill/Slider.js","friendlyPath":".Slider","directory":"modules/devkit-core/modules/squill/","filename":"Slider.js","src":"jsio('from util.browser import $');\njsio('import .Widget');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Slider=__class__;var Slider = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Slider(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Slider(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._css = 'rng';\n\tthis._type = 'range';\n\n\tthis.init = function(params) {\n\t\tthis._width = params.width || 100;\n\t\tthis._padding = 12;\n\t\tthis._hover = false;\n\t\tthis._fillColor = params.fillColor || '#000000';\n\t\tthis._lineColor = params.lineColor || '#FFFFFF';\n\n\t\tthis._def = {\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\tid: params.id + 'Canvas',\n\t\t\t\t\ttag: 'canvas',\n\t\t\t\t\tattrs: {width: this._width, height: this._padding * 2}\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\tsupr(this, 'init', [params]);\n\t};\n\n\tthis._render = function() {\n\t\tvar width = this._width,\n\t\t\tpadding = this._padding,\n\t\t\tctx = this._ctx,\n\t\t\tradialGradient,\n\t\t\tv;\n\n\t\tctx.clearRect(0, 0, width, padding * 2);\n\n\t\tctx.lineCap = 'round';\n\n\t\tctx.beginPath();\n\t\tctx.arc(padding + 2, padding, 2, Math.PI * 0.5, Math.PI * 1.5, false);\n\t\tctx.arc(width - padding - 2, padding, 2, Math.PI * 1.5, Math.PI * 0.5, false);\n\t\tctx.closePath();\n\n\t\tctx.lineWidth = 1;\n\t\tctx.strokeStyle = this._lineColor;\n\t\tctx.stroke();\n\t\tctx.fillStyle = this._fillColor;\n\t\tctx.fill();\n\n\t\tctx.save();\n\n\t\tif (this._hover) {\n\t\t\tctx.shadowOffsetX = 0;\n\t\t\tctx.shadowOffsetY = 0;\n\t\t\tctx.shadowBlur = 10;\n\t\t\tctx.shadowColor = '#0099FF';\n\t\t}\n\n\t\tv = ~~((width - padding * 2) * (this.value - this.min) / (this.max - this.min));\n\n\t\tctx.beginPath();\n\t\tctx.arc(padding + v, padding, 5, 0, Math.PI * 2, false);\n\t\tctx.closePath();\n\n\t\tradialGradient = ctx.createRadialGradient(padding - 1 + v, padding - 1, 0, padding + v, padding, 4);\n\n\t\tradialGradient.addColorStop(0, '#FFFFFF');\n\t\tradialGradient.addColorStop(1, '#707070');\n\t\tctx.fillStyle = radialGradient;\n\t\tctx.fill();\n\n\t\tctx.restore();\n\t};\n\n\tthis.buildWidget = function() {\n\t\tvar el = this._el;\n\t\t\tcanvas = el.firstChild;\n\n\t\tel.slider = this;\n\n\t\t$.onEvent(canvas, 'mouseout', this, '_onMouseOut');\n\t\t$.onEvent(canvas, 'mousedown', this, '_onMouseDown');\n\t\t$.onEvent(canvas, 'mouseup', this, '_onMouseUp');\n\t\t$.onEvent(canvas, 'mousemove', this, '_onMouseMove');\n\n\t\tthis.min = this._opts.min || 0;\n\t\tthis.max = this._opts.max || 100;\n\t\tthis.step = this._opts.step || 1;\n\t\tthis.value = this._opts.value || 0;\n\n\t\tthis._mouseDown = false;\n\t\tthis._checkRange();\n\t\tthis._ctx = canvas.getContext('2d');\n\t\tthis._render();\n\t};\n\n\tthis.setValue = function(value) {\n\t\tthis.value = value;\n\t\tthis._render();\n\t};\n\n\tthis._onChange = function() {\n\t\tthis.publish('Change', this.value);\n\t};\n\n\tthis._checkRange = function() {\n\t\tif (this.value < this.min) {\n\t\t\tthis.value = this.min;\n\t\t}\n\t\tif (this.value > this.max) {\n\t\t\tthis.value = this.max;\n\t\t}\n\t};\n\n\tthis._checkMouse = function(evt) {\n\t\tvar mouseX = evt.offsetX,\n\t\t\tmouseY = evt.offsetY,\n\t\t\twidth = this._width,\n\t\t\tpadding = this._padding,\n\t\t\thover = this._hover,\n\t\t\tvalue;\n\n\t\tif (this._mouseDown) {\n\t\t\tif ((mouseX > padding) && (mouseY > padding - 5) && (mouseX < width - padding) && (mouseY < padding + 5)) {\n\t\t\t\tvalue = (evt.offsetX - padding) / (width - padding * 2) * (this.max - this.min);\n\t\t\t\tvalue = this.min + Math.round(value / this.step) * this.step;\n\t\t\t\tthis.value = value;\n\t\t\t\tthis._checkRange();\n\t\t\t\tthis._render();\n\t\t\t\tthis._onChange();\n\t\t\t}\n\t\t} else {\n\t\t\tif ((mouseY > padding - 5) && (mouseY < padding + 5)) {\n\t\t\t\tv = padding + ~~((width - padding * 2) * (this.value - this.min) / (this.max - this.min));\n\t\t\t\tthis._hover = (mouseX > v - 5) && (mouseY < v + 5);\n\t\t\t} else {\n\t\t\t\tthis._hover = false;\n\t\t\t}\n\n\t\t\tif (this._hover !== hover) {\n\t\t\t\tthis._render();\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._onMouseOut = function(evt) {\n\t\tthis._mouseDown = false;\n\t\tthis._hover = false;\n\t\tthis._render();\n\t};\n\n\tthis._onMouseDown = function(evt) {\n\t\tthis._mouseDown = true;\n\t\tthis._checkMouse(evt);\n\t};\n\n\tthis._onMouseUp = function(evt) {\n\t\tthis._mouseDown = false;\n\t};\n\n\tthis._onMouseMove = function(evt) {\n\t\tthis._checkMouse(evt);\n\t};\n});\n\n","pre":true},"modules/devkit-core/modules/squill/Color.js":{"path":"modules/devkit-core/modules/squill/Color.js","friendlyPath":".Color","directory":"modules/devkit-core/modules/squill/","filename":"Color.js","src":"jsio('from util.browser import $');\njsio('import .Widget');\n\njsio('import .jscolor.jscolor as jscolor');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Color=__class__;var Color = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Color(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Color(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._css = 'clr';\n\tthis._type = 'text';\n\n\tthis.init = function(params) {\n\t\tparams = merge(params, {tag: 'input'});\n\t\tthis._isEnabled = params.isEnabled;\n\n\t\tsupr(this, 'init', [params]);\n\n\t};\n\n\tthis.buildWidget = function() {\n\t\tvar el = this._el;\n\n\t\t$.addClass(el, 'squill-color');\n\t\tel.min = this._opts.min || 0;\n\t\tel.max = this._opts.max || 100;\n\t\tel.step = this._opts.step || 1;\n\t\tel.value = this._opts.value || 0;\n\t\tel.onchange = bind(this, this._onChange);\n\n\t\tjscolor.bind(el);\n\t};\n\n\tthis.setValue = function(value) {\n\t\tif (value) {\n\t\t\tif (value[0] !== '#') {\n\t\t\t\tvalue = '#' + value;\n\t\t\t}\n\t\t\tthis._el.style.backgroundColor = value;\n\n\t\t\tvalue = value.substr(1, 6);\n\t\t}\n\t\tthis._el.value = value;\n\t};\n\n\tthis.getValue = function() {\n\t\treturn this._el.value;\n\t};\n\n\tthis._onChange = function() {\n\t\tthis.publish('Change', this._el.value);\n\t};\n});\n\n","pre":true},"modules/devkit-core/modules/squill/VerticalCenter.js":{"path":"modules/devkit-core/modules/squill/VerticalCenter.js","friendlyPath":".VerticalCenter","directory":"modules/devkit-core/modules/squill/","filename":"VerticalCenter.js","src":"jsio('import .Widget');\njsio('from util.browser import $');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_VerticalCenter=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_VerticalCenter(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_VerticalCenter(){return this.init&&this.init.apply(this,arguments)},Widget, function() {\n\tthis._def = {\n\t\ttag: 'table',\n\t\tstyle: merge({height: '100%', width: '100%'}, def.style),\n\t\tattrs: {cellpadding: 0, cellspacing: 0},\n\t\tchildren: [\n\t\t\t$({tag: 'tbody', children: [\n\t\t\t\t$({tag: 'tr', children: [\n\t\t\t\t\t$({id: 'contentPane', tag: 'td', attrs: {valign: 'middle'}, style: {verticalAlign: 'middle'}})\n\t\t\t\t]})\n\t\t\t]})\n\t\t]\n\t};\n\n\tthis.addElement = function() { this.contentPane.appendChild(el); }\n});\n","pre":true},"modules/devkit-core/modules/squill/TreeList.js":{"path":"modules/devkit-core/modules/squill/TreeList.js","friendlyPath":".TreeList","directory":"modules/devkit-core/modules/squill/","filename":"TreeList.js","src":"jsio('from util.browser import $');\n\njsio('import .Widget');\n\nvar elementIDPrefix = 0;\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TreeList=__class__;var TreeList = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TreeList(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_TreeList(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tvar defaults = {\n\t\tkey: 'id',\n\t\tlabel: 'title',\n\t\twrapperId: 'browser',\n\t\tcontentId: 'contentWrapper'\n\t};\n\n\tthis.init = function(opts) {\n\t\topts = opts || {};\n\t\topts = merge(opts, defaults);\n\n\t\tthis._initClasses(opts);\n\n\t\tthis._key = opts.key;\n\t\tthis._label = opts.label;\n\t\tthis._wrapperId = opts.wrapperId;\n\t\tthis._contentId = opts.contentId;\n\t\tthis._leaveWidth = opts.leaveWidth || 600;\n\n\t\telementIDPrefix++;\n\t\tthis._elementIDPrefix = 'menuItem' + elementIDPrefix + '_';\n\n\t\tif (opts.dataSource) {\n\t\t\tthis.setDataSource(opts.dataSource);\n\t\t} else {\n\t\t\tthis._dataSource = null;\n\t\t}\n\n\t\tthis._def = {id: this._wrapperId, className: 'browser', children: [\n\t\t\t\t\t\t{id: this._contentId, className: 'contentWrapper', children: []}\n\t\t\t\t\t]};\n\n\t\tthis._root = null;\n\t\tthis._itemByKey = {};\n\n\t\tsupr(this, 'init', arguments);\n\t};\n\n\tthis._initClasses = function(opts) {\n\t\tthis._classNames = {\n\t\t\tnodeWrapper: opts.nodeWrapper || 'browserNodeWrapper',\n\t\t\tnodeWrapperHidden: opts.nodeWrapperHidden || 'browserNodeWrapperHidden',\n\t\t\tnode: opts.node || 'browserNode',\n\t\t\tnodeChildren: opts.nodeChildren || 'children', // Node has children...\n\t\t\tnodeActive: opts.nodeActive || 'active', // Selected node...\n\t\t\tnodeActiveChild: opts.nodeActiveChild || 'browserNodeActiveChild'\n\t\t};\n\t};\n\n\tthis._clearItem = function(item) {\n\t\tvar parent,\n\t\t\tchildren,\n\t\t\ti, j;\n\n\t\tif (item.children) {\n\t\t\tchildren = item.children;\n\t\t\twhile (children.length) {\n\t\t\t\tthis._clearItem(children.pop());\n\t\t\t}\n\t\t}\n\n\t\tif (item.parent) {\n\t\t\tparent = item.parent;\n\t\t\tchildren = parent.children;\n\t\t\tfor (i = 0, j = children.length; i < j; i++) {\n\t\t\t\tif (children[i] === item) {\n\t\t\t\t\tchildren.splice(i, 1);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!children.length && parent.group) {\n\t\t\t\t$.remove(parent.group.parentNode);\n\t\t\t\t$.remove(parent.group);\n\t\t\t\tdelete(parent.group);\n\t\t\t}\n\t\t}\n\n\t\t$.remove(item.node);\n\t\titem.group && $.remove(item.group);\n\t};\n\n\tthis._createMenuId = function(inc) {\n\t\tvar menuId = this._menuId;\n\t\tif (inc) {\n\t\t\tthis._menuId++;\n\t\t}\n\t\treturn this._elementIDPrefix + menuId;\n\t};\n\n\tthis._createGroup = function(visible) {\n\t\tvar menuId = this._createMenuId(true),\n\t\t\tnode = $({\n\t\t\t\t\tparent: $({\n\t\t\t\t\t\t\t\tparent: $.id(this._contentId),\n\t\t\t\t\t\t\t\tid: menuId,\n\t\t\t\t\t\t\t\tclassName: visible ? this._classNames.nodeWrapper : this._classNames.nodeWrapperHidden\n\t\t\t\t\t\t\t}),\n\t\t\t\t\tclassName: this._classNames.node\n\t\t\t\t});\n\n\t\tnode.menuId = menuId;\n\t\treturn node;\n\t};\n\n\tthis._createItem = function(item, group) {\n\t\tvar id = this._createMenuId(true);\n\n\t\titem.node = $({parent: group, id: id, tag: 'a', text: item[this._label]});\n\t\t$.onEvent(id, 'click', this, 'onClick', item);\n\t};\n\n\tthis.buildWidget = function() {\n\t\tthis._menuId = 0;\n\t\tthis._menuById = [];\n\t\tthis._menuStack = [];\n\t\tthis._menuActiveItem = false;\n\n\t\tif (this._dataSource !== null) {\n\t\t\tthis._dataSource.each(bind(this, this.onCreateItem));\n\t\t}\n\t};\n\n\tthis._removeFromStack = function(depth) {\n\t\tvar menuStack = this._menuStack,\n\t\t\tinfo = null;\n\n\t\twhile (menuStack.length && (menuStack[menuStack.length - 1].depth >= depth)) {\n\t\t\tinfo = menuStack.pop();\n\n\t\t\t$.removeClass(info.node.id, this._classNames.nodeActive);\n\t\t\t$.removeClass(info.node.id, this._classNames.nodeActiveChild);\n\n\t\t\tif (info.group) {\n\t\t\t\t$.addClass(info.group.menuId, this._classNames.nodeWrapperHidden);\n\t\t\t\t$.removeClass(info.group.menuId, this._classNames.nodeWrapper);\n\t\t\t}\n\t\t}\n\n\t\treturn info;\n\t};\n\n\tthis.applyNodeStyle = function(item) {\n\t\tif (item.children && item.children.length) {\n\t\t\t$.addClass(item.node, this._classNames.nodeChildren);\n\t\t} else {\n\t\t\t$.removeClass(item.node, this._classNames.nodeChildren)\n\t\t}\n\t\tif (item === this._menuActiveItem) {\n\t\t\t$.addClass(item.node, this._classNames.nodeActive);\n\t\t} else {\n\t\t\t$.removeClass(item.node, this._classNames.nodeActive);\n\t\t}\n\n\t\tif ((item.removeCustomClass !== undefined) && item.removeCustomClass) {\n\t\t\t$.removeClass(item.node, item.removeCustomClass);\n\t\t}\n\t\tif ((item.customClass !== undefined) && item.customClass) {\n\t\t\t$.removeClass(item.node, item.customClass);\n\t\t\t$.addClass(item.node, item.customClass);\n\t\t}\n\t};\n\n\tthis._addToStack = function(item) {\n\t\tthis._menuStack.push(item);\n\t\tthis.applyNodeStyle(item);\n\n\t\tif (item.children && item.children.length) {\n\t\t\tif (!item.group) {\n\t\t\t\tvar child,\n\t\t\t\t\ti, j;\n\n\t\t\t\titem.children.sort();\n\n\t\t\t\titem.group = this._createGroup(true);\n\t\t\t\tfor (i = 0, j = item.children.length; i < j; i++) {\n\t\t\t\t\tchild = item.children[i];\n\t\t\t\t\tthis._createItem(child, item.group);\n\n\t\t\t\t\t// DisplayItem might change the styling of the element!\n\t\t\t\t\tthis.publish('DisplayItem', child.data, child);\n\t\t\t\t\tthis.applyNodeStyle(child);\n\t\t\t\t}\n\t\t\t}\n\t\t\t$.addClass(item.group.menuId, this._classNames.nodeWrapper);\n\t\t\t$.removeClass(item.group.menuId, this._classNames.nodeWrapperHidden);\n\t\t}\n\t};\n\n\tthis.onClick = function(item) {\n\t\tvar menuStack = this._menuStack;\n\t\tvar lastItem = null;\n\t\tvar id;\n\t\tvar i;\n\n\t\tthis.publish('SelectItem', item.data, item);\n\n\t\tif (this._menuActiveItem) {\n\t\t\tlastItem = this._menuActiveItem;\n\t\t\tthis._menuActiveItem = null;\n\t\t\tthis.applyNodeStyle(lastItem);\n\t\t\tlastItem = null;\n\t\t}\n\n\t\tif (menuStack.length && (item.depth <= menuStack[menuStack.length - 1].depth)) {\n\t\t\tlastItem = this._removeFromStack(item.depth);\n\t\t}\n\t\tif (lastItem !== item) {\n\t\t\tthis._addToStack(item);\n\t\t}\n\n\t\tthis._menuActiveItem = item;\n\t\tthis.applyNodeStyle(item);\n\n\t\tif (menuStack.length) {\n\t\t\ti = menuStack.length;\n\t\t\tif (menuStack[menuStack.length - 1].children && menuStack[menuStack.length - 1].children.length) {\n\t\t\t\ti++;\n\t\t\t}\n\t\t\t$.id(this._contentId).style.width = (i * 200 + this._leaveWidth) + 'px';\n\t\t}\n\t};\n\n\tthis.onUpdateItem = function(item, key) {\n\t\tvar treeItem = {\n\t\t\t\ttitle: item[this._label],\n\t\t\t\ttoString: function() { return this.title; }\n\t\t\t},\n\t\t\tparentItem,\n\t\t\tchildren,\n\t\t\tchild,\n\t\t\ti, j;\n\n\t\tif (this._itemByKey[key]) {\n\t\t\tif (this._itemByKey[key].node) {\n\t\t\t\tthis._itemByKey[key].node.innerHTML = item[this._label];\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif ((item.parent === null) || (item.parent === -1)) {\n\t\t\tif (this._root === null) {\n\t\t\t\tthis._rootGroup = this._createGroup(true);\n\t\t\t\tthis._createItem(treeItem, this._rootGroup);\n\t\t\t\tthis._root = treeItem;\n\n\t\t\t\ttreeItem.data = item;\n\t\t\t\ttreeItem.depth = 0;\n\t\t\t\ttreeItem.parent = null;\n\n\t\t\t\t// DisplayItem might change the styling of the element!\n\t\t\t\tthis.publish('DisplayItem', treeItem.data, treeItem);\n\t\t\t\tthis.applyNodeStyle(treeItem);\n\t\t\t}\n\t\t} else {\n\t\t\tparentItem = this._itemByKey[item.parent[this._key]];\n\t\t\tif (parentItem) {\n\t\t\t\tif (!parentItem.children) {\n\t\t\t\t\tparentItem.children = [];\n\t\t\t\t}\n\t\t\t\tchildren = parentItem.children;\n\n\t\t\t\tif (this._menuActiveItem && ((this._menuActiveItem === parentItem) || (this._menuActiveItem.parent === parentItem))) {\n\t\t\t\t\tfor (i = 0, j = children.length; i < j; i++) {\n\t\t\t\t\t\tif (children[i].node) {\n\t\t\t\t\t\t\t$.remove(children[i].node)\n\t\t\t\t\t\t\tchildren[i].node = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tchildren.push(treeItem);\n\t\t\t\t\tchildren.sort();\n\n\t\t\t\t\tif (!parentItem.group) {\n\t\t\t\t\t\tparentItem.group = this._createGroup(true);\n\t\t\t\t\t\t$.id(this._contentId).style.width = ((this._menuStack.length + 1) * 200 + 500) + 'px';\n\t\t\t\t\t}\n\t\t\t\t\tfor (i = 0, j = children.length; i < j; i++) {\n\t\t\t\t\t\tchild = children[i];\n\t\t\t\t\t\tthis._createItem(child, parentItem.group);\n\n\t\t\t\t\t\t// DisplayItem might change the styling of the element!\n\t\t\t\t\t\tthis.publish('DisplayItem', child.data, child);\n\t\t\t\t\t\tthis.applyNodeStyle(child);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tchildren.push(treeItem);\n\t\t\t\t}\n\t\t\t}\n\t\t\ttreeItem.depth = parentItem.depth + 1;\n\t\t\ttreeItem.parent = parentItem;\n\t\t}\n\n\t\ttreeItem.data = item;\n\t\tthis._itemByKey[key] = treeItem;\n\t};\n\n\tthis.onCreateItem = function(item) {\n\t\tthis.onUpdateItem(item, item[this._key]);\n\t};\n\n\tthis.onRemoveItem = function(item, key) {\n\t\tvar treeItem = this._itemByKey[key];\n\t\tvar lastChild;\n\t\tvar treeParent;\n\n\t\tif (treeItem) {\n\t\t\tlastChild = (treeItem.parent.children.length <= 1);\n\t\t\ttreeParent = item[this._dataSource.parentKey];\n\n\t\t\tthis._removeFromStack(this._itemByKey[key].depth - 1);\n\t\t\tthis._clearItem(this._itemByKey[key]);\n\t\t\tthis._menuActiveItem = false;\n\n\t\t\tdelete(this._itemByKey[key]);\n\t\t\tthis.publish('UnSelectItem');\n\n\t\t\tif (lastChild && treeParent) {\n\t\t\t\ttreeItem = this._itemByKey[treeParent[this._dataSource.key]];\n\t\t\t\tthis.publish('DisplayItem', treeItem.data, treeItem);\n\t\t\t\tthis.applyNodeStyle(treeItem);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.showItem = function(item) {\n\t\tvar treeItem = this.getTreeNode(item);\n\t\tthis.publish('DisplayItem', item, treeItem);\n\t\tthis.applyNodeStyle(treeItem);\n\t};\n\n\tthis.setDataSource = function(dataSource) {\n\t\tthis._dataSource = dataSource;\n\t\tthis._dataSource.subscribe('Update', this, this.onUpdateItem);\n\t\tthis._dataSource.subscribe('Remove', this, this.onRemoveItem);\n\t};\n\n\tthis.getPathString = function(separator) {\n\t\tvar result = '',\n\t\t\tmenuStack = this._menuStack,\n\t\t\ti, j;\n\n\t\tseparator = separator || ' ';\n\t\tfor (i = 0, j = menuStack.length; i < j; i++) {\n\t\t\tif (result !== '') {\n\t\t\t\tresult += separator;\n\t\t\t}\n\t\t\tresult += menuStack[i].data[this._label];\n\t\t}\n\n\t\treturn result;\n\t};\n\n\tthis.getTreeNode = function(item) {\n\t\treturn this._itemByKey[item[this._dataSource.key]];\n\t};\n});\n","pre":true},"modules/devkit-core/modules/squill/Graph.js":{"path":"modules/devkit-core/modules/squill/Graph.js","friendlyPath":".Graph","directory":"modules/devkit-core/modules/squill/","filename":"Graph.js","src":"jsio('from util.browser import $');\njsio('import .Widget');\n\njsio('import .hint as hint');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Graph=__class__;var Graph = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Graph(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_Graph(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\tthis._css = 'cnvs';\n\tthis._type = 'canvas';\n\n\tthis.init = function(opts) {\n\t\tparams = merge(opts, {tag: 'canvas'});\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis.setSettings(opts.settings || {});\n\n\t\tthis._width = opts.width || 400;\n\t\tthis._height = opts.height || 400;\n\n\t\tthis._rectangles = [];\n\t\tthis._data = false;\n\n\t\t$.onEvent(this._el, 'mousemove', this, this._onMouseMove);\n\t\t$.onEvent(this._el, 'mouseout', this, this._onMouseOut);\n\t};\n\n\tthis._onMouseMove = function(evt) {\n\t\tvar rectangles = this._rectangles,\n\t\t\trectangle,\n\t\t\tfound = false,\n\t\t\ti = rectangles.length;\n\n\t\twhile (i) {\n\t\t\trectangle = rectangles[--i];\n\t\t\tif ((evt.offsetX >= rectangle.x1) && (evt.offsetY >= rectangle.y1) &&\n\t\t\t\t(evt.offsetX <= rectangle.x2) && (evt.offsetY <= rectangle.y2)) {\n\t\t\t\tfound = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (found) {\n\t\t\thint.show(evt.pageX + 15, evt.pageY + 15, rectangle.label);\n\t\t} else {\n\t\t\thint.hide();\n\t\t}\n\t};\n\n\tthis._onMouseOut = function(evt) {\n\t\thint.hide();\n\t};\n\n\tthis.buildWidget = function() {\n\t\tvar el = this._el;\n\n\t\tthis.initMouseEvents(el);\n\t\tthis.initKeyEvents(el);\n\t};\n\n\tthis._renderBackground = function(ctx) {\n\t\tvar el = this._el,\n\t\t\twidth = el.width,\n\t\t\theight = el.height;\n\n\t\tthis._currentWidth = width;\n\t\tthis._currentHeight = height;\n\n\t\tif (this._settings.fillColor) {\n\t\t\tctx.fillStyle = this._settings.fillColor;\n\t\t\tctx.fillRect(0, 0, width, height);\n\t\t} else {\n\t\t\tctx.clearRect(0, 0, width, height);\n\t\t}\n\t};\n\n\tthis._calculateSegments = function(ctx, data) {\n\t\tvar settings = this._settings,\n\t\t\tmax = 0,\n\t\t\tmaxLabel = 0,\n\t\t\ti, j = data.length,\n\t\t\tk, l;\n\n\t\tfor (i = 0; i < j; i++) {\n\t\t\titem = data[i];\n\t\t\tmaxLabel = Math.max(ctx.measureText(item.title).width, maxLabel);\n\t\t\tif (maxLabel > settings.maxLabelSize) {\n\t\t\t\tmaxLabel = settings.maxLabelSize;\n\t\t\t}\n\t\t\tfor (k = 0, l = item.points.length; k < l; k++) {\n\t\t\t\tmax = Math.max(item.points[k], max);\n\t\t\t}\n\t\t}\n\n\t\tvar steps = [0.5, 0.25, 0.2, 0.125, 0.1],\n\t\t\tstepIndex = 0,\n\t\t\tstepCount,\n\t\t\tfactor = 1;\n\n\t\twhile (max / (steps[stepIndex] * factor) > 10) {\n\t\t\tstepIndex++;\n\t\t\tif (stepIndex >= steps.length) {\n\t\t\t\tstepIndex = 0;\n\t\t\t\tfactor *= 10;\n\t\t\t}\n\t\t}\n\n\t\tstepCount = Math.ceil(max / (steps[stepIndex] * factor));\n\t\treturn {\n\t\t\tsteps: stepCount,\n\t\t\tstep: steps[stepIndex],\n\t\t\tmax: stepCount * steps[stepIndex] * factor,\n\t\t\tmaxLabel: maxLabel + 4,\n\t\t\tfactor: factor\n\t\t}\n\t};\n\n\tthis._trimLabel = function(segmentInfo, ctx, label) {\n\t\tif (ctx.measureText(label).width > segmentInfo.maxLabel) {\n\t\t\twhile (ctx.measureText(label + '...').width > segmentInfo.maxLabel) {\n\t\t\t\tlabel = label.substr(0, label.length - 1);\n\t\t\t}\n\t\t\tlabel += '...';\n\t\t}\n\t\treturn label;\n\t};\n\n\tthis._renderHorizontalAxis = function(segmentInfo, ctx, data) {\n\t\tvar settings = this._settings,\n\t\t\tvalueSpace = settings.valueSpace,\n\t\t\tmainPadding = settings.mainPadding,\n\t\t\twidth = this._currentWidth - mainPadding * 2 - valueSpace,\n\t\t\theight = this._currentHeight - mainPadding * 2 - segmentInfo.maxLabel,\n\t\t\tstep = width / data.length,\n\t\t\tlabel,\n\t\t\thasDecimal,\n\t\t\tx, y,\n\t\t\ti, j, k;\n\n\t\tctx.strokeStyle = settings.barBackground;\n\t\tfor (i = 0; i < 2; i++) {\n\t\t\tx = valueSpace + mainPadding + 0.5 + i * width;\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(x, mainPadding);\n\t\t\tctx.lineTo(x, mainPadding + height);\n\t\t\tctx.stroke();\n\t\t}\n\n\t\tctx.textAlign = 'right';\n\t\tctx.textBaseline = 'top';\n\n\t\tfor (i = 0, j = data.length; i < j; i++) {\n\t\t\tx = valueSpace + mainPadding + i * step;\n\t\t\tctx.save();\n\t\t\tctx.rotate(Math.PI * -0.5);\n\t\t\tlabel = this._trimLabel(segmentInfo, ctx, data[i].title);\n\n\t\t\tctx.fillStyle = this._settings.textColor;\n\t\t\tctx.fillText(label, -(mainPadding + height + 4), x);\n\t\t\tctx.restore();\n\n\t\t\tif ((i & 1) === 0) {\n\t\t\t\tctx.fillStyle = settings.barBackground;\n\t\t\t\tctx.fillRect(x, mainPadding, step, height);\n\t\t\t}\n\t\t}\n\n\t\tctx.strokeStyle = this._settings.lineColor;\n\t\tctx.fillStyle = '#000000';\n\n\t\thasDecimal = 0;\n\t\ti = height;\n\t\tj = 0;\n\t\twhile (i >= 0) {\n\t\t\tlabel = (j * segmentInfo.step).toString(10);\n\t\t\tk = label.indexOf('.');\n\t\t\tif (k !== -1) {\n\t\t\t\tk = label.length - k - 1;\n\t\t\t\tif (k > hasDecimal) {\n\t\t\t\t\thasDecimal = k;\n\t\t\t\t}\n\t\t\t}\n\t\t\ti = Math.ceil(i - height / segmentInfo.steps);\n\t\t\tj++;\n\t\t}\n\n\t\ti = height;\n\t\tj = 0;\n\t\twhile (i >= 0) {\n\t\t\tx = mainPadding + valueSpace;\n\t\t\ty = mainPadding + ~~i + 0.5;\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(x, y);\n\t\t\tctx.lineTo(x + width, y);\n\t\t\tctx.stroke();\n\n\t\t\tlabel = (j * segmentInfo.step).toString(10);\n\t\t\tif (hasDecimal && (label.indexOf('.') === -1)) {\n\t\t\t\tlabel += '.';\n\t\t\t\tfor (k = 0; k < hasDecimal; k++) {\n\t\t\t\t\tlabel += '0';\n\t\t\t\t}\n\t\t\t}\n\t\t\tctx.fillStyle = this._settings.textColor;\n\t\t\tctx.fillText(label, valueSpace + mainPadding - 2, mainPadding + i - 8);\n\n\t\t\ti = Math.ceil(i - height / segmentInfo.steps);\n\t\t\tj++;\n\t\t}\n\n\t\tctx.textAlign = 'left';\n\n\t\tlabel = settings.mainLabel + ' x' + segmentInfo.factor;\n\n\t\ti = mainPadding;\n\t\tj = mainPadding + height / 2 + (ctx.measureText(label).width + settings.itemSize) / 2;\n\t\tctx.save();\n\t\tctx.rotate(Math.PI * -0.5);\n\t\tctx.fillStyle = this._settings.textColor;\n\t\tctx.fillText(label, -j - settings.itemSize, i);\n\t\tctx.restore();\n\n\t\tj -= ctx.measureText(label).width;\n\t\tctx.beginPath();\n\t\tctx.moveTo(i + 7.5, j);\n\t\tctx.lineTo(i + 7.5, j + 26);\n\t\tctx.stroke();\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(i + 3.5, j + 5.5);\n\t\tctx.lineTo(i + 7.5, j);\n\t\tctx.lineTo(i + 11.5, j + 5.5);\n\t\tctx.stroke();\n\t};\n\n\tthis._renderVerticalBars = function(segmentInfo, ctx, data) {\n\t\tvar settings = this._settings,\n\t\t\tvalueSpace = settings.valueSpace,\n\t\t\tmainPadding = settings.mainPadding,\n\t\t\twidth = this._currentWidth - mainPadding * 2 - valueSpace,\n\t\t\theight = this._currentHeight - mainPadding * 2 - segmentInfo.maxLabel,\n\t\t\tstep = width / data.length,\n\t\t\tbarWidth = step - settings.barPadding * 2,\n\t\t\tbarWidthSeg,\n\t\t\tbarHeight,\n\t\t\tbarX,\n\t\t\titem,\n\t\t\tpoints,\n\t\t\ti, j, k, l;\n\n\t\tctx.globalAlpha = 0.9;\n\t\tfor (i = 0, j = data.length; i < j; i++) {\n\t\t\titem = data[i];\n\t\t\tpoints = item.points;\n\n\t\t\tl = points.length;\n\t\t\tbarWidthSeg = ~~(barWidth / l);\n\t\t\tfor (k = 0; k < l; k++) {\n\t\t\t\tbarHeight = item.points[k] / segmentInfo.max * height;\n\t\t\t\tbarX = valueSpace + mainPadding + i * step + settings.barPadding;\n\t\t\t\tbarY = mainPadding + height - barHeight;\n\n\t\t\t\tctx.fillStyle = settings.dataColors[k % settings.dataColors.length];\n\t\t\t\tctx.fillRect(barX + k * barWidthSeg, barY, barWidthSeg - 1, barHeight);\n\t\t\t}\n\t\t}\n\t\tctx.globalAlpha = 1;\n\t};\n\n\tthis._renderVerticalPoints = function(segmentInfo, ctx, data) {\n\t\tvar settings = this._settings,\n\t\t\trenderPoints = (settings.types.indexOf('points') !== -1),\n\t\t\trenderLines = (settings.types.indexOf('lines') !== -1),\n\t\t\trenderArea = (settings.types.indexOf('area') !== -1),\n\t\t\tvalueSpace = settings.valueSpace,\n\t\t\tmainPadding = settings.mainPadding,\n\t\t\twidth = this._currentWidth - mainPadding * 2 - valueSpace,\n\t\t\theight = this._currentHeight - mainPadding * 2 - segmentInfo.maxLabel,\n\t\t\tstep = width / data.length,\n\t\t\tpointWidth = step - settings.barPadding * 2,\n\t\t\tpointX, pointY,\n\t\t\tpoints,\n\t\t\tpoint,\n\t\t\tpointList = [],\n\t\t\thasLast,\n\t\t\titem,\n\t\t\ti, j, k, l;\n\n\t\tpointYLast = null;\n\n\t\tfor (i = 0, j = data.length; i < j; i++) {\n\t\t\titem = data[i];\n\t\t\tpoints = item.points;\n\n\t\t\thasLast = pointYLast !== null;\n\t\t\tif (pointYLast === null) {\n\t\t\t\tpointYLast = [];\n\t\t\t}\n\t\t\tpointX = ~~(valueSpace + mainPadding + i * step + settings.barPadding + (pointWidth / 2));\n\t\t\tfor (k = 0, l = points.length; k < l; k++) {\n\t\t\t\tpointY = ~~(mainPadding + height - item.points[k] / segmentInfo.max * height);\n\n\t\t\t\tif (!pointList[k]) {\n\t\t\t\t\tpointList[k] = [];\n\t\t\t\t}\n\t\t\t\tpointList[k].push({x: pointX, y: pointY});\n\n\t\t\t\tctx.strokeStyle = settings.dataColors[k % settings.dataColors.length];\n\t\t\t\tif (renderPoints) {\n\t\t\t\t\tctx.strokeRect(pointX - 4.5, pointY - 4.5, 10, 10);\n\t\t\t\t}\n\n\t\t\t\tif (hasLast && renderLines) {\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(pointXLast, pointYLast[k]);\n\t\t\t\t\tctx.lineTo(pointX, pointY);\n\t\t\t\t\tctx.stroke();\n\t\t\t\t}\n\n\t\t\t\tpointYLast[k] = pointY;\n\t\t\t}\n\t\t\tpointXLast = pointX;\n\t\t}\n\n\t\tif (renderArea) {\n\t\t\tctx.globalAlpha = 0.05;\n\t\t\tfor (i = 0, j = pointList.length; i < j; i++) {\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.lineTo(pointList[i][0].x, mainPadding + height);\n\t\t\t\tfor (k = 0, l = pointList[i].length; k < l; k++) {\n\t\t\t\t\tpoint = pointList[i][k];\n\t\t\t\t\tctx.lineTo(point.x, point.y);\n\t\t\t\t}\n\t\t\t\tctx.lineTo(pointList[i][l - 1].x, mainPadding + height);\n\t\t\t\tctx.closePath();\n\t\t\t\tctx.fillStyle = settings.dataColors[i % settings.dataColors.length];\n\t\t\t\tctx.fill();\n\t\t\t}\n\t\t\tctx.globalAlpha = 1;\n\t\t}\n\t};\n\n\tthis._renderVerticalAxis = function(segmentInfo, ctx, data) {\n\t\tvar settings = this._settings,\n\t\t\tvalueSpace = settings.valueSpace,\n\t\t\tmainPadding = settings.mainPadding,\n\t\t\twidth = this._currentWidth - mainPadding * 2 - segmentInfo.maxLabel,\n\t\t\theight = this._currentHeight - mainPadding * 2 - valueSpace,\n\t\t\tstep = height / data.length,\n\t\t\tlabel,\n\t\t\thasDecimal,\n\t\t\tx, y,\n\t\t\ti, j, k;\n\n\t\tctx.strokeStyle = settings.barBackground;\n\t\tfor (i = 0; i < 2; i++) {\n\t\t\ty = mainPadding + 0.5 + i * height;\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(mainPadding + segmentInfo.maxLabel, y);\n\t\t\tctx.lineTo(mainPadding + segmentInfo.maxLabel + width, y);\n\t\t\tctx.stroke();\n\t\t}\n\n\t\tctx.textAlign = 'right';\n\t\tctx.textBaseline = 'top';\n\n\t\tfor (i = 0, j = data.length; i < j; i++) {\n\t\t\ty = mainPadding + i * step;\n\t\t\tlabel = this._trimLabel(segmentInfo, ctx, data[i].title);\n\n\t\t\tctx.fillStyle = this._settings.textColor;\n\t\t\tctx.fillText(label, mainPadding + segmentInfo.maxLabel - 4, y + 4);\n\t\t\tthis._rectangles.push({\n\t\t\t\tx1: mainPadding + segmentInfo.maxLabel - 4 - ctx.measureText(label).width,\n\t\t\t\ty1: y + 4,\n\t\t\t\tx2: mainPadding + segmentInfo.maxLabel - 4,\n\t\t\t\ty2: y + 20,\n\t\t\t\tlabel: data[i].title\n\t\t\t});\n\t\t\tif ((i & 1) === 0) {\n\t\t\t\tctx.fillStyle = settings.barBackground;\n\t\t\t\tctx.fillRect(mainPadding + segmentInfo.maxLabel, y, width, step);\n\t\t\t}\n\t\t}\n\n\t\tctx.textAlign = 'center';\n\n\t\tctx.strokeStyle = this._settings.lineColor;\n\t\tctx.fillStyle = '#000000';\n\n\t\thasDecimal = 0;\n\t\ti = 0;\n\t\tj = 0;\n\t\twhile (i <= width) {\n\t\t\tlabel = (j * segmentInfo.step).toString(10);\n\t\t\tk = label.indexOf('.');\n\t\t\tif (k !== -1) {\n\t\t\t\tk = label.length - k - 1;\n\t\t\t\tif (k > hasDecimal) {\n\t\t\t\t\thasDecimal = k;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ti = Math.floor(i + width / segmentInfo.steps);\n\t\t\tj++;\n\t\t}\n\n\t\ti = 0;\n\t\tj = 0;\n\t\twhile (i <= width) {\n\t\t\tx = mainPadding + segmentInfo.maxLabel + ~~i + 0.5;\n\t\t\ty = mainPadding;\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(x, y);\n\t\t\tctx.lineTo(x, y + height);\n\t\t\tctx.stroke();\n\n\t\t\tlabel = (j * segmentInfo.step).toString(10);\n\t\t\tif (hasDecimal && (label.indexOf('.') === -1)) {\n\t\t\t\tlabel += '.';\n\t\t\t\tfor (k = 0; k < hasDecimal; k++) {\n\t\t\t\t\tlabel += '0';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tctx.fillStyle = this._settings.textColor;\n\t\t\tctx.fillText(label, mainPadding + segmentInfo.maxLabel + i, mainPadding + height + 2);\n\n\t\t\ti = Math.floor(i + width / segmentInfo.steps);\n\t\t\tj++;\n\t\t}\n\n\t\tctx.textAlign = 'left';\n\n\t\tlabel = settings.mainLabel + ' x' + segmentInfo.factor;\n\n\t\ti = mainPadding + width / 2 - (ctx.measureText(label).width + settings.itemSize) / 2 + segmentInfo.maxLabel;\n\t\tj = mainPadding + height + 18;\n\n\t\tctx.fillStyle = this._settings.textColor;\n\t\tctx.fillText(label, i, j);\n\n\t\ti += ctx.measureText(label).width;\n\t\tctx.beginPath();\n\t\tctx.moveTo(i + 4, j + 7.5);\n\t\tctx.lineTo(i + settings.itemSize, j + 7.5);\n\t\tctx.stroke();\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(i + settings.itemSize - 4, j + 3.5);\n\t\tctx.lineTo(i + settings.itemSize, j + 7.5);\n\t\tctx.lineTo(i + settings.itemSize - 4, j + 11.5);\n\t\tctx.stroke();\n\t}\n\n\tthis._renderHorizontalBars = function(segmentInfo, ctx, data) {\n\t\tvar settings = this._settings,\n\t\t\tvalueSpace = settings.valueSpace,\n\t\t\tmainPadding = settings.mainPadding,\n\t\t\twidth = this._currentWidth - mainPadding * 2 - segmentInfo.maxLabel,\n\t\t\theight = this._currentHeight - mainPadding * 2 - valueSpace,\n\t\t\tstep = height / data.length,\n\t\t\tbarWidth,\n\t\t\tbarHeight = step - settings.barPadding * 2,\n\t\t\tbarHeightSeg,\n\t\t\tbarX, barY,\n\t\t\titem,\n\t\t\tpoints,\n\t\t\ti, j, k, l;\n\n\t\tctx.globalAlpha = 0.9;\n\t\tfor (i = 0, j = data.length; i < j; i++) {\n\t\t\titem = data[i];\n\t\t\tpoints = item.points;\n\n\t\t\tl = points.length;\n\t\t\tbarHeightSeg = ~~(barHeight / l);\n\t\t\tfor (k = 0; k < l; k++) {\n\t\t\t\tbarWidth = ~~(item.points[k] / segmentInfo.max * width);\n\t\t\t\tbarX = segmentInfo.maxLabel + mainPadding;\n\t\t\t\tbarY = ~~mainPadding + i * step + settings.barPadding;\n\n\t\t\t\tctx.fillStyle = settings.dataColors[k % settings.dataColors.length];\n\t\t\t\tctx.fillRect(barX, barY + k * barHeightSeg, barWidth, barHeightSeg - 1);\n\t\t\t}\n\t\t}\n\t\tctx.globalAlpha = 1;\n\t};\n\n\tthis._renderHorizontalPoints = function(segmentInfo, ctx, data) {\n\t\tvar settings = this._settings,\n\t\t\trenderPoints = (settings.types.indexOf('points') !== -1),\n\t\t\trenderLines = (settings.types.indexOf('lines') !== -1),\n\t\t\trenderArea = (settings.types.indexOf('area') !== -1),\n\t\t\tvalueSpace = settings.valueSpace,\n\t\t\tmainPadding = settings.mainPadding,\n\t\t\twidth = this._currentWidth - mainPadding * 2 - segmentInfo.maxLabel,\n\t\t\theight = this._currentHeight - mainPadding * 2 - valueSpace,\n\t\t\tstep = height / data.length,\n\t\t\tpointHeight = step - settings.barPadding * 2,\n\t\t\tpointX, pointY,\n\t\t\tpoints,\n\t\t\tpoint,\n\t\t\tpointList = [],\n\t\t\thasLast,\n\t\t\titem,\n\t\t\ti, j, k, l;\n\n\t\tpointXLast = null;\n\n\t\tfor (i = 0, j = data.length; i < j; i++) {\n\t\t\titem = data[i];\n\t\t\tpoints = item.points;\n\n\t\t\thasLast = pointXLast !== null;\n\t\t\tif (pointXLast === null) {\n\t\t\t\tpointXLast = [];\n\t\t\t}\n\t\t\tpointY = ~~(mainPadding + i * step + settings.barPadding + pointHeight / 2);\n\t\t\tfor (k = 0, l = points.length; k < l; k++) {\n\t\t\t\tpointX = ~~(mainPadding + item.points[k] / segmentInfo.max * width + segmentInfo.maxLabel);\n\n\t\t\t\tif (!pointList[k]) {\n\t\t\t\t\tpointList[k] = [];\n\t\t\t\t}\n\t\t\t\tpointList[k].push({x: pointX, y: pointY});\n\n\t\t\t\tctx.strokeStyle = settings.dataColors[k % settings.dataColors.length];\n\t\t\t\tif (renderPoints) {\n\t\t\t\t\tctx.strokeRect(pointX - 4.5, pointY - 4.5, 10, 10);\n\t\t\t\t}\n\n\t\t\t\tif (hasLast && renderLines) {\n\t\t\t\t\tctx.beginPath();\n\t\t\t\t\tctx.moveTo(pointXLast[k], pointYLast);\n\t\t\t\t\tctx.lineTo(pointX, pointY);\n\t\t\t\t\tctx.stroke();\n\t\t\t\t}\n\n\t\t\t\tpointXLast[k] = pointX;\n\t\t\t}\n\t\t\tpointYLast = pointY;\n\t\t}\n\n\t\tif (renderArea) {\n\t\t\tctx.globalAlpha = 0.05;\n\t\t\tfor (i = 0, j = pointList.length; i < j; i++) {\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.moveTo(mainPadding + segmentInfo.maxLabel, pointList[i][0].y);\n\t\t\t\tfor (k = 0, l = pointList[i].length; k < l; k++) {\n\t\t\t\t\tpoint = pointList[i][k];\n\t\t\t\t\tctx.lineTo(point.x, point.y);\n\t\t\t\t}\n\t\t\t\tctx.lineTo(mainPadding + segmentInfo.maxLabel, pointList[i][l - 1].y);\n\t\t\t\tctx.closePath();\n\t\t\t\tctx.fillStyle = settings.dataColors[i % settings.dataColors.length];\n\t\t\t\tctx.fill();\n\t\t\t}\n\t\t\tctx.globalAlpha = 1;\n\t\t}\n\t};\n\n\tthis.setData = function(data) {\n\t\tvar el = this._el,\n\t\t\tctx = el.getContext('2d'),\n\t\t\tsettings = this._settings,\n\t\t\ttypes = settings.types,\n\t\t\taxisRenderMethod = function() {},\n\t\t\tbarsRenderMethod = function() {},\n\t\t\tpointsRenderMethod = function() {},\n\t\t\tsegmentInfo;\n\n\t\tswitch (settings.orientation) {\n\t\t\tcase 'horizontal':\n\t\t\t\tel.width = this._width;\n\t\t\t\tel.height = data.length * settings.itemSize + this._settings.valueSpace;\n\t\t\t\taxisRenderMethod = bind(this, this._renderVerticalAxis);\n\t\t\t\tbarsRenderMethod = bind(this, this._renderHorizontalBars);\n\t\t\t\tpointsRenderMethod = bind(this, this._renderHorizontalPoints);\n\t\t\t\tbreak;\n\n\t\t\tcase 'vertical':\n\t\t\t\tel.width = data.length * settings.itemSize + this._settings.valueSpace;\n\t\t\t\tel.height = this._height;\n\t\t\t\taxisRenderMethod = bind(this, this._renderHorizontalAxis);\n\t\t\t\tbarsRenderMethod = bind(this, this._renderVerticalBars);\n\t\t\t\tpointsRenderMethod = bind(this, this._renderVerticalPoints);\n\t\t\t\tbreak;\n\t\t}\n\n\t\tctx.font = settings.font;\n\n\t\tthis._renderBackground(ctx);\n\n\t\tif (data.length) {\n\t\t\tsegmentInfo = this._calculateSegments(ctx, data);\n\n\t\t\taxisRenderMethod(segmentInfo, ctx, data);\n\n\t\t\tif ((types.indexOf('points') !== -1) || (types.indexOf('area') !== -1) || (types.indexOf('lines') !== -1)) {\n\t\t\t\tpointsRenderMethod(segmentInfo, ctx, data);\n\t\t\t}\n\t\t\tif (types.indexOf('bars') !== -1) {\n\t\t\t\tbarsRenderMethod(segmentInfo, ctx, data);\n\t\t\t}\n\t\t}\n\n\t\tthis._data = data;\n\t};\n\n\tthis.setSettings = function(settings) {\n\t\tsettings.mainLabel = settings.mainLabel || '';\n\t\tsettings.textColor = settings.textColor || '#000000';\n\t\tsettings.fillColor = (settings.fillColor === undefined) ? '#FFFFFF' : settings.fillColor;\n\t\tsettings.lineColor = settings.lineColor || '#000000';\n\t\tsettings.orientation = settings.oriantation || 'horizontal';\n\t\tsettings.types = settings.types || 'bars,lines,area,points';\n\t\tsettings.barPadding = settings.barPadding || 2;\n\t\tsettings.barBackground = settings.barBackground || '#F8F8F8';\n\t\tsettings.mainPadding = settings.mainPadding || 10;\n\t\tsettings.valueSpace = settings.valueSpace || 40;\n\t\tsettings.dataColors = settings.dataColors || ['#DD0000', '#00DD00', '#0000DD'];\n\t\tsettings.font = settings.font || '13px Verdana';\n\t\tsettings.maxLabelSize = settings.maxLabelSize || 200;\n\t\tsettings.itemSize = settings.itemSize || 50;\n\n\t\tthis._settings = settings;\n\t};\n\n\tthis.update = function() {\n\t\tthis._data && this.setData(this._data);\n\t};\n});\n","pre":true},"modules/devkit-core/modules/squill/SelectBox.js":{"path":"modules/devkit-core/modules/squill/SelectBox.js","friendlyPath":".SelectBox","directory":"modules/devkit-core/modules/squill/","filename":"SelectBox.js","src":"jsio('import .Widget');\njsio('import squill.models.DataSource as DataSource');\n\njsio('from util.browser import $');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_SelectBox=__class__;var SelectBox = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_SelectBox(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_squill_SelectBox(){return this.init&&this.init.apply(this,arguments)},Widget, function(supr) {\n\n\tthis._css = 'select';\n\n\tthis._def = {\n\t\ttag: 'label',\n\t\tstyle: {display: 'inline-block'},\n\t\tchildren: [{\n\t\t\tid: '_select',\n\t\t\ttag: 'select'\n\t\t}]\n\t};\n\n\tthis.init = function(opts) {\n\t\topts = merge(opts, {\n\t\t\trenderer: bind(this, 'defaultRenderer')\n\t\t});\n\n\t\tthis._items = {};\n\t\tif (opts.dataSource) { this.setDataSource(opts.dataSource); }\n\t\tsupr(this, 'init', arguments);\n\t}\n\n\tthis.buildWidget = function() {\n\t\tif (this._opts.name) {\n\t\t\tthis.setName(this._opts.name);\n\t\t}\n\n\t\tif (!this._dataSource) {\n\t\t\tthis.setDataSource(new DataSource());\n\t\t}\n\n\t\tif (this._opts.items) {\n\t\t\tvar uid = 1;\n\t\t\tvar items = this._opts.items.map(function (item) {\n\t\t\t\tif (typeof item != 'object') {\n\t\t\t\t\treturn {id: typeof item == 'string' ? item : uid++, value: item};\n\t\t\t\t} else {\n\t\t\t\t\tif (!item.id) {\n\t\t\t\t\t\titem.id =   'value' in item ? item.value :\n\t\t\t\t\t\t\t\t\t'title' in item ? item.title :\n\t\t\t\t\t\t\t\t\t(uid++);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn item;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis._dataSource.add(items);\n\t\t}\n\n\t\tif ('value' in this._opts) {\n\t\t\tthis.setValue(this._opts.value);\n\t\t}\n\n\t\tthis.initMouseEvents(this._el);\n\t\t$.onEvent(this._select, 'change', this, '_onSelect');\n\t}\n\n\tthis._onSelect = function() {\n\t\tvar item = this._dataSource.get(this.getValue());\n\t\tif (item) {\n\t\t\tthis.publish('change', item);\n\t\t}\n\t}\n\n\tthis.getDataSource = function () { return this._dataSource; }\n\n\tthis.setDataSource = function(dataSource) {\n\t\tif (this._dataSource) {\n\t\t\tthis._dataSource.unsubscribe('Update', this);\n\t\t\tthis._dataSource.unsubscribe('Remove', this);\n\t\t}\n\t\tthis._dataSource = dataSource;\n\t\tthis._dataSource.subscribe('Update', this, 'onUpdateItem');\n\t\tthis._dataSource.subscribe('Remove', this, 'onRemoveItem');\n\t\tthis._dataSource.forEach(function(item, key) {\n\t\t\tthis.onUpdateItem(key, item);\n\t\t}, this);\n\t}\n\n\tthis.defaultRenderer = function(item) {\n\t\tvar key = this._dataSource.getKey();\n\t\treturn item.displayName || item.label || item.title || item.text || item[key];\n\t}\n\n\tthis.onUpdateItem = function(id, item) {\n\t\tvar el = this._items[id];\n\t\tvar keyField = this._dataSource.getKey();\n\n\t\tif (typeof(item) === 'string') {\n\t\t\tvar o = {};\n\t\t\to[keyField] = item;\n\t\t\titem = o;\n\t\t}\n\n\t\tif (!el) {\n\t\t\tvar el = this._items[id] = $.create({tag: 'option'});\n\t\t\t$.insertBefore(this._select, el);\n\t\t}\n\n\t\tel.setAttribute('value', item[keyField]);\n\t\tvar renderer = this._opts.renderer;\n\t\tel.innerText = (typeof renderer === 'string' ? item[renderer] : renderer(item))\n\t\tel.value = item[keyField];\n\t}\n\n\tthis.onRemoveItem = function(id) {\n\t\tvar el = this._items[id];\n\t\tvar prevValue = this.getValue();\n\t\tif (el) {\n\t\t\t$.remove(el);\n\t\t\tdelete this._items[id];\n\t\t}\n\t\tvar newValue = this.getValue();\n\t\tif (newValue != prevValue) {\n\t\t\tthis._onSelect(); // the old value was removed, so select a new one\n\t\t}\n\t}\n\n\n\tthis.setName = function(name) { this._select.name = name; }\n\tthis.setValue = function(value) { this._select.value = value; }\n\n\tthis.getValue = function() { return this._select.value; }\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/dom/animate.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/dom/animate.js","friendlyPath":".backend.dom.animate","directory":"modules/devkit-core/modules/timestep/src/ui/backend/dom/","filename":"animate.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.backend.dom.animate;\n *\n * For now, this package simply forwards to Canvas' implementation.\n */\n\njsio('import ui.backend.canvas.animate as canvasAnimate');\n\nexports = function (view) {\n\t// For DOM nodes, return only one singleton animation class.\n\tif ('_node' in view) {\n\t\treturn view.getAnimation();\n\t} else {\n\t\treturn canvasAnimate(view);\n\t}\n}\nexports.linear = canvasAnimate.linear;\nexports.easeIn = canvasAnimate.easeIn;\nexports.easeInOut = canvasAnimate.easeInOut;\nexports.easeOut = canvasAnimate.easeOut;\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/dom/ImageView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/dom/ImageView.js","friendlyPath":".backend.dom.ImageView","directory":"modules/devkit-core/modules/timestep/src/ui/backend/dom/","filename":"ImageView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.backend.dom.ImageView;\n *\n * Renders an image in a View for canvas.\n */\n\njsio('import ui.View as View');\njsio('import ui.resource.Image as Image');\n\n/**\n * @extends timestep.View\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_ImageView=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_ImageView(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_ImageView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\tthis.init = function (opts) {\n\t\topts = merge(opts, {\n\t\t\timage: null,\n\t\t\tautoSize: false\n\t\t});\n\n\t\tsupr(this, \"init\", [opts]);\n\n\t\tvar s = this.__view._node.style;\n\t\ts.webkitBackgroundClip = s.backgroundClip = 'content-box';\n\n\t\tif (opts.image) {\n\t\t\tthis.setImage(opts.image, opts);\n\t\t}\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\tvar opts = supr(this, 'updateOpts', arguments);\n\n\t\tif ('autoSize' in opts) {\n\t\t\tthis._autoSize = !!opts.autoSize;\n\t\t}\n\n\t\tif (opts.image) {\n\t\t\tthis.setImage(opts.image);\n\t\t} else {\n\t\t\tthis.needsReflow();\n\t\t}\n\n\t\treturn opts;\n\t}\n\n\tthis.autoSize = function () {\n\t\tif (this._img) {\n\t\t\tthis.style.width = this._img.getWidth();\n\t\t\tthis.style.height = this._img.getHeight();\n\n\t\t\tif (this.style.fixedAspectRatio) {\n\t\t\t\tthis.style.updateAspectRatio();\n\t\t\t}\n\t\t}\n\t}\n\n\tthis._imgCache = {};\n\n\tthis.getImage = function () { return this._img; }\n\tthis.setImage = function (img, opts) {\n\t\tif (typeof img == 'string') {\n\t\t\t// Cache image requests to avoid heavy performance penalties at the\n\t\t\t// expense of a small amount of additional JS memory usage.\n\t\t\tvar name = img;\n\t\t\timg = this._imgCache[name];\n\t\t\tif (!img) {\n\t\t\t\tthis._imgCache[name] = img = new Image({url: name});\n\t\t\t}\n\t\t}\n\n\t\tif (img != this._img) {\n\t\t\tif (this._img) {\n\t\t\t\tthis._img.unsubscribe('changeBounds', this);\n\t\t\t}\n\n\t\t\tthis._img = img;\n\n\t\t\tif (img) {\n\t\t\t\t// use subscribe/unsubscribe to avoid warnings about 'possible memory leak detected' in EventEmitter API\n\t\t\t\timg.subscribe('changeBounds', this, 'updateImage');\n\t\t\t\tthis._autoSize = (opts && ('autoSize' in opts)) ? opts.autoSize : this._autoSize;\n\t\t\t\tif (this._autoSize) {\n\t\t\t\t\t// sprited resources will know their dimensions immediately\n\t\t\t\t\tif (img.getWidth() > 0 && img.getHeight() > 0) {\n\t\t\t\t\t\tthis.autoSize();\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// non-sprited resources need to load first\n\t\t\t\t\t\timg.doOnLoad(this, 'autoSize');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\timg.doOnLoad(this, 'updateImage');\n\t\t\t} else {\n\t\t\t\tthis.updateImage();\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.reflow = function () {\n\t\tthis.updateImage();\n\t}\n\n\tthis._getBackgroundNode = function (imageURL) {\n\t\t// When a css background-image is set that has an etag and no max-age\n\t\t// (as when developing using the browser simulator in debug mode),\n\t\t// Chrome sends an HTTP request for images to check for a 304\n\t\t// response, causing the background image to flicker.  When using a\n\t\t// sprite-view updating every frame, this causes tons of http requests\n\t\t// and flickering.  To get around this, we add a separate DOM node for\n\t\t// each unique sprite sheet that an image can show\n\t\t// (opts['dom:multipleImageNodes'] == true).  The SpriteView (subclass\n\t\t// of ImageView) enables this option by default when we're in debug\n\t\t// mode.\n\t\tif (!this._bgNodes) {\n\t\t\tthis._bgNodes = {};\n\t\t}\n\n\t\tvar el = this._bgNodes[imageURL];\n\t\tif (!el) {\n\t\t\t// create a background node for this URL if we don't\n\t\t\t// already have one\n\t\t\tthis._bgNodes[imageURL] = el = document.createElement('div');\n\t\t\tel.style.cssText =\n\t\t\t\t  '-webkit-background-clip:content-box;'\n\t\t\t\t+ 'background-clip:content-box;'\n\t\t\t\t+ 'z-index:-1;'\n\t\t\t\t+ 'position:absolute;'\n\t\t\t\t+ 'top:0;'\n\t\t\t\t+ 'left:0;'\n\t\t\t\t+ 'bottom:0;'\n\t\t\t\t+ 'right:0;'\n\t\t\t\t+ 'background-image:' + imageURL + ';';\n\n\t\t\tthis.__view._node.appendChild(el);\n\t\t}\n\n\t\tif (el != this._currentBgNode) {\n\t\t\t// hide the previous background node\n\t\t\tif (this._currentBgNode) {\n\t\t\t\tthis._currentBgNode.style.visibility = 'hidden';\n\t\t\t}\n\n\t\t\t// show the current background node\n\t\t\tthis._currentBgNode = el;\n\t\t\tel.style.visibility = 'visible';\n\t\t}\n\n\t\treturn el;\n\t}\n\n\tthis._canvasRender = function (ctx, opts) {\n\t\tvar canvas = this._img.getSource();\n\t\tctx.drawImage(canvas,\n\t\t\t\t0, 0, canvas.width, canvas.height,\n\t\t\t\t0, 0, this.style.width, this.style.height);\n\t}\n\n\t// sets the CSS background-image for this node\n\tthis.updateImage = function () {\n\t\tvar img = this._img;\n\t\tvar multipleImageNodes = this._opts['dom:multipleImageNodes'];\n\n\t\tif (img && img.getSource() instanceof HTMLCanvasElement) {\n\t\t\tthis.render = this._canvasRender;\n\t\t\tthis.needsRepaint();\n\t\t} else {\n\t\t\t// clear the background image if necessary\n\t\t\tif (!img || !img.isReady()) {\n\t\t\t\tif (multipleImageNodes && this._currentBgNode) {\n\t\t\t\t\tthis._currentBgNode.style.visibility = 'hidden';\n\t\t\t\t} else {\n\t\t\t\t\tthis.__view._node.style.backgroundImage = 'none';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar imageURL = 'url(\"' + img.getSource().src + '\")';\n\t\t\t\tvar sheetWidth = img.getSourceWidth();\n\t\t\t\tvar sheetHeight = img.getSourceHeight();\n\t\t\t\tvar scaleX = this.style.width / img.getWidth();\n\t\t\t\tvar scaleY = this.style.height / img.getHeight();\n\n\t\t\t\tvar s;\n\t\t\t\tif (multipleImageNodes) {\n\t\t\t\t\ts = this._getBackgroundNode(imageURL).style;\n\t\t\t\t} else {\n\t\t\t\t\ts = this.__view._node.style;\n\t\t\t\t\tif (this._cacheImageURL != imageURL) {\n\t\t\t\t\t\tthis._cacheImageURL = imageURL;\n\t\t\t\t\t\ts.backgroundImage = imageURL;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar bounds = img.getBounds();\n\t\t\t\ts.padding = scaleY * bounds.marginTop + 'px '\n\t\t\t\t\t+ scaleX * bounds.marginRight + 'px '\n\t\t\t\t\t+ scaleY * bounds.marginBottom + 'px '\n\t\t\t\t\t+ scaleX * bounds.marginLeft + 'px';\n\t\t\t\ts.backgroundPositionX = scaleX * (-bounds.x + bounds.marginLeft) + 'px';\n\t\t\t\ts.backgroundPositionY = scaleY * (-bounds.y + bounds.marginTop) + 'px';\n\t\t\t\ts.backgroundSize = sheetWidth * scaleX + 'px ' + sheetHeight * scaleY + 'px';\n\t\t\t}\n\t\t}\n\t}\n\n\tthis.getOrigWidth = this.getOrigW = function () { return this._img.getOrigW(); }\n\tthis.getOrigHeight = this.getOrigH = function () { return this._img.getOrigH(); }\n\n\tthis.doOnLoad = function () {\n\t\tif (arguments.length == 1) {\n\t\t\tthis._img.doOnLoad(this, arguments[0]);\n\t\t} else {\n\t\t\tthis._img.doOnLoad.apply(this._img, arguments);\n\t\t}\n\t\treturn this;\n\t}\n\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/dom/StackView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/dom/StackView.js","friendlyPath":".backend.dom.StackView","directory":"modules/devkit-core/modules/timestep/src/ui/backend/dom/","filename":"StackView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import ui.View');\n\n/**\n * @extends timestep.dom.View\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_StackView=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_StackView(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_StackView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', arguments);\n\t\tthis.stack = [];\n\t}\n\t\n\tthis.getCurrentView = function () {\n\t\tif (!this.stack.length) { return null; }\n\t\treturn this.stack[this.stack.length - 1];\n\t}\n\t\n\tthis.push = function (view, dontAnimate) {\n\t\t// don't animate the first (base) view of a stackview unless explicitly asked to\n\t\tif (!this.stack[0] && dontAnimate !== false) {\n\t\t\tdontAnimate = true;\n\t\t}\n\t\t\n\t\tvar current = this.getCurrentView();\n\t\tif (current) { this._hide(current, dontAnimate); }\n\t\tview.style.width = this.style.width;\n\t\tview.style.height = this.style.height;\n\t\tthis.stack.push(view);\n\t\tthis._show(view, dontAnimate);\n\t\treturn view;\n\t}\n\t\n\tthis._hide = function (view, dontAnimate, backward) {\n\t\tview.publish('ViewWillDisappear');\n\t\tif (!dontAnimate) {\n\t\t\t// Prevent touches from triggering buttons/UI on the\n\t\t\t// disappearing view. Unfortunately, canHandleEvents()\n\t\t\t// doesn't affect subviews, so an overlay is added here\n\t\t\t// so that touches just don't go through while it animates out.\n\t\t\tvar overlay = new View({parent: view, zIndex: 100000});\n\t\t\tview.then({x: (backward ? 1 : -1) * view.style.width})\n\t\t\t\t.then(bind(this, 'removeSubview', view))\n\t\t\t\t.then(bind(view, 'publish', 'ViewDidDisappear'))\n\t\t\t\t.then(bind(overlay, 'removeFromSuperview'));\n\t\t} else {\n\t\t\tthis.removeSubview(view);\n\t\t\tview.publish('ViewDidDisappear');\n\t\t}\n\t}\n\n\tthis._show = function (view, dontAnimate, backward) {\n\t\tview.publish('ViewWillAppear');\n\t\tview.style.visible = true;\n\t\tif (!dontAnimate) {\n\t\t\tview.style.x = (backward ? -1 : 1) * this.style.width;\n\t\t\tthis.addSubview(view);\n\t\t\tview.then({x: 0})\n\t\t\t\t.then(bind(view, 'publish', 'ViewDidAppear'));\n\t\t} else {\n\t\t\tthis.addSubview(view);\n\t\t\tview.style.x = 0;\n\t\t\tview.publish('ViewDidAppear');\n\t\t}\n\t}\n\t\n\tthis.pop = function (dontAnimate) {\n\t\tif (!this.stack.length) { return false; }\n\t\tvar view = this.stack.pop();\n\t\tthis._hide(view, dontAnimate, true);\n\t\t\n\t\tif (this.stack.length) {\n\t\t\tthis._show(this.stack[this.stack.length - 1], dontAnimate, true);\n\t\t}\n\t\t\n\t\treturn view;\n\t}\n\t\n\tthis.popAll = function (dontAnimate) {\n\t\twhile (this.stack[1]) {\n\t\t\tthis.pop(dontAnimate);\n\t\t}\n\t}\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/dom/TextView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/dom/TextView.js","friendlyPath":".backend.dom.TextView","directory":"modules/devkit-core/modules/timestep/src/ui/backend/dom/","filename":"TextView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.backend.dom.TextView;\n *\n * TextView implementation for DOM.\n */\n\njsio('import ui.View as View');\njsio('import device');\n\n/**\n * @extends ui.View\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_TextView=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_TextView(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_TextView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\tthis._displayStyle = \"table\";\n\n\tvar defaults = {\n\t\t// layout properties...\n\t\twrap: false,\n\t\tautoSize: false,\n\t\tautoFontSize: true,\n\t\tverticalPadding: 0,\n\t\thorizontalPadding: 0,\n\t\tlineHeight: 1.2,\n\n\t\t// font properties...\n\t\tcolor: \"#000000\",\n\t\tfontFamily: device.defaultFontFamily,\n\t\tfontWeight: \"\",\n\t\tsize: 128,\n\t\tlineWidth: 2,\n\t\tstrokeColor: \"\",\n\t\tshadowColor: \"\",\n\n\t\t// alignment properties...\n\t\tverticalAlign: \"middle\",\n\t\thorizontalAlign: \"center\",\n\n\t\t// misc properties...\n\t\tbackgroundColor: \"\"\n\t};\n\n\tthis.init = function (opts) {\n\t\tvar el = this._textNode = document.createElement(\"div\");\n\t\tel.className = 'view text';\n\t\t// el.style.position = 'relative';\n\n\t\tsupr(this, \"init\", [merge(opts, defaults)]);\n\n\t\tthis.__view.getElement().appendChild(el);\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\topts = supr(this, \"updateOpts\", arguments);\n\n\t\tvar s = this.__view.getElement().style;\n\n\t\tif (opts.horizontalPadding) {\n\t\t\tif (isArray(opts.horizontalPadding)) {\n\t\t\t\ts.paddingLeft = opts.horizontalPadding[0] + \"px\";\n\t\t\t\ts.paddingRight = opts.horizontalPadding[0] + \"px\";\n\t\t\t} else {\n\t\t\t\ts.paddingLeft = opts.horizontalPadding + \"px\";\n\t\t\t\ts.paddingRight = opts.horizontalPadding + \"px\";\n\t\t\t}\n\t\t}\n\n\t\tif (opts.verticalPadding) {\n\t\t\tif (isArray(opts.verticalPadding)) {\n\t\t\t\ts.paddingTop = opts.verticalPadding[0] + \"px\";\n\t\t\t\ts.paddingBottom = opts.verticalPadding[0] + \"px\";\n\t\t\t} else {\n\t\t\t\ts.paddingTop = opts.verticalPadding + \"px\";\n\t\t\t\ts.paddingBottom = opts.verticalPadding + \"px\";\n\t\t\t}\n\t\t}\n\n\t\tif (opts.color)           { s.color = opts.color; }\n\t\tif (opts.size)            { this._fontSize = opts.size; }\n\t\tif (opts.fontFamily)      { s.fontFamily = opts.fontFamily; }\n\t\tif (opts.horizontalAlign) { s.textAlign = opts.horizontalAlign; }\n\t\tif (opts.verticalAlign)   { this._verticalAlign = opts.verticalAlign; }\n\t\tif (opts.fontWeight)      { s.fontWeight = opts.fontWeight; }\n\t\tif (opts.shadowColor)     { s.textShadow = opts.shadowColor + \" 2px 2px 1px\"; }\n\t\tif (opts.lineHeight)      { s.lineHeight = opts.lineHeight * opts.size + 'px'; }\n\t\tif (opts.strokeColor)     { this._updateStroke(); }\n\t\tif (!opts.wrap)           { s.whiteSpace = \"nowrap\"; }\n\n\t\t// s.display = 'table';\n\n\t\tthis.setText(opts.text || \"\");\n\t};\n\n\tthis.getText = function () { return this._text; }\n\n\tvar TOLERANCE = 1;\n\n\tthis.reflow = function () {\n\t\tvar opts = this._opts;\n\t\tvar node = this._textNode;\n\t\tif (node) {\n\t\t\tif (opts.autoSize) {\n\t\t\t\tvar idealHeight = node.scrollHeight;\n\t\t\t\tif (!this.style.height || this.style.height < idealHeight) {\n\t\t\t\t\tthis.style.height = idealHeight;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// use binary-search to fit text into dom node\n\t\t\tif (opts.autoFontSize) {\n\t\t\t\tvar step, size;\n\t\t\t\tstep = size = this._fontSize;\n\n\t\t\t\tif (!opts.wrap) {\n\t\t\t\t\t// fit width\n\t\t\t\t\tdo {\n\t\t\t\t\t\tvar currentWidth = node.scrollWidth;\n\t\t\t\t\t\tvar diff = currentWidth - this.style.width;\n\t\t\t\t\t\tif (diff > TOLERANCE) {\n\t\t\t\t\t\t\tsize -= (step /= 2);\n\t\t\t\t\t\t\tnode.style.fontSize = size + 'px';\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t} while (false);\n\t\t\t\t}\n\n\t\t\t\t// fit height\n\t\t\t\tdo {\n\t\t\t\t\tvar currentHeight = node.scrollHeight;\n\t\t\t\t\tvar diff = currentHeight - this.style.height;\n\t\t\t\t\tif (diff > TOLERANCE) {\n\t\t\t\t\t\tsize -= (step /= 2);\n\t\t\t\t\t\tnode.style.fontSize = size + 'px';\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t} while (false);\n\n\t\t\t\tthis._computedFontSize = size;\n\t\t\t\tnode.style.lineHeight = opts.lineHeight * size + 'px';\n\t\t\t}\n\n\t\t\tthis._computeVerticalAlign();\n\n\t\t\tif (this._strokeNode) {\n\t\t\t\tthis._strokeNode.style.width = this._fillNode.offsetWidth + 'px';\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.setText = function (text) {\n\t\tif (typeof text == \"function\") {\n\t\t\treturn text(this);\n\t\t}\n\n\t\ttext = text != undefined ? text.toString() : '';\n\n\t\tif (this._text != text) {\n\t\t\tthis._text = text;\n\n\t\t\tif (this._strokeNode) {\n\t\t\t\tthis._fillNode.innerText = text;\n\t\t\t\tthis._strokeNode.innerText = text;\n\t\t\t} else {\n\t\t\t\tthis._textNode.innerText = text;\n\t\t\t}\n\n\t\t\tthis._textNode.style.fontSize = this._fontSize + 'px';\n\t\t\tthis.needsReflow();\n\t\t}\n\t};\n\n\tthis._computeVerticalAlign = function () {\n\t\tvar s = this._textNode.style;\n\t\tvar opts = this._opts;\n\t\tvar fontSize = this._computedFontSize || this._fontSize;\n\t\tvar lineSize = opts.lineHeight * fontSize;\n\t\tvar numLines = Math.round(this._textNode.offsetHeight / lineSize);\n\n\t\tvar padding = this.style.padding;\n\t\tvar offset = padding.top;\n\t\tif (opts.verticalAlign == 'middle') {\n\t\t\toffset += (this.style.height\n\t\t\t\t\t\t- padding.top\n\t\t\t\t\t\t- padding.bottom\n\t\t\t\t\t\t- (numLines > 1 ? opts.lineHeight * numLines : 1) * fontSize) / 2;\n\t\t}\n\n\t\tthis._textNode.style.marginTop = offset + 'px';\n\t};\n\n\tthis._updateStroke = function () {\n\t\tvar opts = this._opts;\n\t\tif (opts.strokeColor && opts.strokeWidth) {\n\t\t\tif (!this._strokeNode) {\n\t\t\t\tthis._textNode.innerHTML = '<span style=\"position:relative\"><span></span><span style=\"position:absolute;left:0;top:1px;right:0px;z-index:-1\"></span></span>';\n\t\t\t\tthis._fillNode = this._textNode.childNodes[0].childNodes[0];\n\t\t\t\tthis._strokeNode = this._textNode.childNodes[0].childNodes[1];\n\t\t\t}\n\n\t\t\t// this._strokeNode.style.left = -opts.strokeWidth / 2 + 'px';\n\t\t\tthis._strokeNode.style.webkitTextStroke = (opts.strokeWidth * 1) + \"px \" + opts.strokeColor;\n\t\t\tthis.needsReflow();\n\t\t} else if (this._strokeNode) {\n\t\t\tthis._strokeNode = null;\n\t\t\tthis._fillNode = null;\n\t\t\tthis.setText(this._text);\n\t\t}\n\t}\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/dom/ViewBacking.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/dom/ViewBacking.js","friendlyPath":".backend.dom.ViewBacking","directory":"modules/devkit-core/modules/timestep/src/ui/backend/dom/","filename":"ViewBacking.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\njsio('import event.Callback as Callback');\njsio('import animate');\njsio('import event.input.InputEvent as InputEvent');\njsio('import math.geom.Point as Point');\njsio('from util.browser import $');\n\njsio('import ..BaseBacking');\n\nvar Canvas = device.get('Canvas');\n\nvar AVOID_CSS_ANIM = device.isAndroid;\n\nvar TRANSFORM_PREFIX = 'transform';\nfunction CHECK_TRANSLATE3D() {\n    var el = document.createElement('p'),\n        has3d,\n        transforms = {\n            'webkitTransform':'-webkit-transform',\n            'OTransform':'-o-transform',\n            'msTransform':'-ms-transform',\n            'MozTransform':'-moz-transform',\n            'transform':'transform'\n        };\n\n    // Add it to the body to get the computed style.\n    document.body.insertBefore(el, null);\n\n    for (var t in transforms) {\n        if (el.style[t] !== undefined) {\n            el.style[t] = \"translate3d(1px,1px,1px)\";\n            has3d = window.getComputedStyle(el).getPropertyValue(transforms[t]);\n            TRANSFORM_PREFIX = t;\n        }\n    }\n\n    document.body.removeChild(el);\n\n    return (has3d !== undefined && has3d.length > 0 && has3d !== \"none\");\n}\n\nvar SUPPORTS_TRANSLATE3D = false;//CHECK_TRANSLATE3D();\n\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_ViewBacking=__class__;var ViewBacking = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_ViewBacking(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_dom_ViewBacking(){return this.init&&this.init.apply(this,arguments)},BaseBacking, function () {\n\n\tvar arr = ['x', 'y', 'r', 'width', 'height', 'visible', 'anchorX', 'anchorY', 'offsetX', 'offsetY',\n\t\t\t   'opacity', 'scale', 'zIndex', 'scrollLeft', 'scrollTop', 'flipX', 'flipY'];\n\n\tvar CUSTOM_KEYS = {};\n\n\tarr.forEach(function (prop) {\n\t\tCUSTOM_KEYS[prop] = true;\n\n\t\tthis.__defineGetter__(prop, function () {\n\t\t\tif (prop in this._computed) {\n\t\t\t\treturn this._computed[prop];\n\t\t\t} else {\n\t\t\t\treturn parseInt(this._node.style[prop]);\n\t\t\t}\n\t\t});\n\t\tthis.__defineSetter__(prop, function (val) {\n\t\t\tvar props = {};\n\t\t\tprops[prop] = val;\n\t\t\tthis._setProps(props);\n\t\t\treturn val;\n\t\t});\n\t}, this);\n\n\tthis.init = function (view, opts) {\n\t\tthis._view = view;\n\t\tthis._subviews = [];\n\t\tthis._noCanvas = opts['dom:noCanvas'];\n\n\t\tvar n = this._node = document.createElement(opts['dom:elementType'] || 'div');\n\n\t\t// used to identify dom nodes\n\t\tn._view = view;\n\t\tn.addEventListener(\"webkitTransitionEnd\", bind(this, \"_transitionEnd\"), false);\n\t\tn.className = 'view';\n\t\tif (opts['dom:className']) {\n\t\t\tn.className += ' ' + opts['dom:className'];\n\t\t}\n\n\t\tvar cssText = 'fontSize:1px;position:absolute;top:0px;left:0px;-webkit-transform-origin:0px 0px;';\n\t\tif (!device.isAndroid) {\n\t\t\tcssText += '-webkit-backface-visibility:hidden;';\n\t\t}\n\n\t\tvar s = n.style;\n\t\ts.cssText = cssText;\n\n\t\tthis.position(0, 0);\n\n\t\t// add any custom CSS style\n\t\tvar domStyles = opts['dom:styles'];\n\n\t\tfor (var name in domStyles) {\n\t\t\ts[name] = domStyles[name];\n\t\t}\n\n\t\t// store for the computed styles\n\t\tthis._computed = {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\tr: 0,\n\t\t\twidth: undefined,\n\t\t\theight: undefined,\n\t\t\tanchorX: 0,\n\t\t\tanchorY: 0,\n\t\t\toffsetX: 0,\n\t\t\toffsetY: 0,\n\t\t\topacity: 1,\n\t\t\tvisible: true,\n\t\t\tzIndex: 0,\n\t\t\tscale: 1\n\t\t};\n\n\t\t// animation\n\t\tthis._view.getAnimation = function () { return this.__view; }\n\t\tthis._animating = false;\n\t\tthis._animationQueue = [];\n\t\tthis._animationCallback = null;\n\n\t\t// put the initial view tag into the view tree for easier debugging\n\t\tif (DEBUG) {\n\t\t\tn.setAttribute(\"TAG:\", view.getTag());\n\t\t}\n\t}\n\n\tthis.getElement = function () { return this._node; }\n\n\tvar ADD_COUNTER = 900000;\n\tthis.addSubview = function (view) {\n\t\tvar backing = view.__view;\n\t\tvar node = backing._node;\n\t\tvar superview = node.parentNode && node.parentNode._view;\n\t\tif (superview == this._view) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\tif (superview) { superview.__view.removeSubview(view); }\n\t\t\tvar n = this._subviews.length;\n\t\t\tthis._subviews[n] = backing;\n\t\t\tthis._node.appendChild(node);\n\n\t\t\tbacking._setAddedAt(++ADD_COUNTER);\n\t\t\tif (n && backing.__sortKey < this._subviews[n - 1].__sortKey) {\n\t\t\t\tthis._needsSort = true;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}\n\n\tthis.removeSubview = function (targetView) {\n\t\tvar index = this._subviews.indexOf(targetView.__view);\n\t\tif (index != -1) {\n\t\t\tthis._subviews.splice(index, 1);\n\t\t\tthis._node.removeChild(targetView.__view._node);\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tthis.getSuperview = function () {\n\t\tvar p = this._node.parentNode;\n\t\tif (p == document.body || !p) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn p._view;\n\t}\n\n\tthis.getSubviews = function () {\n\t\tif (this._needsSort) { this._needsSort = false; this._subviews.sort(); }\n\t\tvar subviews = [];\n\t\tvar n = this._subviews.length;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tsubviews[i] = this._subviews[i]._view;\n\t\t}\n\t\treturn subviews;\n\t}\n\n\tthis.wrapTick = function (dt, app) {\n\t\tthis._view.tick && this._view.tick(dt, app);\n\n\t\tfor (var i = 0, view; view = this._subviews[i]; ++i) {\n\t\t\tview.wrapTick(dt, app);\n\t\t}\n\t}\n\n\tthis.wrapRender = function (ctx, opts) {\n\t\tif (!this.visible) { return; }\n\t\tif (this._needsSort) { this._needsSort = false; this._subviews.sort(); }\n\n\t\tvar width = this._computed.width;\n\t\tvar height = this._computed.height;\n\t\tif (width < 0 || height < 0) { return; }\n\n\t\t// var filters = this._view.getFilters();\n\t\t// ctx.setFilters(filters);\n\n\t\ttry {\n\t\t\tvar render = this._view.render;\n\t\t\tif (render && !render.isFake) {\n\t\t\t\tthis._render(render, width, height, opts);\n\t\t\t}\n\n\t\t\tthis._renderSubviews(ctx, opts);\n\t\t} catch(e) {\n\t\t \tlogger.ERROR&&console.error(\"ERROR\",\".backend.dom.ViewBacking\",this, e.message, e.stack);\n\t\t}\n\t}\n\n\tthis._render = function (render, width, height, opts) {\n\t\tif (this._noCanvas) {\n\t\t\trender.call(this._view, null, opts);\n\t\t} else {\n\t\t\tif (!this._canvas) {\n\t\t\t\tvar canvas = new Canvas();\n\t\t\t\tthis._canvas = canvas;\n\t\t\t\tthis._node.insertBefore(this._canvas, this._node.firstChild);\n\t\t\t\tthis.ctx = this._canvas.getContext('2d');\n\t\t\t}\n\n\t\t\tvar needsRepaint = this._view._needsRepaint;\n\n\t\t\t// clear the canvas\n\t\t\tif ((width | 0) != this._canvas.width || (height | 0) != this._canvas.height) {\n\t\t\t\tneedsRepaint = true;\n\t\t\t\tthis._canvas.width = width;\n\t\t\t\tthis._canvas.height = height;\n\t\t\t}\n\n\t\t\tif (needsRepaint) {\n\t\t\t\tthis._view._needsRepaint = false;\n\t\t\t\tthis._canvas.style.display = 'none';\n\t\t\t\tthis.ctx.clear();\n\t\t\t\t// this.ctx.fillStyle = 'red';\n\t\t\t\t// this.ctx.fillRect(0, 0, 1000, 1000);\n\t\t\t\tthis.ctx.save();\n\t\t\t\trender.call(this._view, this.ctx, opts);\n\t\t\t\tthis.ctx.restore();\n\t\t\t\tthis._canvas.style.display = 'block';\n\t\t\t}\n\t\t}\n\t}\n\n\tthis._renderSubviews = function (ctx, opts) {\n\t\tvar i = 0;\n\t\tvar view;\n\t\tvar subviews = this._subviews;\n\t\twhile (view = subviews[i++]) {\n\t\t\tview.wrapRender(ctx, opts);\n\t\t}\n\t}\n\n\tthis.localizePoint = function (pt) {\n\t\tvar s = this._computed;\n\t\tpt.x -= s.x + s.anchorX + s.offsetX;\n\t\tpt.y -= s.y + s.anchorY + s.offsetY;\n\t\tif (s.r) { pt.rotate(-s.r); }\n\t\tpt.scale(1 / s.scale);\n\t\tpt.x += s.anchorX;\n\t\tpt.y += s.anchorY;\n\t\treturn pt;\n\t}\n\n\t// exports the current style object\n\tthis.copy = function () {\n\t\treturn merge({}, this._computed);\n\t}\n\n\tthis.update = function (style) { this._setProps(style); }\n\n\tthis.position = function (x, y) {\n\t\tvar s = this._node.style;\n\n\t\tif (SUPPORTS_TRANSLATE3D) {\n\t\t\tvar translate = 'translate3d(' + (x) + 'px,' + (y) + 'px,0)';\n\n\t\t\t// Check for differences and other properties like scale, rotate, translate, etc\n\t\t\tif (s[TRANSFORM_PREFIX] != '' && s[TRANSFORM_PREFIX] != translate) {\n\t\t\t\ts[TRANSFORM_PREFIX] += translate;\n\t\t\t}\n\t\t\telse {\n\t\t\t\ts[TRANSFORM_PREFIX] = translate;\n\t\t\t}\n\n\t\t}\n\t\telse {\n\t\t\ts.left = x + 'px';\n\t\t\ts.top = y + 'px';\n\t\t}\n\t};\n\n\t//****************************************************************\n\t// ANIMATION\n\n\tfunction getEasing(fn) {\n\t\tif (typeof fn == 'string') { return fn; }\n\t\tif (fn == animate.easeIn) { return 'ease-in'; }\n\t\tif (fn == animate.easeOut) { return 'ease-out'; }\n\t\tif (fn == animate.easeInOut) { return 'ease-in-out'; }\n\t\tif (fn == animate.linear) { return 'linear'; }\n\t\treturn 'ease';\n\t};\n\n\tthis._updateOrigin = function () {\n\t\tthis._node.style.webkitTransformOrigin = (this._computed.anchorX || 0) + 'px ' + (this._computed.anchorY || 0) + 'px';\n\t}\n\n\tthis._setProps = function (props, anim) {\n\t\tvar setMatrix = false;\n\t\tvar s = this._node.style;\n\t\tvar animCount = 0;\n\t\tvar resized = false;\n\t\tvar previous = {};\n\t\tfor (var key in props) {\n\t\t\tvar value = props[key];\n\t\t\tif (key == \"dx\" || key == \"dy\") {\n\t\t\t\tkey = key.substr(1);\n\t\t\t\tvalue = this._computed[key] + value;\n\t\t\t}\n\t\t\tswitch (key) {\n\t\t\t\tcase \"anchorX\":\n\t\t\t\tcase \"anchorY\":\n\t\t\t\t\tthis._computed[key] = value;\n\t\t\t\t\tthis._updateOrigin();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"clip\":\n\t\t\t\t\tthis._computed.clip = value;\n\t\t\t\t\ts.overflow = value ? 'hidden' : 'visible';\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"zIndex\":\n\t\t\t\t\tif (this._computed.zIndex != value) {\n\t\t\t\t\t\tthis._computed.zIndex = value;\n\t\t\t\t\t\ts.zIndex = value;\n\t\t\t\t\t\tthis._onZIndex(value);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"offsetX\":\n\t\t\t\tcase \"offsetY\":\n\t\t\t\tcase \"x\":\n\t\t\t\tcase \"y\":\n\t\t\t\tcase \"r\":\n\t\t\t\tcase \"scale\":\n\t\t\t\t\tif (this._computed[key] != value) {\n\t\t\t\t\t\tprevious[key] = this._computed[key];\n\t\t\t\t\t\tthis._computed[key] = value;\n\t\t\t\t\t\tsetMatrix = true;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (this._computed[key] != value) {\n\t\t\t\t\t\t++animCount;\n\t\t\t\t\t    this._computed[key] = value;\n\t\t\t\t\t\tif (key == 'width' || key == 'height') {\n\t\t\t\t\t\t\ts[key] = value + 'px';\n\t\t\t\t\t\t\tresized = true;\n\t\t\t\t\t\t} else if (key == 'visible') {\n\t\t\t\t\t\t\ts.display = (value ? this._displayStyle || 'block' : 'none');\n\t\t\t\t\t\t\t//s.visibility = (value ? 'visible' : 'hidden');\n\t\t\t\t\t\t\t// chrome has an obscure rendering bug where visibility:hidden won't\n\t\t\t\t\t\t\t// hide the canvas element child nodes sometimes. If you set opacity to zero, it will.\n\t\t\t\t\t\t\t//s.opacity = (value ? this._computed['opacity'] : 0);\n\n\t\t\t\t\t\t} else if (key == 'opacity') {\n\t\t\t\t\t\t\ts[key] = value;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ts[key] = value;\n\n\t\t\t\t\t\t\tif (!CUSTOM_KEYS[key]) {\n\t\t\t\t\t\t\t\tthis[key] = value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (setMatrix) {\n\t\t\t++animCount;\n\n\t\t\tvar c = this._computed;\n\t\t\tvar x = (this._center ? -c.width / 2 | 0 : 0) + c.x + c.offsetX;\n\t\t\tvar y = (this._center ? -c.height / 2 | 0 : 0) + c.y + c.offsetY;\n\n\t\t\tif (AVOID_CSS_ANIM) {\n\t\t\t\tvar obj = {\n\t\t\t\t\tscale: previous.scale || c.scale,\n\t\t\t\t\tr: previous.r || c.r\n\t\t\t\t};\n\n\t\t\t\t// because of android bugs,\n\t\t\t\t// we must never animate -webkit-transform.\n\t\t\t\t// http://code.google.com/p/android/issues/detail?id=12451\n\t\t\t\t// TODO: is this fixed in Android > 2.2? Chrome?\n\t\t\t\tif (anim && ((obj.scale != c.scale) ||\n\t\t\t\t\t\t\t (obj.r != c.r))) {\n\t\t\t\t\t// logger.LOG&&console.log(\"LOG\",\".backend.dom.ViewBacking\",'set transform animated', obj.scale, c.scale, obj.r, c.r);\n\t\t\t\t\tanimate(obj).now({\n\t\t\t\t\t\tscale: c.scale,\n\t\t\t\t\t\tr: c.r\n\t\t\t\t\t}, anim.duration, anim.easing, bind(this, function () {\n\t\t\t\t\t\ts.WebkitTransform = ('scale(' + (c.flipX ? obj.scale * -1 : obj.scale) +\n\t\t\t\t\t\t\t\t\t\t\t ',' + (c.flipY ? obj.scale * -1 : obj.scale) + ') ' +\n\t\t\t\t\t\t\t\t\t\t\t 'rotate(' + obj.r + 'rad)');\n\t\t\t\t\t})).then(bind(this, function () {\n\t\t\t\t\t\ts.WebkitTransform = ('scale(' + (c.flipX ? obj.scale * -1 : obj.scale) +\n\t\t\t\t\t\t\t\t\t\t\t ',' + (c.flipY ? obj.scale * -1 : obj.scale) + ') '  +\n\t\t\t\t\t\t\t\t\t\t\t 'rotate(' + c.r + 'rad)');\n\t\t\t\t\t}));\n\n\t\t\t\t} else if ((obj.scale != c.scale) ||\n\t\t\t\t\t\t   (obj.r != c.r)) {\n\t\t\t\t\t// logger.LOG&&console.log(\"LOG\",\".backend.dom.ViewBacking\",'set transform', c.scale, c.r);\n\t\t\t\t\ts.WebkitTransform = ('scale(' + (c.flipX ? c.scale * -1 : c.scale) +\n\t\t\t\t\t\t\t\t\t\t\t',' + (c.flipY ? c.scale * -1 : c.scale) + ') ' +\n\t\t\t\t\t\t\t\t\t\t 'rotate(' + c.r + 'rad)');\n\t\t\t\t}\n\n\t\t\t\t// use CSS animations for left and top though, since\n\t\t\t\t// those can still be taken out of javascript.\n\t\t\t\tthis.position(x, y);\n\t\t\t} else {\n\t\t\t\tvar matrix = new WebKitCSSMatrix();\n\t\t\t\tmatrix = matrix.translate(x, y);\n\t\t\t\tmatrix = matrix.rotate(c.r * 180 / 3.14159);\n\t\t\t\tmatrix = matrix.scale(c.scale);\n\n\t\t\t\tif (c.flipX || c.flipY) {\n\t\t\t\t\tmatrix = matrix.translate(\n\t\t\t\t\t\tc.flipX ? -c.width : 0,\n\t\t\t\t\t\tc.flipY ? c.height / 2 : 0\n\t\t\t\t\t);\n\t\t\t\t\tmatrix = matrix.scale(\n\t\t\t\t\t\tc.flipX ? -1 : 1,\n\t\t\t\t\t\tc.flipY ? -1 : 1\n\t\t\t\t\t);\n\t\t\t\t\tmatrix = matrix.translate(\n\t\t\t\t\t\tc.flipX ? c.width : 0,\n\t\t\t\t\t\tc.flipY ? -c.height / 2 : 0\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// on iOS, forcing a 3D matrix provides huge performance gains.\n\t\t\t\t// Rotate it about the y axis 360 degrees to achieve this.\n\t\t\t\tmatrix = matrix.rotate(0, 360, 0);\n\t\t\t\ts.WebkitTransform = matrix;\n\t\t\t}\n\t\t}\n\n\t\tif (resized) {\n\t\t\tthis._view.needsReflow();\n\t\t}\n\n\t\treturn animCount;\n\t};\n\n\t// ----- zIndex -----\n\n\tvar LEN_Z = 8;\n\tvar MAX_Z = 99999999;\n\tvar MIN_Z = -99999999;\n\tvar PAD = \"00000000\";\n\n\tthis._sortIndex = \"00000000\";\n\n\tthis._onZIndex = function (zIndex) {\n\t\tzIndex = ~~zIndex;\n\n\t\tif (zIndex < MIN_Z) { zIndex = this._zIndex = MIN_Z; }\n\t\tif (zIndex > MAX_Z) { zIndex = this._zIndex = MAX_Z; }\n\t\tif (zIndex < 0) {\n\t\t\tzIndex *= -1;\n\t\t\tthis._sortIndex = '-' + PAD.substring(0, LEN_Z - ('' + zIndex).length) + zIndex;\n\t\t} else {\n\t\t\tthis._sortIndex = PAD.substring(0, LEN_Z - ('' + zIndex).length) + zIndex;\n\t\t}\n\n\t\tthis._setSortKey();\n\t}\n\n\tthis._setAddedAt = function (addedAt) {\n\t\tthis._addedAt = addedAt;\n\t\tthis._setSortKey();\n\t}\n\n\tthis._setSortKey = function () { this.__sortKey = this._sortIndex + this._addedAt; }\n\tthis.toString = function () { return this.__sortKey; }\n\n\t// ----- ANIMATION -----\n\n\tthis._transitionEnd = function (evt) {\n\t\t$.stopEvent(evt);\n\t\tif (this.transitionCallback.fired()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.transitionCallback.fire();\n\t\tthis.transitionCallback.reset();\n\n\t\tif (evt) {\n\t\t\tevt.cancelBubble = true;\n\t\t} else if (this._transitionEndTimeout) {\n\t\t\tthis._transitionEndTimeout = null;\n\t\t}\n\n\t\tthis._node.style.webkitTransition = \"none\";\n\n\t\tthis._animating = false;\n\t\tif (this._animationCallback) {\n\t\t\tvar callback = this._animationCallback;\n\t\t\tthis._animationCallback = null;\n\t\t\tcallback();\n\t\t}\n\n\t\tthis._processAnimation();\n\t};\n\n\n\tthis._processAnimation = function (doNow) {\n\t\tif (this._animationQueue.length == 0 || this._isPaused) {\n\t\t\treturn;\n\t\t}\n\t\tif (doNow) {\n\t\t\t\tclearTimeout(this._queuedTimeout);\n\t\t\t\tthis._queuedTimeout = null;\n\t\t}\n\t\tif (this._queuedTimeout) {\n\t\t\treturn;\n\t\t}\n\t\tif (!doNow) {\n\t\t\tif (!this._queuedTimeout) {\n\t\t\t\tthis._queuedTimeout = setTimeout(bind(this, function () {\n\t\t\t\t\tthis._queuedTimeout = false;\n\t\t\t\t\tthis._processAnimation(true);\n\t\t\t\t}), 0);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tvar anim = this._animationQueue.shift();\n\t\tswitch (anim.type) {\n\t\tcase \"animate\":\n\t\t\tvar s = this._node.style;\n\t\t\tif (AVOID_CSS_ANIM) {\n\t\t\t\ts.webkitTransitionProperty = \"left, top, opacity, width, height\";\n\t\t\t} else {\n\t\t\t\ts.webkitTransitionProperty = \"-webkit-transform, opacity, width, height\";\n\t\t\t}\n\t\t\ts.webkitTransitionDuration = (anim.duration|0) + \"ms\";\n\t\t\ts.webkitTransitionTimingFunction = getEasing(anim.easing);\n\t\t\tthis._setProps(anim.props, anim);\n\n\t\t\t// fall through\n\t\tcase \"wait\":\n\t\t\tthis._animating = true;\n\t\t\tthis._animationCallback = anim.callback || null;\n\n\t\t\tthis.transitionCallback = new Callback();\n\n\t\t\tthis.transitionCallback.runOrTimeout(function () {\n\t\t\t\t// if webkitTransitionEnd fires, do nothing\n\t\t\t}, bind(this, function (evt) {\n\t\t\t\t// webkitTransitionEnd is too late, baby, it's too late\n\t\t\t\tthis._transitionEnd(evt);\n\t\t\t}), anim.duration);\n\t\t\tbreak;\n\t\tcase \"callback\":\n\t\t\t//logger.LOG&&console.log(\"LOG\",\".backend.dom.ViewBacking\",'doing callback', anim.callback, doNow);\n\t\t\tanim.callback();\n\t\t\tif (!this._animating) {\n\t\t\t\tthis._processAnimation();\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t};\n\n\tthis.getQueue = function () {\n\t\treturn [];\n\t}\n\tthis.getAnimation = function () {\n\t\treturn this;\n\t}\n\n\tthis.animate = function () {\n\t\tif (!arguments[0]) {\n\t\t\treturn this;\n\t\t}\n\t\treturn this.next.apply(this, arguments);\n\t}\n\n\tthis.clear = function () {\n\t\tthis.transitionCallback && this.transitionCallback.fire();\n\t\tif (this._transitionEndTimeout) {\n\t\t\tclearTimeout(this._transitionEndTimeout);\n\t\t}\n\t\tthis._animationQueue = [];\n\t\tthis._animationCallback = null;\n\t\tthis._animating = false;\n\t\treturn this;\n\t};\n\n\tthis.commit = function () {\n\t\tthis._node.style.webkitTransition = 'none';\n\t\tvar queue = this._animationQueue;\n\t\tthis._animationQueue = [];\n\t\tvar n = queue.length;\n\t\tfor (var i = 0; i < n; ++i) {\n\t\t\tvar anim = queue[i];\n\t\t\tswitch (anim.type) {\n\t\t\t\tcase \"animate\":\n\t\t\t\t\tthis._setProps(anim.props);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"wait\":\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"callback\":\n\t\t\t\t\tanim.callback();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tvar DURATION = 600;\n\n\tthis.pause = function () {\n\t\tthis._isPaused = true;\n\t}\n\n\tthis.resume = function () {\n\t\tthis._isPaused = false;\n\t\tthis._processAnimation();\n\t}\n\n\tthis.animate = function (props, duration, easing, callback) {\n\t\t//this.clear();\n\t\treturn this.then(props, duration, easing, callback);\n\t};\n\n\tthis.now = function (props, duration, easing, callback) {\n\t\tthis.clear();\n\t\treturn this.then(props, duration, easing, callback);\n\t}\n\n\tthis.then = function (props, duration, easing, callback) {\n\t\tif (arguments.length == 1 && typeof props === 'function') {\n\t\t\treturn this.callback(props);\n\t\t}\n\t\tthis._animationQueue.push({\n\t\t\ttype: \"animate\",\n\t\t\tprops: props,\n\t\t\tduration: duration || DURATION,\n\t\t\tcallback: callback && bind(this, callback),\n\t\t\teasing: easing\n\t\t});\n\t\tif (this._animationQueue.length == 1 && !this._animating) {\n\t\t\tthis._processAnimation();\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.callback = function (fn) {\n\t\tthis._animationQueue.push({\n\t\t\ttype: \"callback\",\n\t\t\tduration: 0,\n\t\t\tcallback: fn && bind(this, fn)\n\t\t});\n\t\tif (this._animationQueue.length == 1 && !this._animating) {\n\t\t\tthis._processAnimation();\n\t\t}\n\t\treturn this;\n\t}\n\n\tthis.wait = function (duration, callback) {\n\t\tthis._animationQueue.push({\n\t\t\ttype: \"wait\",\n\t\t\tduration: duration,\n\t\t\tcallback: callback\n\t\t});\n\t\tif (this._animationQueue.length == 1 && !this._animating) {\n\t\t\tthis._processAnimation();\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.fadeIn = function (duration, callback) {\n\t\tthis.show();\n\n\t\tif (this._node.style.opacity == 1) {\n\t\t\tif (callback) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis.then({\n\t\t\topacity: 1\n\t\t}, duration, null, callback);\n\t\treturn this;\n\t};\n\n\tthis.fadeOut = function (duration, callback) {\n\t\tif (this._node.style.opacity == 0) {\n\t\t\tthis.hide();\n\t\t\tif (callback) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tthis.then({\n\t\t\topacity: 0\n\t\t}, duration, null, bind(this, function () {\n\t\t\tthis.hide();\n\t\t\tif (callback) {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}));\n\n\t\treturn this;\n\t};\n\n});\n\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ImageView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ImageView.js","friendlyPath":".backend.canvas.ImageView","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"ImageView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.backend.canvas.ImageView;\n *\n * canvas.ImageView implementation.\n */\n\njsio('import util.path');\njsio('import std.uri as URI');\n\njsio('import ui.View as View')\njsio('import ui.resource.Image as Image');\n\nvar imageCache = {};\n\n/**\n * @extends ui.View\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ImageView=__class__;var ImageView = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ImageView(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ImageView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\t/** \n\t * Options:\n\t *   autoSize - See .setImage()\n\t */\n\n\t/**\n\t * Return this view's Image object.\n\t */\n\n\tthis.getImage = function () {\n\t\treturn this._img;\n\t};\n\n\tthis.getImageFromCache = function(url, forceReload) {\n\t\tvar img;\n\t\tif (!forceReload) {\n\t\t\timg = imageCache[url];\n\t\t}\n\t\tif (!img) {\n\t\t\timageCache[url] = img = new Image({\n\t\t\t\turl: url,\n\t\t\t\tforceReload: !!forceReload\n\t\t\t});\n\t\t}\n\t\treturn img;\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\tvar opts = supr(this, 'updateOpts', arguments);\n\t\t\n\t\tif ('autoSize' in opts) {\n\t\t\tthis._autoSize = !!opts.autoSize;\n\t\t}\n\n\t\tif (opts.image) {\n\t\t\tthis.setImage(opts.image);\n\t\t} else {\n\t\t\tthis.needsReflow();\n\t\t}\n\n\t\treturn opts;\n\t}\n\n\t/**\n\t * Set the image of the view from an Image object or string.\n\t * Options:\n\t *   autoSize - Automatically set view size from image dimensions.\n\t */\n\n\tthis.setImage = function (img, opts) {\n\t\tvar forceReload = opts && opts.forceReload;\n\t\tif (typeof img == 'string') {\n\t\t\timg = this.getImageFromCache(img, forceReload);\n\t\t}\n\n\t\tthis._img = img;\n\n\t\tif (this._img) {\n\t\t\tthis._autoSize = (opts && ('autoSize' in opts)) ? opts.autoSize : this._autoSize;\n\t\t\tif (this._autoSize) {\n\t\t\t\t// sprited resources will know their dimensions immediately\n\t\t\t\tif (this._img.getWidth() > 0 && this._img.getHeight() > 0) {\n\t\t\t\t\tthis.autoSize();\n\t\t\t\t} else {\n\t\t\t\t\t// non-sprited resources need to load first\n\t\t\t\t\tthis._img.doOnLoad(this, 'autoSize');\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._img.doOnLoad(this, 'needsRepaint');\n\t\t}\n\t};\n\n\t/**\n\t * Pass a function to load once the Image object is loaded, or a list of\n\t * arguments that call lib.Callback::run() implicitly.\n\t */\n\t\n\tthis.doOnLoad = function () {\n\t\tif (arguments.length == 1) {\n\t\t\tthis._img.doOnLoad(this, arguments[0]);\n\t\t} else {\n\t\t\tthis._img.doOnLoad.apply(this._img, arguments);\n\t\t}\n\t\treturn this;\n\t};\n\n\t/**\n\t * Automatically resize the view to the size of the image.\n\t */\n\t\n\tthis.autoSize = function () {\n\t\tif (this._img) {\n\t\t\tthis.style.width = this._img.getWidth();\n\t\t\tthis.style.height = this._img.getHeight();\n\n\t\t\tif (this.style.fixedAspectRatio) {\n\t\t\t\tthis.style.enforceAspectRatio(this.style.width, this.style.height);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Get original width of the Image object.\n\t */\n\t\n\tthis.getOrigWidth = this.getOrigW = function () {\n\t\treturn this._img.getOrigW();\n\t};\n\n\t/**\n\t * Get original height of the Image object.\n\t */\n\n\tthis.getOrigHeight = this.getOrigH = function () {\n\t\treturn this._img.getOrigH();\n\t};\n\n\t/**\n\t * Render this image onto a canvas.\n\t */\n\n\tthis.render = function (ctx) {\n\t\tif (!this._img) { return; }\n\n\t\tvar s = this.style;\n\t\tvar w = s.width;\n\t\tvar h = s.height;\n\t\tthis._img.render(ctx, 0, 0, w, h);\n\t}\n\n\t/**\n\t * Return a human-readable tag for this view.\n\t */\n\n\tvar _loc = window.location.toString();\n\tvar _host = window.location.hostname;\n\n\tthis.getTag = function () {\n\t\tvar tag;\n\t\tif (this._img) {\n\t\t\tvar url = this._img.getOriginalURL();\n\t\t\tif (this._cachedTag && url == this._cachedTag.url) {\n\t\t\t\ttag = this._cachedTag.tag;\n\t\t\t} else {\n\t\t\t\tvar uri = URI.relativeTo(url, _loc);\n\t\t\t\tvar host = uri.getHost();\n\t\t\t\ttag = util.path.splitExt(uri.getFile()).basename + (host && host != _host ? ':' + host : '');\n\n\t\t\t\tthis._cachedTag = {\n\t\t\t\t\turl: url,\n\t\t\t\t\ttag: tag\n\t\t\t\t};\n\t\t\t}\n\t\t};\n\n\t\treturn (tag || '') + ':ImageView' + this.uid;\n\t}\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/TextView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/TextView.js","friendlyPath":".backend.canvas.TextView","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"TextView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.backend.canvas.TextView;\n *\n * canvas.TextView implementation.\n */\n\njsio('import ui.View as View');\njsio('import ui.resource.Image as Image');\njsio('import device');\njsio('import .util.FragmentBuffer as FragmentBuffer');\njsio('import .TextFlow');\n\njsio('import ...legacySettings as legacySettings');\n\nvar messageFont = true; // Report first font error message\n\nvar textViewID = 1;\n\n/**\n * @extends ui.View\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextView=__class__;var TextView = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextView(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\tvar DEPRECATED = {\n\t\tmultiline: { replacement: \"wrap\" },\n\t\ttextAlign: { replacement: \"horizontalAlign\" },\n\t\tlineWidth: { replacement: \"strokeWidth\" },\n\t\tstrokeStyle: { replacement: \"strokeColor\" },\n\t\toutlineColor: { replacement: \"strokeColor\" }\n\t};\n\n\tvar defaults = {\n\t\t// layout properties...\n\t\twrap: false,\n\t\tautoSize: false,\n\t\tautoFontSize: true,\n\t\tlineHeight: 1.2,\n\n\t\t// font properties...\n\t\tcolor: \"#000000\",\n\t\tfontFamily: device.defaultFontFamily,\n\t\tfontWeight: device.defaultFontWeight,\n\t\tsize: 128,\n\t\tstrokeWidth: 2,\n\t\tshadowWidth: 2,\n\t\tstrokeColor: null,\n\t\tshadowColor: null,\n\n\t\t// alignment properties...\n\t\tverticalAlign: \"middle\",\n\t\thorizontalAlign: \"center\",\n\n\t\t// misc properties...\n\t\tbuffer: false, // GLOBAL.NATIVE && !device.simulatingMobileNative,\n\t\tbackgroundColor: ''\n\t};\n\n\tvar clearCache = {\n\t\t// basic widget properties...\n\t\twidth: true,\n\t\theight: true,\n\n\t\t// layout properties...\n\t\twrap: true,\n\t\tautoSize: true,\n\t\tautoFontSize: true,\n\t\tpadding: true,\n\t\tlineHeight: true,\n\n\t\t// font properties...\n\t\tcolor: false,\n\t\tfontFamily: true,\n\t\tfontWeight: true,\n\t\tsize: true,\n\t\tstrokeWidth: true,\n\t\tshadowWidth: true,\n\t\tstrokeColor: false,\n\t\tshadowColor: false,\n\n\t\t// alignment properties...\n\t\tverticalAlign: true,\n\t\thorizontalAlign: true,\n\n\t\t// misc properties...\n\t\tbackgroundColor: false,\n\t\ttext: true\n\t};\n\tvar clearCacheKeys = Object.keys(clearCache);\n\n\tvar hashItems = {\n\t\t// font properties...\n\t\tcolor: true,\n\t\tfontFamily: true,\n\t\tfontWeight: true,\n\t\tsize: true,\n\t\tstrokeWidth: true,\n\t\tshadowWidth: true,\n\t\tstrokeColor: false,\n\t\tshadowColor: false,\n\n\t\t// misc properties...\n\t\tbackgroundColor: true,\n\t\ttext: true\n\t};\n\tvar hashItemsKeys = Object.keys(hashItems);\n\n\tvar savedOpts = [\n\t\t\"width\",\n\t\t\"height\",\n\t\t\"size\"\n\t];\n\n\tvar fontBuffer = new FragmentBuffer();\n\n\tfontBuffer.onGetHash = function (desc) {\n\t\treturn desc.textView.getHash();\n\t};\n\n\tthis.init = function (opts) {\n\t\tthis._opts = {};\n\t\tthis._optsLast = {};\n\t\tthis.updateCache();\n\n\t\tthis._textFlow = new TextFlow({target: this});\n\t\tthis._textFlow.subscribe(\"ChangeWidth\", this, \"onChangeWidth\");\n\t\tthis._textFlow.subscribe(\"ChangeHeight\", this, \"onChangeHeight\");\n\t\tthis._textFlow.subscribe(\"ChangeSize\", this, \"onChangeSize\");\n\n\t\tsupr(this, 'init', [merge(opts, defaults)]);\n\n\t\tthis._id = textViewID++;\n\t};\n\n\tthis.onChangeWidth = function (width) {\n\t\tthis.updateOpts({width: width}, true);\n\t};\n\n\tthis.onChangeHeight = function (height) {\n\t\tthis.updateOpts({height: height}, true);\n\t};\n\n\tthis.onChangeSize = function (size, ctx) {\n\t\tthis.updateOpts({size: size}, true);\n\t\tif (ctx) {\n\t\t\tctx.font = this._opts.fontWeight + \" \" + this._opts.size + \"px \" + this._opts.fontFamily;\n\t\t}\n\t};\n\n\t// These options might have been changed to make the text fit, restore them...\n\tthis._restoreOpts = function () {\n\t\tvar optsLast = this._optsLast;\n\t\tvar optsKey;\n\t\tvar i = savedOpts.length;\n\t\twhile (i) {\n\t\t\toptsKey = savedOpts[--i];\n\t\t\tif (optsKey in optsLast) {\n\t\t\t\tthis._opts[optsKey] = optsLast[optsKey];\n\t\t\t}\n\t\t}\n\t};\n\n\t// Check if the cache should be updated...\n\tthis._checkOpts = function (opts) {\n\t\tvar optsLast = this._optsLast;\n\t\tvar optsKey;\n\t\tvar i = clearCacheKeys.length;\n\n\t\tthis._cacheUpdate = this._cacheUpdate || !Object.keys(this._opts).length;\n\t\tif (this._cacheUpdate) {\n\t\t\tthis._hash = false;\n\t\t}\n\t\twhile (i) {\n\t\t\toptsKey = clearCacheKeys[--i];\n\t\t\tif ((optsKey in opts) && clearCache[optsKey] && (optsLast[optsKey] !== opts[optsKey])) {\n\t\t\t\tthis._cacheUpdate = true;\n\t\t\t}\n\t\t\tif (optsKey in opts) {\n\t\t\t\toptsLast[optsKey] = opts[optsKey];\n\t\t\t} else if (optsKey in this._opts) {\n\t\t\t\toptsLast[optsKey] = this._opts[optsKey];\n\t\t\t} else {\n\t\t\t\toptsLast[optsKey] = defaults[optsKey];\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._checkDeprecatedOpts = function (opts) {\n\t\topts.allowVerticalSizing = !legacySettings.disableVerticalAutoSize;\n\t\tfor (var k in DEPRECATED) {\n\t\t\tif (k in opts) {\n\t\t\t\tvar dep = DEPRECATED[k];\n\t\t\t\tif (DEBUG && !dep.hasWarned) {\n\t\t\t\t\tconsole.warn(\"TextView opts.\" + k + \" is deprecated, please use \" + dep.replacement + \"...\");\n\t\t\t\t\tdep.hasWarned = true;\n\t\t\t\t}\n\t\t\t\topts[dep.replacement] = opts[k];\n\t\t\t}\n\t\t}\n\t\tvar font = opts.font;\n\t\tif (font) {\n\t\t\tif (DEBUG && messageFont) {\n\t\t\t\tconsole.warn(\"TextView opts.font is deprecated, please use fontFamily and size...\");\n\t\t\t\tmessageFont = false;\n\t\t\t}\n\t\t\twhile (font.length && (font[0] === \" \")) {\n\t\t\t\tfont = font.substr(1 - font.length);\n\t\t\t}\n\t\t\tvar i = font.indexOf(' ');\n\t\t\tif (i !== -1) {\n\t\t\t\topts.size = parseInt(font.substr(0, i).replace(/[pxtem\\s]/gi, \"\"), 10);\n\t\t\t\topts.fontFamily = font.substr(i + 1 - font.length);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.updateCache = function () {\n\t\tthis._cacheUpdate = true;\n\t\tthis._hash = false;\n\t};\n\n\tthis.updateOpts = function (opts, dontCheck) {\n\t\t// update emoticon data\n\t\tif (opts.emoticonData) {\n\t\t\tfor (var key in opts.emoticonData.data) {\n\t\t\t\tvar data = opts.emoticonData.data[key];\n\t\t\t\tif (!data.image) {\n\t\t\t\t\tdata.image = new Image({url: data.url});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this._opts.buffer) {\n\t\t\tfontBuffer.releaseBin(this.getHash());\n\t\t}\n\t\tthis.updateCache();\n\n\t\tthis._checkDeprecatedOpts(opts);\n\n\t\tif (!dontCheck) {\n\t\t\tthis._restoreOpts();\n\t\t\tthis._checkOpts(opts);\n\t\t\tif (this._cacheUpdate) {\n\t\t\t\topts.hash = false;\n\t\t\t} else {\n\t\t\t\tsupr(this, \"updateOpts\", arguments);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\topts = supr(this, \"updateOpts\", arguments);\n\n\t\t(\"text\" in opts) && this.setText(opts.text);\n\t\t!dontCheck && this._textFlow.setOpts(this._opts);\n\n\t\treturn opts;\n\t};\n\n\tthis._updateCtx = function (ctx) {\n\t\tvar opts = this._opts;\n\n\t\tctx.textAlign = \"left\";\n\t\tctx.textBaseline = \"top\";\n\t\tctx.fillStyle = opts.color;\n\t\tctx.font = opts.fontWeight + \" \" + opts.size + \"px \" + opts.fontFamily;\n\t\tctx.lineWidth = this.getStrokeWidth();\n\t};\n\n\tthis._renderToCtx = function (ctx, offsetX, offsetY) {\n\t\tvar opts = this._opts;\n\t\tvar words = this._textFlow.getWords();\n\t\tvar maxWidth = opts.autoFontSize ? this._textFlow.getAvailableWidth() : 1000000;\n\t\tvar item;\n\t\tvar word;\n\t\tvar color = opts.color;\n\t\tvar strokeColor = opts.strokeColor;\n\t\tvar shadowColor = opts.shadowColor;\n\t\tvar lineOffset = this.getStrokeWidth() / 2;\n\t\tvar x, y;\n\t\tvar i = words.length;\n\n\t\tif (legacySettings.textViewColor && this.color) {\n\t\t\tcolor = this.color;\n\t\t}\n\n\t\tthis._updateCtx(ctx);\n\n\t\twhile (i) {\n\t\t\titem = words[--i];\n\t\t\tword = item.word;\n\n\t\t\tx = offsetX + item.x;\n\t\t\ty = offsetY + item.y;\n\n\t\t\tvar emoticonData = (word[0] == '(') && opts.emoticonData && opts.emoticonData.data[word];\n\t\t\tif (emoticonData) {\n\t\t\t\t//ctx.fillStyle = color;\n\t\t\t\t//ctx.fillRect(x + lineOffset, y + lineOffset, opts.size, opts.size);\n\t\t\t\tif (emoticonData.image) {\n\t\t\t\t\temoticonData.image.render(ctx, x + lineOffset, y + lineOffset, opts.size, opts.size);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif (shadowColor) {\n\t\t\t\t\tvar shadowOffsetX = this._opts.shadowWidth || 0;\n\t\t\t\t\tvar shadowOffsetY = this._opts.shadowWidth || 0;\n\t\t\t\t\tif ('shadowDx' in this._opts || 'shadowDy' in this._opts) {\n\t\t\t\t\t\tvar shadowOffsetX = this._opts.shadowDx | 0;\n\t\t\t\t\t\tvar shadowOffsetY = this._opts.shadowDy | 0;\n\t\t\t\t\t}\n\t\t\t\t\tvar hasShadowOpacity = 'shadowOpacity' in this._opts;\n\t\t\t\t\tvar oldOpacity = ctx.globalAlpha;\n\t\t\t\t\tif (hasShadowOpacity) {\n\t\t\t\t\t\tctx.globalAlpha *= this._opts.shadowOpacity;\n\t\t\t\t\t}\n\t\t\t\t\tif (strokeColor) {\n\t\t\t\t\t\tctx.strokeStyle = shadowColor;\n\t\t\t\t\t\tctx.strokeText(word, x + lineOffset + shadowOffsetX, y + lineOffset + shadowOffsetY, maxWidth);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tctx.fillStyle = shadowColor;\n\t\t\t\t\t\tctx.fillText(word, x + lineOffset + shadowOffsetX, y + lineOffset + shadowOffsetY, maxWidth);\n\t\t\t\t\t}\n\t\t\t\t\tif (hasShadowOpacity) {\n\t\t\t\t\t\tctx.globalAlpha = oldOpacity;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (strokeColor) {\n\t\t\t\t\tctx.strokeStyle = strokeColor;\n\t\t\t\t\tctx.strokeText(word, x + lineOffset, y + lineOffset, maxWidth);\n\t\t\t\t}\n\n\t\t\t\tctx.fillStyle = color;\n\t\t\t\tctx.fillText(word, x + lineOffset, y + lineOffset, maxWidth);\n\t\t\t}\n\t\t}\n\t\tif (this._opts.debug) {\n\t\t\tctx.strokeStyle = 'black';\n\t\t\tctx.strokeRect(x, y, item.width, this.style.height - 2 * y);\n\t\t\tctx.strokeStyle = 'red';\n\t\t\tctx.strokeRect(0, 0, this.style.width, this.style.height);\n\t\t}\n\t};\n\n\tthis._renderBuffer = function (ctx) {\n\t\tvar fontBufferCtx = fontBuffer.getContext();\n\t\tvar offsetRect = this._textFlow.getOffsetRect();\n\t\tvar width = offsetRect.width;\n\t\tvar height = offsetRect.height;\n\t\tvar words = this._textFlow.getWords();\n\t\tvar desc;\n\n\t\tif (width && height) {\n\t\t\tthis._opts.lineCount = words[words.length - 1].line;\n\t\t\toffsetRect.text = this._opts.text;\n\t\t\toffsetRect.textView = this;\n\t\t\t// When we support clearing offscreen buffers then this line can be activated instead of the next one...\n\t\t\t// desc = fontBuffer.getPositionForText(offsetRect) || fontBuffer.getPositionForText(offsetRect);\n\t\t\tdesc = fontBuffer.getPositionForText(offsetRect);\n\t\t\tif (desc != null) {\n\t\t\t\tif (this._cacheUpdate) {\n\t\t\t\t\tfontBufferCtx.clearRect(desc.x, desc.y, desc.width, desc.height);\n\t\t\t\t\tthis._renderToCtx(fontBufferCtx, desc.x - offsetRect.x, desc.y - offsetRect.y);\n\t\t\t\t}\n\t\t\t\tctx.drawImage(fontBuffer.getCanvas(), desc.x, desc.y, width, height, offsetRect.x, offsetRect.y, width, height);\n\t\t\t} else {\n\t\t\t\tthis._opts.buffer = false;\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.computeSize = function (ctx) {\n\t\tif (this._cacheUpdate) {\n\t\t\tthis._updateCtx(ctx);\n\t\t\tvar opts = this._opts;\n\t\t\tthis._textFlow.reflow(ctx, 1 + (opts.autoFontSize ? 4 : 0) + (opts.autoSize ? 2 : 0) + (opts.wrap ? 1 : 0));\n\t\t}\n\t}\n\n\tthis.render = function (ctx) {\n\t\tthis.computeSize(ctx);\n\t\tif (!this._textFlow.getWords().length) {\n\t\t\tthis._cacheUpdate = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._opts.buffer) {\n\t\t\tthis._renderBuffer(ctx);\n\t\t} else {\n\t\t\tvar strokeWidthOffset = -this.getStrokeWidth()/2;\n\t\t\tthis._renderToCtx(ctx, strokeWidthOffset, strokeWidthOffset);\n\t\t}\n\n\t\tthis._cacheUpdate = false;\n\t};\n\n\tthis.clearBuffers = function () {\n\t\tfontBuffer.clearBuffer();\n\t};\n\n\tthis.getFontBuffer = function () {\n\t\treturn fontBuffer;\n\t};\n\n\tthis.setText = function (textData) {\n\t\tvar text = (textData != undefined) ? textData.toString() : \"\";\n\n\t\tvar emoticonData = this._opts.emoticonData;\n\t\tif (emoticonData) {\n\t\t\tfor (var key in emoticonData.map) {\n\t\t\t\tvar re = new RegExp(key.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&'), 'g');\n\t\t\t\ttext = text.replace(re, emoticonData.map[key]);\n\t\t\t}\n\t\t}\n\n\t\tif (this._opts.text !== text) {\n\t\t\tif (this._opts.buffer) {\n\t\t\t\tfontBuffer.releaseBin(this.getHash());\n\t\t\t}\n\n\t\t\tthis._restoreOpts();\n\t\t\tthis._opts.text = text;\n\t\t\tthis.updateCache();\n\t\t\tthis.needsRepaint();\n\t\t}\n\t};\n\n\tthis.getStrokeWidth = function () {\n\t\treturn this._opts.strokeColor ? this._opts.strokeWidth : 0;\n\t};\n\n\tthis.getText = function () {\n\t\treturn this._opts.text;\n\t};\n\n\tthis.getTag = function () {\n\t\treturn \"TextView\" + this.uid + \":\" + (this.tag || (this._opts.text || \"\").substring(0, 20));\n\t};\n\n\tthis.getOpts = function () {\n\t\treturn this._opts;\n\t};\n\n\tthis.getHash = function () {\n\t\tif (!this._hash) {\n\t\t\tthis._hash = \"\";\n\n\t\t\tvar opts = this._opts;\n\t\t\tvar i = hashItemsKeys.length;\n\t\t\twhile (i) {\n\t\t\t\tthis._hash += opts[hashItemsKeys[--i]];\n\t\t\t}\n\t\t}\n\t\treturn this._hash;\n\n\t\t// When we support clearing offscreen buffers we can use this instead of the code above...\n\t\t// return 't' + this._id;\n\t};\n\n\tthis.reflow = function () {\n\t\tthis._restoreOpts();\n\t\tthis._cacheUpdate = true;\n\t};\n});\n\nexports.clearBuffers = TextView.prototype.clearBuffers;\nexports.getFontBuffer = TextView.prototype.getFontBuffer;\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/FragmentBuffer.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/FragmentBuffer.js","friendlyPath":".util.FragmentBuffer","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/","filename":"FragmentBuffer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\njsio('import .FragmentBin');\njsio('import .SortedLinkedList as SortedList');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBuffer=__class__;var FragmentBuffer = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBuffer(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBuffer(){return this.init&&this.init.apply(this,arguments)},function () {\n\tvar debug = false;\n\tthis.init = function (opts) {\n\t\tthis.opts = merge(opts, {});\n\t\tthis._cache = {};\n\t\tthis._decriptions = [];\n\t\twindow.addEventListener('pageshow', bind(this, 'clearBuffer'), false);\n\t};\n\n\tvar sort = function (a, b) {\n\t\treturn a.size() > b.size();\n\t};\n\n\tthis._build = function () {\n\t    var Canvas = device.get('Canvas');\n        this._canvas = new Canvas({width: 1024, height: 1024});\n        this._ctx = this.getCanvas().getContext('2d', bind(this, function() {\n\t\t\tlogger.LOG&&console.log(\"LOG\",\".util.FragmentBuffer\",\"{fragment-buffer} Reacting to lost canvas by clearing text buffer\");\n\t\t\t// On canvas loss:\n\t\t\tthis._canvas = null;\n\t\t\tthis.clearBuffer();\n\t\t}));\n\t\tthis._ctx.clearRect(0, 0, 1024, 1024);\n\t\tthis._ctx.textAlign = 'left';\n\t\tthis._ctx.textBaseline = 'middle';\n\t\tthis._ctx.globalCompositeOperation = 'source-over';\n\t\tthis._binList = new SortedList(sort);\n\t\tvar head = new FragmentBin({\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: 1024,\n\t\t\theight: 1024\n\t\t});\n\t\tthis._binList.insert(head);\n\t\tdebug && window.open().document.body.appendChild(this._canvas);\n\t};\n\n\tthis.getCanvas = function () {\n\t\tif (!this._canvas) {\n\t\t\tthis._build();\n\t\t}\n\t\treturn this._canvas;\n\t};\n\n\tthis.getContext = function () {\n\t\tif (!this._ctx) {\n\t\t\tthis._build();\n\t\t}\n\t\treturn this._ctx;\n\t};\n\n\tthis.onGetHash = function (description) {\n\t\tthrow Error('onGetHash should be implemented.');\n\t};\n\n\tvar randomColor = function () {\n\t\tvar color = 'rgba(' +\n\t\t\t\t\t(Math.random()*255).toFixed() + ',' +\n\t\t\t\t\t(Math.random()*255).toFixed() + ',' +\n\t\t\t\t\t(Math.random()*255).toFixed() + ',' +\n\t\t\t\t\t'1)';\n\t\treturn color;\n\t};\n\n\tthis._insertText = function (description) {\n\t\tvar width = Math.ceil(description.width) + 1;\n\t\tvar height = Math.ceil(description.height) + 1;\n\t\tvar iter = this._binList.iterator();\n\t\tvar bin = null;\n\t\tvar found = false;\n\t\twhile (iter.hasNext() && !found) {\n\t\t\tbin = iter.next();\n\t\t\tif (!bin.filled && bin.width >= width && bin.height >= height) {\n\t\t\t\tfound = true;\n\t\t\t} else {\n\t\t\t\t//we don't want to insert in filled bins\n\t\t\t\tbin = null;\n\t\t\t}\n\t\t}\n\t\tif (bin) {\n\t\t\tnewBins = bin.split(width, height);\n\t\t\tfor (var i = 0; i < newBins.length; i++) {\n\t\t\t\tthis._binList.insert(newBins[i]);\n\t\t\t}\n\t\t} else {\n\t\t\tlogger.LOG&&console.log(\"LOG\",\".util.FragmentBuffer\",'buffer full, further TextViews will not be cached');\n\t\t\t// When we support clearing buffers then this should be enabled again...\n\t\t\t// this.clearBuffer();\n\t\t}\n\n\t\treturn bin;\n\t};\n\n\t/**\n\t* debugging code to verify overlapping bins aren't created.\n\t*/\n\tvar rectIntersectsRect = function (r1, r2) {\n\t\tvar ax1 = r1.x;\n\t\tvar ax2 = r1.x + r1.width;\n\t\tvar ay1 = r1.y;\n\t\tvar ay2 = r1.y + r1.height;\n\t\tvar bx1 = r2.x;\n\t\tvar bx2 = r2.x + r2.width;\n\t\tvar by1 = r2.y;\n\t\tvar by2 = r2.y + r2.height;\n\t\treturn ax1 < bx2 && ax2 > bx1 && ay1 < by2 && ay2 > by1;\n\t};\n\n\tvar debugCheck = function (bin, list) {\n\t\tif (!bin) { return;}\n\t\tvar iter = list.iterator();\n\t\tvar ok = true;\n\t\twhile (iter.hasNext() && ok) {\n\t\t\tvar next = iter.next();\n\t\t\tok = next == bin || !rectIntersectsRect(next, bin);\n\t\t\tif (!ok) {\n\t\t\t\tlogger.ERROR&&console.error(\"ERROR\",\".util.FragmentBuffer\",'rect overlaps');\n\t\t\t\tlogger.ERROR&&console.error(\"ERROR\",\".util.FragmentBuffer\",iter.current(), bin);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getPositionForText = function (description) {\n\t\tvar hash = this.onGetHash(description);\n\t\tvar width = Math.ceil(description.width) + 1;\n\n\t\tif (!this._cache[hash] && width > 0) {\n\t\t\tthis._cache[hash] = this._insertText(description, false);\n\t\t\tthis._decriptions.push(description);\n\t\t}\n\t\tif (debug && false) {\n\t\t\tdebugCheck(description, this._binList);\n\t\t}\n\t\treturn this._cache[hash];\n\t};\n\n\tthis.releaseBin = function (hash) {\n\t\tif (this._cache[hash]) {\n\t\t\t// When we support clearin buffers then this should be enabled again...\n\t\t\t// this._cache[hash].filled = false;\n\t\t\t// delete this._cache[hash];\n\t\t}\n\t};\n\n\tthis.clearBuffer = function () {\n\t\tthis._cache = {};\n\t\tthis._binList = new SortedList(sort);\n\t\tthis._binList.insert(new FragmentBin({\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: 1024,\n\t\t\theight: 1024\n\t\t}));\n\t\tthis._ctx && this._ctx.clearRect(0, 0, 1024, 1024);\n\t\twhile (this._decriptions.length) {\n\t\t\tthis._decriptions.pop().textView.updateCache();\n\t\t}\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/FragmentBin.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/FragmentBin.js","friendlyPath":".FragmentBin","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/","filename":"FragmentBin.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * TextBins are used in the FragmentBuffer caching of TextViews.\n **/\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBin=__class__;var FragmentBin = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBin(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_FragmentBin(){return this.init&&this.init.apply(this,arguments)},'TextBin', function (logger, supr) {\n\tthis.init = function (opts) {\n\t\tthis.width = opts.width;\n\t\tthis.height = opts.height;\n\t\tthis.x = opts.x;\n\t\tthis.y = opts.y;\n\t};\n\n\tthis.size = function () {\n\t\treturn this.width * this.height;\n\t};\n\n\tthis.split = function (x, y) {\n\t\tvar newBins = [this];\n\t\tif (this.width > 10 && this.height > 10) {\n\t\t\tif (this.height - y > 10) {\n\t\t\t\tvar bin1 = new FragmentBin({\n\t\t\t\t\tx: this.x,\n\t\t\t\t\ty: this.y + y,\n\t\t\t\t\twidth: this.width,\n\t\t\t\t\theight: this.height - y\n\t\t\t\t});\n\t\t\t\tnewBins.push(bin1);\n\t\t\t}\n\t\t\tif (this.width - x > 10) {\n\t\t\t\tvar bin2 = new FragmentBin({\n\t\t\t\t\tx: this.x + x,\n\t\t\t\t\ty: this.y,\n\t\t\t\t\twidth: this.width - x,\n\t\t\t\t\theight: y\n\t\t\t\t});\n\t\t\t\tnewBins.push(bin2);\n\t\t\t}\n\t\t}\n\t\tthis.width = x;\n\t\tthis.height = y;\n\t\tthis.filled = true;\n\n\t\treturn newBins;\n\t};\n});","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/SortedLinkedList.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/SortedLinkedList.js","friendlyPath":".SortedLinkedList","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/util/","filename":"SortedLinkedList.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nIterator=__class__;var Iterator=Iterator(function Iterator(){return this.init&&this.init.apply(this,arguments)},'Iterator', function (logger, supr) {\n\tthis.init = this.update = function (list) {\n\t\tthis._list = list || this._list;\n\t\tthis._current = list.head;\n\t\tthis._count = 0;\n\t};\n\n\tthis.next = function () {\n\t\tvar data = this._current.data;\n\t\tthis._current = this._current.next;\n\t\tthis._count++;\n\t\treturn data;\n\t};\n\n\tthis.current = function () {\n\t\treturn this._current.data;\n\t};\n\n\tthis.insertBefore = function (data) {\n\t\tthis._current.insertBefore(data);\t\n\t\tthis._list.count++;\n\t};\n\n\tthis.insertAfter = function (data) {\n\t\tthis._current.insertAfter(data);\t\n\t\tthis._list.count++;\n\t};\n\n\tthis.remove = function () {\n\t\tthis._current.prev.remove();\n\t\tif (this._current.prev == this._current) {\n\t\t\tthis._list.head = null;\n\t\t}\n\t\tthis._list.count--;\n\t};\n\n\tthis.hasNext = function () {\n\t\treturn this._count < this._list.count;\n\t};\n\n\tthis.atHead = function () {\n\t\treturn this._current == this._list.head;\n\t};\n});\n\nItem=__class__;var Item=Item(function Item(){return this.init&&this.init.apply(this,arguments)},'Item', function (logger, supr) {\n\tthis.init = function (data, prev, next) {\n\t\tthis.data = data;\n\t\tthis.prev = prev || this; \n\t\tthis.next = next || this;\n\t};\n\n\tthis.insertBefore = function (data) {\n\t\tvar item = new Item(data, this.prev, this);\n\t\tthis.prev.next = item;\n\t\tthis.prev = item;\n\t};\n\t\n\tthis.insertAfter = function (data) {\n\t\tvar item = new Item(data, this, this.next);\n\t\tthis.next.prev = item;\n\t\tthis.next = item;\n\t};\n\n\tthis.remove = function () {\n\t\tthis.prev.next = this.next;\n\t\tthis.next.prev = this.prev;\n\t};\n});\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_SortedLinkedList=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_SortedLinkedList(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_util_SortedLinkedList(){return this.init&&this.init.apply(this,arguments)},'SortedLinkedList', function (logger, supr) {\n\tthis.init = function (comparator) {\n\t\tthis.head = null;\n\t\tthis._comparator = comparator;\n\t\tthis.count = 0;\n\t};\n\n\tthis.append = function (data) {\n\t\tthis._head.insertAfter(data);\n\t\tthis.count++;\n\t};\n\n\tthis.insert = function (data) {\n\t\tif (!this.head) {\n\t\t\tthis.head = new Item(data);\n\t\t\tthis.count++;\n\t\t} else {\n\t\t\tvar i = this.iterator();\n\t\t\tvar d = i.current();\t\n\t\t\tvar found = false;\n\t\t\twhile (i.hasNext() && !found) {\n\t\t\t\tfound = !this._comparator(data, d);\n\t\t\t\tif (!found) {\n\t\t\t\t\ti.next();\t\n\t\t\t\t\td = i.current();\n\t\t\t\t}\n\t\t\t}\n\t\t\ti.insertBefore(data);\n\t\t\tif (found && i.atHead()) {\n\t\t\t\tthis.head = this.head.prev;\t\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.iterator = function () {\n\t\treturn new Iterator(this);\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/TextFlow.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/TextFlow.js","friendlyPath":".TextFlow","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"TextFlow.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import lib.Enum as Enum');\njsio('import lib.PubSub as PubSub');\n\nvar textFlowMode = Enum(\n\t\"NONE\",\n\t\"WRAP\",\n\t\"AUTOSIZE\",\n\t\"AUTOSIZE_WRAP\",\n\t\"AUTOFONTSIZE\",\n\t\"AUTOFONTSIZE_WRAP\",\n\t\"AUTOFONTSIZE_AUTOSIZE\",\n\t\"AUTOFONTSIZE_WRAP_AUTOSIZE\"\n);\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextFlow=__class__;var TextFlow = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextFlow(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_TextFlow(){return this.init&&this.init.apply(this,arguments)},PubSub, function (supr) {\n\tthis.init = function (opts) {\n\t\tsupr(this, \"init\", arguments);\n\n\t\tthis._target = opts.target;\n\t\tthis._lineWidth = 0;\n\t\tthis._line = [];\n\t\tthis._lines = [];\n\n\t\tthis._words = [];\n\n\t\tthis._maxWordWidth = 0;\n\t\tthis._maxWidth = 0;\n\t\tthis._maxHeight = 0;\n\n\t\tthis._heightFound = 0;\n\n\t\tthis._offsetRect = {x: 0, y: 0, width: 0, height: 0};\n\t};\n\n\tthis.measureText = function (ctx, text) {\n\t\tvar opts = this._opts;\n\n\t\tvar emoticonData = (text[0] == '(') && opts.emoticonData && opts.emoticonData.data[text];\n\t\tif (emoticonData) {\n\t\t\treturn opts.size;\n\t\t} else {\n\t\t\treturn ctx.measureText(text).width;\n\t\t}\n\t};\n\n\t// Split the text into a list containing the word and the width of the word...\n\tthis._lineSplit = function (ctx) {\n\t\tvar opts = this._opts;\n\t\tvar spaceWidth = opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n\t\tvar text = opts.text || \"\";\n\t\tvar words =\n\t\t\t\topts.wrapCharacter\n\t\t\t\t\t? text.replace(/\\t/g, \" \").match(/\\S[。，]?|[\\n]/g) || []\n\t\t\t\t\t: (opts.wrap || (opts.horizontalAlign === \"justify\"))\n\t\t\t\t\t\t? (text.replace(/\\t/g, \" \").match(/\\S+|[\\n]| +(?= )/g) || [])\n\t\t\t\t\t\t: text.split(\"\\n\");\n\n\t\tvar splitWords = [];\n\t\tfor (i in words) {\n\t\t\tvar word = words[i];\n\t\t\tvar eStart = -1;\n\t\t\tvar lastSplit = 0;\n\t\t\tfor (var index = 0; index < word.length; index++) {\n\t\t\t\tvar c = word[index];\n\t\t\t\tif (c == '(') {\n\t\t\t\t\teStart = index;\n\t\t\t\t} else if (c == ')') {\n\t\t\t\t\tif (eStart > -1) {\n\t\t\t\t\t\t(eStart - lastSplit > 0) && splitWords.push(word.substring(lastSplit, eStart));\n\t\t\t\t\t\tsplitWords.push(word.substring(eStart, index + 1));\n\t\t\t\t\t\tlastSplit = index + 1;\n\t\t\t\t\t\teStart = -1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (lastSplit < word.length) {\n\t\t\t\tsplitWords.push(word.substring(lastSplit));\n\t\t\t}\n\t\t}\n\t\twords = splitWords;\n\t\tvar currentWord = 0;\n\t\tvar wordCount = words.length;\n\n\t\tthis._line = [];\n\t\tthis._lineWidth = 0;\n\t\tthis._maxWordWidth = 0;\n\n\t\tvar availableWidth = this.getAvailableWidth();\n\t\tif ((opts.hardWrap || exports.hardWrap) && words.length && this.measureText(ctx, text) > availableWidth) {\n\t\t\twords = [];\n\n\t\t\tvar s = \"\";\n\t\t\tvar i = 0;\n\n\t\t\twhile (i < text.length) {\n\t\t\t\tvar c = text[i++];\n\t\t\t\tif (ctx.measureText(s + c).width >= availableWidth) {\n\t\t\t\t\twords.push(s);\n\t\t\t\t\ts = c;\n\t\t\t\t} else {\n\t\t\t\t\ts += c;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (s !== \"\") {\n\t\t\t\twords.push(s);\n\t\t\t}\n\t\t\twordCount = words.length;\n\t\t}\n\n\t\twhile (currentWord < wordCount) {\n\t\t\tvar word = {word: words[currentWord], width: this.measureText(ctx, words[currentWord]), line: 1};\n\t\t\tthis._line.push(word);\n\t\t\tthis._lineWidth += word.width + spaceWidth;\n\t\t\tthis._maxWordWidth = Math.max(this._maxWordWidth, word.width);\n\t\t\tcurrentWord++;\n\t\t}\n\t\tthis._lineWidth -= spaceWidth;\n\t};\n\n\tthis._measureWords = function (ctx) {\n\t\tvar spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n\t\tvar currentWord = 0;\n\t\tvar wordCount = this._line.length;\n\n\t\tthis._lineWidth = 0;\n\t\tthis._maxWordWidth = 0;\n\n\t\twhile (currentWord < wordCount) {\n\t\t\tvar word = this._line[currentWord];\n\t\t\tword.line = 1;\n\t\t\tword.width = this.measureText(ctx, word.word);\n\t\t\tthis._lineWidth += word.width + spaceWidth;\n\t\t\tthis._maxWordWidth = Math.max(this._maxWordWidth, word.width);\n\t\t\tcurrentWord++;\n\t\t}\n\t\tthis._lineWidth -= spaceWidth;\n\t};\n\n\t// Split the single line into multiple lines which fit into the available width...\n\tthis._wrap = function (ctx, width) {\n\t\tvar spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n\t\tvar currentWidth = 0;\n\t\tvar lines = [];\n\t\tvar line = [];\n\t\tvar s = \"\";\n\n\t\tthis._lines = lines;\n\t\tthis._maxWidth = 0;\n\n\t\tvar currentWord = 0;\n\t\tvar wordCount = this._line.length;\n\n\t\tif (this._opts.horizontalAlign === \"justify\") {\n\t\t\twhile (currentWord < wordCount) {\n\t\t\t\tvar word = this._line[currentWord++];\n\t\t\t\tcurrentWidth += word.width + spaceWidth;\n\t\t\t\tif (word.word === \"\\n\") {\n\t\t\t\t\tlines.push(line);\n\t\t\t\t\tline = [];\n\t\t\t\t\tcurrentWidth = 0;\n\t\t\t\t} else if (currentWidth > width) {\n\t\t\t\t\tline.length && lines.push(line);\n\t\t\t\t\tline = [word];\n\t\t\t\t\tcurrentWidth = word.width + spaceWidth;\n\t\t\t\t} else {\n\t\t\t\t\tline.push(word);\n\t\t\t\t}\n\t\t\t}\n\t\t\tline.length && lines.push(line);\n\t\t} else {\n\t\t\t// Note: this algorithm isn't 100% accurate because we are going\n\t\t\t// to use the cumulative width of the line (sum up widths of all\n\t\t\t// measured words plus space widths), which on some platforms will\n\t\t\t// actually be slightly longer than the actual line length.  Usually\n\t\t\t// we're only off by a few pixels, so it doesn't matter.  However,\n\t\t\t// if we remeasured each line after computing the full line length,\n\t\t\t// we'd end up with a shorter line than we expected, and if we then\n\t\t\t// resize our view to fit the width and try to wrap text again, we'd\n\t\t\t// find that the width of the line is now longer than the width of\n\t\t\t// the view, resulting in the line wrapping shorter than the previous\n\t\t\t// time (unnecessarily).  Additionally, this extra measure is\n\t\t\t// expensive, so we'll just use our rough approximation.\n\t\t\twhile (currentWord < wordCount) {\n\t\t\t\tvar word = this._line[currentWord++];\n\t\t\t\t// currentWidth = ctx.measureText(s).width;\n\t\t\t\tif (word.word === \"\\n\") {\n\t\t\t\t\t//lines.push([{word: s, width: currentWidth, line: lines.length}]);\n\t\t\t\t\t//s = \"\";\n\t\t\t\t\tlines.push(line);\n\t\t\t\t\tline = [];\n\t\t\t\t\tcurrentWidth = 0;\n\t\t\t\t} else {\n\t\t\t\t\tvar isLineEmpty = !line.length;\n\t\t\t\t\t//var isLineEmpty = !s.length;\n\t\t\t\t\tvar hasSpace = !isLineEmpty && !this._opts.wrapCharacter;\n\t\t\t\t\tvar offset = hasSpace ? spaceWidth : 0;\n\t\t\t\t\tif (currentWidth + word.width + offset > width) {\n\t\t\t\t\t\tvar wordWidth = word.width;\n\n\t\t\t\t\t\t// if word is longer than the entire line width\n\t\t\t\t\t\tif (wordWidth > width) {\n\t\t\t\t\t\t\tvar current = word.word;\n\n\t\t\t\t\t\t\t// split word into lines\n\t\t\t\t\t\t\tvar wordPiece = \"\";\n\t\t\t\t\t\t\tfor (var i = 0, n = current.length; i < n; ++i) {\n\t\t\t\t\t\t\t\tif ((isLineEmpty && !wordPiece) || this.measureText(ctx, wordPiece + current[i]) + offset + currentWidth <= width) {\n\t\t\t\t\t\t\t\t\twordPiece += current[i];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t\t\tvar line = s + (hasSpace ? \" \" : \"\") + wordPiece;\n\t\t\t\t\t\t\t\t\tcurrentWidth = ctx.measureText(line).width;\n\t\t\t\t\t\t\t\t\tlines.push([{word: line, width: currentWidth, line: lines.length}]);\n\t\t\t\t\t\t\t\t\t*/\n\t\t\t\t\t\t\t\t\tcurrentWidth = this.measureText(ctx, wordPiece);\n\t\t\t\t\t\t\t\t\tline.push({word: wordPiece, width: currentWidth, line: lines.length});\n\t\t\t\t\t\t\t\t\tlines.push(line);\n\t\t\t\t\t\t\t\t\tline = [];\n\t\t\t\t\t\t\t\t\tcurrentWidth = 0;\n\t\t\t\t\t\t\t\t\toffset = 0;\n\t\t\t\t\t\t\t\t\t//s = \"\";\n\t\t\t\t\t\t\t\t\tisLineEmpty = true;\n\t\t\t\t\t\t\t\t\thasSpace = false;\n\t\t\t\t\t\t\t\t\twordPiece = current[i];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (wordPiece) {\n\t\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t\tvar line = s + (hasSpace ? \" \" : \"\") + wordPiece;\n\t\t\t\t\t\t\t\tcurrentWidth = ctx.measureText(line).width;\n\t\t\t\t\t\t\t\tlines.push([{word: line, width: currentWidth, line: lines.length}]);\n\t\t\t\t\t\t\t\t*/\n\t\t\t\t\t\t\t\tcurrentWidth = this.measureText(ctx, wordPiece);\n\t\t\t\t\t\t\t\tline.push({word: wordPiece, width: currentWidth, line: lines.length});\n\t\t\t\t\t\t\t\t//lines.push(line);\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t//(!isLineEmpty) && lines.push([{word: s, width: currentWidth, line: lines.length}]);\n\t\t\t\t\t\t\t(!isLineEmpty) && lines.push(line);\n\t\t\t\t\t\t\t//s = word.word;\n\t\t\t\t\t\t\tline = [word];\n\t\t\t\t\t\t\tcurrentWidth = word.width;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tline.push(word);\n\t\t\t\t\t\t//s += (hasSpace ? \" \" : \"\") + word.word;\n\t\t\t\t\t\tcurrentWidth += word.width + offset;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//if (s !== \"\") {\n\t\t\tif (line.length > 0) {\n\t\t\t\t//lines.push([{word: s, width: currentWidth, line: lines.length}]);\n\t\t\t\tlines.push(line);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._getLineSize = function (lineCount) {\n\t\tvar opts = this._opts;\n\t\treturn ((lineCount <= 1) ? 1 : opts.lineHeight) * opts.size;\n\t};\n\n\t// Calculate the position of each word on the line...\n\tthis._wordFlow = function (ctx) {\n\t\tvar spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n\t\tvar lines = this._lines;\n\n\t\tthis._words = [];\n\n\t\tthis._maxWidth = 0;\n\t\tthis._maxHeight = 0;\n\n\t\tvar currentLine = 0;\n\t\tvar lineCount = lines.length;\n\t\tvar lineSize = this._getLineSize(lineCount);\n\t\tvar y = 0;\n\n\t\twhile (currentLine < lineCount) {\n\t\t\tvar line = lines[currentLine++];\n\t\t\tvar currentWord = 0;\n\t\t\tvar wordCount = line.length;\n\t\t\tvar x = 0;\n\n\t\t\twhile (currentWord < wordCount) {\n\t\t\t\tvar word = line[currentWord++];\n\n\t\t\t\tword.x = x;\n\t\t\t\tword.y = y;\n\t\t\t\tword.line = currentLine;\n\t\t\t\tthis._words.push(word);\n\n\t\t\t\tx += word.width + spaceWidth;\n\t\t\t}\n\n\t\t\ty += lineSize;\n\t\t\tx -= spaceWidth;\n\n\t\t\tthis._maxWidth = Math.max(this._maxWidth, x);\n\t\t\tthis._maxHeight = Math.max(this._maxHeight, y);\n\t\t}\n\t};\n\n\t// Check if the given width fits into the available size, if not the resize the font...\n\tthis._checkWidth = function (ctx, width) {\n\t\tif (this._opts.text === \"\") {\n\t\t\treturn false;\n\t\t}\n\t\tvar opts = this._opts;\n\n\t\tif (width > this.getAvailableWidth()) {\n\t\t\tvar size = (opts.size * this._target.style.width / width) | 0;\n\t\t\t(opts.size !== size) && this.publish(\"ChangeSize\", size, ctx);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tthis._checkHeight = function (ctx, loSize, hiSize, cb) {\n\t\tif (this._opts.text === \"\") {\n\t\t\treturn;\n\t\t}\n\t\tif (Math.abs(hiSize - loSize) < 2) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar pivot = Math.max((loSize + hiSize) >> 1, 1);\n\t\tthis.publish(\"ChangeSize\", pivot, ctx);\n\t\tcb();\n\t\tif (pivot === 1) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar opts = this._opts;\n\t\tvar lineSize = this._getLineSize(this._lines.length);\n\t\tif ((this._lines.length * lineSize > this.getAvailableHeight())) {\n\t\t\tthis._checkHeight(ctx, loSize, pivot, cb);\n\t\t} else {\n\t\t\tthis._heightFound = opts.size;\n\t\t\tthis._checkHeight(ctx, pivot, hiSize, cb);\n\t\t}\n\t};\n\n\tthis._horizontalAlign = function (ctx) {\n\t\tvar words = this._words;\n\t\tif (words.length) {\n\t\t\tvar spaceWidth = this._opts.wrapCharacter ? 0 : ctx.measureText(\" \").width;\n\t\t\tvar lastLineSpaceWidth = spaceWidth;\n\t\t\tvar lastLine = words[words.length - 1].line;\n\t\t\tvar paddingLeft = this.getPaddingLeft();\n\t\t\tvar div = {left: -1, center: 2, right: 1, justify: 3}[this._opts.horizontalAlign] || -1;\n\t\t\tvar availableWidth = this.getAvailableWidth();\n\n\t\t\tif (div === 3) {\n\t\t\t\tspaceWidth = 0;\n\t\t\t}\n\n\t\t\tvar endWordIndex = 0;\n\t\t\tvar wordCount = words.length;\n\t\t\t// for each line\n\t\t\twhile (endWordIndex < wordCount) {\n\n\t\t\t\t// compute length of line\n\t\t\t\tvar wordIndex = endWordIndex;\n\t\t\t\tvar line = words[endWordIndex].line;\n\t\t\t\tvar lineWidth = 0;\n\t\t\t\twhile ((endWordIndex < wordCount) && (line === words[endWordIndex].line)) {\n\t\t\t\t\tlineWidth += words[endWordIndex].width + spaceWidth;\n\t\t\t\t\tendWordIndex++;\n\t\t\t\t}\n\n\t\t\t\t// align words in line\n\t\t\t\tif (div === -1) { // left\n\t\t\t\t\twhile (wordIndex < endWordIndex) {\n\t\t\t\t\t\twords[wordIndex++].x += paddingLeft;\n\t\t\t\t\t}\n\t\t\t\t} else if (div === 3) { // justify\n\t\t\t\t\tvar wordSpacing = (line < lastLine ? (availableWidth - lineWidth) / (endWordIndex - wordIndex - 1) : lastLineSpaceWidth);\n\t\t\t\t\tvar x = paddingLeft;\n\t\t\t\t\twhile (wordIndex < endWordIndex) {\n\t\t\t\t\t\twords[wordIndex].x = x;\n\t\t\t\t\t\tx += words[wordIndex].width + wordSpacing;\n\t\t\t\t\t\twordIndex++;\n\t\t\t\t\t}\n\t\t\t\t} else { // center|right\n\t\t\t\t\tvar offset = (availableWidth - lineWidth + spaceWidth) / div + paddingLeft;\n\t\t\t\t\twhile (wordIndex < endWordIndex) {\n\t\t\t\t\t\twords[wordIndex++].x += offset;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._verticalAlign = function () {\n\t\tvar lineCount = this._lines.length;\n\t\tvar verticalAlign = this._opts.verticalAlign;\n\t\tvar words = this._words;\n\t\tvar availableHeight = this.getAvailableHeight();\n\t\tvar i = words.length;\n\t\tif (i) {\n\t\t\tvar offset;\n\t\t\tif (verticalAlign == 'top') {\n\t\t\t\toffset = this.getPaddingTop();\n\t\t\t} else {\n\t\t\t\tvar div = verticalAlign == 'middle' ? 2 : 1;\n\t\t\t\tvar lineSize = this._getLineSize(lineCount);\n\t\t\t\toffset = (availableHeight - lineCount * lineSize) / div + this.getPaddingTop();\n\t\t\t}\n\n\t\t\twhile (i) {\n\t\t\t\twords[--i].y += offset;\n\t\t\t}\n\n\t\t\tthis._offsetRect.y += offset;\n\t\t}\n\t};\n\n\tthis.reflow = function (ctx, mode) {\n\t\tvar opts = this._opts;\n\t\tvar availableWidth = this.getAvailableWidth();\n\t\tvar availableHeight = this.getAvailableHeight();\n\n\t\tthis._lineSplit(ctx);\n\n\t\tswitch (mode) {\n\t\t\tcase textFlowMode.NONE:\n\t\t\t\tthis._lines = [this._line];\n\t\t\t\tthis._wordFlow(ctx);\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.WRAP:\n\t\t\t\tthis._wrap(ctx, availableWidth);\n\t\t\t\tthis._wordFlow(ctx);\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.AUTOSIZE:\n\t\t\tcase textFlowMode.AUTOFONTSIZE_AUTOSIZE:\n\t\t\t\tthis._lines = [this._line];\n\t\t\t\tthis._wordFlow(ctx);\n\n\t\t\t\tif (this._opts.fitWidth || availableWidth < this._maxWidth) {\n\t\t\t\t\tthis.publish(\"ChangeWidth\", this._maxWidth + this.getHorizontalPadding());\n\t\t\t\t}\n\n\t\t\t\tif (this._opts.fitHeight || availableHeight < this._maxHeight) {\n\t\t\t\t\tthis.publish(\"ChangeHeight\", this._maxHeight + this.getVerticalPadding());\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.AUTOSIZE_WRAP:\n\t\t\t\tthis._wrap(ctx, availableWidth);\n\t\t\t\tthis._wordFlow(ctx);\n\n\t\t\t\tif (this._opts.fitWidth || availableWidth < this._maxWidth) {\n\t\t\t\t\tthis.publish(\"ChangeWidth\", this._maxWidth + this.getHorizontalPadding());\n\t\t\t\t}\n\n\t\t\t\tif (this._opts.fitHeight  || availableHeight < this._maxHeight) {\n\t\t\t\t\tthis.publish(\"ChangeHeight\", this._maxHeight + this.getVerticalPadding());\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.AUTOFONTSIZE:\n\t\t\t\tthis._checkWidth(ctx, this._lineWidth) && this._lineSplit(ctx);\n\t\t\t\tthis._lines = [this._line];\n\t\t\t\t// Don't use the lineHeight here because it's a single line\n\t\t\t\tif (opts.allowVerticalSizing && opts.size > availableHeight) {\n\t\t\t\t\tvar cb = bind(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tfunction () {\n\t\t\t\t\t\t\tthis._measureWords(ctx);\n\t\t\t\t\t\t\tthis._wordFlow(ctx);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tthis._checkHeight(ctx, 1, opts.size, cb);\n\t\t\t\t\tthis.publish(\"ChangeSize\", this._heightFound, ctx);\n\t\t\t\t\tcb();\n\t\t\t\t} else {\n\t\t\t\t\tthis._wordFlow(ctx);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.AUTOFONTSIZE_WRAP:\n\t\t\t\tthis._wrap(ctx, availableWidth);\n\t\t\t\tthis._wordFlow(ctx);\n\n\t\t\t\tvar lineCount = this._lines.length;\n\t\t\t\tvar lineSize = this._getLineSize(lineCount);\n\t\t\t\tif (opts.allowVerticalSizing && lineCount * lineSize > availableHeight) {\n\t\t\t\t\tvar cb = bind(\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tfunction () {\n\t\t\t\t\t\t\tthis._measureWords(ctx);\n\t\t\t\t\t\t\tthis._wrap(ctx, availableWidth);\n\t\t\t\t\t\t\tthis._wordFlow(ctx);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tthis._checkHeight(ctx, 1, opts.size, cb);\n\t\t\t\t\tthis.publish(\"ChangeSize\", this._heightFound, ctx);\n\t\t\t\t\tcb();\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase textFlowMode.AUTOFONTSIZE_WRAP_AUTOSIZE:\n\t\t\t\tthis._wrap(ctx, availableWidth);\n\t\t\t\tthis._wordFlow(ctx);\n\n\t\t\t\t(availableHeight < this._maxHeight) && this.publish(\"ChangeHeight\", this._maxHeight + this.getVerticalPadding());\n\t\t\t\tbreak;\n\t\t}\n\n\t\tvar words = this._words;\n\t\tvar lastWord = words[words.length - 1];\n\n\t\tif (words.length) {\n\t\t\tvar strokeWidth = this._target.getStrokeWidth();\n\t\t\tvar lineSize = Math.ceil(opts.size * opts.lineHeight + strokeWidth);\n\t\t\tthis._offsetRect.x = this.getPaddingLeft();\n\t\t\tthis._offsetRect.y = this.getPaddingTop();\n\t\t\tthis._offsetRect.width = availableWidth;\n\t\t\tthis._offsetRect.height = lastWord.line * lineSize;\n\n\t\t\tthis._horizontalAlign(ctx);\n\t\t\tthis._verticalAlign();\n\n\t\t\tif (lastWord.line === 1) {\n\t\t\t\tthis._offsetRect.x = words[0].x;\n\t\t\t\tthis._offsetRect.width = lastWord.x + lastWord.width - words[0].x;\n\t\t\t}\n\n\t\t\tthis._offsetRect.width += strokeWidth;\n\t\t}\n\t};\n\n\tthis.setOpts = function (opts) {\n\t\tthis._opts = opts;\n\t};\n\n\tthis.getWords = function () {\n\t\treturn this._words;\n\t};\n\n\tthis.getHorizontalPadding = function () {\n\t\tvar padding = this._target.style.padding;\n\n\t\treturn padding.left + padding.right;\n\t};\n\n\tthis.getPaddingLeft = function () {\n\t\treturn this._target.style.padding.left;\n\t};\n\n\tthis.getAvailableWidth = function () {\n\t\treturn this._target.style.width - this.getHorizontalPadding();\n\t};\n\n\tthis.getVerticalPadding = function () {\n\t\tvar padding = this._target.style.padding;\n\n\t\treturn padding.top + padding.bottom;\n\t};\n\n\tthis.getPaddingTop = function () {\n\t\treturn this._target.style.padding.top;\n\t};\n\n\tthis.getAvailableHeight = function () {\n\t\treturn this._target.style.height - this.getVerticalPadding();\n\t};\n\n\tthis.getOffsetRect = function () {\n\t\treturn this._offsetRect;\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/legacySettings.js":{"path":"modules/devkit-core/modules/timestep/src/ui/legacySettings.js","friendlyPath":"...legacySettings","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"legacySettings.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nexports = {\n\tdisableVerticalAutoSize: false,\n\ttextViewColor: false // use this.color in TextView if true\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ViewDebugger.js":{"path":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/ViewDebugger.js","friendlyPath":".backend.canvas.ViewDebugger","directory":"modules/devkit-core/modules/timestep/src/ui/backend/canvas/","filename":"ViewDebugger.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewDebugger=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewDebugger(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_backend_canvas_ViewDebugger(){return this.init&&this.init.apply(this,arguments)},function () {\n\t\n\tthis.init = function (target, opts) {\n\t\tthis._target = target;\n\t\tthis._opts = opts = merge(opts, {\n\t\t\ttrackClicks: false,\n\t\t\toutline: false,\n\t\t\tflash: false\n\t\t});\n\t\t\n\t\tthis.outline = opts.outline;\n\t\tthis.trackClicks = opts.trackClicks;\n\t\tthis.flash = opts.flash;\n\t\t\n\t\tthis._flashState = 0;\n\t\tthis._nextFlash = 0;\n\t}\n\t\n\tthis.preRender = function (ctx) {\n\t\tif (!this._time) { this._time = +new Date(); }\n\t\tvar prevTime = this._time;\n\t\tthis._time = +new Date();\n\t\tthis._dt = this._time - prevTime;\n\t\t\n\t\tvar s = this._target.style;\n\t\tif (this.outline) {\n\t\t\tctx.save();\n\t\t\tctx.globalAlpha = 0.2;\n\t\t\tctx.strokeStyle = 'black';\n\t\t\tctx.lineWidth = 1.0;\n\t\t\tctx.strokeRect(0, 0, s.width, s.height);\n\t\t\tctx.restore();\n\t\t}\n\t}\n\t\n\tthis.postRender = function (ctx) {\n\t\t\tvar s = this._target.style;\n\n\t\tvar t = this._target;\n\t\tif (this.trackClicks) {\n\t\t\tfor (var i = t._clicks.length - 1; i >= 0; --i) {\n\t\t\t\tvar c = t._clicks[i];\n\t\t\t\tctx.setFillStyle('rgba(0, 0, 0, ' + c.o + ')');\n\t\t\t\tc.o -= 0.4 * this._dt / 1000;\n\t\t\t\tif (c.o > 0) {\n\t\t\t\t\tctx.circle(c.x, c.y, 15);\n\t\t\t\t\tctx.fill();\n\t\t\t\t} else {\n\t\t\t\t\tt._clicks.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (this.flash) {\n\t\t\tswitch(this._flashState) {\n\t\t\t\tcase 0:\n\t\t\t\t\tctx.setFillStyle('rgba(0, 0, 0, 0.5)');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1:\n\t\t\t\t\tctx.setFillStyle('rgba(0, 0, 0, 0)');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tctx.setFillStyle('rgba(255, 255, 255, 0.5)');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\tctx.setFillStyle('rgba(0, 0, 0, 0)');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tvar now = +new Date();\n\t\t\tif (now > this._nextFlash) {\n\t\t\t\tthis._flashState = (this._flashState + 1) % 4;\n\t\t\t\tthis._nextFlash = now + 300;\n\t\t\t}\n\t\t\t\n\t\t\tctx.fillRect(0, 0, t.style.width, t.style.height);\n\t\t}\n\t}\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/InputPrompt.js":{"path":"modules/devkit-core/modules/timestep/src/ui/InputPrompt.js","friendlyPath":"ui.InputPrompt","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"InputPrompt.js","baseMod":"ui","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/modules/timestep/src/ui","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n /* globals NATIVE, DEBUG, jsio */\n\njsio('import device');\njsio('import .debug.deprecated as deprecated');\n\nvar inputDialog = device.get('inputDialog');\n\n/**\n * @class InputPrompt\n *\n * Shows a native dialog that prompts the user for input.  In the tealeaf\n * runtime, this will open a native Android and iOS prompt.  In the browser, we\n * create a pure-DOM alternative of a one or two button prompt view using the\n * <input> tag and HTML5 input types.\n *\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_InputPrompt=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_InputPrompt(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_InputPrompt(){return this.init&&this.init.apply(this,arguments)},function () {\n  /**\n   * @param {string} opts.title the prompt title\n   * @param {string} opts.value the value passed to the callbacks\n   * @param {function} opts.onChange called with value when value in prompt changes\n   * @param {function} opts.onSubmit called wtih value when prompt is submitted\n   * @param {function} opts.onCancel called with value when prompt is cancelled\n   * @param {string} [opts.okText='ok'] sets custom text for the ok button\n   * @param {string} [opts.cancelText='cancel'] sets custom text for the cancel button\n   * @param {boolean} [opts.autoShowKeyboard=true] opens the keyboard by default on mobile devices\n   * @param {boolean} [opts.isPassword=false] sets the input type to a password\n   * @param {string} [opts.keyboardType='Default'] sets the type of keyboard {@link keyboardTypes.rawTypes}\n   * @param {boolean} [opts.defaultBrowserStyles] use default browser styles\n   */\n  this.init = function (opts) {\n    opts = opts || {};\n\n    function get(prop, defaultValue) {\n      return opts[prop] !== undefined ? opts[prop] : defaultValue;\n    }\n\n    this._opts = merge({\n      title: get('title', ''),\n      value: get('value', ''),\n      okText: get('okText', 'ok'),\n      cancelText: get('cancelText', 'cancel'),\n      message: get('message', get('prompt', '')),\n      autoFocus: !!get('autoFocus', get('autoShowKeyboard', true)),\n      isPassword: !!get('isPassword', false),\n      keyboardType: get('keyboardType', 'default'),\n      defaultBrowserStyles: get('defaultBrowserStyles', true)\n    }, opts);\n\n    if (DEBUG) {\n      jsio(\"import .debug.types\").check('InputPrompt', {\n        'title': {value: this._opts.title, type: 'string', required: true},\n        'message (prompt)': {value: this._opts.message, type: 'string', required: true},\n        'ok text': {value: this._opts.okText, type: 'string', required: true},\n        'cancel text': {value: this._opts.cancelText, type: 'string', required: true},\n        'value': {value: this._opts.value, type: 'string', required: true},\n        'auto-show keyboard': {value: this._opts.autoShowKeyboard, type: 'boolean', require: true},\n        'is password field': {value: this._opts.isPassword, type: 'boolean', require: true},\n        'keyboard type': {value: this._opts.keyboardType, type: 'key', dictionary: exports.KeyboardTypes.htmlTypes, toLowerCase: true, require: true}\n      });\n    }\n  };\n\n  this.show = function () {\n    this._prompt = inputDialog.show(this, this._opts);\n  };\n\n  this.getValue = function () {\n    return this._opts.value;\n  };\n\n  this.setValue = function (value) {\n    this._opts.value = value;\n    return this;\n  };\n\n  this.setOkButton = function (value) {\n    this._opts.okText = value;\n    return this;\n  };\n\n  this.setCancelButton = function (value) {\n    this._opts.cancelText = value;\n    return this;\n  };\n\n  this.setKeyboardType = function (keyboardType) {\n    this._opts.keyboardType = keyboardType;\n    return this;\n  };\n\n  this.setMessage = function (message) {\n    this._opts.message = message;\n    return this;\n  };\n\n  deprecated.method(this, 'requestFocus', function () {\n    this.show();\n    return this;\n  });\n  deprecated.method(this, 'closeEditField');\n  deprecated.method(this, 'refresh');\n  deprecated.method(this, 'setHint');\n});\n\njsio('import .keyboardTypes as exports.KeyboardTypes');\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/debug/deprecated.js":{"path":"modules/devkit-core/modules/timestep/src/ui/debug/deprecated.js","friendlyPath":".debug.deprecated","directory":"modules/devkit-core/modules/timestep/src/ui/debug/","filename":"deprecated.js","src":"/* globals DEBUG */\n\nexports.method = function (prototype, method, func) {\n  if (DEBUG) {\n    prototype[method] = function () {\n      logger.ERROR&&console.error(\"ERROR\",\".debug.deprecated\",'@deprecated', method, prototype.constructor.name);\n      if (func) {\n        return func.apply(this, arguments);\n      }\n    };\n  } else {\n    prototype[method] = func || function () {};\n  }\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/debug/types.js":{"path":"modules/devkit-core/modules/timestep/src/ui/debug/types.js","friendlyPath":".debug.types","directory":"modules/devkit-core/modules/timestep/src/ui/debug/","filename":"types.js","src":"/* globals DEBUG */\n\n/*\n * opts:\n *  - value: value to check\n *  - allowNull: if true and required, value can be null, else nulls for\n *    required values are errors\n *  - required: if true, error if value is undefined/null (see allowNull)\n */\nif (DEBUG) {\n  var isNumber = function (val) { return typeof val == 'number' && !isNaN(val); };\n  var VALIDATORS = {\n    'string': function (val) { return typeof val == 'string'; },\n    'integer': function (val) { return isNumber(val) && Math.floor(val) == val; },\n    'number': isNumber,\n    'float': isNumber,\n    'array': Array.isArray,\n    'object': function (val) { return typeof val == 'object'; },\n    'key': function (key, opts) {\n      if (opts.toLowerCase) {\n        return (key.toLowerCase && key.toLowerCase()) in lowerCaseKeys(opts.dictionary);\n      } else {\n        return opts.dictionary && (key in opts.dictionary);\n      }\n    }\n  };\n\n  var ERRORS = {\n    'default': function (scope, name, opts) {\n      return scope + ' \"' + name + '\" should be a ' + opts.type;\n    },\n    'key': function (scope, name, opts) {\n      return scope + ' \"' + name + '\" should be a key from the set: '\n        + Object\n            .keys(opts.toLowerCase\n              ? lowerCaseKeys(opts.dictionary)\n              : opts.dictionary)\n            .join(', ');\n    }\n  };\n\n  var lowerCaseKeys = function (obj) {\n    var keys = {};\n    if (obj) {\n      for (var k in obj) {\n        keys[k.toLowerCase()] = true;\n      }\n    }\n    return keys;\n  };\n\n  var getError = function (scope, name, opts) {\n    var msg = (ERRORS[opts.type] || ERRORS['default'])(scope, name, opts);\n    return new TypeError(msg);\n  };\n\n  exports.check = function (scope, properties) {\n    if (DEBUG) {\n      Object.keys(properties).forEach(function (name) {\n        var opts = properties[name];\n        if (opts.required && opts.value === undefined || opts.value === null && !opts.allowNull) {\n          logger.ERROR&&console.error(\"ERROR\",\".debug.types\",new TypeError(scope + ' \"' + name + '\" required'));\n        } else if (opts.type in VALIDATORS) {\n          if (!VALIDATORS[opts.type](opts.value, opts)) {\n            logger.ERROR&&console.error(\"ERROR\",\".debug.types\",getError(scope, name, opts));\n          }\n        }\n      });\n    }\n  };\n} else {\n  // production, no checking\n  exports.check = function () {};\n}\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/init.js":{"path":"modules/devkit-core/modules/timestep/src/ui/init.js","friendlyPath":"ui.init","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"init.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import .View');\njsio('import .layout.BackingExtension');\njsio('import .Engine');","pre":true},"modules/devkit-core/modules/timestep/src/ui/layout/BackingExtension.js":{"path":"modules/devkit-core/modules/timestep/src/ui/layout/BackingExtension.js","friendlyPath":".layout.BackingExtension","directory":"modules/devkit-core/modules/timestep/src/ui/layout/","filename":"BackingExtension.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import ..View');\njsio('import ..backend.strPad as strPad');\njsio('import ..backend.BaseBacking');\njsio('import .BoxLayout');\njsio('import .LinearLayout');\njsio('import .Padding');\n\njsio('import util.setProperty');\n\nvar layoutProps = {\n\t\t'layout': {value: false, cb: '_onSetLayout'},\n\t\t'inLayout': {value: true, cb: '_onInLayout'},\n\t\t'order': {value: 0, cb: '_onOrder'},\n\t\t'direction': {value: 'vertical', cb: '_onLayoutChange'},\n\t\t'flex': {value: 0, cb: '_onLayoutChange'},\n\t\t'justifyContent': {value: 'start', cb: '_onLayoutChange'},\n\n\t\t'centerX': {value: false, cb: '_onLayoutChange'},\n\t\t'centerY': {value: false, cb: '_onLayoutChange'},\n\n\t\t'top': {value: undefined, cb: '_onLayoutChange'},\n\t\t'right': {value: undefined, cb: '_onLayoutChange'},\n\t\t'bottom': {value: undefined, cb: '_onLayoutChange'},\n\t\t'left': {value: undefined, cb: '_onLayoutChange'},\n\n\t\t'minWidth': {value: undefined, cb: '_onBoundsChange'},\n\t\t'minHeight': {value: undefined, cb: '_onBoundsChange'},\n\t\t'maxWidth': {value: undefined, cb: '_onBoundsChange'},\n\t\t'maxHeight': {value: undefined, cb: '_onBoundsChange'},\n\n\t\t'layoutWidth': {value: undefined, cb: '_onLayoutWidth'},\n\t\t'layoutHeight': {value: undefined, cb: '_onLayoutHeight'},\n\n\t\t'fixedAspectRatio': {value: false, cb: '_onFixedAspectRatio'},\n\t\t'aspectRatio': {value: null, cb: '_onLayoutChange'},\n\n\t\t'margin': {value: null, cb: '_onMarginChange'},\n\t\t'padding': {\n\t\t\tget: function () {\n\t\t\t\treturn this._padding || (this._padding = new Padding());\n\t\t\t},\n\t\t\tset: function (value) {\n\t\t\t\tif (this._padding) {\n\t\t\t\t\tthis._padding.update(value);\n\t\t\t\t} else {\n\t\t\t\t\tthis._padding = new Padding(value);\n\t\t\t\t}\n\n\t\t\t\tthis._onLayoutChange();\n\t\t\t}\n\t\t}\n\t};\n\nfor (var key in layoutProps) {\n\tbackend.BaseBacking.addProperty(key, layoutProps[key]);\n}\n\nView.addExtension({\n\textend: function (ViewBacking) {\n\n\t\tvar proto = ViewBacking.prototype;\n\n\t\tproto._sortOrder = strPad.initialValue;\n\t\tproto._onOrder = function (_, order) {\n\t\t\tthis._sortOrder = strPad.pad(order);\n\t\t\tthis._onLayoutChange();\n\t\t};\n\n\t\tproto._onMarginChange = function (key, value) {\n\t\t\tif (this._cachedMargin) {\n\t\t\t\tthis._cachedMargin.update(value);\n\t\t\t} else {\n\t\t\t\tthis._cachedMargin = new Padding(value);\n\t\t\t}\n\n\t\t\tthis.top = this._cachedMargin.top;\n\t\t\tthis.bottom = this._cachedMargin.bottom;\n\t\t\tthis.left = this._cachedMargin.left;\n\t\t\tthis.right = this._cachedMargin.right;\n\n\t\t\tthis._onLayoutChange();\n\t\t}\n\n\t\tproto._onFixedAspectRatio = function (key, value) {\n\t\t\tif (value) {\n\t\t\t\tthis.updateAspectRatio();\n\t\t\t}\n\t\t}\n\n\t\tproto.updateAspectRatio = function (width, height) {\n\t\t\tthis.aspectRatio = (width || this.width) / (height || this.height);\n\t\t}\n\n\t\tproto.enforceAspectRatio = function(iw, ih, isTimeout) {\n\t\t\tif (iw && ih) {\n\t\t\t\tthis.updateAspectRatio(iw, ih);\n\t\t\t}\n\t\t\tvar parent = this._view.getSuperview();\n\t\t\tvar opts = this._view._opts;\n\t\t\tiw = iw || opts.width;\n\t\t\tih = ih || opts.height;\n\t\t\tif (opts.width) {\n\t\t\t\tiw = opts.width;\n\t\t\t\tih = opts.width / this.aspectRatio;\n\t\t\t}\n\t\t\telse if (opts.height) {\n\t\t\t\tih = opts.height;\n\t\t\t\tiw = opts.height * this.aspectRatio;\n\t\t\t}\n\t\t\telse if (parent) {\n\t\t\t\tif (this.layoutWidth && parent.style.width) {\n\t\t\t\t\tiw = parent.style.width * parseFloat(this.layoutWidth) / 100;\n\t\t\t\t\tih = iw / this.aspectRatio;\n\t\t\t\t}\n\t\t\t\telse if (this.layoutHeight && parent.style.height) {\n\t\t\t\t\tih = parent.style.height * parseFloat(this.layoutHeight) / 100;\n\t\t\t\t\tiw = ih * this.aspectRatio;\n\t\t\t\t}\n\t\t\t\telse if (this.flex && parent.style.direction == 'horizontal' && this.width) {\n\t\t\t\t\tiw = this.width;\n\t\t\t\t\tih = iw / this.aspectRatio;\n\t\t\t\t}\n\t\t\t\telse if (this.flex && parent.style.direction == 'vertical' && this.height) {\n\t\t\t\t\tih = this.height;\n\t\t\t\t\tiw = ih * this.aspectRatio;\n\t\t\t\t}\n\t\t\t\telse if (!isTimeout) {\n\t\t\t\t\tsetTimeout(bind(this, 'enforceAspectRatio', iw, ih, true), 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.width = iw;\n\t\t\tthis.height = ih;\n\t\t};\n\n\t\tvar layouts = {\n\t\t\t'linear': LinearLayout,\n\t\t\t'box': BoxLayout\n\t\t};\n\n\t\tproto._onSetLayout = function (key, which) {\n\t\t\tvar view = this._view;\n\t\t\tvar LayoutCtor = layouts[which];\n\t\t\tif (LayoutCtor) {\n\t\t\t\tview.__layout = new LayoutCtor({view: view});\n\t\t\t\tthis.addResizeListeners();\n\t\t\t} else {\n\t\t\t\tthis._layout = false;\n\t\t\t}\n\t\t};\n\n\t\tproto.addResizeListeners = function () {\n\t\t\tif (!this._hasResizeListeners) {\n\t\t\t\tthis._hasResizeListeners = true;\n\t\t\t\tutil.setProperty(this, 'width', {cb: '_onWidth', value: this.width, configurable: true});\n\t\t\t\tutil.setProperty(this, 'height', {cb: '_onHeight', value: this.height, configurable: true});\n\t\t\t}\n\t\t}\n\n\t\tproto._onWidth = function(prop, value, prevValue) {\n\t\t\t// local properties are invalidated\n\t\t\t// this._cache = null;\n\n\t\t\tif (typeof this.maxWidth == 'number') {\n\t\t\t\tthis._width = Math.min(this.maxWidth, value || 0);\n\t\t\t}\n\n\t\t\tif (typeof this.minWidth == 'number') {\n\t\t\t\tthis._width = Math.max(this.minWidth, value || 0);\n\t\t\t}\n\n\t\t\tif (this._aspectRatio) {\n\t\t\t\tthis._height = this._width / this._aspectRatio;\n\t\t\t}\n\n\t\t\tthis._onLayoutChange();\n\t\t}\n\n\t\tproto._onHeight = function(prop, value, prevValue) {\n\t\t\t// local properties are invalidated\n\t\t\t// this._cache = null;\n\n\t\t\tif (typeof this.maxHeight == 'number') {\n\t\t\t\tthis._height = Math.min(this.maxHeight, value || 0);\n\t\t\t}\n\n\t\t\tif (typeof this.minHeight == 'number') {\n\t\t\t\tthis._height = Math.max(this.minHeight, value || 0);\n\t\t\t}\n\n\t\t\tif (this._aspectRatio) {\n\t\t\t\tthis._width = this._height * this._aspectRatio;\n\t\t\t}\n\n\t\t\tthis._onLayoutChange();\n\t\t}\n\n\t\tproto._onInLayout = function (key, value) {\n\t\t\tvar layout = this._superview && this._superview.__layout;\n\t\t\tif (layout) {\n\t\t\t\tif (value) {\n\t\t\t\t\tlayout.add(this._view);\n\t\t\t\t} else {\n\t\t\t\t\tlayout.remove(this._view);\n\t\t\t\t\tthis._view.needsReflow();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tproto._onLayoutWidth = function (key, value) {\n\t\t\tif (value.charAt(value.length - 1) == '%') {\n\t\t\t\tthis._layoutWidthValue = parseFloat(value) / 100;\n\t\t\t\tthis._layoutWidthIsPercent = true;\n\t\t\t} else {\n\t\t\t\tthis._layoutWidthValue = 0;\n\t\t\t\tthis._layoutWidthIsPercent = false;\n\t\t\t}\n\n\t\t\tthis._onLayoutChange();\n\t\t}\n\n\t\tproto._onLayoutHeight = function (key, value) {\n\t\t\tif (value.charAt(value.length - 1) == '%') {\n\t\t\t\tthis._layoutHeightValue = parseFloat(value) / 100;\n\t\t\t\tthis._layoutHeightIsPercent = true;\n\t\t\t} else {\n\t\t\t\tthis._layoutHeightValue = 0;\n\t\t\t\tthis._layoutHeightIsPercent = false;\n\t\t\t}\n\n\t\t\tthis._onLayoutChange();\n\t\t}\n\n\t\tproto._onBoundsChange = function () {\n\t\t\tthis.addResizeListeners();\n\t\t\tthis._onLayoutChange();\n\t\t}\n\n\t\t// trigger a reflow, optionally of the parent if the parent has layout too\n\t\tproto._onLayoutChange = function () {\n\t\t\tvar superview = this.getSuperview();\n\t\t\tif (superview && superview.__layout) {\n\t\t\t\tsuperview.needsReflow();\n\t\t\t}\n\n\t\t\tthis._view.needsReflow();\n\t\t}\n\t}\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/layout/BoxLayout.js":{"path":"modules/devkit-core/modules/timestep/src/ui/layout/BoxLayout.js","friendlyPath":".BoxLayout","directory":"modules/devkit-core/modules/timestep/src/ui/layout/","filename":"BoxLayout.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_layout_BoxLayout=__class__;var BoxLayout = exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_layout_BoxLayout(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_layout_BoxLayout(){return this.init&&this.init.apply(this,arguments)},function () {\n\n\tvar cls = this.constructor;\n\n\tthis.init = function (opts) {\n\t\tthis._view = opts.view;\n\n\t\tcls.listenSubviewResize(opts.view);\n\t}\n\n\tthis.reflow = function () {\n\t\tvar view = this._view;\n\t\tvar sv = view.getSuperview();\n\t\tvar style = view.style;\n\n\t\t// if wrapping content, listen for changes to subviews\n\t\tif (style._layoutWidth == 'wrapContent' || style._layoutHeight == 'wrapContent') {\n\t\t\tcls.addSubviewListener(view);\n\t\t}\n\n\t\tif (sv) {\n\t\t\tvar notInLayout = !style.inLayout || !style.flex || sv.style.layout != 'linear';\n\t\t\tif (notInLayout || !sv.__layout.isHorizontal()) {\n\t\t\t\tthis.reflowX();\n\t\t\t}\n\n\t\t\tif (notInLayout || !sv.__layout.isVertical()) {\n\t\t\t\tthis.reflowY();\n\t\t\t}\n\t\t}\n\t}\n\n\tcls.addSubviewListener = function (view) {\n\t\tif (!view.__hasSubviewListener) {\n\t\t\tview.__hasSubviewListener = true;\n\t\t\tview.subscribe('SubviewAdded', this, '_onSubviewAdded', view);\n\t\t\tview.subscribe('SubviewRemoved', this, '_onSubviewRemoved', view);\n\n\t\t\tvar subviews = view.getSubviews();\n\t\t\tfor (var i = 0, n = subviews.length; i < n; ++i) {\n\t\t\t\tthis._onSubviewAdded(view, subviews[i]);\n\t\t\t}\n\t\t}\n\t};\n\n\tcls.removeSubviewListener = function (view) {\n\t\tif (view.__hasSubviewListener) {\n\t\t\tview.__hasSubviewListener = false;\n\t\t\tview.unsubscribe('SubviewAdded', this, '_onSubviewAdded');\n\t\t\tview.unsubscribe('SubviewRemoved', this, '_onSubviewRemoved');\n\n\t\t\tvar subviews = view.getSubviews();\n\t\t\tfor (var i = 0, n = subviews.length; i < n; ++i) {\n\t\t\t\tthis._onSubviewRemoved(view, subviews[i]);\n\t\t\t}\n\t\t}\n\t};\n\n\tcls._onSubviewAdded = function (view, subview) {\n\t\tsubview.style.addResizeListeners();\n\t\tview.connectEvent(subview, 'resize', bind(view, 'needsReflow'));\n\t};\n\n\tcls._onSubviewRemoved = function (view, subview) {\n\t\tview.disconnectEvent(subview, 'resize');\n\t};\n\n\tcls.addResizeListener = function (view) {\n\t\tif (view.style.__removeSuperviewResize) {\n\t\t\tview.style.__removeSuperviewResize();\n\t\t}\n\n\t\t// reflow on parent view resize\n\t\tvar onResize = bind(view, 'needsReflow');\n\t\tvar superview = view.getSuperview();\n\t\tif (superview) {\n\t\t\tsuperview.on('resize', onResize);\n\t\t\t// store a closure to unsubscribe this event\n\t\t\tview.style.__removeSuperviewResize = bind(view.style, function () {\n\t\t\t\tthis.__removeSuperviewResize = null;\n\t\t\t\tsuperview && superview.removeListener('resize', onResize);\n\t\t\t});\n\t\t}\n\t}\n\n\tcls.listenSubviewResize = function (view) {\n\t\tif (view.__root) { this.addResizeListener(view); }\n\n\t\tview.on('ViewAdded', bind(this, 'addResizeListener', view));\n\t\tview.on('ViewRemoved', bind(view.style, function () {\n\t\t\tthis.__removeSuperviewResize && this.__removeSuperviewResize();\n\t\t}));\n\t}\n\n\tthis.reflowX = function (view) {\n\t\tvar view = this._view;\n\t\tvar s = view.style;\n\n\t\tvar sv = view.getSuperview();\n\t\tif (s.inLayout && sv.style.layout == 'linear') {\n\t\t\tvar inLinearLayout = sv.__layout.isHorizontal();\n\t\t\tvar padding = sv.style.padding;\n\t\t}\n\n\t\tvar svWidth = sv.style.width;\n\t\tvar availWidth = svWidth - (padding && padding.getHorizontal() || 0);\n\n\t\t// compute the width\n\t\tvar w;\n\t\tif (s._layoutWidth == 'wrapContent') {\n\t\t\t// find the maximal right edge\n\t\t\tw = this.getContentWidth() + s.padding.right;\n\t\t}\n\n\t\t// 1. we're not in a layout and both right and left are defined\n\t\telse if (!inLinearLayout && svWidth && s.right != undefined && s.left != undefined) {\n\t\t\tw = availWidth / s.scale - (s.left || 0) - (s.right || 0);\n\t\t}\n\n\t\t// 2. width is defined a percent\n\t\telse if (svWidth && s._layoutWidthIsPercent) {\n\t\t\tw = availWidth / s.scale * s._layoutWidthValue;\n\t\t}\n\n\t\t// 3. width is inherited from the superview\n\t\telse if (s.width == undefined && svWidth) {\n\t\t\tw = availWidth / s.scale;\n\t\t}\n\n\t\telse {\n\t\t\tw = s._width;\n\t\t}\n\n\t\t// Note that we don't trigger any resize handlers here\n\t\ts._width = w;\n\n\t\tif (!inLinearLayout && svWidth) {\n\t\t\tif (w !== undefined && s.centerX) { s.x = Math.round((availWidth - s.scale * w) / 2 + (padding && padding.left || 0)); }\n\t\t\tif (w !== undefined && s.left == undefined && s.right != undefined) { s.x = Math.round(availWidth - s.scale * w - s.right - (padding && padding.right || 0)); }\n\t\t\tif (s.left != undefined) { s.x = Math.round(s.left + (padding && padding.left || 0)); }\n\t\t}\n\t}\n\n\tthis.reflowY = function () {\n\t\tvar view = this._view;\n\t\tvar s = view.style;\n\t\tvar sv = view.getSuperview();\n\t\tif (s.inLayout && sv.style.layout == 'linear') {\n\t\t\tvar inLinearLayout = sv.__layout.isVertical();\n\t\t\tvar padding = sv.style.padding;\n\t\t}\n\n\t\tvar svHeight = sv.style.height;\n\t\tvar availHeight = svHeight - (padding && padding.getVertical() || 0);\n\n\t\tvar wrapContent = (s._layoutHeight == 'wrapContent');\n\n\t\t// compute the height\n\t\tvar h;\n\t\tif (wrapContent) {\n\t\t\th = this.getContentHeight() + s.padding.bottom;\n\t\t} else if (!inLinearLayout && svHeight && s.top != undefined && s.bottom != undefined) {\n\t\t\th = availHeight / s.scale - (s.top || 0) - (s.bottom || 0);\n\t\t} else if (svHeight && s._layoutHeightIsPercent) {\n\t\t\th = availHeight / s.scale * s._layoutHeightValue;\n\t\t} else if (s.height == undefined && svHeight) {\n\t\t\th = availHeight / s.scale;\n\t\t} else {\n\t\t\th = s.height;\n\t\t}\n\n\t\ts._height = h;\n\n\t\tif (!inLinearLayout && svHeight) {\n\t\t\tif (h !== undefined && s.centerY) { s.y = Math.round((availHeight - s.scale * h) / 2 + (padding && padding.top || 0)); }\n\t\t\tif (h !== undefined && s.top == undefined && s.bottom != undefined) { s.y = Math.round(availHeight - s.scale * h - s.bottom - (padding && padding.bottom || 0)); }\n\t\t\tif (s.top != undefined) { s.y = Math.round(s.top + (padding && padding.top || 0)); }\n\t\t}\n\t}\n\n\tthis.getContentWidth = function () {\n\t\t// find the maximal right edge\n\t\tvar w = 0;\n\t\tvar views = this._view.getSubviews();\n\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\tif (!v.style._layoutWidthIsPercent && v.style.visible) {\n\t\t\t\tvar right = v.style.x + v.style.width * v.style.scale + (v.style.right || 0);\n\t\t\t\tif (right > w) {\n\t\t\t\t\tw = right;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn w;\n\t}\n\n\tthis.getContentHeight = function () {\n\t\t// find the maximal bottom edge\n\t\tvar views = this._view.getSubviews();\n\t\tvar h = 0;\n\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\tif (!v.style._layoutHeightIsPercent && v.style.visible) {\n\t\t\t\tvar bottom = v.style.y + v.style.height * v.style.scale + (v.style.bottom || 0);\n\t\t\t\tif (bottom > h) {\n\t\t\t\t\th = bottom;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn h;\n\t}\n\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/layout/LinearLayout.js":{"path":"modules/devkit-core/modules/timestep/src/ui/layout/LinearLayout.js","friendlyPath":".LinearLayout","directory":"modules/devkit-core/modules/timestep/src/ui/layout/","filename":"LinearLayout.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * package ui.layout.LinearLayout;\n *\n * A class to direct the layout of its parent view, set through opts.parent.\n */\n\n/**\n * package ui.layout.LinearLayout;\n *\n * A class to direct the layout of its parent view, set through opts.parent.\n */\n\njsio('import ui.layout.Padding as Padding');\njsio('import ui.backend.strPad as strPad');\n\njsio('import .BoxLayout');\n\nvar DEBUG = false;\nif (DEBUG) {\n\tvar VIEW_STR = function (view) { return view + ' (' + view.uid + ')'; }\n\tvar _debug = {\n\t\t\tspace: '',\n\t\t\tstepIn: function () { this.space += ' '; return true; },\n\t\t\tstepOut: function () { this.space = this.space.slice(0, this.space.length - 1); return true; },\n\t\t\tlog: function () { logger.log.apply(logger, [this.space].concat(Array.prototype.slice.call(arguments, 0))); return true; }\n\t\t};\n}\n\n// TODO: native\n// TODO: Resize event on width/height change\n// TODO: reflow on subview visibility change\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_layout_LinearLayout=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_layout_LinearLayout(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_layout_LinearLayout(){return this.init&&this.init.apply(this,arguments)},BoxLayout, function (supr) {\n\n\tthis.init = function () {\n\t\tsupr(this, 'init', arguments);\n\n\t\tthis._view.subscribe('SubviewAdded', this, '_onSubviewAdded');\n\t\tthis._view.subscribe('SubviewRemoved', this, '_onSubviewRemoved');\n\n\t\tthis._views = [];\n\t\tvar subviews = this._view.getSubviews();\n\t\tfor (var i = 0, view; view = subviews[i]; ++i) {\n\t\t\tif (view.style.inLayout) {\n\t\t\t\tthis._views.push(this._initLayoutView(view));\n\t\t\t}\n\t\t}\n\n\t\tthis._forwardEvents();\n\n\t\tthis._debug = DEBUG;\n\t}\n\n\tthis._onSubviewRemoved = function (view) {\n\t\tif (view.style.inLayout) {\n\t\t\tthis.remove(view);\n\t\t}\n\t}\n\n\tthis._onSubviewAdded = function (view) {\n\t\tif (view.style.inLayout) {\n\t\t\tthis.add(view);\n\t\t}\n\t}\n\n\tthis.debug = function () { this._debug = true; return this; }\n\n\tthis._setDirection = function (direction) {\n\t\tthis._direction = direction;\n\n\t\tvar isVertical = this.isVertical();\n\t\tthis._propPos = isVertical ? 'y' : 'x';\n\t\tthis._propPosOpp = isVertical ? 'x' : 'y';\n\t\tthis._propDim = isVertical ? '_height' : '_width';\n\t\tthis._minPropDim = isVertical ? 'minHeight' : 'minWidth';\n\t\tthis._maxPropDim = isVertical ? 'maxHeight' : 'maxWidth';\n\t\tthis._layoutPropDim = isVertical ? 'layoutHeight' : 'layoutWidth';\n\t\tthis._propDimOpp = isVertical ? '_width' : '_height';\n\t\tthis._propSideA = isVertical ? 'top' : 'left';\n\t\tthis._propSideB = isVertical ? 'bottom' : 'right';\n\n\t\tthis._flexProp = isVertical ? 'vflex' : 'hflex';\n\t}\n\n\tthis.isVertical = function () { return this._direction == 'vertical'; }\n\tthis.isHorizontal = function () { return this._direction == 'horizontal'; }\n\n\t/**\n\t * Events to proxy to the parent view from this layout.\n\t */\n\tthis._events = ['ViewWillAppear', 'ViewDidAppear', 'ViewWillDisappear', 'ViewDidDisappear'];\n\n\tthis._forwardEvents = function() {\n\t\tfor (var i = 0, a; a = this._events[i]; ++i) {\n\t\t\tthis._view.subscribe(a, this, '_forwardSignal', a);\n\t\t}\n\t};\n\n\tthis._events = ['ViewWillAppear', 'ViewDidAppear', 'ViewWillDisappear', 'ViewDidDisappear'];\n\n\t/**\n\t * Emit events on the children. Variable arguments.\n\t */\n\n\tthis._forwardSignal = function () {\n\t\tfor (var i = 0, v; v = this._views[i]; ++i) {\n\t\t\tv.view.publish.apply(v.view, arguments);\n\t\t}\n\t};\n\n\t/**\n\t * Initialize a subview controlled by this layout.\n\t */\n\n\tthis._initLayoutView = function(view) {\n\t\tview.style.inLayout = true;\n\n\t\tthis._debug && _debug.log('view', this._view.uid, 'layout: adding view', view.uid, '(' + this._propDim, '=', view.style[this._propDim] + ')');\n\n\t\t// use connectEvent: prevents a memory leak\n\t\t// acts like subscribe, but disconnects the event when this._view\n\t\t// is not in the view hierarchy\n\t\tthis._view.connectEvent(view, 'Resize', bind(this, 'reflow'));\n\n\t\treturn {\n\t\t\tview: view,\n\t\t\tindex: 0,\n\t\t\ttoString: toStringSort\n\t\t};\n\t};\n\n\tfunction toStringSort () {\n\t\treturn this.view.style._sortOrder + this.index;\n\t}\n\n\t/**\n\t * Return the size of this element (in its cardinal direction).\n\t */\n\n\tthis.getSize = function () {\n\t\treturn this._size;\n\t};\n\n\t/**\n\t * Return the index of a subview.\n\t */\n\n\tthis.getViewIndex = function (view) {\n\t\tfor (var i = 0, d; d = this._views[i]; ++i) {\n\t\t\tif (d.view == view) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t};\n\n\t/**\n\t * Add an array of subviews to this element in batch (prevent reflow each\n\t * time).\n\t */\n\n\tthis.addSubviews = function (views) {\n\t\tthis._debug && _debug.log(this._view.uid, \"adding\", views.length, \"views\");\n\t\tif (isArray(views)) {\n\t\t\tfor (var i = 0, n = views.length; i < n; ++i) {\n\t\t\t\tvar view = views[i];\n\t\t\t\tif (view) {\n\t\t\t\t\tthis._views.push(this._initLayoutView(view));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._view.needsReflow();\n\t\t} else {\n\t\t\tthis.insertBefore(views);\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Return the list of subviews controlled by this layout.\n\t */\n\n\tthis.getSubviews = function () {\n\t\treturn this._views.map(function (v) { return v.view; });\n\t};\n\n\t/**\n\t * Remove a subview controlled by this layout.\n\t */\n\n\tthis.remove = function (view) {\n\t\tvar i = this.getViewIndex(view);\n\t\tif (i != -1) {\n\t\t\tthis._views.splice(i, 1);\n\t\t\tthis._view.disconnectEvent(view, 'Resize');\n\t\t\tthis._view.needsReflow();\n\t\t\treturn;\n\t\t}\n\t}\n\n\t/**\n\t * Insert a subview before another subview in this hierarchy.\n\t */\n\n\tthis.add =\n\tthis.insertBefore = function (view, before) {\n\n\t\tif (this.getViewIndex(view) != -1) { return; }\n\n\t\tvar item = this._initLayoutView(view);\n\t\tvar added = false;\n\t\tif (before) {\n\t\t\tvar i = this.getViewIndex(before);\n\t\t\tif (i != -1) {\n\t\t\t\tthis._views.splice(i, 0, item);\n\t\t\t\tadded = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!added) {\n\t\t\tthis._views.push(item);\n\t\t}\n\n\t\tthis._view.needsReflow();\n\t}\n\n\t/**\n\t * Insert a subview after another subview in this hierarchy.\n\t */\n\n\tthis.insertAfter = function (view, after) {\n\n\t\tif (this.getViewIndex(view) != -1) { return; }\n\n\t\tvar item = this._initLayoutView(view);\n\t\tvar added = false;\n\t\tif (after) {\n\t\t\tvar i = this.getViewIndex(after);\n\t\t\tif (i != -1) {\n\t\t\t\tthis._views.splice(i + 1, 0, item);\n\t\t\t\tadded = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!added) {\n\t\t\tthis._views.unshift(item);\n\t\t}\n\n\t\tthis._view.needsReflow();\n\t}\n\n\t/**\n\t * Reflow logic.\n\t */\n\n\tthis.reflow = function () {\n\t\tsupr(this, 'reflow', arguments);\n\n\t\t// Get the position of each view in the subview array. This index\n\t\t// will be used as the secondary sorting key.\n\t\tvar children = this._view.getSubviews();\n\t\tvar indexMap = {};\n\t\tfor (var i = 0, v; v = children[i]; ++i) {\n\t\t\tindexMap[v.uid] = strPad.pad(i);\n\t\t}\n\n\t\t// style.order is first, then default to the views position in the\n\t\t// subview array.\n\t\tvar n = 0;\n\t\tfor (var i = 0, v; v = this._views[i]; ++i) {\n\t\t\tif (v.view.style.visible) {\n\t\t\t\tv.index = indexMap[v.view.uid];\n\n\t\t\t\t++n;\n\t\t\t}\n\t\t}\n\n\t\tif (!n) { return; }\n\n\t\tthis._views.sort();\n\n\t\tvar layoutStyle = this._view.style;\n\t\tif (layoutStyle.direction != this._direction) {\n\t\t\tthis._setDirection(layoutStyle.direction);\n\t\t}\n\n\t\tvar scale = this._view.getPosition().scale;\n\n\t\tvar isVertical = this._direction == 'vertical';\n\t\tvar propDim = this._propDim;\n\t\tvar propDimOpp = this._propDimOpp;\n\t\tvar minPropDim = this._minPropDim;\n\t\tvar propA = this._propSideA;\n\t\tvar propB = this._propSideB;\n\t\tvar padding = layoutStyle.padding;\n\t\tvar paddingSum = padding && (isVertical ? padding.getVertical() : padding.getHorizontal()) || 0;\n\t\tvar parentDim = layoutStyle[propDim];\n\t\tvar views = this._views;\n\n\t\tthis._debug && _debug.log(VIEW_STR(this._view) + ': layout', this._direction + ',', views.length, 'subview(s):') && _debug.stepIn() && this._summarize();\n\n\t\t// compute the total size of the fixed views and count\n\t\t// how many dynamically sized views we have\n\t\tvar viewSizeSum = 0;\n\t\tvar flexSum = 0;\n\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\tvar s = v.view.style;\n\t\t\tif (!s.visible) { continue; }\n\t\t\tv.view.reflowSync();\n\n\t\t\tv.margins = (s[propA] || 0) + (s[propB] || 0);\n\n\t\t\tif (s.flex) {\n\t\t\t\tflexSum += s.flex;\n\t\t\t\tv.baseSize = (s[minPropDim] || 0) * s.scale + v.margins;\n\t\t\t\tviewSizeSum += v.baseSize;\n\t\t\t} else {\n\t\t\t\tviewSizeSum += (s[propDim] || 0) * s.scale + v.margins;\n\t\t\t}\n\t\t}\n\n\t\tif (flexSum && parentDim == undefined) { return; }\n\n\t\t// compute available space\n\t\tvar availableSpace = parentDim - paddingSum;\n\t\tif (availableSpace < 0) { return; }\n\n\t\t// if there's a flex subview, the total size is the availableSpace\n\t\t// otherwise the totalSize is the sum of the subview sizes\n\t\tvar justifyContent = layoutStyle.justifyContent;\n\t\tvar totalSize = flexSum ? parentDim : viewSizeSum + paddingSum;\n\t\tvar flexSize = availableSpace - viewSizeSum;\n\n\t\t// compute the space for each flexible view\n\t\tvar flexUsed = 0;\n\t\tvar balance = 0;\n\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\tvar s = v.view.style;\n\t\t\tif (!s.visible) { continue; }\n\n\t\t\tif (s.flex) {\n\t\t\t\t// compute the ideal space for the flex view\n\t\t\t\tvar idealSpace = v.baseSize + flexSize * (s.flex / flexSum) / s.scale + balance;\n\n\t\t\t\t// round to the nearest screen pixel (take into account the global scale of the layout view)\n\t\t\t\tvar roundedSpace = Math.round(idealSpace * scale) / scale;\n\n\t\t\t\t// propogate the balance into the next view space computation\n\t\t\t\tbalance = idealSpace - roundedSpace;\n\n\t\t\t\t// store the actual space for the view, which is the computed space minus the margins\n\t\t\t\tv.dim = roundedSpace - v.margins;\n\n\t\t\t\t// account for maximal bound\n\t\t\t\tif (v.dim > s[this._maxPropDim]) {\n\t\t\t\t\tv.dim = s[this._maxPropDim];\n\t\t\t\t}\n\n\t\t\t\t// keep track of used flex space\n\t\t\t\tflexUsed += roundedSpace;\n\t\t\t}\n\t\t}\n\n\t\tvar flexRemaining = flexSize - flexUsed;\n\n\t\t// set the position of the views\n\t\tvar pos = padding && padding[propA] || 0;\n\t\tvar gap = 0;\n\t\tif (flexRemaining > 0) {\n\t\t\t// there's unused space, so justify our views\n\t\t\tswitch (justifyContent) {\n\t\t\t\tcase 'end':\n\t\t\t\t\tpos += flexRemaining;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'center':\n\t\t\t\t\tpos += flexRemaining / 2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'space':\n\t\t\t\t\tgap = flexRemaining / (n - 1) || 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'space-outside':\n\t\t\t\t\tgap = flexRemaining / (n + 1) || 0;\n\t\t\t\t\tpos += gap;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'start':\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// position and size views!\n\t\tvar propPos = this._propPos;\n\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\tpos = ((pos * scale) | 0) / scale;\n\t\t\tvar s = v.view.style;\n\t\t\tif (!s.visible) { continue; }\n\n\t\t\t// set position\n\t\t\ts[propPos] = pos + (s[propA] || 0);\n\n\t\t\tthis._debug && _debug.log('->', VIEW_STR(v.view), propPos, '=', s[propPos]);\n\n\t\t\tif (s.flex) {\n\t\t\t\t// set width\n\t\t\t\ts[propDim] = v.dim;\n\n\t\t\t\tthis._debug && _debug.log('->', VIEW_STR(v.view), propDim, '=', s[propDim]);\n\t\t\t}\n\n\t\t\t// advance position\n\t\t\tpos += gap + (s[propDim] || 0) * s.scale + v.margins;\n\t\t}\n\n\t\tthis._debug && this._summarize() && _debug.stepOut();\n\n\t\tif (isVertical && layoutStyle.layoutHeight == 'wrapContent') {\n\t\t\tthis.reflowY();\n\t\t} else if (!isVertical && layoutStyle.layoutWidth == 'wrapContent') {\n\t\t\tthis.reflowX();\n\t\t}\n\n\t\tif (this._size != totalSize) {\n\t\t\tthis._size = totalSize;\n\t\t\t// this._view.publish('LayoutResize', totalSize);\n\t\t}\n\t};\n\n\tthis._summarize = function () {\n\t\tvar views = this._views;\n\t\tfor (var i = 0, v; v = views[i]; ++i) {\n\t\t\tvar s = v.view.style;\n\t\t\t_debug.log('*', VIEW_STR(v.view) + ': ' + (!s.visible ? 'invisible' : ''), s.x + ',' + s.y + '-' + s.width + 'x' + s.height + ' (flex=' + (s.flex || 0) + ')');\n\t\t}\n\n\t\treturn true;\n\t}\n});\n\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/layout/Padding.js":{"path":"modules/devkit-core/modules/timestep/src/ui/layout/Padding.js","friendlyPath":"ui.layout.Padding","directory":"modules/devkit-core/modules/timestep/src/ui/layout/","filename":"Padding.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @package ui.layout.Padding;\n *\n * A simple class to express padding views.\n */\n\nPadding=__class__;exports = Padding=Padding(function Padding(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis.init =\n\tthis.update = function (args) {\n\t\tif (args instanceof Padding) {\n\t\t\tthis.top = args.top;\n\t\t\tthis.right = args.right;\n\t\t\tthis.bottom = args.bottom;\n\t\t\tthis.left = args.left;\n\t\t\treturn;\n\t\t}\n\t\tif (typeof args == 'string') {\n\t\t\targs = args.split(/\\s+/).map(function (piece) { return parseFloat(piece); });\n\t\t}\n\n\t\tif (!args || !args.length) { args = [args || 0]; }\n\n\t\tswitch (args.length) {\n\t\t\tcase 1:\n\t\t\t\tthis.left = this.right = this.top = this.bottom = args[0];\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tthis.top = this.bottom = args[0];\n\t\t\t\tthis.left = this.right = args[1];\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.top = args[0];\n\t\t\t\tthis.left = this.right = args[1];\n\t\t\t\tthis.bottom = args[2];\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tthis.top = args[0];\n\t\t\t\tthis.right = args[1];\n\t\t\t\tthis.bottom = args[2];\n\t\t\t\tthis.left = args[3];\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tthis.getVertical = function () { return this.top + this.bottom; }\n\tthis.getHorizontal = function () { return this.left + this.right; }\n\n\tthis.toString = function () { return [this.top, this.right, this.bottom, this.left].join(' '); }\n});","pre":true},"modules/devkit-core/node_modules/jsio/packages/std/JSON.js":{"path":"modules/devkit-core/node_modules/jsio/packages/std/JSON.js","friendlyPath":"std.JSON","directory":"modules/devkit-core/node_modules/jsio/packages/std/","filename":"JSON.js","src":"// Based on json2.js (version 2009-09-29) http://www.JSON.org/json2.js\n// exports createGlobal, stringify, parse, stringifyDate\n\n/**\n * if a global JSON object doesn't exist, create one\n */\nexports.createGlobal = function() {\n\tif(typeof JSON == 'undefined') { JSON = {}; }\n\tif(typeof JSON.stringify !== 'function') {\n\t\tJSON.stringify = exports.stringify;\n\t}\n\tif(typeof JSON.parse !== 'function') {\n\t\tJSON.parse = exports.parse;\n\t}\n};\n\n;(function() {\n\tvar cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n\t\tescapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n\t\tgap,\n\t\tindent,\n\t\tmeta = {\t// table of character substitutions\n\t\t\t'\\b': '\\\\b',\n\t\t\t'\\t': '\\\\t',\n\t\t\t'\\n': '\\\\n',\n\t\t\t'\\f': '\\\\f',\n\t\t\t'\\r': '\\\\r',\n\t\t\t'\"' : '\\\\\"',\n\t\t\t'\\\\': '\\\\\\\\'\n\t\t},\n\t\trep;\n\t\n\tfunction quote(string) {\n\t\t// quote the string if it doesn't contain control characters, quote characters, and backslash characters\n\t\t// otherwise, replace those characters with safe escape sequences\n\t\tescapable.lastIndex = 0;\n\t\treturn escapable.test(string)\n\t\t\t? '\"' + string.replace(escapable, function (a) {\n\t\t\t\t\tvar c = meta[a];\n\t\t\t\t\treturn typeof c === 'string' ? c : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n\t\t\t\t}) + '\"'\n\t\t\t: '\"' + string + '\"';\n\t}\n\t\n\t// Produce a string from holder[key].\n\tfunction str(key, holder) {\n\t\tvar mind = gap, value = holder[key];\n\t\t\n\t\t// If the value has a toJSON method, call it to obtain a replacement value.\n\t\tif (value && typeof value === 'object' && typeof value.toJSON === 'function') {\n\t\t\tvalue = value.toJSON(key);\n\t\t}\n\t\t\n\t\t// If we were called with a replacer function, then call the replacer to\n\t\t// obtain a replacement value.\n\t\tif (typeof rep === 'function') { value = rep.call(holder, key, value); }\n\t\t\n\t\tswitch (typeof value) {\n\t\t\tcase 'string':\n\t\t\t\treturn quote(value);\n\t\t\tcase 'number':\n\t\t\t\t// JSON numbers must be finite\n\t\t\t\treturn isFinite(value) ? String(value) : 'null';\n\t\t\tcase 'boolean':\n\t\t\t\treturn String(value);\n\t\t\tcase 'object': // object, array, date, null\n\t\t\t\tif (value === null) { return 'null'; } // typeof null == 'object'\n\t\t\t\tif (value.constructor === Date) { return exports.stringifyDate(value); }\n\t\t\t\n\t\t\t\tgap += indent;\n\t\t\t\tvar partial = [];\n\t\t\t\t\n\t\t\t\t// Is the value an array?\n\t\t\t\tif (value.constructor === Array) {\n\t\t\t\t\tvar length = value.length;\n\t\t\t\t\tfor (var i = 0; i < length; i += 1) {\n\t\t\t\t\t\tpartial[i] = str(i, value) || 'null';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Join all of the elements together, separated with commas, and wrap them in brackets.\n\t\t\t\t\tvar v = partial.length === 0 ? '[]' :\n\t\t\t\t\t\tgap ? '[\\n' + gap +\n\t\t\t\t\t\t\t\tpartial.join(',\\n' + gap) + '\\n' +\n\t\t\t\t\t\t\t\t\tmind + ']' :\n\t\t\t\t\t\t\t  '[' + partial.join(',') + ']';\n\t\t\t\t\tgap = mind;\n\t\t\t\t\treturn v;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (rep && typeof rep === 'object') { // rep is an array\n\t\t\t\t\tvar length = rep.length;\n\t\t\t\t\tfor (var i = 0; i < length; i += 1) {\n\t\t\t\t\t\tvar k = rep[i];\n\t\t\t\t\t\tif (typeof k === 'string') {\n\t\t\t\t\t\t\tvar v = str(k, value);\n\t\t\t\t\t\t\tif (v) {\n\t\t\t\t\t\t\t\tpartial.push(quote(k) + (gap ? ': ' : ':') + v);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else { // iterate through all of the keys in the object.\n\t\t\t\t\tfor (var k in value) {\n\t\t\t\t\t\tif (Object.hasOwnProperty.call(value, k)) {\n\t\t\t\t\t\t\tvar v = str(k, value);\n\t\t\t\t\t\t\tif (v) {\n\t\t\t\t\t\t\t\tpartial.push(quote(k) + (gap ? ': ' : ':') + v);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Join all of the member texts together, separated with commas,\n\t\t\t\t// and wrap them in braces.\n\t\t\t\tvar v = partial.length === 0 ? '{}' :\n\t\t\t\t\tgap ? '{\\n' + gap + partial.join(',\\n' + gap) + '\\n' +\n\t\t\t\t\t\t\tmind + '}' : '{' + partial.join(',') + '}';\n\t\t\t\tgap = mind;\n\t\t\t\treturn v;\n\t\t}\n\t}\n\n\n\t/**\n\t * The stringify method takes a value and an optional replacer, and an optional\n\t * space parameter, and returns a JSON text. The replacer can be a function\n\t * that can replace values, or an array of strings that will select the keys.\n \t * A default replacer method can be provided. Use of the space parameter can\n\t * produce text that is more easily readable.\n\t */\n\texports.stringify = function (value, replacer, space) {\n\t\tgap = '';\n\t\tindent = '';\n\t\t\n\t\t// If the space parameter is a number, make an indent string containing that many spaces.\n\t\tif (typeof space === 'number') {\n\t\t\tfor (var i = 0; i < space; i += 1) {\n\t\t\t\tindent += ' ';\n\t\t\t}\n\t\t} else if (typeof space === 'string') {\n\t\t\tindent = space;\n\t\t}\n\t\t\n\t\t// If there is a replacer, it must be a function or an array.\n\t\trep = replacer;\n\t\tif (replacer && typeof replacer !== 'function' &&\n\t\t\t\t(typeof replacer !== 'object' ||\n\t\t\t\t typeof replacer.length !== 'number')) {\n\t\t\tthrow new Error('JSON stringify: invalid replacer');\n\t\t}\n\t\t\n\t\t// Make a fake root object containing our value under the key of ''.\n\t\t// Return the result of stringifying the value.\n\t\treturn str('', {'': value});\n\t};\n\t\n\texports.stringifyDate = function(d) {\n\t\tvar year = d.getUTCFullYear(),\n\t\t\tmonth = d.getUTCMonth() + 1,\n\t\t\tday = d.getUTCDate(),\n\t\t\thours = d.getUTCHours(),\n\t\t\tminutes = d.getUTCMinutes(),\n\t\t\tseconds = d.getUTCSeconds(),\n\t\t\tms = d.getUTCMilliseconds();\n\t\t\n\t\tif (month < 10) { month = '0' + month; }\n\t\tif (day < 10) { day = '0' + day; }\n\t\tif (hours < 10) { hours = '0' + hours; }\n\t\tif (minutes < 10) { minutes = '0' + minutes; }\n\t\tif (seconds < 10) { seconds = '0' + seconds; }\n\t\tif (ms < 10) { ms = '00' + ms; }\n\t\telse if (ms < 100) { ms = '0' + ms; }\n\n\t\treturn '\"' + year\n\t\t\t+ '-' + month\n\t\t\t+ '-' + day\n\t\t\t+ 'T' + hours\n\t\t\t+ ':' + minutes\n\t\t\t+ ':' + seconds\n\t\t\t+ '.' + ms\n\t\t\t+ 'Z\"';\n\t}\n\t\n\t/**\n\t * The parse method takes a text and an optional reviver function, and returns\n\t * a JavaScript value if the text is a valid JSON text.\n\t */\n\texports.parse = function (text, reviver) {\n\t\t// Parsing happens in four stages. In the first stage, we replace certain\n\t\t// Unicode characters with escape sequences. JavaScript handles many characters\n\t\t// incorrectly, either silently deleting them, or treating them as line endings.\n\t\tcx.lastIndex = 0;\n\t\tif (cx.test(text)) {\n\t\t\ttext = text.replace(cx, function (a) {\n\t\t\t\treturn '\\\\u' +\n\t\t\t\t\t('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n\t\t\t});\n\t\t}\n\t\t\n\t\t// In the second stage, we run the text against regular expressions that look\n\t\t// for non-JSON patterns. We are especially concerned with '()' and 'new'\n\t\t// because they can cause invocation, and '=' because it can cause mutation.\n\t\t// But just to be safe, we want to reject all unexpected forms.\n\n\t\t// We split the second stage into 4 regexp operations in order to work around\n\t\t// crippling inefficiencies in IE's and Safari's regexp engines. First we\n\t\t// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n\t\t// replace all simple value tokens with ']' characters. Third, we delete all\n\t\t// open brackets that follow a colon or comma or that begin the text. Finally,\n\t\t// we look to see that the remaining characters are only whitespace or ']' or\n\t\t// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n\n\t\tif (/^[\\],:{}\\s]*$/\n\t\t\t\t.test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n\t\t\t\t.replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n\t\t\t\t.replace(/(?:^|:|,)(?:\\s*\\[)+/g, '')))\n\t\t{\n\t\t\tvar j = eval('(' + text + ')');\n\t\t\tif(!reviver) {\n\t\t\t\treturn j;\n\t\t\t} else {\n\t\t\t\t// In the optional fourth stage, we recursively walk the new structure, passing\n\t\t\t\t// each name/value pair to a reviver function for possible transformation.\n\t\t\t\tvar walk = function(holder, key) {\n\t\t\t\t\t// The walk method is used to recursively walk the resulting structure so\n\t\t\t\t\t// that modifications can be made.\n\t\t\t\t\tvar k, v, value = holder[key];\n\t\t\t\t\tif (value && typeof value === 'object') {\n\t\t\t\t\t\tfor (k in value) {\n\t\t\t\t\t\t\tif (Object.hasOwnProperty.call(value, k)) {\n\t\t\t\t\t\t\t\tv = walk(value, k);\n\t\t\t\t\t\t\t\tif (v !== undefined) {\n\t\t\t\t\t\t\t\t\tvalue[k] = v;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tdelete value[k];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn reviver.call(holder, key, value);\n\t\t\t\t}\n\t\t\t\treturn walk({'': j}, '');\n\t\t\t}\n\t\t}\n\n\t\t// If the text is not JSON parseable, then a SyntaxError is thrown.\n\t\tthrow new SyntaxError('JSON.parse');\n\t};\n}());","pre":true},"modules/devkit-core/src/clientapi/browser/cache.js":{"path":"modules/devkit-core/src/clientapi/browser/cache.js","friendlyPath":".cache","directory":"modules/devkit-core/src/clientapi/browser/","filename":"cache.js","src":"jsio('import device');\n\nvar _cacheWorker;\n\nfunction init() {\n  return navigator.serviceWorker.register('cache-worker.js', {scope: 'cache-worker.js'})\n    .then(function(reg) {\n\n      // try to grab the just-registered worker to send it the cache message\n      _cacheWorker = reg.installing || reg.waiting || reg.active;\n\n      if (reg.installing) {\n        console.log('cache worker installing...');\n      } else if (reg.waiting) {\n        console.log('cache worker waiting to activate (close, then reopen app)');\n      } else if (reg.active) {\n        console.log('cache worker already active!');\n      } else {\n        console.error('unknown cache worker state?');\n      }\n    }, function(err) {\n      console.log('cache worker failed', err);\n    });\n}\n\nexports.isEnabled = ('serviceWorker' in navigator) && !device.isSimulator;\n\nvar _onInit;\nif (exports.isEnabled) {\n  _onInit = init();\n\n  // cache spritesheets after init\n  Promise\n    .resolve(_onInit)\n    .then(function () {\n      // cache spritesheets\n      jsio('import ui.resource.loader');\n      var map = ui.resource.loader.getMap();\n      var sheets = {};\n      for (var uri in map) {\n        if (map[uri].sheet) {\n          sheets[map[uri].sheet] = true;\n        }\n      }\n\n      var urls = Object.keys(sheets);\n\n      // cache the current URL (index.html is cached, but we might be loading /\n      // instead)\n      urls.unshift(window.location.toString());\n\n      return exports.addToCache(urls);\n    })\n    .then(function (res) {\n      console.log('spritesheets now available offline');\n\n      if (res && res.failedURLs && res.failedURLs.length > 0) {\n        console.error('following spritesheets failed to load:',\n                      res.failedURLs);\n      }\n    });\n}\n\nexports.addWhitelistDomain = function (domain) {\n  if (!_onInit) {\n    return Promise.reject(new Error(\"cache not available\"));\n  }\n\n  // block on init\n  return Promise\n    .resolve(_onInit)\n    .then(function () {\n      return sendMessage({\n        command: 'addWhitelistDomain',\n        domain: domain\n      });\n    });\n}\n\n// Accepts a url or array of urls to cache\n// Returns a promise that resolves after caching, with any urls that failed to\n// cache\nexports.addToCache = function (urls) {\n  if (!Array.isArray(urls)) {\n    urls = [urls];\n  }\n\n  if (!_onInit) {\n    return Promise.reject(new Error(\"cache not available\"));\n  }\n\n  // block on init\n  return Promise\n    .resolve(_onInit)\n    .then(function () {\n      return sendMessage({\n        command: 'addURLs',\n        urls: urls\n      });\n    });\n};\n\n// from https://github.com/GoogleChrome/samples/blob/gh-pages/service-worker/post-message/index.html\nfunction sendMessage(message) {\n  // This wraps the message posting/response in a promise, which will resolve if the response doesn't\n  // contain an error, and reject with the error if it does. If you'd prefer, it's possible to call\n  // controller.postMessage() and set up the onmessage handler independently of a promise, but this is\n  // a convenient wrapper.\n  return new Promise(function(resolve, reject) {\n    var messageChannel = new MessageChannel();\n    messageChannel.port1.onmessage = function(event) {\n      if (event.data.error) {\n        reject(event.data.error);\n      } else {\n        resolve(event.data);\n      }\n    };\n\n    if (!_cacheWorker) {\n      reject(new Error('no worker found'));\n    }\n\n    // This sends the message data as well as transferring messageChannel.port2 to the service worker.\n    // The service worker can then use the transferred port to reply via postMessage(), which\n    // will in turn trigger the onmessage handler on messageChannel.port1.\n    // See https://html.spec.whatwg.org/multipage/workers.html#dom-worker-postmessage\n    _cacheWorker.postMessage(message, [messageChannel.port2]);\n  });\n}\n","pre":true},"modules/devkit-core/src/clientapi/index.js":{"path":"modules/devkit-core/src/clientapi/index.js","friendlyPath":"devkit","directory":"modules/devkit-core/src/clientapi/","filename":"index.js","src":"/** @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n// Import this before importing GC\n// _api.client.init sets up the GC object for the client apis\n\n/* globals CONFIG, Class, bind, logger, merge */\n\njsio('import lib.PubSub');\njsio('import lib.Callback');\njsio('import ui.Engine');\njsio('import ui.View');\njsio('import ui.StackView');\n\njsio('import device');\nvar FontRenderer = device.get('FontRenderer');\n\nif (!GLOBAL.CONFIG) { GLOBAL.CONFIG = {}; }\nif (!GLOBAL.DEBUG) { GLOBAL.DEBUG = false; }\n\nexports.ClientAPI=__class__;exports.ClientAPI=exports.ClientAPI(function exports_ClientAPI(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function () {\n\n  var ua = navigator.userAgent;\n  this.isNative = /TeaLeaf/.test(ua);\n  if (this.isNative) {\n    this.isIOS = /iPhone OS/.test(ua);\n    this.isAndroid = /Android/.test(ua);\n  } else if (/(iPod|iPhone|iPad)/i.test(ua)) {\n    this.isMobileBrowser = true;\n    this.isIOS = true;\n    this.isUIWebView = !/Safari/.test(ua);\n  } else if (/Android/.test(ua)) {\n    this.isMobileBrowser = true;\n    this.isAndroid = true;\n  } else {\n    this.isDesktop = true;\n    this.isFacebook = GLOBAL.CONFIG.isFacebookApp;\n  }\n\n  this.isKik = /Kik\\/\\d/.test(ua);\n\n  this.init = function (opts) {\n    window.addEventListener('pageshow', bind(this, '_onShow'), false);\n    window.addEventListener('pagehide', bind(this, '_onHide'), false);\n\n    if (this.isKik && GLOBAL.cards && cards.browser) {\n      cards.browser.on('foreground', bind(this, '_onShow'));\n      cards.browser.on('background', bind(this, '_onHide'));\n    }\n\n    this.isOnline = navigator.onLine;\n\n    window.addEventListener('online', bind(this, function () {\n      if (!this.isOnline) {\n        this.isOnline = true;\n        this.publish('OnlineStateChanged', true);\n      }\n    }), false);\n\n    window.addEventListener('offline', bind(this, function () {\n      if (this.isOnline) {\n        this.isOnline = false;\n        this.publish('OnlineStateChanged', false);\n      }\n    }), false);\n\n    // var uri = new URI(window.location);\n    // var campaign = uri.query('campaign') || \"NO CAMPAIGN\";\n    //\n    // XXX: The following lines cause a DOMException in some browsers\n    // because we're using a <base> tag, which doesn't resolve the URL relative correctly.\n    //get rid of it in case the game uses something\n    // if (window.history && window.history.replaceState) {\n    //  history.replaceState(null, null, uri.toString().replace(\"?campaign=\" + campaign, \"\"));\n    // }\n    //\n    // if (!localStorage.getItem(\"campaignID\")) {\n    //  localStorage.setItem(\"campaignID\", campaign)\n    // }\n\n    if (this.env == 'browser') { setTimeout(bind(this, '_onShow'), 0); }\n\n    if (CONFIG.version) {\n      logger.LOG&&console.log(\"LOG\",\"devkit\",'Version', CONFIG.version);\n    }\n  };\n\n  this.Application = ui.StackView;\n\n  PluginManager=__class__;var PluginManager=PluginManager(function PluginManager(){return this.init&&this.init.apply(this,arguments)},function () {\n    this.init = function () {\n      this._plugins = {};\n    }\n\n    this.register = function (name, plugin) {\n      this._plugins[name] = plugin;\n    }\n\n    this.getPlugin = function (name) {\n      return this._plugins[name];\n    }\n  });\n\n  this.plugins = new PluginManager();\n\n  jsio('import .UI');\n  this.ui = new UI();\n\n\n  // this.track({\n  //  name: \"campaignID\",\n  //  category: \"campaign\",\n  //  subcategory: \"id\",\n  //  data: campaign\n  // });\n\n  var map;\n  try {\n    if (GLOBAL.CACHE) {\n      map = JSON.parse(GLOBAL.CACHE['spritesheets/map.json']);\n    }\n  } catch (e) {\n    logger.WARN&&console.warn(\"WARN\",\"devkit\",\"spritesheet map failed to parse\", e);\n  }\n\n  jsio('import ui.resource.loader');\n  this.resources = ui.resource.loader;\n  this.resources.setMap(map);\n\n  jsio('import AudioManager');\n\n  this._onHide = function () {\n    // signal to the app that the window is going away\n    this.app && this.app.onPause && this.app.onPause();\n\n    this.publish('Hide');\n    this.publish('AfterHide');\n\n    if (this.tracker) {\n      this.tracker.endSession();\n    }\n  };\n\n  this._onShow = function () {\n    this.app && this.app.onResume && this.app.onResume();\n\n    this.publish('Show');\n    this.publish('AfterShow');\n  };\n\n  this.buildApp = function (entry) {\n    jsio('import src.Application as Application');\n\n    Application.prototype.__root = true;\n    this.app = new Application();\n    this.buildEngine(merge({view: this.app}, this.app._settings));\n\n    this.emit('app', this.app);\n  };\n\n  this.buildEngine = function (opts) {\n    if (!opts) { opts = {}; }\n    if (!opts.entry) { opts.entry = 'launchUI'; }\n\n    var view = opts.view;\n    if (!view) {\n      throw \"a timestep.Engine must be created with a root view\";\n    }\n\n    if (!(view instanceof ui.View)) {\n      throw \"src/Application.js must export a Class that inherits from ui.View\";\n    }\n\n    view.subscribe('onLoadError', this, '_onAppLoadError');\n\n    var launch;\n    if (typeof view[opts.entry] == 'function') {\n      launch = bind(view, opts.entry);\n    }\n\n    view.view = view; // legacy, deprecated\n    view.engine = new ui.Engine(opts);\n    view.engine.show();\n    view.engine.startLoop();\n\n    view.initUI && view.initUI();\n\n    FontRenderer.init();\n\n    var settings = view._settings || {};\n    var preload = settings.preload;\n    var autoHide = CONFIG.splash && (CONFIG.splash.autoHide !== false);\n    if (preload && preload.length) {\n      var cb = new lib.Callback();\n      for (var i = 0, group; group = preload[i]; ++i) {\n        this.resources.preload(group, cb.chain());\n      }\n\n      // note that hidePreloader takes a null cb argument to avoid\n      // forwarding the preloader result as the callback\n      if (autoHide) { cb.run(this, 'hidePreloader', null); }\n      if (launch) { cb.run(launch); }\n    } else {\n      if (autoHide) { this.hidePreloader(); }\n      launch && launch();\n    }\n  };\n\n  this._onAppLoadError = function (error) {\n    logger.ERROR&&console.error(\"ERROR\",\"devkit\",'encountered error when creating src Application: ', JSON.stringify(error));\n    var splash = CONFIG.splash;\n    if (splash && splash.onAppLoadError) {\n      splash.onAppLoadError(error);\n    }\n  };\n\n  this.hideSplash =\n  this.hidePreloader = function (cb) {\n    var splash = CONFIG.splash;\n    if (splash && splash.hide && !splash.hidden) {\n      splash.hide(cb);\n      splash.hidden = true;\n    } else {\n      cb && cb();\n    }\n  };\n});\n","pre":true},"modules/devkit-core/src/clientapi/UI.js":{"path":"modules/devkit-core/src/clientapi/UI.js","friendlyPath":".UI","directory":"modules/devkit-core/src/clientapi/","filename":"UI.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\njsio('import ui.widget.Spinner as Spinner');\n\nvar config = window.CONFIG;\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_src_clientapi_UI=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_src_clientapi_UI(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_src_clientapi_UI(){return this.init&&this.init.apply(this,arguments)},function () {\n\tthis._spinnerCounter = 0;\n\n\tjsio('import device');\n\n\tvar baseScale;\n\tif (navigator.displayMetrics) {\n\t\tbaseScale = navigator.displayMetrics.densityDpi / 160;\n\t} else if (!CONFIG.scaleDPR && device.isMobileBrowser) {\n\t\tbaseScale = 1;\n\t} else {\n\t\tbaseScale = window.devicePixelRatio || 1;\n\t}\n\n\tthis._scale = baseScale;\n\n\tthis.setTargetDensity = function (target) {\n\t\tswitch (target) {\n\t\t\tcase 'high':\n\t\t\t\tthis._scale = baseScale * 0.5;\n\t\t\t\tbreak;\n\t\t\tcase 'medium':\n\t\t\t\tthis._scale = baseScale * 0.75;\n\t\t\t\tbreak;\n\t\t\tcase 'low':\n\t\t\tdefault:\n\t\t\t\tthis._scale = baseScale;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tlogger.LOG&&console.log(\"LOG\",\".UI\",'scale:', this._scale);\n\t}\n\n\tthis.getScale = function () {\n\t\treturn this._scale;\n\t}\n\n\tthis.getIntValue = function (val) {\n\t\treturn Math.round(val * this._scale) / this._scale;\n\t}\n\n\tthis.showSpinner = function () {\n\t\tif (this._spinnerCounter) {\n\t\t\t++this._spinnerCounter;\n\t\t\treturn;\n\t\t}\n\n\t\tvar parent = GC.app.view;\n\t\tif (!parent) { return; }\n\n\t\t++this._spinnerCounter;\n\n\t\tif (!this._spinner) {\n\t\t\tvar dim = device.screen.devicePixelRatio * 50;\n\t\t\tthis._spinner = new Spinner({\n\t\t\t\twidth: dim,\n\t\t\t\theight: dim,\n\t\t\t\tx: parent.style.width / 2 - dim / 2,\n\t\t\t\ty: parent.style.height / 2 - dim / 2,\n\t\t\t\tparent: parent\n\t\t\t});\n\t\t} else {\n\t\t\tparent.addSubview(this._spinner);\n\t\t}\n\t}\n\n\tthis.hideSpinner = function () {\n\t\t--this._spinnerCounter;\n\t\tif (this._spinnerCounter <= 0) {\n\t\t\tthis._spinnerCounter = 0;\n\n\t\t\tthis._spinner && this._spinner.removeFromSuperview();\n\t\t}\n\t}\n});\n\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/widget/Spinner.js":{"path":"modules/devkit-core/modules/timestep/src/ui/widget/Spinner.js","friendlyPath":"ui.widget.Spinner","directory":"modules/devkit-core/modules/timestep/src/ui/widget/","filename":"Spinner.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.widget.Spinner;\n */\njsio('import ui.View as View');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_widget_Spinner=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_widget_Spinner(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_widget_Spinner(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\tvar defaults = {\n\t\tcycles: 0.5,\n\t\tradius: 10,\n\t\tspokes: 20,\n\t\tthickness: 2,\n\t\ttrail: 10,\n\t\tcolor: '#ffffff',\n\t\tbackgroundColor: 'rgba(0, 0, 0, 0.5)',\n\t\tlayout: 'box'\n\t};\n\t\n\tthis.tag = 'Spinner';\n\tthis._t = 0;\n\t\n\tthis.init = function (opts) {\n\t\tthis._opts = merge(opts, defaults);\n\t\t\n\t\tthis._step = 2 * Math.PI / this._opts.spokes;\n\t\t\n\t\tsupr(this, 'init', [this._opts]);\n\t};\n\t\n\tthis.tick = function (dt) {\n\t\tthis._t += dt;\n\t\t\n\t\tvar r = (this._t / 1000 % (1 / this._opts.cycles)) * Math.PI;\n\t\t\n\t\tvar oldR = this._r;\n\t\tthis._r = r - (r % this._step);\n\t\t\n\t\tif (oldR != r) {\n\t\t\tthis.needsRepaint();\n\t\t}\n\t}\n\t\n\tthis.render = function (ctx) {\n\t\tctx.fillStyle = this._opts.backgroundColor;\n\t\tvar alpha = ctx.globalAlpha;\n\n\t\tvar w = this.style.width,\n\t\t\t\th = this.style.height,\n\t\t\t\tradius = this._opts.radius,\n\t\t\t\ttrail = this._opts.trail,\n\t\t\t\tthickness = this._opts.thickness,\n\t\t\t\tx, y, i, j;\n\t\t\n\t\tfor (y = 0; y < radius; ++y) {\n\t\t\tj = y + 1;\n\t\t\tx = Math.round(radius - Math.sqrt(2 * j * radius - j * j));\n\t\t\tctx.fillRect(x, y, w - 2 * x, 1);\n\t\t}\n\t\t\n\t\ty = h - radius;\n\t\tctx.fillRect(0, radius, w, y - radius);\n\t\t\n\t\tfor (i = 0; i < radius; ++i) {\n\t\t\tj = radius - i;\n\t\t\tx = Math.round(radius - Math.sqrt(2 * j * radius - j * j));\n\t\t\tctx.fillRect(x, y + i, w - 2 * x, 1);\n\t\t}\n\t\t\n\t\tctx.fillStyle = this._opts.color;\n\t\tctx.translate(w / 2, h / 2);\n\t\tw /= 2;\n\t\tctx.rotate(this._r);\n\t\t\n\t\tfor (i = 0; i < this._opts.spokes; ++i) {\n\t\t\tctx.rotate(this._step);\n\t\t\tctx.globalAlpha = alpha * Math.max(0.1, (i - trail) / trail);\n\t\t\tctx.fillRect(10, -thickness / 2, w - 15, thickness);\n\t\t}\n\t}\n});\n","pre":true},"src/Application.js":{"path":"src/Application.js","friendlyPath":"src.Application","directory":"src/","filename":"Application.js","baseMod":"src","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/src","src":"//import ui.TextView as TextView;\njsio('import ui.StackView');\njsio('import device'); \n\n// import src.TitleScreen as TitleScreen;\njsio('import src.GameScreen as GameScreen');\njsio('import src.TitleScreen as TitleScreen');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_src_Application=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_src_Application(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_src_Application(){return this.init&&this.init.apply(this,arguments)},GC.Application, function () {\n\n  this.initUI = function () {\n    this.view.style.backgroundColor = 'red';\n\n    var rootView = new ui.StackView({\n      superview: this,\n      // x: device.width / 2 - 160,\n      // y: device.height / 2 - 240,\n      backgroundColor: 'green',\n      x: 0,\n      y: 0,\n      clip: true,\n      width: device.width,\n      height: device.height,\n      // scale: device.width / 320\n    }); //initialize the view stack \n\n    var _GameScreen = new GameScreen({\n      superview: this.view,\n    // image: 'resources/images/background.png',\n      backgroundColor: 'orange',\n      x: 0,\n      y: 0,\n      width: device.width,\n      height: device.height, \n      visible:false\n    });\n\n    var _TitleScreen = new TitleScreen({\n      superview: this.view,\n    // image: 'resources/images/background.png',\n      backgroundColor: 'black',\n      x: 0,\n      y: 0,\n      width: device.width,\n      height: device.height, \n      visible:false\n    });\n\n    _TitleScreen.on('title:launch', function (){\n      console.log(\"Application -------> title:launch\");\n    });\n\n    rootView.push(_TitleScreen);\n\n    // _GameScreen.on('InputSelect', function (event, point) {\n    //   console.log(\"GameScreen clicked\", rootView.stack);\n    //   rootView.pop();\n    // }); \n\n    // rootView.on('InputSelect', function (event, point) {\n    //   console.log(\"rootView clicked\", rootView.stack);\n    //   rootView.push(_GameScreen);\n    // }); \n\n  };\n\n  this.launchUI = function () {\n\n  };\n\n});\n","pre":true},"src/GameScreen.js":{"path":"src/GameScreen.js","friendlyPath":"src.GameScreen","directory":"src/","filename":"GameScreen.js","src":"jsio('import ui.ImageView');\njsio('import device');\n// import math.util as util;\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_src_GameScreen=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_src_GameScreen(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_src_GameScreen(){return this.init&&this.init.apply(this,arguments)},ui.ImageView, function (supr) {\n\n\n  this.init = function (opts) {\n    opts = merge(opts, {});\n\n    supr(this, 'init', [opts]);\n\n    this.build();\n  };\n\n  this.build = function() {\n    \n  }; //build()  \n\n}); //GameScreen","pre":true},"modules/devkit-core/modules/timestep/src/ui/ImageView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/ImageView.js","friendlyPath":"ui.ImageView","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"ImageView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.ImageView;\n * Import the ImageView from the Canvas/DOM rendering backend.\n *\n * @doc http://doc.gameclosure.com/api/ui-imageview.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/imageview.md\n */\n\njsio('import device');\nexports = device.importUI('ImageView');\n","pre":true},"src/TitleScreen.js":{"path":"src/TitleScreen.js","friendlyPath":"src.TitleScreen","directory":"src/","filename":"TitleScreen.js","src":"jsio('import ui.ImageView');\njsio('import ui.TextView');\njsio('import device');\n// import math.util as util;\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_src_TitleScreen=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_src_TitleScreen(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_src_TitleScreen(){return this.init&&this.init.apply(this,arguments)},ui.ImageView, function (supr) {\n\n\n  this.init = function (opts) {\n    opts = merge(opts, {});\n\n    supr(this, 'init', [opts]);\n\n    this.build();\n  };\n\n  this.build = function() {\n\n    var title = new ui.TextView({\n      superview: this,\n      x: 0,\n      y: 300,\n      width: device.width,\n      height: 200,\n      autoSize: false,\n      size: 180,\n      verticalAlign: 'middle',\n      horizontalAlign: 'center',\n      wrap: true,\n      color: '#FFFFFF', \n      text: \"Bubble Shooter!\"\n    });\n\n    var startButton = new ui.ImageView({\n      superview: this,\n      x: device.width/2-121,\n      y: device.height/2,\n      horizontalAlign: 'center',\n      width: device.width,\n      height: 100,\n      autoSize: true,\n      image: \"resources/images/startbutton.png\"\n    });\n    \n    startButton.on('InputSelect', function (event, point) {\n      console.log(\"TitleScreen -------> title:launch\");\n      \n      this.getSuperview().emit('title:launch');\n\n    });\n\n  }; //build()  \n\n}); //GameScreen","pre":true},"modules/devkit-core/modules/timestep/src/ui/TextView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/TextView.js","friendlyPath":"ui.TextView","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"TextView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.TextView;\n * Import the Canvas/DOM implementation of TextView.\n *\n * @doc http://doc.gameclosure.com/api/ui-text.html#class-ui.textview\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/text.md\n */\n\njsio('import device');\n\nexports = device.importUI('TextView');\n","pre":true},"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/client.js":{"path":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/client.js","friendlyPath":"devkit-simulator-client","directory":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client","filename":"client.js","src":"/* globals CONFIG, GC, logger */\n\nvar dispatchWindowEvent = function(eventName) {\n  var e = document.createEvent('Event');\n  e.initEvent(eventName, true, true);\n  window.dispatchEvent(e);\n};\n\nexports.onLaunch = function () {\n  var deviceId = CONFIG.simulator.deviceId;\n  var deviceType = CONFIG.simulator.deviceType;\n  var deviceInfo = CONFIG.simulator.deviceInfo;\n\n  jsio('import .simulateDevice');\n  simulateDevice.simulate(deviceInfo);\n\n  jsio('import devkit.debugging');\n  var channel = devkit.debugging.getChannel('devkit-simulator');\n\n  var _isHomeScreen = false;\n  channel.on('button:home', function () {\n    var app = GC.app;\n\n    _isHomeScreen = !_isHomeScreen;\n    if (_isHomeScreen) {\n      dispatchWindowEvent('pagehide');\n      app.engine.pause();\n\n      var canvas = document.getElementsByTagName('canvas');\n      if (canvas.length) {\n        canvas = canvas[0];\n        if (canvas.getContext) {\n          var ctx = canvas.getContext('2d');\n          ctx.fillStyle = '#000000';\n          ctx.fillRect(0, 0, canvas.width, canvas.height);\n        }\n      }\n    } else {\n      dispatchWindowEvent('pageshow');\n      app.engine.resume();\n    }\n  });\n\n  channel.on('button:back', function (evt) {\n    GLOBAL.NATIVE.onBackButton && GLOBAL.NATIVE.onBackButton(evt);\n  });\n\n  channel.on('screenshot', function (data, req) {\n    devkit.debugging.screenshot(function (err, res) {\n      if (err) {\n        req.error(err);\n      } else {\n        req.send(res);\n      }\n    });\n  });\n\n  channel.on('mute', function (evt) {\n    console.log('MUTE', evt.shouldMute);\n    jsio('import AudioManager');\n    AudioManager.muteAll(evt.shouldMute);\n  });\n\n  channel.on('pause', function () { exports.setPaused(true); });\n  channel.on('resume', function () { exports.setPaused(false); });\n  channel.on('step', function () { GC.app.engine.stepFrame(); });\n\n  logger.log('waiting for devkit simulator client...');\n\n  jsio('import device');\n  if (device.isMobileBrowser) {\n    jsio('import .mobileUI');\n  }\n\n  return channel.connect()\n    .timeout(1000)\n    .then(function () {\n      logger.log('simulator client connected!');\n      channel.emit('handshake', {\n        deviceId: deviceId,\n        deviceType: deviceType,\n        userAgent: navigator.userAgent,\n        screen: {\n          width: device.screen.width,\n          height: device.screen.height\n        }\n      });\n    });\n};\n\nvar _isPaused = false;\nexports.setPaused = function (isPaused) {\n  _isPaused = isPaused;\n\n  var app = GC.app;\n  if (_isPaused) {\n    console.log(\"app paused\");\n    app.engine.pause();\n  } else {\n    app.engine.resume();\n  }\n};\n","pre":true},"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/simulateDevice.js":{"path":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/simulateDevice.js","friendlyPath":".simulateDevice","directory":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client","filename":"simulateDevice.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\nexports.simulate = function (params) {\n  if (params.userAgent) {\n    var navigator = window.navigator;\n    var shim = window.navigator = {};\n    for (var i in navigator) {\n      shim[i] = navigator[i];\n    }\n\n    shim.userAgent = params.userAgent;\n  }\n\n  window.devicePixelRatio = params.devicePixelRatio || 1;\n\n  jsio('import device');\n  var isMobileBrowser = (params.target === 'browser-mobile');\n  if (isMobileBrowser) {\n    device.isMobileBrowser = true;\n  }\n};\n","pre":true},"modules/devkit-core/src/clientapi/debugging/index.js":{"path":"modules/devkit-core/src/clientapi/debugging/index.js","friendlyPath":"devkit.debugging","directory":"modules/devkit-core/src/clientapi/debugging/","filename":"index.js","src":"jsio('import lib.PubSub');\n\njsio('import .traversal');\njsio('from .screenshot import screenshot');\n\njsio('import .Channel');\n\nAPI=__class__;var API=API(function API(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function () {\n    this._channels = {};\n  }\n\n  this.getChannel = function (channelName) {\n    var channel = this._channels[channelName];\n    if (!channel) {\n      channel = new Channel(channelName);\n      this._channels[channelName] = channel;\n\n      if (_transport) {\n        channel.setTransport(_transport);\n      }\n    }\n\n    return channel;\n  }\n\n  this.__onConnect = function (transport) {\n    for (var channel in this._channels) {\n      this._channels[channel].setTransport(transport);\n    }\n  }\n\n  this.screenshot = screenshot;\n});\n\nexports = new API();\n\nmerge(exports, traversal);\n\nvar _transport;\n\n// private callback for when connection is established\nvar setTransport = bind(exports, function (transport) {\n  _transport = transport;\n  transport.on('disconnect', function () {\n    _transport = null;\n  });\n\n  this.__onConnect(transport);\n});\n\n// try to connect\nif (CONFIG.simulator) {\n  // try a direct connection to an outer frame (assuming we're in a\n  // simulator iframe)\n  var devkit;\n  try {\n    devkit = window.parent.devkit;\n  } catch (e) {}\n\n  if (!devkit || !devkit.getSimulator) {\n    return;\n  }\n\n  var simulator = devkit.getSimulator(CONFIG.simulator.deviceId);\n  if (simulator) {\n    jsio('import .BridgeTransport');\n    var bridge = new BridgeTransport();\n    simulator.setTransport(bridge.a);\n    setTransport(bridge.b);\n  }\n} else {\n  if (/^browser/.test(CONFIG.target)) {\n    // TODO: loadSocketIO();\n  } else {\n    // TODO: loadTCP();\n  }\n}\n","pre":true},"modules/devkit-core/src/clientapi/debugging/traversal.js":{"path":"modules/devkit-core/src/clientapi/debugging/traversal.js","friendlyPath":".traversal","directory":"modules/devkit-core/src/clientapi/debugging/","filename":"traversal.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/*\n * debug tools for traversing views from the JS console.\n * This class ends up being in the global scope:\n *   GLOBAL._DEBUG = new exports();\n */\n\n/* globals GC, bind, logger */\n\nexports.traverse = function (f) { return GC.app && exports.traverseView(f, GC.app.view); };\nexports.traverseView = function (f, view) {\n  var data = f(view);\n  var subviews = view.getSubviews().map(bind(this, 'traverseView', f));\n  return {\n    uid: view.uid,\n    data: data,\n    subviews: subviews.length ? subviews : undefined\n  };\n};\n\nexports.find = function (f) { return GC.app && exports.findView(f, GC.app.view); };\nexports.findView = function (f, view) {\n  if (f(view)) { return view; }\n  var subviews = view.getSubviews();\n  for (var i = 0, sub; sub = subviews[i]; ++i) {\n    var res = exports.findView(f, sub);\n    if (res) { return res; }\n  }\n\n  return false;\n};\n\nvar _isHighlighting = false;\nvar _highlightViews = [];\n\nvar _renderHighlights = (function () {\n  var prev = null;\n  var highlight = 0;\n  var fadeIn = true;\n  var FADE_IN_TIME = 1000;\n  return function (ctx) {\n    var now = Date.now();\n    var dt = 0;\n    if (prev) {\n      dt = now - prev;\n    }\n\n    prev = now;\n\n    if (fadeIn) {\n      highlight += dt;\n      if (highlight >= FADE_IN_TIME) {\n        fadeIn = false;\n        highlight = FADE_IN_TIME;\n      }\n    } else {\n      highlight -= dt;\n      if (highlight < 0) {\n        fadeIn = true;\n        highlight = 0;\n      }\n    }\n\n    _highlightViews.forEach(function (view) {\n      var pos = view.getPosition();\n      var gray = Math.round(255 * highlight / FADE_IN_TIME);\n      ctx.save();\n      ctx.fillStyle = 'rgba(' + gray + ',' + gray + ',' + gray + ',' + gray / 512 + ')';\n      ctx.strokeStyle = 'rgba(' + gray + ',0,0,1)';\n      ctx.translate(pos.x, pos.y);\n      ctx.rotate(pos.r);\n      ctx.fillRect(0, 0, pos.width, pos.height);\n      ctx.strokeRect(-0.5, -0.5, pos.width + 1, pos.height + 1);\n      ctx.restore();\n    });\n  };\n})();\n\nexports.unhighlightViews = function () {\n  _highlightViews = [];\n};\n\nexports.highlightView = function (view) {\n  if (_highlightViews.indexOf(view) == -1) {\n    _highlightViews.push(view);\n    if (!_isHighlighting) {\n      _isHighlighting = true;\n      GC.app.engine.on('Render', _renderHighlights);\n    }\n  }\n};\n\nexports.unhighlightView = function (view) {\n  var i = _highlightViews.indexOf(view);\n  if (i != -1) {\n    _highlightViews.splice(i, 1);\n  }\n};\n\nexports.getViewById =\nexports.getViewByID = function (uid) { return exports.find(function (view) { return view.uid == uid; }); };\n\nexports.getImages = function (view) {\n  jsio('import ui.ImageView');\n  jsio('import ui.ImageScaleView');\n\n  var hash = {};\n  exports.traverseView(function (view) {\n    if (view instanceof ui.ImageView || view instanceof ui.ImageScaleView) {\n      var img = view.getImage();\n      if (img) {\n        var url = img.getOriginalURL();\n        hash[url] = true;\n      }\n    }\n\n  }, view || GC.app);\n\n  var images = Object.keys(hash);\n  images.sort();\n  return images;\n};\n\nexports.pack = function () { return GC.app && exports.packView(GC.app.view); };\nexports.packView = function (view) {\n  jsio('import ui.ImageView');\n  jsio('import ui.ImageScaleView');\n  jsio('import ui.TextView');\n\n  return exports.traverseView(function (view) {\n    var imageData;\n    var sourceSlices;\n    var destSlices;\n    if (view instanceof ui.ImageView || view instanceof ui.ImageScaleView) {\n      var img = view.getImage();\n      if (img) {\n        imageData = img.getOriginalURL() || img.getMap();\n      }\n\n      if (view.getScaleMethod) {\n        var scaleMethod = view.getScaleMethod();\n        if (/slice$/.test(scaleMethod)) {\n          sourceSlices = view._opts.sourceSlices;\n          destSlices = view._opts.destSlices;\n        }\n      }\n    }\n\n    var text;\n    if (view instanceof ui.TextView) {\n      text = view.getText();\n    }\n\n    var s = view.style;\n    return {\n      x: s.x ? s.x : undefined,\n      y: s.y ? s.y : undefined,\n      width: s.width,\n      height: s.height,\n      scale: s.scale != 1 ? s.scale : undefined,\n      sourceSlices: sourceSlices,\n      destSlices: destSlices,\n      scaleMethod: scaleMethod,\n      image: imageData,\n      text: text,\n      visible: s.visible == false ? false : undefined,\n      opacity: s.opacity != 1 ? s.opacity : undefined,\n      tag: view.getTag()\n    };\n  }, view);\n};\n\nexports.unpack = function (data) {\n  jsio('import ui.View');\n  jsio('import ui.ImageView');\n  jsio('import ui.resource.Image');\n  jsio('import ui.TextView');\n  jsio('import ui.ScrollView');\n\n  function buildView (superview, data) {\n    var view;\n\n    var opts = data.data;\n    opts.x = opts.x || 0;\n    opts.y = opts.y || 0;\n    opts.visible = 'visible' in opts ? opts.visible : true;\n    opts.opacity = 'opacity' in opts ? opts.opacity : 1;\n    opts.scale = opts.scale || 1;\n    if (opts.image) {\n      var img = opts.image;\n      view = new ui.ImageView({\n        x: opts.x,\n        y: opts.y,\n        width: opts.width,\n        height: opts.height,\n        scale: opts.scale,\n        clip: opts.clip,\n\n        scaleMethod: opts.scaleMethod,\n        slices: opts.slices,\n\n        superview: superview,\n        image: typeof img == 'string' ? img : new ui.resource.Image({\n          url: img.url,\n          sourceX: img.x,\n          sourceY: img.y,\n          sourceW: img.width,\n          sourceH: img.height,\n          marginTop: img.marginTop,\n          marginRight: img.marginRight,\n          marginBottom: img.marginBottom,\n          marginLeft: img.marginLeft\n        }),\n        visible: opts.visible,\n        opacity: opts.opacity,\n        tag: opts.tag\n      });\n    } else {\n      view = new (opts.text ? ui.TextView : (opts.clip ? ui.ScrollView : ui.View))({\n        x: opts.x,\n        y: opts.y,\n        clip: opts.clip,\n        width: opts.width,\n        height: opts.height,\n        text: opts.text,\n        superview: superview,\n        scale: opts.scale,\n        visible: opts.visible,\n        opacity: opts.opacity,\n        tag: opts.tag\n      });\n    }\n\n    view.uid = data.uid;\n\n    if (data.subviews) {\n      for (var i = 0, sub; sub = data.subviews[i]; ++i) {\n        buildView(view, sub);\n      }\n    }\n  }\n\n  GC.app.view.updateOpts(data.data);\n  for (var i = 0, sub; sub = data.subviews[i]; ++i) {\n    buildView(GC.app.view, sub);\n  }\n};\n\nexports.eachView = function (list, f) {\n  for (var i = 0, n = list.length; i < n; ++i) {\n    var view = exports.getViewByID(list[i]);\n    if (view) {\n      f(view, list[i]);\n    } else {\n      logger.WARN&&console.warn(\"WARN\",\".traversal\",'view', list[i], 'not found');\n    }\n  }\n};\n\nexports.hideViews = function (/* id1, id2, id3, ... */) {\n  exports.eachView(arguments, function (view) { view.style.visible = false; });\n};\n\nexports.showViews = function (/* id1, id2, id3, ... */) {\n  exports.eachView(arguments, function (view) { view.style.visible = true; });\n};\n\nexports.hideAllViews = function () {\n  exports.traverse(function (view) { view.style.visible = false; });\n};\n\nexports.showAllViews = function () {\n  exports.traverse(function (view) { view.style.visible = true; });\n};\n\nexports.hideViewRange = function (a, b) {\n  var range = [];\n  for (var i = a; i < b; ++i) {\n    range.push(i);\n  }\n\n  exports.hideViews.apply(this, range);\n};\n\nexports.showViewRange = function (a, b) {\n  var range = [];\n  for (var i = a; i < b; ++i) {\n    range.push(i);\n  }\n\n  exports.showViews.apply(this, range);\n};\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/ImageScaleView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/ImageScaleView.js","friendlyPath":"ui.ImageScaleView","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"ImageScaleView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.ImageScaleView\n *\n * @doc http://doc.gameclosure.com/api/ui-imageview.html#class-ui.imagescaleview\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/imageview.md\n */\n\njsio('import ui.View');\njsio('import ui.resource.Image as Image');\njsio('import ui.resource.loader as resourceLoader');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_ImageScaleView=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_ImageScaleView(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_ImageScaleView(){return this.init&&this.init.apply(this,arguments)},ui.View, function (supr) {\n\n\tvar defaults = {\n\t\timage: null,\n\t\tautoSize: false,\n\t\tscaleMethod: 'stretch',\n\t\trenderCenter: true\n\t};\n\n\tthis.init = function (opts) {\n\t\tsupr(this, 'init', [merge(opts, defaults)]);\n\t\tif (this._imgUrlChangeListenerFn) {\n\t\t\tthis._img.removeListener('urlChanged', this._imgUrlChangeListenerFn);\n\t\t\tthis._imgUrlChangeListenerFn = null;\n\t\t}\n\t};\n\n\tthis.getScaleMethod = function () {\n\t\treturn this._scaleMethod;\n\t};\n\n\tthis.updateSlices = function (opts) {\n\t\topts = opts || this._opts;\n\n\t\t// reset slice cache\n\t\tthis._renderCacheKey = {};\n\t\tthis._sliceCache = [];\n\t\tfor (var i = 0; i < 9; ++i) {\n\t\t\tvar row = [this._img.getSource(), 0, 0, 0, 0, 0, 0, 0, 0];\n\t\t\trow.render = false;\n\t\t\tthis._sliceCache.push(row);\n\t\t}\n\n\t\topts.destSlices = opts.destSlices || opts.sourceSlices;\n\t\t// {horizontal: {left: n, center: n, right: n}, vertical: {top: n, middle: n, bottom: n}}\n\t\tthis._sourceSlices = opts.sourceSlices;\n\t\t// {horizontal: {left: n, right: n}, vertical: {top: n, bottom: n}}\n\t\tthis._destSlices = opts.destSlices;\n\n\t\tthis._imgScale = opts.imgScale || 1;\n\n\t\tif (!opts.sourceSlices || !(opts.sourceSlices.horizontal || opts.sourceSlices.vertical)) {\n\t\t\tthrow new Error('slice views require sourceSlices.horizontal and/or sourceSlices.vertical');\n\t\t}\n\n\t\tif (opts.scaleMethod === '2slice') {\n\t\t\tif (opts.sourceSlices.horizontal && opts.destSlices.horizontal) {\n\t\t\t\tif (opts.destSlices.horizontal.left) {\n\t\t\t\t\topts.sourceSlices.horizontal.center = opts.sourceSlices.horizontal.right;\n\t\t\t\t\topts.sourceSlices.horizontal.right = 0;\n\t\t\t\t} else if (opts.destSlices.horizontal.right) {\n\t\t\t\t\topts.sourceSlices.horizontal.center = opts.sourceSlices.horizontal.left;\n\t\t\t\t\topts.sourceSlices.horizontal.left = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (opts.sourceSlices.vertical && opts.destSlices.vertical) {\n\t\t\t\tif (opts.destSlices.vertical.top) {\n\t\t\t\t\topts.sourceSlices.vertical.middle = opts.sourceSlices.vertical.bottom;\n\t\t\t\t\topts.sourceSlices.vertical.bottom = 0;\n\t\t\t\t} else if (opts.destSlices.vertical.bottom) {\n\t\t\t\t\topts.sourceSlices.vertical.middle = opts.sourceSlices.vertical.bottom;\n\t\t\t\t\topts.sourceSlices.vertical.bottom = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (opts.sourceSlices.horizontal) {\n\t\t\tvar src = opts.sourceSlices.horizontal;\n\t\t\tvar slices = [src.left || 0, src.center || 0, src.right || 0];\n\t\t\tif (src.center == undefined && this._img) { // also captures null, but ignores 0\n\t\t\t\tvar width = this._img.getWidth();\n\t\t\t\tslices[1] = width ? width - slices[0] - slices[2] : 0;\n\t\t\t}\n\n\t\t\tthis._sourceSlicesHor = slices;\n\t\t\tthis._destSlicesHor = [\n\t\t\t\t(this._destSlices.horizontal.left || 0) * this._imgScale,\n\t\t\t\t0,\n\t\t\t\t(this._destSlices.horizontal.right || 0) * this._imgScale\n\t\t\t];\n\t\t} else {\n\t\t\tthis._sourceSlicesHor = [0, 100, 0];\n\t\t\tthis._destSlicesHor = [0, 100, 0];\n\t\t}\n\n\t\tif (opts.sourceSlices.vertical) {\n\t\t\tvar src = opts.sourceSlices.vertical;\n\t\t\tvar slices = [src.top || 0, src.middle || 0, src.bottom || 0];\n\t\t\tif (src.middle == undefined && this._img) {\n\t\t\t\tvar height = this._img.getHeight();\n\t\t\t\tslices[1] = height ? height - slices[0] - slices[2] : 0;\n\t\t\t}\n\n\t\t\tthis._sourceSlicesVer = slices;\n\t\t\tthis._destSlicesVer = [\n\t\t\t\t(this._destSlices.vertical.top || 0) * this._imgScale,\n\t\t\t\t0,\n\t\t\t\t(this._destSlices.vertical.bottom || 0) * this._imgScale\n\t\t\t];\n\t\t} else {\n\t\t\tthis._sourceSlicesVer = [0, 100, 0];\n\t\t\tthis._destSlicesVer = [0, 100, 0];\n\t\t}\n\t};\n\n\tthis.updateOpts = function (opts) {\n\t\tvar opts = supr(this, 'updateOpts', arguments);\n\t\tvar changeScaleMethod = opts.scaleMethod && this._scaleMethod != opts.scaleMethod;\n\t\tif (changeScaleMethod) {\n\t\t\tvar key = opts.scaleMethod;\n\t\t\tif (/slice$/.test(key)) {\n\t\t\t\tkey = 'slice';\n\t\t\t}\n\n\t\t\tthis.render = renderFunctions[key];\n\t\t\tthis._renderCacheKey = {};\n\t\t\tthis._scaleMethod = opts.scaleMethod;\n\t\t\tthis._isSlice = this._scaleMethod.slice(1) == 'slice';\n\t\t}\n\n\t\tif ('debug' in opts) {\n\t\t\tthis.debug = !!opts.debug;\n\t\t}\n\n\t\tif (opts.image) {\n\t\t\tthis.setImage(opts.image);\n\t\t} else if (changeScaleMethod && this._isSlice && this._img) {\n\t\t\tthis.updateSlices();\n\t\t}\n\n\t\tif (opts.verticalAlign) {\n\t\t\tthis._renderCacheKey = {};\n\t\t\tthis._verticalAlign = opts.verticalAlign;\n\t\t}\n\t\tif (opts.align || opts.horizontalAlign) {\n\t\t\tthis._align = opts.align || opts.horizontalAlign;\n\t\t}\n\n\t\t// tile mode\n\t\tif ('rows' in opts) {\n\t\t\tthis.rows = opts.rows;\n\t\t}\n\t\tif ('columns' in opts) {\n\t\t\tthis.columns = opts.columns;\n\t\t}\n\t\tvar r = this.rows;\n\t\tvar c = this.columns;\n\t\tif (this._scaleMethod == 'tile' && (!(r || c) || (r && c))) {\n\t\t\tthrow new Error('tile views must define either rows or columns');\n\t\t}\n\n\t\treturn opts;\n\t};\n\n\tthis._computeSlices = function (w, h, absScale) {\n\t\tvar bounds = this._img.getBounds();\n\t\tvar iw = bounds.width;\n\t\tvar ih = bounds.height;\n\t\tif (iw <= 0 || ih <= 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar image = this._img.getSource();\n\t\tvar sourceSlicesHor = this._sourceSlicesHor;\n\t\tvar sourceSlicesVer = this._sourceSlicesVer;\n\t\tvar destSlicesHor = [];\n\t\tvar destSlicesVer = [];\n\n\t\tif (sourceSlicesHor) {\n\t\t\tvar ratio = this.style.fixedAspectRatio ? h / ih : 1;\n\t\t\tdestSlicesHor[0] = this._destSlicesHor[0] * ratio;\n\t\t\tdestSlicesHor[2] = this._destSlicesHor[2] * ratio;\n\t\t\tdestSlicesHor[1] = w - destSlicesHor[0] - destSlicesHor[2];\n\n\t\t\tif (destSlicesHor[1] < 0) {\n\t\t\t\tdestSlicesHor[0] = (destSlicesHor[0] * w / (destSlicesHor[0] + destSlicesHor[2])) | 0;\n\t\t\t\tdestSlicesHor[1] = 0;\n\t\t\t\tdestSlicesHor[2] = w - destSlicesHor[0];\n\t\t\t}\n\t\t}\n\n\t\tif (sourceSlicesVer) {\n\t\t\tvar ratio = this.style.fixedAspectRatio ? w / iw : 1;\n\t\t\tdestSlicesVer[0] = this._destSlicesVer[0] * ratio;\n\t\t\tdestSlicesVer[2] = this._destSlicesVer[2] * ratio;\n\t\t\tdestSlicesVer[1] = h - destSlicesVer[0] - destSlicesVer[2];\n\n\t\t\tif (destSlicesVer[1] < 0) {\n\t\t\t\tdestSlicesVer[0] = (destSlicesVer[0] * h / (destSlicesVer[0] + destSlicesVer[2])) | 0;\n\t\t\t\tdestSlicesVer[1] = 0;\n\t\t\t\tdestSlicesVer[2] = h - destSlicesVer[0];\n\t\t\t}\n\t\t}\n\n\t\tvar marginLeft = bounds.marginLeft,\n\t\t\torigLeftSlice = sourceSlicesHor[0] + bounds.marginLeft;\n\t\tif (origLeftSlice && destSlicesHor[0]) {\n\t\t\tmarginLeft *= destSlicesHor[0] / origLeftSlice;\n\t\t}\n\n\t\tvar marginRight = bounds.marginRight,\n\t\t\torigRightSlice = sourceSlicesHor[2] + bounds.marginRight;\n\t\tif (origRightSlice && destSlicesHor[2]) {\n\t\t\tmarginRight *= destSlicesHor[2] / origRightSlice;\n\t\t}\n\n\t\tvar marginTop = bounds.marginTop,\n\t\t\torigTopSlice = sourceSlicesVer[0] + bounds.marginTop;\n\t\tif (origTopSlice && destSlicesVer[0]) {\n\t\t\tmarginTop *= destSlicesVer[0] / origTopSlice;\n\t\t}\n\n\t\tvar marginBottom = bounds.marginBottom,\n\t\t\torigBottomSlice = sourceSlicesVer[2] + bounds.marginBottom;\n\t\tif (origBottomSlice && destSlicesVer[2]) {\n\t\t\tmarginBottom *= destSlicesVer[2] / origBottomSlice;\n\t\t}\n\n\t\tif (destSlicesHor[0]) {\n\t\t\tdestSlicesHor[0] -= marginLeft;\n\t\t} else {\n\t\t\tdestSlicesHor[1] -= marginLeft;\n\t\t}\n\n\t\tif (destSlicesVer[0]) {\n\t\t\tdestSlicesVer[0] -= marginTop;\n\t\t} else {\n\t\t\tdestSlicesVer[1] -= marginTop;\n\t\t}\n\n\t\tif (destSlicesHor[2]) {\n\t\t\tdestSlicesHor[2] -= marginRight;\n\t\t} else {\n\t\t\tdestSlicesHor[1] -= marginRight;\n\t\t}\n\n\t\tif (destSlicesVer[2]) {\n\t\t\tdestSlicesVer[2] -= marginBottom;\n\t\t} else {\n\t\t\tdestSlicesVer[1] -= marginBottom;\n\t\t}\n\n\t\tvar heightBalance = 0;\n\t\tvar sx, sw, sh;\n\t\tvar sy = bounds.y;\n\t\tvar dx, dw, dh;\n\t\tvar dy = marginTop;\n\t\tvar i, j;\n\n\t\tfor (j = 0; j < 3; j++) {\n\t\t\tvar widthBalance = 0;\n\t\t\tvar idealHeight = destSlicesVer[j] + heightBalance;\n\t\t\tvar roundedHeight = Math.round(absScale * idealHeight) / absScale;\n\t\t\theightBalance = idealHeight - roundedHeight;\n\n\t\t\tsh = sourceSlicesVer[j];\n\t\t\tdh = roundedHeight;\n\t\t\tsx = bounds.x;\n\t\t\tdx = marginLeft;\n\t\t\tfor (i = 0; i < 3; i++) {\n\t\t\t\tvar idealWidth = destSlicesHor[i] + widthBalance;\n\t\t\t\tvar roundedWidth = Math.round(absScale * idealWidth) / absScale;\n\t\t\t\twidthBalance = idealWidth - roundedWidth;\n\n\t\t\t\tsw = sourceSlicesHor[i];\n\t\t\t\tdw = roundedWidth;\n\n\t\t\t\tvar cache = this._sliceCache[j * 3 + i];\n\t\t\t\tif (sw > 0 && sh > 0 && dw > 0 && dh > 0) {\n\t\t\t\t\tcache[1] = sx;\n\t\t\t\t\tcache[2] = sy;\n\t\t\t\t\tcache[3] = sw;\n\t\t\t\t\tcache[4] = sh;\n\t\t\t\t\tcache[5] = dx;\n\t\t\t\t\tcache[6] = dy;\n\t\t\t\t\tcache[7] = dw;\n\t\t\t\t\tcache[8] = dh;\n\t\t\t\t\tcache.render = true;\n\t\t\t\t} else {\n\t\t\t\t\tcache.render = false;\n\t\t\t\t}\n\n\t\t\t\tsx += sw;\n\t\t\t\tdx += dw;\n\t\t\t}\n\t\t\tsy += sh;\n\t\t\tdy += dh;\n\n\t\t\tmarginTop = 0;\n\t\t}\n\t};\n\n\tthis.getImage = function () {\n\t\treturn this._img;\n\t};\n\n\tthis.setImage = function (img) {\n\t\tthis._renderCacheKey = {};\n\n\t\tif (this._imgUrlChangeListenerFn) {\n\t\t\tthis._img.removeListener('urlChanged', this._imgUrlChangeListenerFn);\n\t\t\tthis._imgUrlChangeListenerFn = null;\n\t\t}\n\n\t\tvar autoSized = false;\n\t\tvar sw, sh, iw, ih, bounds;\n\t\tvar opts = this._opts;\n\n\t\tif (typeof img == 'string') {\n\t\t\tbounds = resourceLoader.getMap()[img];\n\t\t\tif (bounds) {\n\t\t\t\tiw = bounds.w + bounds.marginLeft + bounds.marginRight;\n\t\t\t\tih = bounds.h + bounds.marginTop + bounds.marginBottom;\n\t\t\t}\n\t\t} else if (img instanceof Image && img.isLoaded()) {\n\t\t\tbounds = img.getBounds();\n\t\t\tiw = bounds.width + bounds.marginLeft + bounds.marginRight;\n\t\t\tih = bounds.height + bounds.marginTop + bounds.marginBottom;\n\t\t}\n\n\t\tif (!bounds) {\n\t\t\tif (typeof img == 'string') {\n\t\t\t\timg = new Image({url: img});\n\t\t\t}\n\n\t\t\tif (img) {\n\t\t\t\tif (!img.isError()) {\n\t\t\t\t\timg.doOnLoad(this, 'setImage', img);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (opts.autoSize && this._scaleMethod == 'stretch' && !((opts.width || opts.layoutWidth) && (opts.height || opts.layoutHeight))) {\n\t\t\tautoSized = true;\n\t\t\tif (this.style.fixedAspectRatio) {\n\t\t\t\tthis.style.enforceAspectRatio(iw, ih);\n\t\t\t} else {\n\t\t\t\tthis.style.width = iw;\n\t\t\t\tthis.style.height = ih;\n\t\t\t}\n\t\t}\n\n\t\tthis._opts.image = this._img = (typeof img == 'string') ? new Image({url: img}) : img;\n\n\t\tif (this._img) {\n\t\t\tif (this._isSlice) {\n\t\t\t\tthis.updateSlices();\n\n\t\t\t\tvar sourceSlicesHor = this._sourceSlicesHor;\n\t\t\t\tvar sourceSlicesVer = this._sourceSlicesVer;\n\t\t\t\tif (sourceSlicesHor) {\n\t\t\t\t\tsw = sourceSlicesHor[0] + sourceSlicesHor[1] + sourceSlicesHor[2];\n\t\t\t\t\tvar sourceScaleX = iw / sw;\n\t\t\t\t\tsourceSlicesHor[0] = sourceSlicesHor[0] * sourceScaleX - bounds.marginLeft;\n\t\t\t\t\tsourceSlicesHor[1] *= sourceScaleX;\n\t\t\t\t\tsourceSlicesHor[2] = sourceSlicesHor[2] * sourceScaleX - bounds.marginRight;\n\t\t\t\t}\n\t\t\t\tif (sourceSlicesVer) {\n\t\t\t\t\tsh = sourceSlicesVer[0] + sourceSlicesVer[1] + sourceSlicesVer[2];\n\t\t\t\t\tvar sourceScaleY = ih / sh;\n\t\t\t\t\tsourceSlicesVer[0] = sourceSlicesVer[0] * sourceScaleY - bounds.marginTop;\n\t\t\t\t\tsourceSlicesVer[1] *= sourceScaleY;\n\t\t\t\t\tsourceSlicesVer[2] = sourceSlicesVer[2] * sourceScaleY - bounds.marginBottom;\n\t\t\t\t}\n\t\t\t\t[0, 2].forEach(function(num) {\n\t\t\t\t\tif (sourceSlicesHor && sourceSlicesHor[num] < 0) {\n\t\t\t\t\t\tsourceSlicesHor[1] += sourceSlicesHor[num];\n\t\t\t\t\t\tsourceSlicesHor[num] = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (sourceSlicesVer && sourceSlicesVer[num] < 0) {\n\t\t\t\t\t\tsourceSlicesVer[1] += sourceSlicesVer[num];\n\t\t\t\t\t\tsourceSlicesVer[num] = 0;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (opts && opts.autoSize && !autoSized) {\n\t\t\t\tthis._img.doOnLoad(this, 'autoSize');\n\t\t\t}\n\n\t\t\tthis._img.doOnLoad(this, 'needsRepaint');\n\n\t\t\tthis._imgUrlChangeListenerFn = bind(this, 'setImage', this._img);\n\t\t\tthis._img.on('urlChanged', this._imgUrlChangeListenerFn);\n\t\t}\n\t};\n\n\tthis.doOnLoad = function () {\n\t\tif (arguments.length == 1) {\n\t\t\tthis._img.doOnLoad(this, arguments[0]);\n\t\t} else {\n\t\t\tthis._img.doOnLoad.apply(this._img, arguments);\n\t\t}\n\t\treturn this;\n\t};\n\n\tthis.autoSize = function () {\n\t\tif (this._img && this._img.isLoaded()) {\n\t\t\tthis.style.width = this._img.getWidth() || this._opts.width;\n\t\t\tthis.style.height = this._img.getHeight() || this._opts.height;\n\t\t}\n\t};\n\n\tthis.getOrigWidth = this.getOrigW = function () {\n\t\treturn this._img.getOrigW();\n\t};\n\n\tthis.getOrigHeight = this.getOrigH = function () {\n\t\treturn this._img.getOrigH();\n\t};\n\n\tfunction renderCoverOrContain(ctx, opts) {\n\t\tif (!this._img) { return; }\n\n\t\tvar max = Math.max;\n\t\tvar min = Math.min;\n\t\tvar s = this.style;\n\t\tvar w = s.width;\n\t\tvar h = s.height;\n\t\tvar cachedKey = this._renderCacheKey;\n\t\tvar cache = this._renderCache || (this._renderCache = {x: 0, y: 0, w: 0, h: 0});\n\t\tif (cachedKey.width != w || cachedKey.height != h) {\n\t\t\tcachedKey.width = w;\n\t\t\tcachedKey.height = h;\n\n\t\t\tvar bounds = this._img.getBounds();\n\t\t\tvar marginLeft = bounds.marginLeft;\n\t\t\tvar marginRight = bounds.marginRight;\n\t\t\tvar marginTop = bounds.marginTop;\n\t\t\tvar marginBottom = bounds.marginBottom;\n\t\t\tvar sw = bounds.width;\n\t\t\tvar sh = bounds.height;\n\t\t\tvar ow = sw + marginLeft + marginRight;\n\t\t\tvar oh = sh + marginTop + marginBottom;\n\t\t\tvar scale = 1;\n\t\t\tvar targetRatio = ow / oh;\n\t\t\tvar ratio = w / h;\n\n\t\t\tvar isCover = this._scaleMethod == 'cover';\n\t\t\tif (isCover ? ratio > targetRatio : ratio < targetRatio) {\n\t\t\t\tscale = w / ow;\n\t\t\t} else {\n\t\t\t\tscale = h / oh;\n\t\t\t}\n\n\t\t\tvar dw = sw * scale;\n\t\t\tvar dh = sh * scale;\n\t\t\tvar fw = ow * scale;\n\t\t\tvar fh = oh * scale;\n\n\t\t\tcache.x = this._align == 'left'\n\t\t\t\t? marginLeft * scale\n\t\t\t\t: this._align == 'right'\n\t\t\t\t\t? w - (sw + marginRight) * scale\n\t\t\t\t\t: (w - dw) / 2;\n\t\t\tcache.y = this._verticalAlign == 'top'\n\t\t\t\t? marginTop * scale\n\t\t\t\t: this._verticalAlign == 'bottom'\n\t\t\t\t\t? h - (sh + marginBottom) * scale\n\t\t\t\t\t: (h - dh) / 2;\n\n\t\t\tcache.w = dw;\n\t\t\tcache.h = dh;\n\t\t\tcache.sx = bounds.x;\n\t\t\tcache.sy = bounds.y;\n\t\t\tcache.sw = sw;\n\t\t\tcache.sh = sh;\n\n\t\t\tif (isCover) {\n\t\t\t\tif (fh > h) {\n\t\t\t\t\tif (this._verticalAlign == 'bottom') {\n\t\t\t\t\t\tcache.y = max(0, h - marginBottom * scale - dh);\n\t\t\t\t\t\tcache.h = min(dh, h - marginBottom * scale);\n\t\t\t\t\t\tcache.sy += max(0, sh - cache.h / scale);\n\t\t\t\t\t\tcache.sh = cache.h / scale;\n\t\t\t\t\t} else if (this._verticalAlign == 'top') {\n\t\t\t\t\t\tcache.y = marginTop * scale;\n\t\t\t\t\t\tcache.h = min(dh, h - cache.y);\n\t\t\t\t\t\tcache.sh = cache.h / scale;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcache.y = max(0, (h - dh) / 2);\n\t\t\t\t\t\tcache.h = min(dh, h);\n\t\t\t\t\t\tcache.sh = cache.h / scale;\n\t\t\t\t\t\tcache.sy = max(cache.sy, cache.sy + (sh - cache.sh) / 2);\n\t\t\t\t\t}\n\t\t\t\t} else if (fw > w) {\n\t\t\t\t\tif (this._align == 'right') {\n\t\t\t\t\t\tcache.x = max(0, w - marginRight * scale - dw);\n\t\t\t\t\t\tcache.w = min(dw, w - marginRight * scale);\n\t\t\t\t\t\tcache.sx += max(0, sw - cache.w / scale);\n\t\t\t\t\t\tcache.sw = cache.w / scale;\n\t\t\t\t\t} else if (this._align == 'left') {\n\t\t\t\t\t\tcache.x = marginLeft * scale;\n\t\t\t\t\t\tcache.w = min(dw, w - cache.x);\n\t\t\t\t\t\tcache.sw = cache.w / scale;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcache.x = max(0, (w - dw) / 2);\n\t\t\t\t\t\tcache.w = min(dw, w);\n\t\t\t\t\t\tcache.sw = cache.w / scale;\n\t\t\t\t\t\tcache.sx = max(cache.sx, cache.sx + (sw - cache.sw) / 2);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._img.render(ctx, cache.sx, cache.sy, cache.sw, cache.sh, cache.x, cache.y, cache.w, cache.h);\n\n\t\tif (this.debug) {\n\t\t\tctx.strokeStyle = debugColors[0];\n\t\t\tctx.strokeRect(0, 0, s.width, s.height);\n\t\t}\n\t}\n\n\tvar renderFunctions = {\n\t\t'none': function (ctx, opts) {\n\t\t\tthis._img && this._img.render(ctx, 0, 0);\n\t\t},\n\t\t'stretch': function (ctx, opts) {\n\t\t\tvar s = this.style;\n\t\t\tvar w = s.width;\n\t\t\tvar h = s.height;\n\t\t\tthis._img && this._img.render(ctx, 0, 0, w, h);\n\t\t},\n\t\t'contain': renderCoverOrContain,\n\t\t'cover': renderCoverOrContain,\n\t\t'tile': function (ctx, opts) {\n\t\t\tif (!this._img) { return; }\n\n\t\t\tvar s = this.style;\n\t\t\tvar w = s.width;\n\t\t\tvar h = s.height;\n\n\t\t\tvar bounds = this._img.getBounds();\n\t\t\tvar iw = bounds.width;\n\t\t\tvar ih = bounds.height;\n\n\t\t\tvar x = 0, y = 0;\n\n\t\t\tif (this.rows) {\n\t\t\t\tvar targetHeight = h / this.rows;\n\t\t\t\tvar targetRatio = targetHeight / ih;\n\t\t\t\tvar targetWidth = iw * targetRatio;\n\t\t\t\tfor (var i = 0; i < this.rows; i++) {\n\t\t\t\t\twhile (x < w) {\n\t\t\t\t\t\tthis._img.render(ctx, x, y, targetWidth, targetHeight);\n\t\t\t\t\t\tif (this.debug) {\n\t\t\t\t\t\t\tctx.strokeStyle = debugColors[i % 3];\n\t\t\t\t\t\t\tctx.strokeRect(x + 0.5, y + 0.5, targetWidth - 1, targetHeight - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tx += targetWidth;\n\t\t\t\t\t}\n\t\t\t\t\ty += targetHeight;\n\t\t\t\t\tx = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.columns) {\n\t\t\t\tvar targetWidth = w / this.columns;\n\t\t\t\tvar targetRatio = targetWidth / iw;\n\t\t\t\tvar targetHeight = ih * targetRatio;\n\t\t\t\tfor (var i = 0; i < this.columns; i++) {\n\t\t\t\t\twhile (y < h) {\n\t\t\t\t\t\tthis._img.render(ctx, x, y, targetWidth, targetHeight);\n\t\t\t\t\t\tif (this.debug) {\n\t\t\t\t\t\t\tctx.strokeStyle = debugColors[i % 3];\n\t\t\t\t\t\t\tctx.strokeRect(x + 0.5, y + 0.5, targetWidth - 1, targetHeight - 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ty += targetHeight;\n\t\t\t\t\t}\n\t\t\t\t\tx += targetWidth;\n\t\t\t\t\ty = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t'slice': function (ctx, opts) {\n\t\t\tif (!this._img) { return; }\n\n\t\t\tvar s = this.style;\n\t\t\tvar w = s.width;\n\t\t\tvar h = s.height;\n\t\t\tvar scale = s.scale;\n\t\t\tvar cachedKey = this._renderCacheKey;\n\t\t\tif (cachedKey.width != w || cachedKey.height != h || cachedKey.absScale != scale) {\n\t\t\t\tcachedKey.width = w;\n\t\t\t\tcachedKey.height = h;\n\t\t\t\tcachedKey.absScale = scale;\n\t\t\t\tthis._computeSlices(w, h, scale);\n\t\t\t}\n\n\t\t\tfor (var i = 0; i < 9; i++) {\n\t\t\t\tthis._drawSlice(ctx, this._sliceCache[i], i);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis._drawSlice = function (ctx, sliceData, i) {\n\t\tif (!sliceData.render || (!this._opts.renderCenter && (i == 4))) { return; }\n\t\tctx.drawImage.apply(ctx, sliceData);\n\t\tif (this.debug) {\n\t\t\tctx.strokeStyle = debugColors[i % 3];\n\t\t\tctx.strokeRect(sliceData[5] + 0.5, sliceData[6] + 0.5,\n\t\t\t\tsliceData[7] - 1, sliceData[8] - 1);\n\t\t}\n\t};\n\n\tvar debugColors = ['#FF0000', '#00FF00', '#0000FF'];\n\n\tthis.getTag = function () {\n\t\tvar url = this._img && (this._img.getOriginalURL() || this._img._map && this._img._map.url);\n\t\tif (url) {\n\t\t\tvar match = url.match(/[^\\/]+$/);\n\t\t\tif (match) {\n\t\t\t\turl = match[0];\n\t\t\t}\n\n\t\t\turl = ':' + url.substring(0, 16);\n\t\t}\n\n\t\treturn 'ImageScaleView' + this.uid + (url || '');\n\t};\n});\n","pre":true},"modules/devkit-core/modules/timestep/src/ui/ScrollView.js":{"path":"modules/devkit-core/modules/timestep/src/ui/ScrollView.js","friendlyPath":"ui.ScrollView","directory":"modules/devkit-core/modules/timestep/src/ui/","filename":"ScrollView.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/**\n * @class ui.ScrollView;\n *\n * @doc http://doc.gameclosure.com/api/ui-scrollview.html\n * @docsrc https://github.com/gameclosure/doc/blob/master/api/ui/scrollview.md\n */\njsio('import animate');\njsio('import device');\n\njsio('import event.input.dispatch as input');\njsio('import event.input.InputEvent as InputEvent');\n\njsio('import math.geom.Rect as Rect');\njsio('import math.geom.Point as Point');\njsio('import math.geom.Circle as Circle');\njsio('import math.geom.intersect as intersect');\n\njsio('import ui.View as View');\njsio('import ui.backend.ReflowManager as ReflowManager');\n\nvar _reflowMgr = ReflowManager.get();\n\nvar DEBUG = true;\nvar USE_CLIPPING = false;\n// var USE_CLIPPING = !device.useDOM && !device.isMobile;\n\nif (DEBUG) {\n\tvar _debug = {\n\t\tbounds: []\n\t};\n}\n/*function customEaseOut(x) {\n\tvar x = (1 - x);\n\tx *= x;\n\treturn 1 - x * x;\n}*/\n\n/**\n * @extends ui.View\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_ScrollView=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_ScrollView(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_modules_timestep_src_ui_ScrollView(){return this.init&&this.init.apply(this,arguments)},View, function (supr) {\n\n\tthis.tag = \"ScrollView\";\n\n\tif (USE_CLIPPING) {\n\n\t\t// extend the default backing ctor\n\t\tthis.BackingCtor=__class__;this.BackingCtor=this.BackingCtor(function this_BackingCtor(){return this.init&&this.init.apply(this,arguments)},View.prototype.BackingCtor, function () {\n\n\t\t\tfunction clippedWrapRender(contentView, backing, ctx, opts) {\n\t\t\t\tif (!backing.visible) { return; }\n\n\t\t\t\t// non-native case only\n\t\t\t\tif (backing._needsSort) { backing._needsSort = false; backing._subviews.sort(); }\n\n\t\t\t\tctx.save();\n\t\t\t\tctx.translate(backing.x + backing.anchorX, backing.y + backing.anchorY);\n\n\t\t\t\tif (backing.r) { ctx.rotate(backing.r); }\n\n\t\t\t\t// clip this render to be within its view;\n\t\t\t\tif (backing.scale != 1) { ctx.scale(backing.scale, backing.scale); }\n\t\t\t\tif (backing.opacity != 1) { ctx.globalAlpha *= backing.opacity; }\n\n\t\t\t\tctx.translate(-backing.anchorX, -backing.anchorY);\n\n\t\t\t\t// if (backing._circle) { ctx.translate(-backing.width / 2, -backing.height / 2); }\n\n\t\t\t\tif (backing.clip) { ctx.clipRect(0, 0, backing.width, backing.height); }\n\t\t\t\t// var filters = this.getFilters();\n\t\t\t\t// ctx.setFilters(filters);\n\n\t\t\t\ttry {\n\t\t\t\t\tif (backing.backgroundColor) {\n\t\t\t\t\t\tctx.fillStyle = backing.backgroundColor;\n\t\t\t\t\t\tctx.fillRect(0, 0, backing.width, backing.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tbacking._view.render && backing._view.render(ctx, opts);\n\n\t\t\t\t\tvar viewport = opts.viewport;\n\t\t\t\t\tvar subviews = backing._subviews;\n\n\t\t\t\t\tvar i = 0, subview;\n\t\t\t\t\twhile (subview = subviews[i++]) {\n\t\t\t\t\t\tif (subview == contentView) {\n\t\t\t\t\t\t\tclippedWrapRender(contentView, subview.__view, ctx, opts);\n\n\t\t\t\t\t\t\t// restore the old viewport it was changed\n\t\t\t\t\t\t\topts.viewport = viewport;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar pos = subview.getPosition(viewport.src);\n\t\t\t\t\t\t\tgetBoundingRectangle(pos);\n\n\t\t\t\t\t\t\tif (intersect.isRectAndRect(pos, viewport)) {\n\t\t\t\t\t\t\t\tclippedWrapRender(contentView, subview.__view, ctx, opts);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (DEBUG) {\n\t\t\t\t\t\t\t\t_debug.bounds.push(pos);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t \tlogger.ERROR&&console.error(\"ERROR\",\"ui.ScrollView\",backing._view, e.message, e.stack);\n\t\t\t\t} finally {\n\t\t\t\t\t// ctx.clearFilters();\n\t\t\t\t\tctx.restore();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.wrapRender = function (ctx, opts) {\n\n\t\t\t\tclippedWrapRender(this._view._contentView, this, ctx, opts);\n\n\t\t\t\tif (DEBUG) {\n\t\t\t\t\tvar viewport = opts.viewport;\n\n\t\t\t\t\tctx.save();\n\t\t\t\t\tctx.translate(this.x + this.anchorX, this.y + this.anchorY);\n\t\t\t\t\tif (this.r) { ctx.rotate(this.r); }\n\t\t\t\t\tif (this.scale != 1) { ctx.scale(this.scale, this.scale); }\n\t\t\t\t\tctx.translate(-this.anchorX, -this.anchorY);\n\n\t\t\t\t\tctx.fillStyle = 'rgba(255, 0, 0, 0.2)';\n\t\t\t\t\tctx.fillRect(viewport.x, viewport.y, viewport.width, viewport.height);\n\n\t\t\t\t\tctx.translate(-viewport.x, -viewport.y);\n\n\t\t\t\t\tctx.fillStyle = 'rgba(255, 255, 255, 0.2)';\n\t\t\t\t\tfor (var i = 0, bounds; (bounds = _debug.bounds[i]); ++i) {\n\t\t\t\t\t\tctx.fillRect(bounds.x, bounds.y, bounds.width, bounds.height);\n\t\t\t\t\t}\n\t\t\t\t\t_debug.bounds = [];\n\t\t\t\t\tctx.restore();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tvar defaults = {\n\t\toffsetX: 0,\n\t\toffsetY: 0,\n\t\tscrollY: true,\n\t\tscrollX: true,\n\t\tclip: true,\n\t\tbounce: true,\n\t\tbounceRadius: 50, // [number] or 'bounds'\n\t\tdrag: true,\n\t\tinertia: true,\n\t\tdragRadius: Math.min(device.width, device.height) / 32,\n\t\tsnapPixels: undefined,\n\t\tuseLayoutBounds: false,\n\t\tlayout: 'box'\n\t};\n\n\tthis.init = function (opts) {\n\n\t\topts = merge(opts, defaults);\n\n\t\topts['dom:noCanvas'] = true;\n\n\t\tthis._acceleration = 15;\n\n\t\tthis._animState = {\n\t\t\tlastDelta: 0,\n\t\t\toffset: 0\n\t\t};\n\n\t\tthis._snapPixels = 1;\n\n\t\tthis._contentView = new View({\n\t\t\tx: opts.offsetX,\n\t\t\ty: opts.offsetY,\n\t\t\tinfinite: true,\n\t\t\ttag: 'ContentView',\n\t\t\tlayout: 'box',\n\t\t\tlayoutWidth: '100%',\n\t\t\tlayoutHeight: '100%'\n\t\t});\n\n\t\tthis._bounceRadius = opts.bounceRadius;\n\t\tthis._scrollBounds = {\n\t\t\tminX: -Number.MAX_VALUE,\n\t\t\tminY: -Number.MAX_VALUE,\n\t\t\tmaxX: Number.MAX_VALUE,\n\t\t\tmaxY: Number.MAX_VALUE\n\t\t};\n\n\t\tthis._viewport = new Rect();\n\t\tthis._viewport.src = this._contentView;\n\n\t\tsupr(this, 'init', [opts]);\n\t\tsupr(this, 'addSubview', [this._contentView]);\n\n\t\t// this.__layout = this._contentView.__layout;\n\t}\n\n\tthis.updateOpts = function (opts) {\n\t\tsupr(this, 'updateOpts', arguments);\n\n\t\tif ('useContentBounds' in opts) {\n\t\t\tif (opts.useContentBounds) {\n\t\t\t\tthis._contentView.style.layoutHeight = 'wrapContent';\n\t\t\t\tthis._contentView.style.layoutWidth = 'wrapContent';\n\t\t\t\tthis._contentView.subscribe('resize', this, '_updateContentBounds');\n\t\t\t\tthis._updateContentBounds();\n\t\t\t} else {\n\t\t\t\tthis._contentView.unsubscribe('resize', this, '_updateContentBounds');\n\t\t\t}\n\t\t}\n\n\t\tif ('scrollBounds' in opts) {\n\t\t\tthis.setScrollBounds(opts.scrollBounds);\n\t\t}\n\n\t\tif ('bounceRadius' in opts) {\n\t\t\tthis._bounceRadius = opts.bounceRadius;\n\t\t}\n\n\t\treturn opts;\n\t};\n\n\tthis._updateContentBounds = function () {\n\n\t\tif (!this._opts.useContentBounds) { return; }\n\n\t\tvar bounds = this._scrollBounds;\n\t\tvar s = this._contentView.style;\n\t\tbounds.minX = s.x;\n\t\tbounds.maxX = s.x + s.width + this.style.padding.right;\n\t\tbounds.minY = s.y;\n\t\tbounds.maxY = s.y + s.height + this.style.padding.bottom;\n\t};\n\n\tthis.buildView = function () {\n\t\tthis._snapPixels = this._opts.snapPixels || 1 / this.getPosition().scale;\n\t};\n\n\tthis.addSubview = function (view) {\n\t\tthis._contentView.addSubview(view);\n\t\tthis._updateContentBounds();\n\t};\n\n\tthis.removeSubview = function (view) {\n\t\tthis._contentView.removeSubview(view);\n\t\tthis._updateContentBounds();\n\t};\n\n\tthis.removeAllSubviews = function () {\n\t\tthis._contentView.removeAllSubviews();\n\t};\n\n\tthis.addFixedView = function (view) { return supr(this, 'addSubview', [view]); };\n\tthis.removeFixedView = function (view) { return supr(this, 'removeSubview', [view]); };\n\n\tvar PI_2 = Math.PI / 2;\n\n\tthis.getStyleBounds = function () {\n\t\tvar bounds = this._scrollBounds;\n\t\tvar minY = -bounds.maxY;\n\t\tvar maxY = -bounds.minY < minY ? minY : -bounds.minY;\n\t\tvar minX = -bounds.maxX;\n\t\tvar maxX = -bounds.minX < minX ? minX : -bounds.minX;\n\t\treturn {\n\t\t\tminY: Math.min(minY + this.style.height, maxY),\n\t\t\tmaxY: maxY,\n\t\t\tminX: Math.min(minX + this.style.width, maxX),\n\t\t\tmaxX: maxX\n\t\t};\n\t};\n\n\tthis.getOffset = function () { return new Point(this._contentView.style); };\n\tthis.getOffsetX = function () { return this._contentView.style.x; };\n\tthis.getOffsetY = function () { return this._contentView.style.y; };\n\n\tthis.setOffset = function (x, y) {\n\t\tvar style = this._contentView.style,\n\t\t\tdelta = {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0\n\t\t\t};\n\n\t\tvar bounds = this.getStyleBounds();\n\t\t//threshold for which if the current bounce radius minus the current\n\t\t//bounced amount is under, the bounce will be ended\n\t\tvar BOUNCE_THRESHOLD = 1;\n\t\tif (typeof x == 'number') {\n\t\t\tif (this._isBouncing) {\n\t\t\t\t// do nothing\n\t\t\t} else if (this._canBounce) {\n\t\t\t\tif (x < bounds.minX) {\n\t\t\t\t\tvar temp = (bounds.minX - x) / this._bounceRadius;\n\t\t\t\t\tx = bounds.minX - Math.atan(temp) * this._bounceRadius / PI_2;\n\t\t\t\t\tif (this._bounceRadius - (bounds.minX - x) < BOUNCE_THRESHOLD) {\n\t\t\t\t\t\tthis._endBounce();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tif (x > bounds.maxX) {\n\t\t\t\t\tvar temp = (x - bounds.maxX) / this._bounceRadius;\n\t\t\t\t\tx = bounds.maxX + Math.atan(temp) * this._bounceRadius / PI_2;\n\t\t\t\t\tif (this._bounceRadius - x < BOUNCE_THRESHOLD) {\n\t\t\t\t\t\tthis._endBounce();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (x < bounds.minX) { x = bounds.minX; }\n\t\t\t\tif (x > bounds.maxX) { x = bounds.maxX; }\n\t\t\t}\n\n\t\t\tif (x != style.x) {\n\t\t\t\tdelta.x = x - style.x;\n\t\t\t\tstyle.x = (x / this._snapPixels | 0) * this._snapPixels;\n\t\t\t}\n\t\t}\n\n\t\tif (typeof y == 'number') {\n\t\t\tif (this._isBouncing) {\n\t\t\t\t// do nothing\n\t\t\t} else if (this._canBounce) {\n\t\t\t\tif (y < bounds.minY) {\n\t\t\t\t\tvar temp = (bounds.minY - y) / this._bounceRadius;\n\t\t\t\t\ty = bounds.minY - Math.atan(temp) * this._bounceRadius / PI_2;\n\t\t\t\t\tif (this._bounceRadius - (bounds.minY - y) < BOUNCE_THRESHOLD) {\n\t\t\t\t\t\tthis._endBounce();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (y > bounds.maxY) {\n\t\t\t\t\tvar temp = (y - bounds.maxY) / this._bounceRadius;\n\t\t\t\t\ty = bounds.maxY + Math.atan(temp) * this._bounceRadius / PI_2;\n\t\t\t\t\tif (this._bounceRadius - y < BOUNCE_THRESHOLD) {\n\t\t\t\t\t\tthis._endBounce();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (y < bounds.minY) { y = bounds.minY; }\n\t\t\t\tif (y > bounds.maxY) { y = bounds.maxY; }\n\t\t\t}\n\n\t\t\tif (y != style.y) {\n\t\t\t\tdelta.y = y - style.y;\n\t\t\t\tstyle.y = (y / this._snapPixels | 0) * this._snapPixels;\n\t\t\t}\n\t\t}\n\n\t\tthis.publish('Scrolled', delta);\n\t};\n\n\tthis.isScrolling = function () { return this.isDragging() || this._anim && this._anim.hasFrames(); };\n\n\tthis.stopScrolling = function () {\n\t\tthis._anim && this._anim.now({}, 1);\n\t};\n\n\tthis.onInputStart = function (evt, pt) {\n\t\tif (this._opts.drag && (this._opts.scrollX || this._opts.scrollY)) {\n\t\t\tthis.startDrag({radius: this._opts.dragRadius * this._snapPixels});\n\n\t\t\tif (this._anim && this._anim.hasFrames()) {\n\t\t\t\tthis._anim.clear();\n\t\t\t}\n\n\t\t\tevt.cancel();\n\t\t}\n\t};\n\n\tthis.onDragStart = function (dragEvt) {\n\t\tinput.clearOverState(dragEvt.id);\n\n\t\tthis._contentView.getInput().blockEvents = true;\n\t\tthis._startBounce();\n\t\tthis._animState.offset = this.getOffset();\n\t\tthis._anim = animate(this._animState).clear();\n\t};\n\n\tthis.scrollData = [];\n\tthis.onDrag = function (dragEvt, moveEvt, delta) {\n\t\tvar state = this._animState;\n\t\tstate.dt = delta.t;\n\t\tstate.lastDelta = delta;\n\n\t\tthis.scrollData.push(delta);\n\t\tif (!this._opts.scrollY) { delta.y = 0; }\n\t\tif (!this._opts.scrollX) { delta.x = 0; }\n\n\t\tthis.setOffset(state.offset.x += delta.x, state.offset.y += delta.y);\n\t\tmoveEvt.cancel();\n\t};\n\n\tthis.onDragStop = function (dragEvt, selectEvt) {\n\t\tthis._contentView.getInput().blockEvents = false;\n\n\t\tif (this._opts.inertia) {\n\n\t\t\t//how much of the current event\n\t\t\t//should be favored over older events in the running\n\t\t\t//weighted average being computed\n\t\t\tvar WEIGHT = .5;\n\t\t\t//how much to deccelerate when\n\t\t\t//scrolling\n\t\t\tvar ACCEL = -.45;\n\t\t\t//multiplier for mapping the calculated time to\n\t\t\t//a more reasonable real time for scrolling\n\t\t\tvar TIME_MULTIPLIER = 8;\n\n\t\t\tvar avgDelta = new Point(0, 0);\n\t\t\tfor (var i in this.scrollData) {\n\t\t\t\tavgDelta.x = (avgDelta.x * (1 - WEIGHT)) + (this.scrollData[i].x * WEIGHT);\n\t\t\t\tavgDelta.y = (avgDelta.y * (1 - WEIGHT)) + (this.scrollData[i].y * WEIGHT);\n\t\t\t}\n\n\t\t\tthis.scrollData = [];\n\n\t\t\tvar delta = new Point(avgDelta).scale(.7);\n\t\t\tvar offset = this._animState.offset;\n\n\t\t\tvar velocity = delta.getMagnitude();\n\t\t\t//calculate the travel time of the scroll\n\t\t\t//vf = vi + at -> t = vf - vi / a\n\t\t\tvar time = - velocity / ACCEL;\n\t\t\t//vf^2 = vi^2 + 2ax -> x = - (vi^2) / (2 *a)\n\t\t\tvar distance = .5 * - (velocity * velocity) / ACCEL;\n\t\t\tvar tempDelta = delta;\n\t\t\ttempDelta = tempDelta.normalize();\n\t\t\t//distance to travel from start to finish\n\t\t\t//in the x and y directions\n\t\t\tdelta.x = tempDelta.x * distance;\n\t\t\tdelta.y = tempDelta.y * distance;\n\n\t\t\tvar offset = this._animState.offset;\n\t\t\tvar distance = delta.getMagnitude();\n\n\t\t\t// if we overshot the bounds, don't waste time animating the acceleration.\n\t\t\tvar bounds = this.getStyleBounds();\n\t\t\tvar target = new Point(offset).add(delta);\n\t\t\tif (target.y < bounds.minY - this._bounceRadius) {\n\t\t\t\tif (offset.y < bounds.minY) {\n\t\t\t\t\tdistance = 0;\n\t\t\t\t} else {\n\t\t\t\t\tdistance = delta.getMagnitude();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (target.y > bounds.maxY + this._bounceRadius) {\n\t\t\t\tif (offset.y > bounds.maxY) {\n\t\t\t\t\tdistance = 0;\n\t\t\t\t} else {\n\t\t\t\t\tdistance = delta.getMagnitude();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (target.x < bounds.minX - this._bounceRadius) {\n\t\t\t\tif (offset.x < bounds.minX) {\n\t\t\t\t\tdistance = 0;\n\t\t\t\t} else {\n\t\t\t\t\tdistance = delta.getMagnitude();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (target.x > bounds.maxX + this._bounceRadius) {\n\t\t\t\tif (offset.x > bounds.maxX) {\n\t\t\t\t\tdistance = 0;\n\t\t\t\t} else {\n\t\t\t\t\tdistance = delta.getMagnitude();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (distance) {\n\t\t\t\tthis._anim.now(bind(this, function (tt, t) {\n\t\t\t\t\tthis.setOffset(\n\t\t\t\t\t\toffset.x + delta.x * tt,\n\t\t\t\t\t\toffset.y + delta.y * tt);\n\t\t\t\t}), time * TIME_MULTIPLIER, animate.easeOut).then(bind(this, function () {\n\t\t\t\t\tthis._endBounce(offset);\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tthis._endBounce(offset);\n\t\t\t}\n\t\t}\n\t};\n\n\n\tthis._startBounce = function () {\n\t\tthis._isBouncing = false;\n\t\tif (this._opts.inertia && this._opts.bounce) {\n\t\t\tthis._canBounce = true;\n\t\t}\n\t};\n\n\tthis._endBounce = function () {\n\t\tvar offset = this.getOffset();\n\t\tvar bounds = this.getStyleBounds();\n\n\t\tvar dx = 0;\n\t\tvar dy = 0;\n\n\t\tvar ty = offset.y, tx = offset.x;\n\t\tif (offset.y < bounds.minY) {\n\t\t\tty = bounds.minY;\n\t\t} else if (offset.y > bounds.maxY) {\n\t\t\tty = bounds.maxY;\n\t\t}\n\n\t\tif (offset.x < bounds.minX) {\n\t\t\ttx = bounds.minX;\n\t\t} else if (offset.x > bounds.maxX) {\n\t\t\ttx = bounds.maxX;\n\t\t}\n\n\t\tdy = ty - offset.y;\n\t\tdx = tx - offset.x;\n\n\t\tif (dy === 0 && dx === 0) { return; }\n\n\t\tthis._isBouncing = true;\n\t\tthis._anim.now(bind(this, function (tt, t) {\n\t\t\tthis.setOffset(\n\t\t\t\toffset.x + dx * tt,\n\t\t\t\toffset.y + dy * tt);\n\t\t}), 500, animate.easeInOut).then(bind(this, function () {\n\t\t\tthis._canBounce = false;\n\t\t\tthis._isBouncing = false;\n\n\t\t\t// Ensure that after the bounce an update to the bounds has not\n\t\t\t// been ignored.\n\t\t\tthis.scrollTo(undefined, undefined, 0);\n\t\t}));\n\t};\n\n\tthis.setScrollBounds = function (bounds) {\n\t\tif (bounds) {\n\t\t\tif ('minX' in bounds) { this._scrollBounds.minX = bounds.minX || 0; }\n\t\t\tif ('minY' in bounds) { this._scrollBounds.minY = bounds.minY || 0; }\n\t\t\tif ('maxX' in bounds) { this._scrollBounds.maxX = bounds.maxX || 0; }\n\t\t\tif ('maxY' in bounds) { this._scrollBounds.maxY = bounds.maxY || 0; }\n\n\t\t\t// If not in the middle of a bounce animation,\n\t\t\tif (!this._canBounce) {\n\t\t\t\t// Scroll to current position with duration 0. If the bounds have\n\t\t\t\t// changed, this will move the scroll position immediately to a valid\n\t\t\t\t// position.\n\t\t\t\tthis.scrollTo(undefined, undefined, 0);\n\t\t\t}\n\t\t}\n\t};\n\n\tthis.getScrollBounds = function () { return this._scrollBounds; }\n\n\tthis.addOffset = function (x, y) {\n\t\tthis.setOffset(\n\t\t\t\tx != undefined && x != null && (this._contentView.style.x + x),\n\t\t\t\ty != undefined && y != null && (this._contentView.style.y + y)\n\t\t\t);\n\t}\n\n\tthis.getContentView = function () { return this._contentView; }\n\n\t/* @deprecated */\n\tthis.getFullWidth = function () { return this._contentView.style.width; }\n\t/* @deprecated */\n\tthis.getFullHeight= function () { return this._contentView.style.height; }\n\n\tfunction getBoundingRectangle(pos) {\n\t\tif (!pos.r) { return; }\n\n\t\tvar w = pos.width;\n\t\tvar h = pos.height;\n\t\tvar cr = Math.cos(pos.r);\n\t\tvar sr = Math.sin(pos.r);\n\n\t\tvar x1 = pos.x;\n\t\tvar y1 = pos.y;\n\n\t\tvar x = w;\n\t\tvar y = 0;\n\n\t\tvar x2 = x1 + x * cr - y * sr;\n\t\tvar y2 = y1 + x * sr + y * cr;\n\n\t\ty += h;\n\n\t\tvar x3 = x1 + x * cr - y * sr;\n\t\tvar y3 = y1 + x * sr + y * cr;\n\n\t\tx -= w;\n\n\t\tvar x4 = x1 + x * cr - y * sr;\n\t\tvar y4 = y1 + x * sr + y * cr;\n\n\t\tpos.x = Math.min(x1, x2, x3, x4);\n\t\tpos.y = Math.min(y1, y2, y3, y4);\n\n\t\tpos.width = Math.max(x1, x2, x3, x4) - pos.x;\n\t\tpos.height = Math.max(y1, y2, y3, y4) - pos.y;\n\t\tpos.r = 0;\n\t};\n\n\tfunction intersect(viewport, prevViewport) {\n\t\tvar pos = viewport.src.getPosition(prevViewport.src);\n\n\t\tpos.x = (prevViewport.x - pos.x) / pos.scale;\n\t\tpos.y = (prevViewport.y - pos.y) / pos.scale;\n\t\tpos.width = prevViewport.width / pos.scale;\n\t\tpos.height = prevViewport.height / pos.scale;\n\t\tpos.r = -pos.r;\n\n\t\tgetBoundingRectangle(pos);\n\n\t\tviewport.intersectRect(pos);\n\t};\n\n\tthis.render = function (ctx, opts) {\n\t\tvar s = this.style;\n\t\tvar cvs = this._contentView.style;\n\n\t\tvar viewport = this._viewport;\n\n\t\tvar x = viewport.x;\n\t\tvar y = viewport.y;\n\t\tvar width = viewport.width;\n\t\tvar height = viewport.height;\n\n\t\tviewport.x = -cvs.x;\n\t\tviewport.y = -cvs.y;\n\n\t\t// TODO: does flooring versus rounding hurt us?\n\t\t// NOTE: + 0.5 | 0 for rounding DOES NOT work for negative numbers\n\t\tviewport.width = s.width * s.scale | 0;\n\t\tviewport.height = s.height * s.scale | 0;\n\n\t\tif (opts.viewport) {\n\t\t\tintersect(viewport, opts.viewport);\n\t\t}\n\n\t\topts.viewport = viewport;\n\n\t\treturn viewport.x != x || viewport.y != y || viewport.width != width || viewport.height != height;\n\t};\n\n\tthis.onInputScroll = function (evt) {\n\t\tvar style = this._contentView.style;\n\t\tvar x = style.x;\n\t\tvar y = style.y;\n\n\t\tif (this._opts.scrollY && evt.scrollAxis == input.VERTICAL_AXIS) {\n\t\t\tthis.addOffset(undefined, evt.scrollDelta * 40);\n\t\t} else if (this._opts.scrollX) {\n\t\t\tthis.addOffset(evt.scrollDelta * 40);\n\t\t}\n\n\t\tif (style.y != y || style.x != x) {\n\t\t\tevt.cancel();\n\t\t}\n\t};\n\n\tthis.scrollTo = function (x, y, opts, cb) {\n\t\tvar bounds = this.getStyleBounds();\n\t\tvar cvs = this._contentView.style;\n\n\t\tx = (x == null) ? cvs.x : -x;\n\t\ty = (y == null) ? cvs.y : -y;\n\n\t\tx = x < bounds.minX ? bounds.minX : x;\n\t\tx = x > bounds.maxX ? bounds.maxX : x;\n\t\ty = y < bounds.minY ? bounds.minY : y;\n\t\ty = y > bounds.maxY ? bounds.maxY : y;\n\n\t\tvar duration;\n\t\tif (typeof opts == 'number') {\n\t\t\t// legacy api\n\t\t\tduration = opts;\n\t\t} else {\n\t\t\tif (opts.duration) {\n\t\t\t\tduration = opts.duration;\n\t\t\t} else if (opts.speed) {\n\t\t\t\tvar dx = x - cvs.x;\n\t\t\t\tvar dy = y - cvs.y;\n\t\t\t\tvar distance = Math.sqrt(dx * dx + dy * dy);\n\t\t\t\tduration = distance / opts.speed * 1000;\n\t\t\t} else {\n\t\t\t\tduration = 500;\n\t\t\t}\n\n\t\t\tif (opts.maxDuration) {\n\t\t\t\tduration = Math.min(duration, opts.maxDuration);\n\t\t\t}\n\t\t}\n\n\t\tif (duration) {\n\t\t\tvar anim = animate(this._contentView).now({ x: x, y: y }, duration, animate.easeOut);\n\t\t\tif (cb) {\n\t\t\t\tanim.then(cb);\n\t\t\t}\n\t\t} else {\n\t\t\tcvs.x = x;\n\t\t\tcvs.y = y;\n\t\t\tcb && cb();\n\t\t}\n\t};\n});\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/math/geom/Circle.js":{"path":"modules/devkit-core/node_modules/jsio/packages/math/geom/Circle.js","friendlyPath":"math.geom.Circle","directory":"modules/devkit-core/node_modules/jsio/packages/math/geom/","filename":"Circle.js","src":"jsio('import .Point');\n\n/**\n * @extends math.geom.Point\n * Models a circle given a radius.\n *   Circle(x, y, radius)\n *   Circle({x: default 0, y: default 0, radius: default 0})\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Circle=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Circle(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_node_modules_jsio_packages_math_geom_Circle(){return this.init&&this.init.apply(this,arguments)},Point, function(supr) {\n\tthis.init = function(a, b, c) {\n\t\tswitch(arguments.length) {\n\t\t\tcase 0:\n\t\t\t\tthis.x = 0;\n\t\t\t\tthis.y = 0;\n\t\t\t\tthis.radius = 0;\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\tcase 2:\n\t\t\t\tthis.x = a.x || 0;\n\t\t\t\tthis.y = a.y || 0;\n\t\t\t\tthis.radius = a.radius || 0;\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tthis.x = a;\n\t\t\t\tthis.y = b;\n\t\t\t\tthis.radius = c;\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Scale the position and radius of this circle by a percentage.\n\t */\n\t\n\tthis.scale = function(s) {\n\t\tsupr(this, 'scale', arguments);\n\t\tthis.radius *= s;\n\t\treturn this;\n\t}\n});","pre":true},"modules/devkit-core/src/clientapi/debugging/screenshot.js":{"path":"modules/devkit-core/src/clientapi/debugging/screenshot.js","friendlyPath":".screenshot","directory":"modules/devkit-core/src/clientapi/debugging/","filename":"screenshot.js","src":"jsio('import device');\n\nexports.screenshot = function (cb) {\n  var canvas = GC.app.engine.getElement();\n\n  var Canvas = device.get('Canvas');\n  var _debugCanvas = new Canvas({\n      width: canvas.width,\n      height: canvas.height\n    });\n\n  if (_debugCanvas && _debugCanvas.toDataURL) {\n    var ctx = _debugCanvas.getContext('2d');\n    var reDomain = /^https?:\\/\\/(.*?)\\//;\n    var origDrawImage = ctx.drawImage;\n    ctx.drawImage = function (img, sx, sy, sw, sh, dx, dy, dw, dh) {\n      var match = img.src.match(reDomain);\n      if (match && match[1] != location.host) {\n        if (dw != undefined && dh != undefined) {\n          this.drawBrokenImage(dx, dy, dw, dh);\n        } else if (dx != undefined) {\n          this.drawBrokenImage(dx, dy, sw, sh);\n        } else if (sw != undefined) {\n          this.drawBrokenImage(sx, sy, sw, sh);\n        } else {\n          this.drawBrokenImage(sx, sy, img.width, img.height);\n        }\n      } else {\n        origDrawImage.apply(this, arguments);\n      }\n    };\n\n    ctx.drawBrokenImage = function (x, y, w, h) {\n      var lineWidth = 6;\n      x = x || 0;\n      y = y || 0;\n      if (w && h) {\n        this.save();\n        this.clipRect(x, y, w, h);\n        this.fillStyle = 'rgba(0, 0, 0, 0.5)';\n        this.fillRect(x, y, w, h);\n        this.lineWidth = lineWidth;\n        this.strokeStyle = 'rgba(255, 255, 255, 0.5)';\n        this.strokeRect(x + lineWidth / 2, y + lineWidth / 2, w - lineWidth, h - lineWidth);\n        this.strokeStyle = 'rgba(255, 0, 0)';\n        this.fillStyle = 'red';\n        this.font = 'bold 15px Helvetica';\n        this.textAlign = 'center';\n        this.textBaseline = 'middle';\n        this.fillText(\"X\", x + w / 2, y + h / 2);\n        this.restore();\n      }\n    }\n\n    GC.app.engine.getView().__view.wrapRender(ctx, {});\n\n    try {\n      var base64Image = _debugCanvas.toDataURL('image/png');\n    } catch (e) {\n      cb({\n        NOT_SUPPORTED: true,\n        error: e\n      });\n    }\n\n    if (base64Image) {\n      cb(null, {\n        width: _debugCanvas.width,\n        height: _debugCanvas.height,\n        base64Image: base64Image\n      });\n    }\n  } else {\n    cb({\n      NOT_SUPPORTED: true\n    });\n  }\n}\n","pre":true},"modules/devkit-core/src/clientapi/debugging/Channel.js":{"path":"modules/devkit-core/src/clientapi/debugging/Channel.js","friendlyPath":".Channel","directory":"modules/devkit-core/src/clientapi/debugging/","filename":"Channel.js","src":"jsio('import lib.PubSub');\n\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_src_clientapi_debugging_Channel=__class__;exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_src_clientapi_debugging_Channel(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_src_clientapi_debugging_Channel(){return this.init&&this.init.apply(this,arguments)},lib.PubSub, function (supr) {\n\n  var reqId = 0;\n\n  this.init = function (name) {\n    this._name = name;\n    this._requests = {};\n\n    this._onTransportConnect = this._onTransportConnect.bind(this);\n    this._onTransportDisconnect = this._onTransportDisconnect.bind(this);\n    this._onTransportMessage = this._onTransportMessage.bind(this);\n  };\n\n  /**\n   * returns a Promise that resolves once the channel is connected to another channel\n   */\n  this.connect = function () {\n    return new Promise(function (resolve, reject) {\n      if (this._isConnected) {\n        resolve();\n      } else {\n        this.once('connect', resolve);\n      }\n    }.bind(this));\n  };\n\n  this._isConnected = false;\n\n  // is someone on the other end of this channel listening\n  this.isConnected = function () { return this._isConnected; };\n\n  this.disconnect =\n  this.close = function () {\n    this._sendInternalMessage('disconnect');\n  };\n\n  // internal: set an underlying transport\n  this.setTransport = function (transport) {\n\n    if (this._transport && this._transport != transport) {\n      // tear-down an old transport\n      this._transport\n        .removeListener('disconnect', this._onTransportDisconnect)\n        .removeListener('connect', this._onTransportConnect)\n        .removeListener(this._name, this._onTransportMessage);\n    }\n\n    this._transport = transport;\n    if (transport) {\n      transport.on('disconnect', this._onTransportDisconnect)\n        .on('connect', this._onTransportConnect)\n        .on(this._name, this._onTransportMessage);\n\n      // start connect handshake\n      this._onTransportConnect();\n    }\n  };\n\n  this._onTransportConnect = function () {\n    // transport connected, start a connect handshake (see if anyone is listening)\n    this._sendInternalMessage('connect');\n  };\n\n  this._onTransportDisconnect = function () {\n    this._isConnected = false;\n  };\n\n  this._onTransportMessage = function (msg) {\n    if (msg.internal) {\n      this._onInternalMessage(msg.internal);\n    } else if (msg.res) {\n      if (msg.error) {\n        this._requests[msg.res].reject(msg.error);\n      } else {\n        this._requests[msg.res].resolve(msg.data);\n      }\n    } else if (msg.id) {\n      supr(this, 'emit', [msg.name, msg.data, new Response(this, msg.id)]);\n    } else {\n      supr(this, 'emit', [msg.name, msg.data]);\n    }\n  };\n\n  this._sendInternalMessage = function (name) {\n    if (this._transport) {\n      this._transport.emit(this._name, {internal: name});\n    }\n  };\n\n  this._onInternalMessage = function (msg) {\n    // handle internal message protocol, used to determine if the receiver channel is listening to events\n    switch (msg) {\n      case 'connect':\n        // complete the channel connection\n        this._sendInternalMessage('connectConfirmed');\n\n        // fall-through\n      case 'connectConfirmed':\n        this._isConnected = true;\n        this._emit('connect');\n        break;\n      case 'disconnect':\n        this._isConnected = false;\n        this._emit('disconnect');\n        break;\n    }\n  };\n\n  Response=__class__;var Response=Response(function Response(){return this.init&&this.init.apply(this,arguments)},function () {\n    this.init = function (channel, id) {\n      this.channel = channel;\n      this.id = id;\n      this.responded = false;\n    };\n\n    this.error = function (err) {\n      if (this.responded) { return; }\n      this.responded = true;\n      this.channel._send({error: err, res: this.id});\n    };\n\n    this.send = function (data) {\n      if (this.responded) { return; }\n      this.responded = true;\n      this.channel._send({data: data, res: this.id});\n    };\n  });\n\n  this._send = function (data) {\n    if (this._transport) {\n      this._transport.emit(this._name, data);\n    } else {\n      logger.WARN&&console.warn(\"WARN\",\".Channel\",this._name, 'failed to send', data);\n    }\n  };\n\n  // emit an event locally on the channel object\n  this._emit = function (name, data) {\n    supr(this, 'emit', arguments);\n  };\n\n  // emit an event remotely on the receiver channel object\n  this.emit = function (name, data) {\n    if (name == 'newListener') { return this._emit(name, data); }\n    this._send({name: name, data: data});\n  };\n\n  /**\n   * emits\n   */\n  this.request = function (name, data) {\n    return this.connect().bind(this).then(function () {\n      var id = ++reqId;\n      this._send({name: name, data: data, id: id});\n      return new Promise(function (resolve, reject) {\n        this._requests[id] = {resolve: resolve, reject: reject};\n      }.bind(this));\n    });\n  };\n});\n","pre":true},"modules/devkit-core/src/clientapi/debugging/BridgeTransport.js":{"path":"modules/devkit-core/src/clientapi/debugging/BridgeTransport.js","friendlyPath":".BridgeTransport","directory":"modules/devkit-core/src/clientapi/debugging/","filename":"BridgeTransport.js","src":"jsio('import lib.PubSub as EventEmitter');\njsio('import nextTick');\n\n/**\n * The BridgeTransport creates two Transport objects that look like vaguely\n * like socket.io connections (have `.on` and `.emit`) where `.emit` on\n * transport A fires events on transport B.\n *\n * All events fire in the next tick to simulate a true connection and prevent\n * unexpected race conditions.\n */\nvar Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_src_clientapi_debugging_BridgeTransport=__class__;module.exports=Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_src_clientapi_debugging_BridgeTransport(function Users_whamsicore_Desktop_Code_Challenges_bubbleShooter_modules_devkit_core_src_clientapi_debugging_BridgeTransport(){return this.init&&this.init.apply(this,arguments)},function () {\n  this.init = function () {\n    this.a = new Transport();\n    this.b = new Transport();\n    this.a.target = this.b;\n    this.b.target = this.a;\n  }\n\n  Transport=__class__;var Transport=Transport(function Transport(){return this.init&&this.init.apply(this,arguments)},EventEmitter, function (supr) {\n    this.emit = function (name, data) {\n      nextTick(EventEmitter.prototype.emit.bind(this.target, name, data));\n    }\n  });\n});\n","pre":true},"modules/devkit-core/src/clientapi/api/nextTick.js":{"path":"modules/devkit-core/src/clientapi/api/nextTick.js","friendlyPath":"nextTick","directory":"modules/devkit-core/src/clientapi/api/","filename":"nextTick.js","baseMod":"nextTick","basePath":"/Users/whamsicore/Desktop/Code/Challenges/bubbleShooter/modules/devkit-core/src/clientapi/api/nextTick","src":"var _onTick = window.requestAnimationFrame || window.setTimeout;\nfunction nextTick(cb, ctx) {\n  if (ctx) { cb = bind(cb, ctx); }\n  _onTick(cb);\n}\n\nmodule.exports = nextTick;\n","pre":true},"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI/index.js":{"path":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI/index.js","friendlyPath":".mobileUI","directory":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI","filename":"index.js","src":"jsio('import .embeddedCSS');\njsio('import .swipeUpListener');\njsio('import .debugMenu');\n\nswipeUpListener.on('swipe', function () {\n  debugMenu.show();\n});\n","pre":true},"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI/embeddedCSS.js":{"path":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI/embeddedCSS.js","friendlyPath":".embeddedCSS","directory":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI","filename":"embeddedCSS.js","src":"jsio('from util.browser import $');\nvar style = $({tag: 'style', parent: $('head')[0]});\nstyle.innerText = \"/*\\n * Bootstrap v3.3.4 (http://getbootstrap.com)\\n * Copyright 2011-2015 Twitter, Inc.\\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)\\n */\\n.glyphicon{position:relative;top:1px;display:inline-block;font-family:'Glyphicons Halflings';font-style:normal;font-weight:normal;line-height:1;font-size:12px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}.glyphicon-asterisk:before{content:\\\"\\\\2a\\\"}.glyphicon-plus:before{content:\\\"\\\\2b\\\"}.glyphicon-euro:before,.glyphicon-eur:before{content:\\\"\\\\20ac\\\"}.glyphicon-minus:before{content:\\\"\\\\2212\\\"}.glyphicon-cloud:before{content:\\\"\\\\2601\\\"}.glyphicon-envelope:before{content:\\\"\\\\2709\\\"}.glyphicon-pencil:before{content:\\\"\\\\270f\\\"}.glyphicon-glass:before{content:\\\"\\\\e001\\\"}.glyphicon-music:before{content:\\\"\\\\e002\\\"}.glyphicon-search:before{content:\\\"\\\\e003\\\"}.glyphicon-heart:before{content:\\\"\\\\e005\\\"}.glyphicon-star:before{content:\\\"\\\\e006\\\"}.glyphicon-star-empty:before{content:\\\"\\\\e007\\\"}.glyphicon-user:before{content:\\\"\\\\e008\\\"}.glyphicon-film:before{content:\\\"\\\\e009\\\"}.glyphicon-th-large:before{content:\\\"\\\\e010\\\"}.glyphicon-th:before{content:\\\"\\\\e011\\\"}.glyphicon-th-list:before{content:\\\"\\\\e012\\\"}.glyphicon-ok:before{content:\\\"\\\\e013\\\"}.glyphicon-remove:before{content:\\\"\\\\e014\\\"}.glyphicon-zoom-in:before{content:\\\"\\\\e015\\\"}.glyphicon-zoom-out:before{content:\\\"\\\\e016\\\"}.glyphicon-off:before{content:\\\"\\\\e017\\\"}.glyphicon-signal:before{content:\\\"\\\\e018\\\"}.glyphicon-cog:before{content:\\\"\\\\e019\\\"}.glyphicon-trash:before{content:\\\"\\\\e020\\\"}.glyphicon-home:before{content:\\\"\\\\e021\\\"}.glyphicon-file:before{content:\\\"\\\\e022\\\"}.glyphicon-time:before{content:\\\"\\\\e023\\\"}.glyphicon-road:before{content:\\\"\\\\e024\\\"}.glyphicon-download-alt:before{content:\\\"\\\\e025\\\"}.glyphicon-download:before{content:\\\"\\\\e026\\\"}.glyphicon-upload:before{content:\\\"\\\\e027\\\"}.glyphicon-inbox:before{content:\\\"\\\\e028\\\"}.glyphicon-play-circle:before{content:\\\"\\\\e029\\\"}.glyphicon-repeat:before{content:\\\"\\\\e030\\\"}.glyphicon-refresh:before{content:\\\"\\\\e031\\\"}.glyphicon-list-alt:before{content:\\\"\\\\e032\\\"}.glyphicon-lock:before{content:\\\"\\\\e033\\\"}.glyphicon-flag:before{content:\\\"\\\\e034\\\"}.glyphicon-headphones:before{content:\\\"\\\\e035\\\"}.glyphicon-volume-off:before{content:\\\"\\\\e036\\\"}.glyphicon-volume-down:before{content:\\\"\\\\e037\\\"}.glyphicon-volume-up:before{content:\\\"\\\\e038\\\"}.glyphicon-qrcode:before{content:\\\"\\\\e039\\\"}.glyphicon-barcode:before{content:\\\"\\\\e040\\\"}.glyphicon-tag:before{content:\\\"\\\\e041\\\"}.glyphicon-tags:before{content:\\\"\\\\e042\\\"}.glyphicon-book:before{content:\\\"\\\\e043\\\"}.glyphicon-bookmark:before{content:\\\"\\\\e044\\\"}.glyphicon-print:before{content:\\\"\\\\e045\\\"}.glyphicon-camera:before{content:\\\"\\\\e046\\\"}.glyphicon-font:before{content:\\\"\\\\e047\\\"}.glyphicon-bold:before{content:\\\"\\\\e048\\\"}.glyphicon-italic:before{content:\\\"\\\\e049\\\"}.glyphicon-text-height:before{content:\\\"\\\\e050\\\"}.glyphicon-text-width:before{content:\\\"\\\\e051\\\"}.glyphicon-align-left:before{content:\\\"\\\\e052\\\"}.glyphicon-align-center:before{content:\\\"\\\\e053\\\"}.glyphicon-align-right:before{content:\\\"\\\\e054\\\"}.glyphicon-align-justify:before{content:\\\"\\\\e055\\\"}.glyphicon-list:before{content:\\\"\\\\e056\\\"}.glyphicon-indent-left:before{content:\\\"\\\\e057\\\"}.glyphicon-indent-right:before{content:\\\"\\\\e058\\\"}.glyphicon-facetime-video:before{content:\\\"\\\\e059\\\"}.glyphicon-picture:before{content:\\\"\\\\e060\\\"}.glyphicon-map-marker:before{content:\\\"\\\\e062\\\"}.glyphicon-adjust:before{content:\\\"\\\\e063\\\"}.glyphicon-tint:before{content:\\\"\\\\e064\\\"}.glyphicon-edit:before{content:\\\"\\\\e065\\\"}.glyphicon-share:before{content:\\\"\\\\e066\\\"}.glyphicon-check:before{content:\\\"\\\\e067\\\"}.glyphicon-move:before{content:\\\"\\\\e068\\\"}.glyphicon-step-backward:before{content:\\\"\\\\e069\\\"}.glyphicon-fast-backward:before{content:\\\"\\\\e070\\\"}.glyphicon-backward:before{content:\\\"\\\\e071\\\"}.glyphicon-play:before{content:\\\"\\\\e072\\\"}.glyphicon-pause:before{content:\\\"\\\\e073\\\"}.glyphicon-stop:before{content:\\\"\\\\e074\\\"}.glyphicon-forward:before{content:\\\"\\\\e075\\\"}.glyphicon-fast-forward:before{content:\\\"\\\\e076\\\"}.glyphicon-step-forward:before{content:\\\"\\\\e077\\\"}.glyphicon-eject:before{content:\\\"\\\\e078\\\"}.glyphicon-chevron-left:before{content:\\\"\\\\e079\\\"}.glyphicon-chevron-right:before{content:\\\"\\\\e080\\\"}.glyphicon-plus-sign:before{content:\\\"\\\\e081\\\"}.glyphicon-minus-sign:before{content:\\\"\\\\e082\\\"}.glyphicon-remove-sign:before{content:\\\"\\\\e083\\\"}.glyphicon-ok-sign:before{content:\\\"\\\\e084\\\"}.glyphicon-question-sign:before{content:\\\"\\\\e085\\\"}.glyphicon-info-sign:before{content:\\\"\\\\e086\\\"}.glyphicon-screenshot:before{content:\\\"\\\\e087\\\"}.glyphicon-remove-circle:before{content:\\\"\\\\e088\\\"}.glyphicon-ok-circle:before{content:\\\"\\\\e089\\\"}.glyphicon-ban-circle:before{content:\\\"\\\\e090\\\"}.glyphicon-arrow-left:before{content:\\\"\\\\e091\\\"}.glyphicon-arrow-right:before{content:\\\"\\\\e092\\\"}.glyphicon-arrow-up:before{content:\\\"\\\\e093\\\"}.glyphicon-arrow-down:before{content:\\\"\\\\e094\\\"}.glyphicon-share-alt:before{content:\\\"\\\\e095\\\"}.glyphicon-resize-full:before{content:\\\"\\\\e096\\\"}.glyphicon-resize-small:before{content:\\\"\\\\e097\\\"}.glyphicon-exclamation-sign:before{content:\\\"\\\\e101\\\"}.glyphicon-gift:before{content:\\\"\\\\e102\\\"}.glyphicon-leaf:before{content:\\\"\\\\e103\\\"}.glyphicon-fire:before{content:\\\"\\\\e104\\\"}.glyphicon-eye-open:before{content:\\\"\\\\e105\\\"}.glyphicon-eye-close:before{content:\\\"\\\\e106\\\"}.glyphicon-warning-sign:before{content:\\\"\\\\e107\\\"}.glyphicon-plane:before{content:\\\"\\\\e108\\\"}.glyphicon-calendar:before{content:\\\"\\\\e109\\\"}.glyphicon-random:before{content:\\\"\\\\e110\\\"}.glyphicon-comment:before{content:\\\"\\\\e111\\\"}.glyphicon-magnet:before{content:\\\"\\\\e112\\\"}.glyphicon-chevron-up:before{content:\\\"\\\\e113\\\"}.glyphicon-chevron-down:before{content:\\\"\\\\e114\\\"}.glyphicon-retweet:before{content:\\\"\\\\e115\\\"}.glyphicon-shopping-cart:before{content:\\\"\\\\e116\\\"}.glyphicon-folder-close:before{content:\\\"\\\\e117\\\"}.glyphicon-folder-open:before{content:\\\"\\\\e118\\\"}.glyphicon-resize-vertical:before{content:\\\"\\\\e119\\\"}.glyphicon-resize-horizontal:before{content:\\\"\\\\e120\\\"}.glyphicon-hdd:before{content:\\\"\\\\e121\\\"}.glyphicon-bullhorn:before{content:\\\"\\\\e122\\\"}.glyphicon-bell:before{content:\\\"\\\\e123\\\"}.glyphicon-certificate:before{content:\\\"\\\\e124\\\"}.glyphicon-thumbs-up:before{content:\\\"\\\\e125\\\"}.glyphicon-thumbs-down:before{content:\\\"\\\\e126\\\"}.glyphicon-hand-right:before{content:\\\"\\\\e127\\\"}.glyphicon-hand-left:before{content:\\\"\\\\e128\\\"}.glyphicon-hand-up:before{content:\\\"\\\\e129\\\"}.glyphicon-hand-down:before{content:\\\"\\\\e130\\\"}.glyphicon-circle-arrow-right:before{content:\\\"\\\\e131\\\"}.glyphicon-circle-arrow-left:before{content:\\\"\\\\e132\\\"}.glyphicon-circle-arrow-up:before{content:\\\"\\\\e133\\\"}.glyphicon-circle-arrow-down:before{content:\\\"\\\\e134\\\"}.glyphicon-globe:before{content:\\\"\\\\e135\\\"}.glyphicon-wrench:before{content:\\\"\\\\e136\\\"}.glyphicon-tasks:before{content:\\\"\\\\e137\\\"}.glyphicon-filter:before{content:\\\"\\\\e138\\\"}.glyphicon-briefcase:before{content:\\\"\\\\e139\\\"}.glyphicon-fullscreen:before{content:\\\"\\\\e140\\\"}.glyphicon-dashboard:before{content:\\\"\\\\e141\\\"}.glyphicon-paperclip:before{content:\\\"\\\\e142\\\"}.glyphicon-heart-empty:before{content:\\\"\\\\e143\\\"}.glyphicon-link:before{content:\\\"\\\\e144\\\"}.glyphicon-phone:before{content:\\\"\\\\e145\\\"}.glyphicon-pushpin:before{content:\\\"\\\\e146\\\"}.glyphicon-usd:before{content:\\\"\\\\e148\\\"}.glyphicon-gbp:before{content:\\\"\\\\e149\\\"}.glyphicon-sort:before{content:\\\"\\\\e150\\\"}.glyphicon-sort-by-alphabet:before{content:\\\"\\\\e151\\\"}.glyphicon-sort-by-alphabet-alt:before{content:\\\"\\\\e152\\\"}.glyphicon-sort-by-order:before{content:\\\"\\\\e153\\\"}.glyphicon-sort-by-order-alt:before{content:\\\"\\\\e154\\\"}.glyphicon-sort-by-attributes:before{content:\\\"\\\\e155\\\"}.glyphicon-sort-by-attributes-alt:before{content:\\\"\\\\e156\\\"}.glyphicon-unchecked:before{content:\\\"\\\\e157\\\"}.glyphicon-expand:before{content:\\\"\\\\e158\\\"}.glyphicon-collapse-down:before{content:\\\"\\\\e159\\\"}.glyphicon-collapse-up:before{content:\\\"\\\\e160\\\"}.glyphicon-log-in:before{content:\\\"\\\\e161\\\"}.glyphicon-flash:before{content:\\\"\\\\e162\\\"}.glyphicon-log-out:before{content:\\\"\\\\e163\\\"}.glyphicon-new-window:before{content:\\\"\\\\e164\\\"}.glyphicon-record:before{content:\\\"\\\\e165\\\"}.glyphicon-save:before{content:\\\"\\\\e166\\\"}.glyphicon-open:before{content:\\\"\\\\e167\\\"}.glyphicon-saved:before{content:\\\"\\\\e168\\\"}.glyphicon-import:before{content:\\\"\\\\e169\\\"}.glyphicon-export:before{content:\\\"\\\\e170\\\"}.glyphicon-send:before{content:\\\"\\\\e171\\\"}.glyphicon-floppy-disk:before{content:\\\"\\\\e172\\\"}.glyphicon-floppy-saved:before{content:\\\"\\\\e173\\\"}.glyphicon-floppy-remove:before{content:\\\"\\\\e174\\\"}.glyphicon-floppy-save:before{content:\\\"\\\\e175\\\"}.glyphicon-floppy-open:before{content:\\\"\\\\e176\\\"}.glyphicon-credit-card:before{content:\\\"\\\\e177\\\"}.glyphicon-transfer:before{content:\\\"\\\\e178\\\"}.glyphicon-cutlery:before{content:\\\"\\\\e179\\\"}.glyphicon-header:before{content:\\\"\\\\e180\\\"}.glyphicon-compressed:before{content:\\\"\\\\e181\\\"}.glyphicon-earphone:before{content:\\\"\\\\e182\\\"}.glyphicon-phone-alt:before{content:\\\"\\\\e183\\\"}.glyphicon-tower:before{content:\\\"\\\\e184\\\"}.glyphicon-stats:before{content:\\\"\\\\e185\\\"}.glyphicon-sd-video:before{content:\\\"\\\\e186\\\"}.glyphicon-hd-video:before{content:\\\"\\\\e187\\\"}.glyphicon-subtitles:before{content:\\\"\\\\e188\\\"}.glyphicon-sound-stereo:before{content:\\\"\\\\e189\\\"}.glyphicon-sound-dolby:before{content:\\\"\\\\e190\\\"}.glyphicon-sound-5-1:before{content:\\\"\\\\e191\\\"}.glyphicon-sound-6-1:before{content:\\\"\\\\e192\\\"}.glyphicon-sound-7-1:before{content:\\\"\\\\e193\\\"}.glyphicon-copyright-mark:before{content:\\\"\\\\e194\\\"}.glyphicon-registration-mark:before{content:\\\"\\\\e195\\\"}.glyphicon-cloud-download:before{content:\\\"\\\\e197\\\"}.glyphicon-cloud-upload:before{content:\\\"\\\\e198\\\"}.glyphicon-tree-conifer:before{content:\\\"\\\\e199\\\"}.glyphicon-tree-deciduous:before{content:\\\"\\\\e200\\\"}.glyphicon-cd:before{content:\\\"\\\\e201\\\"}.glyphicon-save-file:before{content:\\\"\\\\e202\\\"}.glyphicon-open-file:before{content:\\\"\\\\e203\\\"}.glyphicon-level-up:before{content:\\\"\\\\e204\\\"}.glyphicon-copy:before{content:\\\"\\\\e205\\\"}.glyphicon-paste:before{content:\\\"\\\\e206\\\"}.glyphicon-alert:before{content:\\\"\\\\e209\\\"}.glyphicon-equalizer:before{content:\\\"\\\\e210\\\"}.glyphicon-king:before{content:\\\"\\\\e211\\\"}.glyphicon-queen:before{content:\\\"\\\\e212\\\"}.glyphicon-pawn:before{content:\\\"\\\\e213\\\"}.glyphicon-bishop:before{content:\\\"\\\\e214\\\"}.glyphicon-knight:before{content:\\\"\\\\e215\\\"}.glyphicon-baby-formula:before{content:\\\"\\\\e216\\\"}.glyphicon-tent:before{content:\\\"\\\\26fa\\\"}.glyphicon-blackboard:before{content:\\\"\\\\e218\\\"}.glyphicon-bed:before{content:\\\"\\\\e219\\\"}.glyphicon-apple:before{content:\\\"\\\\f8ff\\\"}.glyphicon-erase:before{content:\\\"\\\\e221\\\"}.glyphicon-hourglass:before{content:\\\"\\\\231b\\\"}.glyphicon-lamp:before{content:\\\"\\\\e223\\\"}.glyphicon-duplicate:before{content:\\\"\\\\e224\\\"}.glyphicon-piggy-bank:before{content:\\\"\\\\e225\\\"}.glyphicon-scissors:before{content:\\\"\\\\e226\\\"}.glyphicon-bitcoin:before{content:\\\"\\\\e227\\\"}.glyphicon-btc:before{content:\\\"\\\\e227\\\"}.glyphicon-xbt:before{content:\\\"\\\\e227\\\"}.glyphicon-yen:before{content:\\\"\\\\00a5\\\"}.glyphicon-jpy:before{content:\\\"\\\\00a5\\\"}.glyphicon-ruble:before{content:\\\"\\\\20bd\\\"}.glyphicon-rub:before{content:\\\"\\\\20bd\\\"}.glyphicon-scale:before{content:\\\"\\\\e230\\\"}.glyphicon-ice-lolly:before{content:\\\"\\\\e231\\\"}.glyphicon-ice-lolly-tasted:before{content:\\\"\\\\e232\\\"}.glyphicon-education:before{content:\\\"\\\\e233\\\"}.glyphicon-option-horizontal:before{content:\\\"\\\\e234\\\"}.glyphicon-option-vertical:before{content:\\\"\\\\e235\\\"}.glyphicon-menu-hamburger:before{content:\\\"\\\\e236\\\"}.glyphicon-modal-window:before{content:\\\"\\\\e237\\\"}.glyphicon-oil:before{content:\\\"\\\\e238\\\"}.glyphicon-grain:before{content:\\\"\\\\e239\\\"}.glyphicon-sunglasses:before{content:\\\"\\\\e240\\\"}.glyphicon-text-size:before{content:\\\"\\\\e241\\\"}.glyphicon-text-color:before{content:\\\"\\\\e242\\\"}.glyphicon-text-background:before{content:\\\"\\\\e243\\\"}.glyphicon-object-align-top:before{content:\\\"\\\\e244\\\"}.glyphicon-object-align-bottom:before{content:\\\"\\\\e245\\\"}.glyphicon-object-align-horizontal:before{content:\\\"\\\\e246\\\"}.glyphicon-object-align-left:before{content:\\\"\\\\e247\\\"}.glyphicon-object-align-vertical:before{content:\\\"\\\\e248\\\"}.glyphicon-object-align-right:before{content:\\\"\\\\e249\\\"}.glyphicon-triangle-right:before{content:\\\"\\\\e250\\\"}.glyphicon-triangle-left:before{content:\\\"\\\\e251\\\"}.glyphicon-triangle-bottom:before{content:\\\"\\\\e252\\\"}.glyphicon-triangle-top:before{content:\\\"\\\\e253\\\"}.glyphicon-console:before{content:\\\"\\\\e254\\\"}.glyphicon-superscript:before{content:\\\"\\\\e255\\\"}.glyphicon-subscript:before{content:\\\"\\\\e256\\\"}.glyphicon-menu-left:before{content:\\\"\\\\e257\\\"}.glyphicon-menu-right:before{content:\\\"\\\\e258\\\"}.glyphicon-menu-down:before{content:\\\"\\\\e259\\\"}.glyphicon-menu-up:before{content:\\\"\\\\e260\\\"}@font-face{font-family:'Glyphicons Halflings';src:url(\\\"../../fonts/glyphicons-halflings-regular.eot\\\");src:url(\\\"../../fonts/glyphicons-halflings-regular.eot?#iefix\\\") format('embedded-opentype'),url(\\\"../../fonts/glyphicons-halflings-regular.woff2\\\") format('woff2'),url(\\\"../../fonts/glyphicons-halflings-regular.woff\\\") format('woff'),url(\\\"../../fonts/glyphicons-halflings-regular.ttf\\\") format('truetype'),url(\\\"../../fonts/glyphicons-halflings-regular.svg#glyphicons_halflingsregular\\\") format('svg')}#devkit-debug-menu{display:none;position:absolute;-webkit-box-align:center;-moz-box-align:center;-o-box-align:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:center;-moz-box-pack:center;-o-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;z-index:2000;-webkit-transition:0.5s opacity;-moz-transition:0.5s opacity;-o-transition:0.5s opacity;-ms-transition:0.5s opacity;transition:0.5s opacity;top:0;left:0;background:rgba(0,0,0,0.5);}#devkit-debug-menu.disabled .devkit-debug-menu-btn{background:#aaa;color:#888}#devkit-debug-menu.show{display:-webkit-box;display:-moz-box;display:-webkit-flex;display:-ms-flexbox;display:box;display:flex}#devkit-debug-menu-content{white-space:nowrap;height:97px;-webkit-border-radius:10px;border-radius:10px;-webkit-box-shadow:0 0 10px rgba(0,0,0,0.3);box-shadow:0 0 10px rgba(0,0,0,0.3);background:rgba(225,225,225,0.8);padding:8px;}#devkit-debug-menu-content .devkit-debug-menu-btn{background:#fff;-webkit-transition:1s background;-moz-transition:1s background;-o-transition:1s background;-ms-transition:1s background;transition:1s background;opacity:.8;-ms-filter:\\\"progid:DXImageTransform.Microsoft.Alpha(Opacity=80)\\\";filter:alpha(opacity=80);-webkit-border-radius:100px;border-radius:100px;padding:10px 18px;font-size:20px;padding:20px;margin:8px}#devkit-debug-menu-content .devkit-debug-menu-spin{-webkit-animation:spin 1s linear infinite;-moz-animation:spin 1s linear infinite;-o-animation:spin 1s linear infinite;-ms-animation:spin 1s linear infinite;animation:spin 1s linear infinite}@-moz-keyframes spin{100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg)}}\";","pre":true},"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI/swipeUpListener.js":{"path":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI/swipeUpListener.js","friendlyPath":".swipeUpListener","directory":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI","filename":"swipeUpListener.js","src":"jsio('import lib.PubSub');\n\nexports = new lib.PubSub();\n\nvar touches = {};\nvar SWIPE_DIST = Math.min(100, window.innerHeight * 0.1);\nvar forEach = Array.prototype.forEach;\nvar slice = Array.prototype.slice;\nvar doubleSwipe = null;\n\ndocument.addEventListener('touchstart', function (evt) {\n  if (evt.changedTouches) {\n    forEach.call(evt.changedTouches, function (touch) {\n      touches[touch.identifier] = {\n        x: touch.clientX,\n        y: touch.clientY,\n        dx: 0,\n        dy: 0\n      };\n\n      if (evt.touches.length == 2) {\n        doubleSwipe = [evt.touches[0].identifier, evt.touches[1].identifier];\n      } else {\n        doubleSwipe = null;\n      }\n    });\n  }\n}, true);\n\ndocument.addEventListener('touchcancel', function (evt) {\n  if (evt.changedTouches) {\n    forEach.call(evt.changedTouches, function (touch) {\n      delete touches[touch.identifier];\n    });\n  }\n});\n\nfunction isSwipeUp(point) {\n  var dx = point.dx;\n  var dy = point.dy;\n  return dy * dy > dx * dx && dy < -SWIPE_DIST;\n}\n\ndocument.addEventListener('touchend', function (evt) {\n  if (!evt.changedTouches || !doubleSwipe) { return; }\n\n  forEach.call(evt.changedTouches, function (touch) {\n    var data = touches[touch.identifier];\n    data.dx = touch.clientX - data.x;\n    data.dy = touch.clientY - data.y;\n  });\n\n  for (var i = 0, n = evt.changedTouches.length; i < n; ++i) {\n    if (doubleSwipe.indexOf(evt.changedTouches[i].identifier) >= 0\n        && isSwipeUp(touches[doubleSwipe[0]])\n        && isSwipeUp(touches[doubleSwipe[1]])) {\n      exports.emit('swipe');\n      return;\n    }\n  }\n}, true);\n","pre":true},"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI/debugMenu.js":{"path":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI/debugMenu.js","friendlyPath":".debugMenu","directory":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-simulator-client/mobileUI","filename":"debugMenu.js","src":"jsio('from util.browser import $');\njsio('import util.ajax');\njsio('import std.uri');\n\nvar nextTick = requestAnimationFrame || setTimeout;\nvar url = new std.uri(location.href);\nvar _disabled = false;\n\nvar buttons = [\n  {icon: 'fast-backward', onClick: function () {\n    window.location.reload();\n  }},\n  {icon: 'refresh', onClick: function () {\n    _disabled = true;\n\n    $.addClass(debugMenu, 'disabled');\n    $.addClass(this, 'devkit-debug-menu-spin');\n    util.ajax.get({\n      url: '../../api/simulate',\n      data: {\n        app: url.query('app'),\n        mobile: true\n      }\n    }, function (err, res) {\n      if (res) {\n        location.reload();\n      }\n    });\n\n  }},\n  {icon: 'pause', onClick: function () {\n    if (!window.GC || !GC.app || !GC.app.engine) { return; }\n\n    if (/pause/.test(this.className)) {\n      GC.app.engine.pause();\n      $.removeClass(this, 'glyphicon-pause');\n      $.addClass(this, 'glyphicon-play');\n    } else {\n      GC.app.engine.resume();\n      $.removeClass(this, 'glyphicon-play');\n      $.addClass(this, 'glyphicon-pause');\n    }\n  }},\n  {icon: 'erase', onClick: function () {\n    window.addEventListener('unload', function () {\n      localStorage.clear();\n    });\n    location.reload();\n  }}\n].map(function (def) {\n  def.className = 'devkit-debug-menu-btn glyphicon glyphicon-' + def.icon;\n  def.attrs = {noCapture: true};\n  var btn = $(def);\n  btn.addEventListener('click', function () {\n    if (!_disabled) {\n      return def.onClick.apply(this, arguments);\n    }\n  }, true);\n  return btn;\n});\n\nvar debugMenu = $({\n  id: 'devkit-debug-menu',\n  parent: document.body,\n  attrs: {noCapture: true},\n  children: [\n    {\n      id: 'devkit-debug-menu-content',\n      className: 'glyphicon glyphicon',\n      children: buttons\n    }\n  ]\n});\n\ndebugMenu.addEventListener('touchstart', function (evt) {\n  if (evt.target == debugMenu) {\n    evt.preventDefault();\n    exports.hide();\n  }\n});\n\nexports.show = function () {\n  pauseInput();\n\n  $.style(debugMenu, {\n    opacity: 0,\n    width: window.innerWidth + 'px',\n    height: window.innerHeight + 'px'\n  });\n\n  $.addClass(debugMenu, 'show');\n\n  nextTick(function () {\n    $.style(debugMenu, {opacity: 1});\n  });\n\n  var contents = debugMenu.childNodes[0];\n  var scale = window.innerWidth / contents.offsetWidth;\n  contents.style.WebkitTransform = 'scale(' + 0.75 * scale + ')';\n};\n\nexports.hide = function () {\n  resumeInput();\n\n  $.style(debugMenu, {opacity: 0});\n  setTimeout(function () {\n    $.removeClass(debugMenu, 'show');\n  }, 500);\n};\n\nfunction pauseInput() {\n  try {\n    GC.app.engine.getInput().disable();\n  } catch (e) {}\n}\n\nfunction resumeInput() {\n  try {\n    GC.app.engine.getInput().enable();\n  } catch (e) {}\n}\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/ajax.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/ajax.js","friendlyPath":"util.ajax","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"ajax.js","src":"jsio('import std.uri as URI');\n\nexports.MAX_SIMULTANEOUS = 4;\n\nvar _inflight = 0;\n\nvar doc;\nexports.getDoc = function() {\n\tif (doc) { return doc; }\n\ttry {\n\t\tdoc = window.ActiveXObject && new ActiveXObject('htmlfile');\n\t\tif (doc) {\n\t\t\tdoc.open().write('<html></html>');\n\t\t\tdoc.close();\n\t\t\twindow.attachEvent('onunload', function() {\n\t\t\t\ttry { doc.body.innerHTML = ''; } catch(e) {}\n\t\t\t\tdoc = null;\n\t\t\t});\n\t\t}\n\t} catch(e) {}\n\n\tif (!doc) { doc = document; }\n\treturn doc;\n};\n\nvar ctor = function() {\n\tvar win = window,\n\t\tdoc = exports.getDoc();\n\t//if (doc.parentWindow) { win = doc.parentWindow; }\n\n\treturn new (ctor = win.XMLHttpRequest ? win.XMLHttpRequest\n\t\t: function() { return win.ActiveXObject && new win.ActiveXObject('Msxml2.XMLHTTP') || null; });\n};\n\nexports.createXHR = function() { return new ctor(); }\n\nexports.post = function(opts, cb) {\n\treturn exports.get(merge({method: 'POST'}, opts), cb);\n}\n\nRequest=__class__;var Request=Request(function Request(){return this.init&&this.init.apply(this,arguments)},function() {\n\tvar _UID = 0;\n\n\tthis.init = function(opts, cb) {\n\t\tif (typeof opts == 'string') { opts = {url: opts}; }\n\t\tif (!opts || !opts.url) { logger.ERROR&&console.error(\"ERROR\",\"util.ajax\",'no url provided'); return; }\n\n\t\tthis.method = (opts.method || 'GET').toUpperCase();\n\t\tthis.url = opts.url;\n\t\tthis.type = opts.type;\n\t\tthis.async = opts.async;\n\t\tthis.timeout = opts.timeout;\n\t\tthis.withCredentials = !!opts.withCredentials;\n\t\tthis.id = ++_UID;\n\t\tthis.headers = {};\n\t\tthis.cb = cb;\n\n\t\tif (opts.headers) {\n\t\t\tfor (var key in opts.headers) if (opts.headers.hasOwnProperty(key)) {\n\t\t\t\tvar value = opts.headers[key];\n\t\t\t\tthis.headers[key] = value;\n\t\t\t}\n\t\t}\n\n\t\tvar isObject = opts.data && typeof opts.data == 'object';\n\n\t\tif (this.method == 'GET' && opts.data) {\n\t\t\tthis.url = new URI(this.url)\n\t\t\t\t\t\t\t.addQuery(isObject ? opts.data : URI.parseQuery(opts.data))\n\t\t\t\t\t\t\t.toString();\n\t\t}\n\n\t\tif (opts.query) {\n\t\t\tthis.url = new URI(this.url)\n\t\t\t\t\t\t\t.addQuery(typeof opts.query == 'object' ? opts.query : URI.parseQuery(opts.query))\n\t\t\t\t\t\t\t.toString();\n\t\t}\n\n\t\ttry {\n\t\t\tthis.data = (this.method != 'GET' ? (isObject ? JSON.stringify(opts.data) : opts.data) : null);\n\t\t\tif (isObject && !this.headers['Content-Type']) {\n\t\t\t\tthis.headers['Content-Type'] = 'application/json';\n\t\t\t}\n\t\t} catch(e) {\n\t\t\tcb && cb({invalidData: true}, null, '');\n\t\t\treturn;\n\t\t}\n\t}\n});\n\nvar _pending = [];\n\nexports.get = function(opts, cb) {\n\tvar request = new Request(opts, cb);\n\n\tif (_inflight >= exports.MAX_SIMULTANEOUS) {\n\t\t_pending.push(request);\n\t} else {\n\t\t_send(request);\n\t}\n}\n\nfunction _sendNext() {\n\t//logger.LOG&&console.log(\"LOG\",\"util.ajax\",'====INFLIGHT', _inflight, exports.MAX_SIMULTANEOUS, 'might send next?');\n\tif (_inflight < exports.MAX_SIMULTANEOUS) {\n\t\tvar request = _pending.shift();\n\t\tif (request) {\n\t\t\t_send(request);\n\t\t}\n\t}\n}\n\nfunction _send(request) {\n\t++_inflight;\n\t//logger.LOG&&console.log(\"LOG\",\"util.ajax\",'====INFLIGHT', _inflight, 'sending request', request.id);\n\n\tvar xhr = exports.createXHR();\n\txhr.open(request.method, request.url, !(request.async == false));\n\tvar setContentType = false;\n\tfor (var key in request.headers) {\n\t\tif (key.toLowerCase() == 'content-type') { setContentType = true; }\n\t\txhr.setRequestHeader(key, request.headers[key]);\n\t}\n\n\txhr.withCredentials = request.withCredentials;\n\n\tif (!setContentType) {\n\t\txhr.setRequestHeader('Content-Type', 'text/plain');\n\t}\n\n\txhr.onreadystatechange = bind(this, onReadyStateChange, request, xhr);\n\tif (request.timeout) {\n\t\trequest.timeoutRef = setTimeout(bind(this, cancel, xhr, request), request.timeout);\n\t\t//logger.LOG&&console.log(\"LOG\",\"util.ajax\",'==== setting timeout for', request.timeout, request.timeoutRef, '<<');\n\t}\n\n\trequest.ts = +new Date();\n\txhr.send(request.data || null);\n}\n\nfunction cancel(xhr, request) {\n\t--_inflight;\n\t// logger.LOG&&console.log(\"LOG\",\"util.ajax\",'====INFLIGHT', _inflight, 'timeout (cancelled)', request.id);\n\tif (request.timedOut) {\n\t\tlogger.LOG&&console.log(\"LOG\",\"util.ajax\",'already timed out?!');\n\t}\n\n\txhr.onreadystatechange = null;\n\trequest.timedOut = true;\n\tif (xhr.readyState >= xhr.HEADERS_RECEIVED) {\n\t\ttry {\n\t\t\tvar headers = xhr.getAllResponseHeaders();\n\t\t} catch (e) {}\n\t}\n\n\trequest.cb && request.cb({timeout: true}, null, headers);\n}\n\nfunction onReadyStateChange(request, xhr) {\n\tif (xhr.readyState != 4) { return; }\n\n\tif (request.timedOut) { throw 'Unexpected?!'; }\n\n\t--_inflight;\n\n\t// logger.LOG&&console.log(\"LOG\",\"util.ajax\",'====INFLIGHT', _inflight, 'received response', request.ts, request.id, (+new Date() - request.ts) / 1000);\n\tsetTimeout(_sendNext, 0);\n\n\tvar cb = request.cb;\n\tif ('timeoutRef' in request) {\n\t\t// logger.LOG&&console.log(\"LOG\",\"util.ajax\",'==== AJAX CLEARING TIMEOUT', request.id);\n\t\tclearTimeout(request.timeoutRef);\n\t\trequest.timeoutRef = null;\n\t}\n\n\t// only fire callback once\n\tif (!cb || request.handled) { return; }\n\trequest.handled = true;\n\n\tvar isJSON = /^application\\/json(;|$)/.test(xhr.getResponseHeader('Content-Type')) || request.type == 'json';\n\tvar response = xhr.response || xhr.responseText;\n\tvar data = response;\n\tvar parseError = false;\n\tif (isJSON && response && typeof response == 'string') {\n\t\ttry {\n\t\t\tdata = JSON.parse(response);\n\t\t} catch(e) {\n\t\t\tparseError = true;\n\t\t}\n\t}\n\n\t// .status will be 0 when requests are filled via app cache on at least iOS 4.x\n\tif (xhr.status != 200 && xhr.status != 0 || parseError) {\n\t\tcb({status: xhr.status, response: data, parseError: parseError}, null, xhr.getAllResponseHeaders());\n\t} else {\n\t\tcb(null, data, xhr.getAllResponseHeaders());\n\t}\n}\n","pre":true},"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-view-inspector/simulator/index.js":{"path":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-view-inspector/simulator/index.js","friendlyPath":"devkit-view-inspector","directory":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-view-inspector/simulator","filename":"index.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\n/* globals GC, Class, bind, logging, merge */\n\njsio('import ui.resource.Image as Image');\njsio('import ui.ImageView as ImageView');\n\njsio('import devkit.debugging');\njsio('import devkit.debugging.InputMoveListener as InputMoveListener');\n\njsio('import .OverlayRenderer');\n\nvar CHANNEL_ID = 'devkit.debugging.viewInspector';\n\n// mapping for reading/writing style properties on a view\n// map: inspector id -> style property\nvar INSPECTOR_PROPERTIES = {\n  relX: 'x',\n  relY: 'y',\n  relR: 'r',\n  relWidthPercent: 'widthPercent',\n  relHeightPercent: 'heightPercent',\n  relWidth: 'width',\n  relHeight: 'height',\n  relScale: 'scale',\n  opacity: 'opacity',\n  zIndex: 'zIndex',\n  visible: 'visible',\n  anchorX: 'anchorX',\n  anchorY: 'anchorY',\n  offsetX: 'offsetX',\n  offsetY: 'offsetY',\n  clip: 'clip',\n  layout: 'layout',\n  inLayout: 'inLayout',\n  top: 'top',\n  left: 'left',\n  bottom: 'bottom',\n  right: 'right',\n  flex: 'flex',\n  direction: 'direction',\n  justifyContent: 'justifyContent',\n  order: 'order',\n\n  layoutWidth: 'layoutWidth',\n  layoutHeight: 'layoutHeight',\n  centerX: 'centerX',\n  centerY: 'centerY',\n  minWidth: 'minWidth',\n  minHeight: 'minHeight',\n  maxWidth: 'maxWidth',\n  maxHeight: 'maxHeight',\n};\n\nvar ViewInspectorClient = Class(function () {\n  this.init = function () {};\n\n  function getParentUIDs(view) {\n    var uids = view.getSuperviews().map(function (view) { return view.uid; });\n    uids.push(view.uid);\n    return uids;\n  }\n\n  function findBetterTag (view) {\n    var parent = view.getSuperview();\n    for (var key in parent) {\n      if (parent[key] === view) {\n        return key;\n      }\n    }\n\n    return null;\n  }\n\n  this.onLaunch = function () {\n    this._overlay = new OverlayRenderer();\n\n    var channel = devkit.debugging.getChannel(CHANNEL_ID);\n\n    this._channel = channel\n      .on('setName', bind(this, function (name) {\n        GLOBAL._name = name;\n        logging.setPrefix(name + ': ');\n      }))\n      .on('enableInputListener', bind(this, function (req, res) {\n        if (!this._inputListener) {\n          this._inputListener = new InputMoveListener({requireShiftClick: true})\n            .on('trace', function (evt) {\n              channel.emit('inputTrace', {\n                x: evt.x,\n                y: evt.y,\n                target: evt.target.uid,\n                trace: evt.trace.map(function (item) {\n                  return {\n                    uid: item.view.uid,\n                    tag: item.view.getTag(),\n                    depth: item.depth\n                  };\n                })\n              });\n            })\n            .on('move', function (evt) {\n              channel.emit('inputMove', {\n                parents: getParentUIDs(evt.target)\n              });\n            })\n            .on('select', function (evt) {\n              channel.emit('inputSelect', {\n                parents: getParentUIDs(evt.target)\n              });\n            });\n        }\n\n        this._inputListener.connect();\n        res.send();\n      }))\n      .on('disableInputListener', bind(this, function (req, res) {\n        if (this._inputListener) {\n          this._inputListener.disconnect();\n        }\n\n        res.send();\n      }))\n      .on('highlightView', bind(this._overlay, 'setHighlight'))\n      .on('selectView', bind(this._overlay, 'setSelected'))\n      .on('getRootUID', bind(this, function (req, res) {\n        if (GLOBAL.GC && GLOBAL.GC.app && GLOBAL.GC.app.uid) {\n          res.send(GC.app.uid);\n        } else {\n          res.error('no root view');\n        }\n      }))\n      .on('getViews', bind(this, function (req, res) {\n        var data = {};\n        req.uids.forEach(function (uid) {\n          var view = devkit.debugging.getViewById(uid);\n          if (view) {\n            var sup = view.getSuperview();\n\n            //create the optimal tag\n            var tag = view.getTag && view.getTag() || view.toString();\n            var betterTag = findBetterTag(view);\n            if (betterTag) tag = betterTag + \":\" + tag;\n\n            data[uid] = {\n              uid: uid,\n              superviewId: sup && sup.uid,\n              tag: tag,\n              subviewIds: view.getSubviews().map(function (view) { return view.uid; })\n            };\n          }\n        }, this);\n\n        res.send(data);\n      }))\n      .on('replaceImage', bind(this, function (req, res) {\n        var image = req.image;\n        var uid = req.uid;\n\n        var view = devkit.debugging.getViewById(uid);\n        var newImg = new Image();\n\n        newImg._srcImg.addEventListener(\"load\", function () {\n          var map = newImg._map;\n          map.width = newImg._srcImg.width,\n          map.height = newImg._srcImg.height,\n          map.x = 0;\n          map.y = 0;\n          view.setImage(newImg);\n          view.needsRepaint();\n        }, false);\n\n        newImg._srcImg.src = image;\n\n        res.send();\n      }))\n      .on('getViewProps', bind(this, function (req, res) {\n        var uid = req.uid;\n        var view = devkit.debugging.getViewById(uid);\n        if (!view) {\n          return res.error('view ' + uid + ' not found');\n        }\n\n        var s = view.style;\n        var p = view.getPosition();\n        var layout = view.__layout;\n        var data = {};\n        var key;\n        for (key in INSPECTOR_PROPERTIES) {\n          data[key] = s[INSPECTOR_PROPERTIES[key]];\n        }\n\n        merge(data, {\n          absX: p.x,\n          absY: p.y,\n          absR: p.r,\n          absWidth: p.width,\n          absHeight: p.height,\n          absScale: p.scale,\n\n          subviews: layout && (typeof layout.getSubviews == 'function') && layout.getSubviews().length,\n          direction: layout && (typeof layout.getDirection == 'function') && layout.getDirection(),\n          padding: s.padding && s.padding.toString()\n        });\n\n        for (key in data) {\n          if (data[key] === undefined || data[key] === null) {\n            data[key] = '-';\n          }\n        }\n\n        data.isImageView = view instanceof ImageView;\n\n        if (data.isImageView) {\n          data.imagePath = view._opts.image || (view._img && view._img._map && view._img._map.url);\n          if (data.imagePath && data.imagePath._map) {\n            data.imagePath = data.imagePath._map.url;\n          }\n        }\n\n        data.uuid = uid;\n        data.description = (view.constructor.name || 'View') + ' ' + req.uid + '\\n' + view.getTag();\n\n        res.send(data);\n      }))\n      .on('setViewProp', bind(this, function (req, res) {\n        var uid = req.uid;\n        var key = req.key;\n        var value = req.value;\n\n        var view = devkit.debugging.getViewById(uid);\n        if (!view) {\n          return res.error('VIEW_NOT_FOUND');\n        }\n\n        if (key in INSPECTOR_PROPERTIES) {\n          view.style[INSPECTOR_PROPERTIES[key]] = value;\n        } else {\n          switch (key) {\n            case 'absX': break;\n            case 'absY': view.style.y = value; break;\n            case 'absWidth': view.style.width = value; break;\n            case 'absHeight': view.style.height = value; break;\n            case 'absScale': view.style.scale = value; break;\n            case 'padding': view.style.padding = value; break;\n          }\n        }\n      }))\n      .on('stopPollView', bind(this, function () {\n        if (this._pollTimer) {\n          clearTimeout(this._pollTimer);\n          this._pollTimer = null;\n        }\n      }))\n      .on('pollView', bind(this, function (evt) {\n\n        if (this._pollTimer) {\n          clearTimeout(this._pollTimer);\n          this._pollTimer = null;\n        }\n\n        function poll() {\n          if (this._pollView) {\n            var eventData = this._pollView.getPosition();\n            eventData.uid = this._pollView.uid;\n\n            channel\n              .request('viewPollData', eventData)\n              .bind(this)\n              .then(function () {\n                this._pollTimer = setTimeout(poll, 250);\n              });\n          }\n        }\n\n        this._pollView = devkit.debugging.getViewById(evt.uid);\n        if (!this._pollTimer && this._pollView) {\n          this._pollTimer = setTimeout(poll, 500);\n        }\n      }));\n  };\n\n  this.onApp = function (app) {\n    this._channel.emit('appReady', {uid: app.view.uid});\n    app.engine.unsubscribe('Render', this._overlay);\n    app.engine.subscribe('Render', this._overlay, 'render');\n\n    app.engine.on('resume', bind(this._overlay, 'stopTick'));\n    app.engine.on('pause', bind(this._overlay, 'startTick'));\n  };\n\n});\n\nmodule.exports = new ViewInspectorClient();\n","pre":true},"modules/devkit-core/src/clientapi/debugging/InputMoveListener.js":{"path":"modules/devkit-core/src/clientapi/debugging/InputMoveListener.js","friendlyPath":"devkit.debugging.InputMoveListener","directory":"modules/devkit-core/src/clientapi/debugging/","filename":"InputMoveListener.js","src":"jsio('import device');\njsio('import event.Emitter');\njsio('import event.input.dispatch as dispatch');\njsio('import math.geom.Point as Point');\n\nvar modules_devkit_core_src_clientapi_debugging_InputMoveListener=__class__;exports=modules_devkit_core_src_clientapi_debugging_InputMoveListener(function modules_devkit_core_src_clientapi_debugging_InputMoveListener(){return this.init&&this.init.apply(this,arguments)},event.Emitter, function () {\n\n  var _useDOMEvents = device.isSimulator && document.body.addEventListener;\n\n  this.init = function (opts) {\n    opts = opts || {};\n\n    this._requireShiftClick = !!opts.requireShiftClick;\n    this.onMouseMoveCapture = bind(this, this.onMouseMoveCapture);\n    this._checkShift = bind(this, this._checkShift);\n    this.onContextMenu = bind(this, this.onContextMenu);\n  }\n\n  this.connect = function () {\n    if (_useDOMEvents) {\n      window.addEventListener('mousemove', this.onMouseMoveCapture, true);\n      window.addEventListener('contextmenu', this.onContextMenu, true);\n      window.addEventListener('mousedown', this._checkShift, true);\n    }\n\n    GC.app.view.subscribe('InputMoveCapture', this, 'onInputMoveCapture');\n    GC.app.view.subscribe('InputStartCapture', this, '_cancelEvent');\n    GC.app.view.subscribe('InputSelectCapture', this, 'onInputSelectCapture');\n  }\n\n  this.disconnect = function () {\n    if (_useDOMEvents) {\n      window.removeEventListener('mousedown', this._checkShift, true);\n      window.removeEventListener('mousemove', this.onMouseMoveCapture, true);\n      window.removeEventListener('contextmenu', this.onContextMenu, true);\n    }\n\n    GC.app.view.unsubscribe('InputMoveCapture', this, 'onInputMoveCapture');\n    GC.app.view.unsubscribe('InputStartCapture', this, '_cancelEvent');\n    GC.app.view.unsubscribe('InputSelectCapture', this, 'onInputSelectCapture');\n  }\n\n  this._cancelEvent = function (evt) {\n    evt.cancel();\n  }\n\n  this._checkShift = function (e) {\n    if (e.which === 3 || e.button === 2) {\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n    }\n\n    this._shiftDown = !!e.shiftKey;\n\n    if (!GC.app.engine.isRunning()) {\n      // get the event to the active target\n      var mockEvt = {pt: [], trace: [], depth: 0};\n      var mockPt = new Point(e.pageX, e.pageY);\n      dispatch.traceEvt(GC.app.view, mockEvt, mockPt);\n\n      this.onInputSelectCapture(mockEvt, mockPt);\n\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  }\n\n  this.onContextMenu = function (e) {\n    var fullTrace = this.getFullTrace(e.pageX, e.pageY);\n    if (!fullTrace.trace.length) { return; }\n\n    this.emit('trace', {\n      x: e.pageX,\n      y: e.pageY,\n      target: fullTrace.target,\n      trace: fullTrace.trace\n    });\n\n    e.stopPropagation();\n    e.preventDefault();\n    return false;\n  }\n\n  this.onInputMoveCapture = function (evt, pt, allEvt, allPt) {\n    var fullTrace = this.getFullTrace(pt.x, pt.y);\n\n    var data = {\n      x: pt.x,\n      y: pt.y,\n      target: fullTrace.target,\n      evtTrace: evt.trace, // trace of just the views that can receive input events\n      trace: fullTrace.trace // trace of all visible views\n    };\n\n    this.emit('move', data);\n  }\n\n  this.onInputSelectCapture = function (evt, pt) {\n    if (!this._requireShiftClick || this._shiftDown) {\n      evt.cancel();\n      var trace = this.getFullTrace(pt.x, pt.y);\n      this.emit('select', trace);\n    }\n  }\n\n  this.getFullTrace = function (x, y) {\n    var fullTrace = {pt: [], trace: [], depth: 0};\n    this._getFullTrace(GC.app.view, fullTrace, new Point(x, y), 0);\n    return fullTrace;\n  }\n\n  this._getFullTrace = function (view, evt, pt, depth) {\n    var localPt = view.style.localizePoint(new Point(pt));\n\n    //if the point is contained add it to the trace\n    if (view.containsLocalPoint(localPt)) {\n      evt.trace.unshift({view: view, depth: depth});\n      evt.pt[view.uid] = localPt;\n      if (depth >= evt.depth) {\n        evt.depth = depth;\n        evt.target = view;\n      }\n    }\n\n    var subviews = view.getSubviews();\n    var n = subviews.length;\n    for (var i = 0; i < n; ++i) {\n      if (subviews[i].style.visible) {\n        this._getFullTrace(subviews[i], evt, localPt, depth + 1);\n      }\n    }\n  };\n\n  this.onMouseMoveCapture = function (e) {\n    if (!GC.app.engine.isRunning()) {\n      // get the event to the active target\n      var mockEvt = {pt: [], trace: [], depth: 0};\n      var mockPt = new Point(e.pageX, e.pageY);\n      dispatch.traceEvt(GC.app.view, mockEvt, mockPt);\n\n      this.onInputMoveCapture(mockEvt, mockPt);\n    }\n  }\n});\n","pre":true},"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-view-inspector/simulator/OverlayRenderer.js":{"path":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-view-inspector/simulator/OverlayRenderer.js","friendlyPath":".OverlayRenderer","directory":"../../../../../../usr/local/lib/node_modules/devkit/modules/devkit-view-inspector/simulator","filename":"OverlayRenderer.js","src":"/**\n * @license\n * This file is part of the Game Closure SDK.\n *\n * The Game Closure SDK is free software: you can redistribute it and/or modify\n * it under the terms of the Mozilla Public License v. 2.0 as published by Mozilla.\n\n * The Game Closure SDK is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * Mozilla Public License v. 2.0 for more details.\n\n * You should have received a copy of the Mozilla Public License v. 2.0\n * along with the Game Closure SDK.  If not, see <http://mozilla.org/MPL/2.0/>.\n */\n\njsio('import device');\njsio('import devkit.debugging');\n\nvar usr_local_lib_node_modules_devkit_modules_devkit_view_inspector_simulator_OverlayRenderer=__class__;module.exports=usr_local_lib_node_modules_devkit_modules_devkit_view_inspector_simulator_OverlayRenderer(function usr_local_lib_node_modules_devkit_modules_devkit_view_inspector_simulator_OverlayRenderer(){return this.init&&this.init.apply(this,arguments)},function () {\n\n  // store the views we need to render\n  this._highlightViewUID = null;\n  this.setHighlight = function (uid) { this._highlightViewUID = uid; };\n\n  this._selectedViewUID = null;\n  this.setSelected = function (uid) { this._selectedViewUID = uid; };\n\n  var tick = 0;\n  var maxColor = 255;\n  var minColor = 100;\n  var _ctx;\n\n  // render the highlighted view\n  var _now = Date.now()\n  function renderHighlight (pos, ctx) {\n    if (!ctx) { return; }\n    ctx.save();\n    ctx.translate(pos.x, pos.y);\n    ctx.rotate(pos.r);\n\n    // pulsate the blue\n    tick += -(_now - (_now = Date.now()));\n\n    var weight = (Math.sin(2 * Math.PI * tick / 1000) + 1) / 2;\n    var val = (weight * (maxColor - minColor)) + minColor | 0;\n\n\n    var color = '0,' + (val * 0.7 | 0) + ',' + (val | 0);\n\n    ctx.strokeStyle = 'rgba(' + color + ', 0.7)';\n    ctx.strokeRect(0, 0, pos.width, pos.height);\n    ctx.fillStyle = 'rgba(' + color + ', 0.6)';\n    ctx.fillRect(0, 0, pos.width, pos.height);\n\n    //draw the cross hair\n    //ctx.fillStyle = 'rgb(' + val + ',' + val + ',' + val +')';\n    var opacity = weight * (1 - 0.4) + 0.4;\n    ctx.fillStyle = 'rgba(255,255,255,' + (opacity.toFixed(2)) +')';\n    ctx.translate(pos.anchorX, pos.anchorY);\n    ctx.rotate(tick / 500);\n\n    ctx.fillRect(-0.5, -7, 1, 14);\n    ctx.fillRect(-7, -0.5, 14, 1);\n\n    ctx.restore();\n  }\n\n  function renderSelected (pos, ctx) {\n    if (!ctx) { return; }\n\n    ctx.save();\n    ctx.translate(pos.x, pos.y);\n    ctx.rotate(pos.r);\n    ctx.strokeStyle = \"red\";\n    ctx.lineWidth = 1;\n    ctx.strokeRect(-0.5, -0.5, pos.width + 1, pos.height + 1);\n    ctx.restore();\n  }\n\n  if (!device.isMobile) {\n    var element = document.createElement('x');\n    var documentElement = document.documentElement;\n    var getComputedStyle = window.getComputedStyle;\n    var supportsPointerEvents = false;\n    if (element && ('pointerEvents' in element.style)) {\n      element.style.pointerEvents = 'auto';\n      element.style.pointerEvents = 'x';\n      documentElement.appendChild(element);\n      supportsPointerEvents = getComputedStyle && getComputedStyle(element, '').pointerEvents === 'auto';\n      documentElement.removeChild(element);\n    }\n\n    if (device.isSimulator && document.body && document.body.appendChild && supportsPointerEvents) {\n      var canvas = new (device.get('Canvas'))();\n      canvas.style.cssText = 'position: absolute; left: 0; top: 0; z-index: 1000; pointer-events: none;';\n      document.body.appendChild(canvas);\n\n      _ctx = canvas.getContext('2d');\n    }\n  }\n\n  // used to drive renderer separately when app is paused\n  this.startTick = function () {\n    this.stopTick();\n    this._tick = setInterval(bind(this, 'render', _ctx), 1000 / 30);\n  };\n\n  // used to stop renderer's timer when app is unpaused\n  this.stopTick = function () {\n    if (this._tick) {\n      clearInterval(this._tick);\n    }\n  };\n\n  this.setEnabled = function (isEnabled) {\n    this._isEnabled = isEnabled;\n    if (_ctx) {\n      _ctx.clear();\n    }\n  };\n\n  this.render = function (ctx) {\n    if (!ctx) { return; }\n    // if (!this._isEnabled) { return; }\n\n    // on simulated devices, we have our own canvas\n    // so size it to fit the screen (clearing it too)\n    if (_ctx) {\n      ctx = _ctx;\n      ctx.canvas.width = device.screen.width;\n      ctx.canvas.height = device.screen.height;\n    }\n\n    // render highlighted views\n    var view, pos;\n    if (this._highlightViewUID !== null) {\n      view = devkit.debugging.getViewById(this._highlightViewUID);\n      pos = view && view.getPosition();\n      if (pos) {\n        renderHighlight(pos, ctx);\n      }\n    }\n\n    // render selected views\n    if (this._selectedViewUID !== null) {\n      view = devkit.debugging.getViewById(this._selectedViewUID);\n      pos = view && view.getPosition();\n      if (pos) {\n        renderSelected(pos, ctx);\n      }\n    }\n  };\n});\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/syntax.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/syntax.js","friendlyPath":"util.syntax","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"syntax.js","src":"jsio('import .esprima');\n\nfunction validate(code, filename) {\n  try {\n    var syntax = esprima.parse(code, { tolerant: true, loc: true });\n    var errors = syntax.errors;\n    if (errors.length > 0) {\n      logErrors(filename, code, errors);\n    }\n  } catch (e) {\n    logErrors(filename, code, [e]);\n  }\n}\n\nfunction padString(str, pad) {\n  str = str + '';\n  while (str.length < pad) {\n    str = ' ' + str;\n  }\n  return str;\n}\n\nfunction logColor(color, str) {\n  if (console.group) {\n    str = '%c' + str;\n    console.log(str, 'color:' + color);\n  } else {\n    console.log(str);\n  }\n}\n\nfunction logErrors(filename, code, errors) {\n  var title = \"Syntax Error (\" + filename + \"):\";\n  if (console.group) {\n    console.group(\"%c\" + title, \"color: red; text-decoration: underline\");\n  } else {\n    console.error(\"Syntax Error:\");\n  }\n\n  var linesBefore = 3;\n  var linesAfter = 3;\n  var lines = code.split('\\n');\n  for (var i = 0; i < errors.length; i += 1) {\n    var e = errors[i];\n    var pad = ('' + (e.lineNumber + linesAfter)).length;\n    printLines(pad, lines, e.lineNumber - linesBefore, e.lineNumber - 1);\n    logColor(\"red\", padString(e.lineNumber, pad) + ' ' + lines[e.lineNumber - 1]);\n\n    logColor(\"blue\", new Array(pad + e.column + 1).join('·') + '^');\n\n    printLines(pad, lines, e.lineNumber + 1, e.lineNumber + 1 + linesAfter);\n\n    logColor(\"red\", \"Line \" + e.lineNumber + \": \" + e.description);\n  }\n\n  console.groupEnd && console.groupEnd();\n}\n\n\nvar printLines = console.group\n  ? function (pad, lines, from, to) {\n      for (var j = from; j <= to; ++j) {\n        console.log('%c' + padString(j, pad) + ' %c' + lines[j - 1], 'color: gray', 'color: auto');\n      }\n    }\n  : function (pad, lines, from, to) {\n      for (var j = from; j <= to; ++j) {\n        console.log(padString(j, pad), lines[j - 1]);\n      }\n    };\n\nexports = validate;\n","pre":true},"modules/devkit-core/node_modules/jsio/packages/util/esprima.js":{"path":"modules/devkit-core/node_modules/jsio/packages/util/esprima.js","friendlyPath":".esprima","directory":"modules/devkit-core/node_modules/jsio/packages/util/","filename":"esprima.js","src":"/*\n  Copyright (c) jQuery Foundation, Inc. and Contributors, All Rights Reserved.\n\n  Redistribution and use in source and binary forms, with or without\n  modification, are permitted provided that the following conditions are met:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above copyright\n      notice, this list of conditions and the following disclaimer in the\n      documentation and/or other materials provided with the distribution.\n\n  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n  ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY\n  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n(function (root, factory) {\n    'use strict';\n\n    // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js,\n    // Rhino, and plain browser loading.\n\n    /* istanbul ignore next */\n    if (typeof define === 'function' && define.amd) {\n        define(['exports'], factory);\n    } else if (typeof exports !== 'undefined') {\n        factory(exports);\n    } else {\n        factory((root.esprima = {}));\n    }\n}(this, function (exports) {\n    'use strict';\n\n    var Token,\n        TokenName,\n        FnExprTokens,\n        Syntax,\n        PlaceHolders,\n        Messages,\n        Regex,\n        source,\n        strict,\n        sourceType,\n        index,\n        lineNumber,\n        lineStart,\n        hasLineTerminator,\n        lastIndex,\n        lastLineNumber,\n        lastLineStart,\n        startIndex,\n        startLineNumber,\n        startLineStart,\n        scanning,\n        length,\n        lookahead,\n        state,\n        extra,\n        isBindingElement,\n        isAssignmentTarget,\n        firstCoverInitializedNameError;\n\n    Token = {\n        BooleanLiteral: 1,\n        EOF: 2,\n        Identifier: 3,\n        Keyword: 4,\n        NullLiteral: 5,\n        NumericLiteral: 6,\n        Punctuator: 7,\n        StringLiteral: 8,\n        RegularExpression: 9,\n        Template: 10\n    };\n\n    TokenName = {};\n    TokenName[Token.BooleanLiteral] = 'Boolean';\n    TokenName[Token.EOF] = '<end>';\n    TokenName[Token.Identifier] = 'Identifier';\n    TokenName[Token.Keyword] = 'Keyword';\n    TokenName[Token.NullLiteral] = 'Null';\n    TokenName[Token.NumericLiteral] = 'Numeric';\n    TokenName[Token.Punctuator] = 'Punctuator';\n    TokenName[Token.StringLiteral] = 'String';\n    TokenName[Token.RegularExpression] = 'RegularExpression';\n    TokenName[Token.Template] = 'Template';\n\n    // A function following one of those tokens is an expression.\n    FnExprTokens = ['(', '{', '[', 'in', 'typeof', 'instanceof', 'new',\n                    'return', 'case', 'delete', 'throw', 'void',\n                    // assignment operators\n                    '=', '+=', '-=', '*=', '/=', '%=', '<<=', '>>=', '>>>=',\n                    '&=', '|=', '^=', ',',\n                    // binary/unary operators\n                    '+', '-', '*', '/', '%', '++', '--', '<<', '>>', '>>>', '&',\n                    '|', '^', '!', '~', '&&', '||', '?', ':', '===', '==', '>=',\n                    '<=', '<', '>', '!=', '!=='];\n\n    Syntax = {\n        AssignmentExpression: 'AssignmentExpression',\n        AssignmentPattern: 'AssignmentPattern',\n        ArrayExpression: 'ArrayExpression',\n        ArrayPattern: 'ArrayPattern',\n        ArrowFunctionExpression: 'ArrowFunctionExpression',\n        BlockStatement: 'BlockStatement',\n        BinaryExpression: 'BinaryExpression',\n        BreakStatement: 'BreakStatement',\n        CallExpression: 'CallExpression',\n        CatchClause: 'CatchClause',\n        ClassBody: 'ClassBody',\n        ClassDeclaration: 'ClassDeclaration',\n        ClassExpression: 'ClassExpression',\n        ConditionalExpression: 'ConditionalExpression',\n        ContinueStatement: 'ContinueStatement',\n        DoWhileStatement: 'DoWhileStatement',\n        DebuggerStatement: 'DebuggerStatement',\n        EmptyStatement: 'EmptyStatement',\n        ExportAllDeclaration: 'ExportAllDeclaration',\n        ExportDefaultDeclaration: 'ExportDefaultDeclaration',\n        ExportNamedDeclaration: 'ExportNamedDeclaration',\n        ExportSpecifier: 'ExportSpecifier',\n        ExpressionStatement: 'ExpressionStatement',\n        ForStatement: 'ForStatement',\n        ForOfStatement: 'ForOfStatement',\n        ForInStatement: 'ForInStatement',\n        FunctionDeclaration: 'FunctionDeclaration',\n        FunctionExpression: 'FunctionExpression',\n        Identifier: 'Identifier',\n        IfStatement: 'IfStatement',\n        ImportDeclaration: 'ImportDeclaration',\n        ImportDefaultSpecifier: 'ImportDefaultSpecifier',\n        ImportNamespaceSpecifier: 'ImportNamespaceSpecifier',\n        ImportSpecifier: 'ImportSpecifier',\n        Literal: 'Literal',\n        LabeledStatement: 'LabeledStatement',\n        LogicalExpression: 'LogicalExpression',\n        MemberExpression: 'MemberExpression',\n        MethodDefinition: 'MethodDefinition',\n        NewExpression: 'NewExpression',\n        ObjectExpression: 'ObjectExpression',\n        ObjectPattern: 'ObjectPattern',\n        Program: 'Program',\n        Property: 'Property',\n        RestElement: 'RestElement',\n        ReturnStatement: 'ReturnStatement',\n        SequenceExpression: 'SequenceExpression',\n        SpreadElement: 'SpreadElement',\n        Super: 'Super',\n        SwitchCase: 'SwitchCase',\n        SwitchStatement: 'SwitchStatement',\n        TaggedTemplateExpression: 'TaggedTemplateExpression',\n        TemplateElement: 'TemplateElement',\n        TemplateLiteral: 'TemplateLiteral',\n        ThisExpression: 'ThisExpression',\n        ThrowStatement: 'ThrowStatement',\n        TryStatement: 'TryStatement',\n        UnaryExpression: 'UnaryExpression',\n        UpdateExpression: 'UpdateExpression',\n        VariableDeclaration: 'VariableDeclaration',\n        VariableDeclarator: 'VariableDeclarator',\n        WhileStatement: 'WhileStatement',\n        WithStatement: 'WithStatement',\n        YieldExpression: 'YieldExpression'\n    };\n\n    PlaceHolders = {\n        ArrowParameterPlaceHolder: 'ArrowParameterPlaceHolder'\n    };\n\n    // Error messages should be identical to V8.\n    Messages = {\n        UnexpectedToken: 'Unexpected token %0',\n        UnexpectedNumber: 'Unexpected number',\n        UnexpectedString: 'Unexpected string',\n        UnexpectedIdentifier: 'Unexpected identifier',\n        UnexpectedReserved: 'Unexpected reserved word',\n        UnexpectedTemplate: 'Unexpected quasi %0',\n        UnexpectedEOS: 'Unexpected end of input',\n        NewlineAfterThrow: 'Illegal newline after throw',\n        InvalidRegExp: 'Invalid regular expression',\n        UnterminatedRegExp: 'Invalid regular expression: missing /',\n        InvalidLHSInAssignment: 'Invalid left-hand side in assignment',\n        InvalidLHSInForIn: 'Invalid left-hand side in for-in',\n        InvalidLHSInForLoop: 'Invalid left-hand side in for-loop',\n        MultipleDefaultsInSwitch: 'More than one default clause in switch statement',\n        NoCatchOrFinally: 'Missing catch or finally after try',\n        UnknownLabel: 'Undefined label \\'%0\\'',\n        Redeclaration: '%0 \\'%1\\' has already been declared',\n        IllegalContinue: 'Illegal continue statement',\n        IllegalBreak: 'Illegal break statement',\n        IllegalReturn: 'Illegal return statement',\n        IllegalYield: 'Unexpected token yield',\n        StrictModeWith: 'Strict mode code may not include a with statement',\n        StrictCatchVariable: 'Catch variable may not be eval or arguments in strict mode',\n        StrictVarName: 'Variable name may not be eval or arguments in strict mode',\n        StrictParamName: 'Parameter name eval or arguments is not allowed in strict mode',\n        StrictParamDupe: 'Strict mode function may not have duplicate parameter names',\n        StrictFunctionName: 'Function name may not be eval or arguments in strict mode',\n        StrictOctalLiteral: 'Octal literals are not allowed in strict mode.',\n        StrictDelete: 'Delete of an unqualified identifier in strict mode.',\n        StrictLHSAssignment: 'Assignment to eval or arguments is not allowed in strict mode',\n        StrictLHSPostfix: 'Postfix increment/decrement may not have eval or arguments operand in strict mode',\n        StrictLHSPrefix: 'Prefix increment/decrement may not have eval or arguments operand in strict mode',\n        StrictReservedWord: 'Use of future reserved word in strict mode',\n        TemplateOctalLiteral: 'Octal literals are not allowed in template strings.',\n        ParameterAfterRestParameter: 'Rest parameter must be last formal parameter',\n        DefaultRestParameter: 'Unexpected token =',\n        ObjectPatternAsRestParameter: 'Unexpected token {',\n        DuplicateProtoProperty: 'Duplicate __proto__ fields are not allowed in object literals',\n        ConstructorSpecialMethod: 'Class constructor may not be an accessor',\n        DuplicateConstructor: 'A class may only have one constructor',\n        StaticPrototype: 'Classes may not have static property named prototype',\n        MissingFromClause: 'Unexpected token',\n        NoAsAfterImportNamespace: 'Unexpected token',\n        InvalidModuleSpecifier: 'Unexpected token',\n        IllegalImportDeclaration: 'Unexpected token',\n        IllegalExportDeclaration: 'Unexpected token',\n        DuplicateBinding: 'Duplicate binding %0'\n    };\n\n    // See also tools/generate-unicode-regex.py.\n    Regex = {\n        NonAsciiIdentifierStart: new RegExp('[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]'),\n        NonAsciiIdentifierPart: new RegExp('[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]')\n    };\n\n    // Ensure the condition is true, otherwise throw an error.\n    // This is only to have a better contract semantic, i.e. another safety net\n    // to catch a logic error. The condition shall be fulfilled in normal case.\n    // Do NOT use this to enforce a certain condition on any user input.\n\n    function assert(condition, message) {\n        /* istanbul ignore if */\n        if (!condition) {\n            throw new Error('ASSERT: ' + message);\n        }\n    }\n\n    function isDecimalDigit(ch) {\n        return (ch >= 0x30 && ch <= 0x39);   // 0..9\n    }\n\n    function isHexDigit(ch) {\n        return '0123456789abcdefABCDEF'.indexOf(ch) >= 0;\n    }\n\n    function isOctalDigit(ch) {\n        return '01234567'.indexOf(ch) >= 0;\n    }\n\n    function octalToDecimal(ch) {\n        // \\0 is not octal escape sequence\n        var octal = (ch !== '0'), code = '01234567'.indexOf(ch);\n\n        if (index < length && isOctalDigit(source[index])) {\n            octal = true;\n            code = code * 8 + '01234567'.indexOf(source[index++]);\n\n            // 3 digits are only allowed when string starts\n            // with 0, 1, 2, 3\n            if ('0123'.indexOf(ch) >= 0 &&\n                    index < length &&\n                    isOctalDigit(source[index])) {\n                code = code * 8 + '01234567'.indexOf(source[index++]);\n            }\n        }\n\n        return {\n            code: code,\n            octal: octal\n        };\n    }\n\n    // 7.2 White Space\n\n    function isWhiteSpace(ch) {\n        return (ch === 0x20) || (ch === 0x09) || (ch === 0x0B) || (ch === 0x0C) || (ch === 0xA0) ||\n            (ch >= 0x1680 && [0x1680, 0x180E, 0x2000, 0x2001, 0x2002, 0x2003, 0x2004, 0x2005, 0x2006, 0x2007, 0x2008, 0x2009, 0x200A, 0x202F, 0x205F, 0x3000, 0xFEFF].indexOf(ch) >= 0);\n    }\n\n    // 7.3 Line Terminators\n\n    function isLineTerminator(ch) {\n        return (ch === 0x0A) || (ch === 0x0D) || (ch === 0x2028) || (ch === 0x2029);\n    }\n\n    // 7.6 Identifier Names and Identifiers\n\n    function isIdentifierStart(ch) {\n        return (ch === 0x24) || (ch === 0x5F) ||  // $ (dollar) and _ (underscore)\n            (ch >= 0x41 && ch <= 0x5A) ||         // A..Z\n            (ch >= 0x61 && ch <= 0x7A) ||         // a..z\n            (ch === 0x5C) ||                      // \\ (backslash)\n            ((ch >= 0x80) && Regex.NonAsciiIdentifierStart.test(String.fromCharCode(ch)));\n    }\n\n    function isIdentifierPart(ch) {\n        return (ch === 0x24) || (ch === 0x5F) ||  // $ (dollar) and _ (underscore)\n            (ch >= 0x41 && ch <= 0x5A) ||         // A..Z\n            (ch >= 0x61 && ch <= 0x7A) ||         // a..z\n            (ch >= 0x30 && ch <= 0x39) ||         // 0..9\n            (ch === 0x5C) ||                      // \\ (backslash)\n            ((ch >= 0x80) && Regex.NonAsciiIdentifierPart.test(String.fromCharCode(ch)));\n    }\n\n    // 7.6.1.2 Future Reserved Words\n\n    function isFutureReservedWord(id) {\n        switch (id) {\n        case 'enum':\n        case 'export':\n        case 'import':\n        case 'super':\n            return true;\n        default:\n            return false;\n        }\n    }\n\n    // 11.6.2.2 Future Reserved Words\n\n    function isStrictModeReservedWord(id) {\n        switch (id) {\n        case 'implements':\n        case 'interface':\n        case 'package':\n        case 'private':\n        case 'protected':\n        case 'public':\n        case 'static':\n        case 'yield':\n        case 'let':\n            return true;\n        default:\n            return false;\n        }\n    }\n\n    function isRestrictedWord(id) {\n        return id === 'eval' || id === 'arguments';\n    }\n\n    // 7.6.1.1 Keywords\n\n    function isKeyword(id) {\n\n        // 'const' is specialized as Keyword in V8.\n        // 'yield' and 'let' are for compatibility with SpiderMonkey and ES.next.\n        // Some others are from future reserved words.\n\n        switch (id.length) {\n        case 2:\n            return (id === 'if') || (id === 'in') || (id === 'do');\n        case 3:\n            return (id === 'var') || (id === 'for') || (id === 'new') ||\n                (id === 'try') || (id === 'let');\n        case 4:\n            return (id === 'this') || (id === 'else') || (id === 'case') ||\n                (id === 'void') || (id === 'with') || (id === 'enum');\n        case 5:\n            return (id === 'while') || (id === 'break') || (id === 'catch') ||\n                (id === 'throw') || (id === 'const') || (id === 'yield') ||\n                (id === 'class') || (id === 'super');\n        case 6:\n            return (id === 'return') || (id === 'typeof') || (id === 'delete') ||\n                (id === 'switch') || (id === 'export') || (id === 'import');\n        case 7:\n            return (id === 'default') || (id === 'finally') || (id === 'extends');\n        case 8:\n            return (id === 'function') || (id === 'continue') || (id === 'debugger');\n        case 10:\n            return (id === 'instanceof');\n        default:\n            return false;\n        }\n    }\n\n    // 7.4 Comments\n\n    function addComment(type, value, start, end, loc) {\n        var comment;\n\n        assert(typeof start === 'number', 'Comment must have valid position');\n\n        state.lastCommentStart = start;\n\n        comment = {\n            type: type,\n            value: value\n        };\n        if (extra.range) {\n            comment.range = [start, end];\n        }\n        if (extra.loc) {\n            comment.loc = loc;\n        }\n        extra.comments.push(comment);\n        if (extra.attachComment) {\n            extra.leadingComments.push(comment);\n            extra.trailingComments.push(comment);\n        }\n    }\n\n    function skipSingleLineComment(offset) {\n        var start, loc, ch, comment;\n\n        start = index - offset;\n        loc = {\n            start: {\n                line: lineNumber,\n                column: index - lineStart - offset\n            }\n        };\n\n        while (index < length) {\n            ch = source.charCodeAt(index);\n            ++index;\n            if (isLineTerminator(ch)) {\n                hasLineTerminator = true;\n                if (extra.comments) {\n                    comment = source.slice(start + offset, index - 1);\n                    loc.end = {\n                        line: lineNumber,\n                        column: index - lineStart - 1\n                    };\n                    addComment('Line', comment, start, index - 1, loc);\n                }\n                if (ch === 13 && source.charCodeAt(index) === 10) {\n                    ++index;\n                }\n                ++lineNumber;\n                lineStart = index;\n                return;\n            }\n        }\n\n        if (extra.comments) {\n            comment = source.slice(start + offset, index);\n            loc.end = {\n                line: lineNumber,\n                column: index - lineStart\n            };\n            addComment('Line', comment, start, index, loc);\n        }\n    }\n\n    function skipMultiLineComment() {\n        var start, loc, ch, comment;\n\n        if (extra.comments) {\n            start = index - 2;\n            loc = {\n                start: {\n                    line: lineNumber,\n                    column: index - lineStart - 2\n                }\n            };\n        }\n\n        while (index < length) {\n            ch = source.charCodeAt(index);\n            if (isLineTerminator(ch)) {\n                if (ch === 0x0D && source.charCodeAt(index + 1) === 0x0A) {\n                    ++index;\n                }\n                hasLineTerminator = true;\n                ++lineNumber;\n                ++index;\n                lineStart = index;\n            } else if (ch === 0x2A) {\n                // Block comment ends with '*/'.\n                if (source.charCodeAt(index + 1) === 0x2F) {\n                    ++index;\n                    ++index;\n                    if (extra.comments) {\n                        comment = source.slice(start + 2, index - 2);\n                        loc.end = {\n                            line: lineNumber,\n                            column: index - lineStart\n                        };\n                        addComment('Block', comment, start, index, loc);\n                    }\n                    return;\n                }\n                ++index;\n            } else {\n                ++index;\n            }\n        }\n\n        // Ran off the end of the file - the whole thing is a comment\n        if (extra.comments) {\n            loc.end = {\n                line: lineNumber,\n                column: index - lineStart\n            };\n            comment = source.slice(start + 2, index);\n            addComment('Block', comment, start, index, loc);\n        }\n        tolerateUnexpectedToken();\n    }\n\n    function skipComment() {\n        var ch, start;\n        hasLineTerminator = false;\n\n        start = (index === 0);\n        while (index < length) {\n            ch = source.charCodeAt(index);\n\n            if (isWhiteSpace(ch)) {\n                ++index;\n            } else if (isLineTerminator(ch)) {\n                hasLineTerminator = true;\n                ++index;\n                if (ch === 0x0D && source.charCodeAt(index) === 0x0A) {\n                    ++index;\n                }\n                ++lineNumber;\n                lineStart = index;\n                start = true;\n            } else if (ch === 0x2F) { // U+002F is '/'\n                ch = source.charCodeAt(index + 1);\n                if (ch === 0x2F) {\n                    ++index;\n                    ++index;\n                    skipSingleLineComment(2);\n                    start = true;\n                } else if (ch === 0x2A) {  // U+002A is '*'\n                    ++index;\n                    ++index;\n                    skipMultiLineComment();\n                } else {\n                    break;\n                }\n            } else if (start && ch === 0x2D) { // U+002D is '-'\n                // U+003E is '>'\n                if ((source.charCodeAt(index + 1) === 0x2D) && (source.charCodeAt(index + 2) === 0x3E)) {\n                    // '-->' is a single-line comment\n                    index += 3;\n                    skipSingleLineComment(3);\n                } else {\n                    break;\n                }\n            } else if (ch === 0x3C) { // U+003C is '<'\n                if (source.slice(index + 1, index + 4) === '!--') {\n                    ++index; // `<`\n                    ++index; // `!`\n                    ++index; // `-`\n                    ++index; // `-`\n                    skipSingleLineComment(4);\n                } else {\n                    break;\n                }\n            } else {\n                break;\n            }\n        }\n    }\n\n    function scanHexEscape(prefix) {\n        var i, len, ch, code = 0;\n\n        len = (prefix === 'u') ? 4 : 2;\n        for (i = 0; i < len; ++i) {\n            if (index < length && isHexDigit(source[index])) {\n                ch = source[index++];\n                code = code * 16 + '0123456789abcdef'.indexOf(ch.toLowerCase());\n            } else {\n                return '';\n            }\n        }\n        return String.fromCharCode(code);\n    }\n\n    function scanUnicodeCodePointEscape() {\n        var ch, code, cu1, cu2;\n\n        ch = source[index];\n        code = 0;\n\n        // At least, one hex digit is required.\n        if (ch === '}') {\n            throwUnexpectedToken();\n        }\n\n        while (index < length) {\n            ch = source[index++];\n            if (!isHexDigit(ch)) {\n                break;\n            }\n            code = code * 16 + '0123456789abcdef'.indexOf(ch.toLowerCase());\n        }\n\n        if (code > 0x10FFFF || ch !== '}') {\n            throwUnexpectedToken();\n        }\n\n        // UTF-16 Encoding\n        if (code <= 0xFFFF) {\n            return String.fromCharCode(code);\n        }\n        cu1 = ((code - 0x10000) >> 10) + 0xD800;\n        cu2 = ((code - 0x10000) & 1023) + 0xDC00;\n        return String.fromCharCode(cu1, cu2);\n    }\n\n    function getEscapedIdentifier() {\n        var ch, id;\n\n        ch = source.charCodeAt(index++);\n        id = String.fromCharCode(ch);\n\n        // '\\u' (U+005C, U+0075) denotes an escaped character.\n        if (ch === 0x5C) {\n            if (source.charCodeAt(index) !== 0x75) {\n                throwUnexpectedToken();\n            }\n            ++index;\n            ch = scanHexEscape('u');\n            if (!ch || ch === '\\\\' || !isIdentifierStart(ch.charCodeAt(0))) {\n                throwUnexpectedToken();\n            }\n            id = ch;\n        }\n\n        while (index < length) {\n            ch = source.charCodeAt(index);\n            if (!isIdentifierPart(ch)) {\n                break;\n            }\n            ++index;\n            id += String.fromCharCode(ch);\n\n            // '\\u' (U+005C, U+0075) denotes an escaped character.\n            if (ch === 0x5C) {\n                id = id.substr(0, id.length - 1);\n                if (source.charCodeAt(index) !== 0x75) {\n                    throwUnexpectedToken();\n                }\n                ++index;\n                ch = scanHexEscape('u');\n                if (!ch || ch === '\\\\' || !isIdentifierPart(ch.charCodeAt(0))) {\n                    throwUnexpectedToken();\n                }\n                id += ch;\n            }\n        }\n\n        return id;\n    }\n\n    function getIdentifier() {\n        var start, ch;\n\n        start = index++;\n        while (index < length) {\n            ch = source.charCodeAt(index);\n            if (ch === 0x5C) {\n                // Blackslash (U+005C) marks Unicode escape sequence.\n                index = start;\n                return getEscapedIdentifier();\n            }\n            if (isIdentifierPart(ch)) {\n                ++index;\n            } else {\n                break;\n            }\n        }\n\n        return source.slice(start, index);\n    }\n\n    function scanIdentifier() {\n        var start, id, type;\n\n        start = index;\n\n        // Backslash (U+005C) starts an escaped character.\n        id = (source.charCodeAt(index) === 0x5C) ? getEscapedIdentifier() : getIdentifier();\n\n        // There is no keyword or literal with only one character.\n        // Thus, it must be an identifier.\n        if (id.length === 1) {\n            type = Token.Identifier;\n        } else if (isKeyword(id)) {\n            type = Token.Keyword;\n        } else if (id === 'null') {\n            type = Token.NullLiteral;\n        } else if (id === 'true' || id === 'false') {\n            type = Token.BooleanLiteral;\n        } else {\n            type = Token.Identifier;\n        }\n\n        return {\n            type: type,\n            value: id,\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n\n    // 7.7 Punctuators\n\n    function scanPunctuator() {\n        var token, str;\n\n        token = {\n            type: Token.Punctuator,\n            value: '',\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: index,\n            end: index\n        };\n\n        // Check for most common single-character punctuators.\n        str = source[index];\n        switch (str) {\n\n        case '(':\n            if (extra.tokenize) {\n                extra.openParenToken = extra.tokens.length;\n            }\n            ++index;\n            break;\n\n        case '{':\n            if (extra.tokenize) {\n                extra.openCurlyToken = extra.tokens.length;\n            }\n            state.curlyStack.push('{');\n            ++index;\n            break;\n\n        case '.':\n            ++index;\n            if (source[index] === '.' && source[index + 1] === '.') {\n                // Spread operator: ...\n                index += 2;\n                str = '...';\n            }\n            break;\n\n        case '}':\n            ++index;\n            state.curlyStack.pop();\n            break;\n        case ')':\n        case ';':\n        case ',':\n        case '[':\n        case ']':\n        case ':':\n        case '?':\n        case '~':\n            ++index;\n            break;\n\n        default:\n            // 4-character punctuator.\n            str = source.substr(index, 4);\n            if (str === '>>>=') {\n                index += 4;\n            } else {\n\n                // 3-character punctuators.\n                str = str.substr(0, 3);\n                if (str === '===' || str === '!==' || str === '>>>' ||\n                    str === '<<=' || str === '>>=') {\n                    index += 3;\n                } else {\n\n                    // 2-character punctuators.\n                    str = str.substr(0, 2);\n                    if (str === '&&' || str === '||' || str === '==' || str === '!=' ||\n                        str === '+=' || str === '-=' || str === '*=' || str === '/=' ||\n                        str === '++' || str === '--' || str === '<<' || str === '>>' ||\n                        str === '&=' || str === '|=' || str === '^=' || str === '%=' ||\n                        str === '<=' || str === '>=' || str === '=>') {\n                        index += 2;\n                    } else {\n\n                        // 1-character punctuators.\n                        str = source[index];\n                        if ('<>=!+-*%&|^/'.indexOf(str) >= 0) {\n                            ++index;\n                        }\n                    }\n                }\n            }\n        }\n\n        if (index === token.start) {\n            throwUnexpectedToken();\n        }\n\n        token.end = index;\n        token.value = str;\n        return token;\n    }\n\n    // 7.8.3 Numeric Literals\n\n    function scanHexLiteral(start) {\n        var number = '';\n\n        while (index < length) {\n            if (!isHexDigit(source[index])) {\n                break;\n            }\n            number += source[index++];\n        }\n\n        if (number.length === 0) {\n            throwUnexpectedToken();\n        }\n\n        if (isIdentifierStart(source.charCodeAt(index))) {\n            throwUnexpectedToken();\n        }\n\n        return {\n            type: Token.NumericLiteral,\n            value: parseInt('0x' + number, 16),\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    function scanBinaryLiteral(start) {\n        var ch, number;\n\n        number = '';\n\n        while (index < length) {\n            ch = source[index];\n            if (ch !== '0' && ch !== '1') {\n                break;\n            }\n            number += source[index++];\n        }\n\n        if (number.length === 0) {\n            // only 0b or 0B\n            throwUnexpectedToken();\n        }\n\n        if (index < length) {\n            ch = source.charCodeAt(index);\n            /* istanbul ignore else */\n            if (isIdentifierStart(ch) || isDecimalDigit(ch)) {\n                throwUnexpectedToken();\n            }\n        }\n\n        return {\n            type: Token.NumericLiteral,\n            value: parseInt(number, 2),\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    function scanOctalLiteral(prefix, start) {\n        var number, octal;\n\n        if (isOctalDigit(prefix)) {\n            octal = true;\n            number = '0' + source[index++];\n        } else {\n            octal = false;\n            ++index;\n            number = '';\n        }\n\n        while (index < length) {\n            if (!isOctalDigit(source[index])) {\n                break;\n            }\n            number += source[index++];\n        }\n\n        if (!octal && number.length === 0) {\n            // only 0o or 0O\n            throwUnexpectedToken();\n        }\n\n        if (isIdentifierStart(source.charCodeAt(index)) || isDecimalDigit(source.charCodeAt(index))) {\n            throwUnexpectedToken();\n        }\n\n        return {\n            type: Token.NumericLiteral,\n            value: parseInt(number, 8),\n            octal: octal,\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    function isImplicitOctalLiteral() {\n        var i, ch;\n\n        // Implicit octal, unless there is a non-octal digit.\n        // (Annex B.1.1 on Numeric Literals)\n        for (i = index + 1; i < length; ++i) {\n            ch = source[i];\n            if (ch === '8' || ch === '9') {\n                return false;\n            }\n            if (!isOctalDigit(ch)) {\n                return true;\n            }\n        }\n\n        return true;\n    }\n\n    function scanNumericLiteral() {\n        var number, start, ch;\n\n        ch = source[index];\n        assert(isDecimalDigit(ch.charCodeAt(0)) || (ch === '.'),\n            'Numeric literal must start with a decimal digit or a decimal point');\n\n        start = index;\n        number = '';\n        if (ch !== '.') {\n            number = source[index++];\n            ch = source[index];\n\n            // Hex number starts with '0x'.\n            // Octal number starts with '0'.\n            // Octal number in ES6 starts with '0o'.\n            // Binary number in ES6 starts with '0b'.\n            if (number === '0') {\n                if (ch === 'x' || ch === 'X') {\n                    ++index;\n                    return scanHexLiteral(start);\n                }\n                if (ch === 'b' || ch === 'B') {\n                    ++index;\n                    return scanBinaryLiteral(start);\n                }\n                if (ch === 'o' || ch === 'O') {\n                    return scanOctalLiteral(ch, start);\n                }\n\n                if (isOctalDigit(ch)) {\n                    if (isImplicitOctalLiteral()) {\n                        return scanOctalLiteral(ch, start);\n                    }\n                }\n            }\n\n            while (isDecimalDigit(source.charCodeAt(index))) {\n                number += source[index++];\n            }\n            ch = source[index];\n        }\n\n        if (ch === '.') {\n            number += source[index++];\n            while (isDecimalDigit(source.charCodeAt(index))) {\n                number += source[index++];\n            }\n            ch = source[index];\n        }\n\n        if (ch === 'e' || ch === 'E') {\n            number += source[index++];\n\n            ch = source[index];\n            if (ch === '+' || ch === '-') {\n                number += source[index++];\n            }\n            if (isDecimalDigit(source.charCodeAt(index))) {\n                while (isDecimalDigit(source.charCodeAt(index))) {\n                    number += source[index++];\n                }\n            } else {\n                throwUnexpectedToken();\n            }\n        }\n\n        if (isIdentifierStart(source.charCodeAt(index))) {\n            throwUnexpectedToken();\n        }\n\n        return {\n            type: Token.NumericLiteral,\n            value: parseFloat(number),\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    // 7.8.4 String Literals\n\n    function scanStringLiteral() {\n        var str = '', quote, start, ch, unescaped, octToDec, octal = false;\n\n        quote = source[index];\n        assert((quote === '\\'' || quote === '\"'),\n            'String literal must starts with a quote');\n\n        start = index;\n        ++index;\n\n        while (index < length) {\n            ch = source[index++];\n\n            if (ch === quote) {\n                quote = '';\n                break;\n            } else if (ch === '\\\\') {\n                ch = source[index++];\n                if (!ch || !isLineTerminator(ch.charCodeAt(0))) {\n                    switch (ch) {\n                    case 'u':\n                    case 'x':\n                        if (source[index] === '{') {\n                            ++index;\n                            str += scanUnicodeCodePointEscape();\n                        } else {\n                            unescaped = scanHexEscape(ch);\n                            if (!unescaped) {\n                                throw throwUnexpectedToken();\n                            }\n                            str += unescaped;\n                        }\n                        break;\n                    case 'n':\n                        str += '\\n';\n                        break;\n                    case 'r':\n                        str += '\\r';\n                        break;\n                    case 't':\n                        str += '\\t';\n                        break;\n                    case 'b':\n                        str += '\\b';\n                        break;\n                    case 'f':\n                        str += '\\f';\n                        break;\n                    case 'v':\n                        str += '\\x0B';\n                        break;\n                    case '8':\n                    case '9':\n                        throw throwUnexpectedToken();\n\n                    default:\n                        if (isOctalDigit(ch)) {\n                            octToDec = octalToDecimal(ch);\n\n                            octal = octToDec.octal || octal;\n                            str += String.fromCharCode(octToDec.code);\n                        } else {\n                            str += ch;\n                        }\n                        break;\n                    }\n                } else {\n                    ++lineNumber;\n                    if (ch === '\\r' && source[index] === '\\n') {\n                        ++index;\n                    }\n                    lineStart = index;\n                }\n            } else if (isLineTerminator(ch.charCodeAt(0))) {\n                break;\n            } else {\n                str += ch;\n            }\n        }\n\n        if (quote !== '') {\n            throwUnexpectedToken();\n        }\n\n        return {\n            type: Token.StringLiteral,\n            value: str,\n            octal: octal,\n            lineNumber: startLineNumber,\n            lineStart: startLineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    function scanTemplate() {\n        var cooked = '', ch, start, rawOffset, terminated, head, tail, restore, unescaped;\n\n        terminated = false;\n        tail = false;\n        start = index;\n        head = (source[index] === '`');\n        rawOffset = 2;\n\n        ++index;\n\n        while (index < length) {\n            ch = source[index++];\n            if (ch === '`') {\n                rawOffset = 1;\n                tail = true;\n                terminated = true;\n                break;\n            } else if (ch === '$') {\n                if (source[index] === '{') {\n                    state.curlyStack.push('${');\n                    ++index;\n                    terminated = true;\n                    break;\n                }\n                cooked += ch;\n            } else if (ch === '\\\\') {\n                ch = source[index++];\n                if (!isLineTerminator(ch.charCodeAt(0))) {\n                    switch (ch) {\n                    case 'n':\n                        cooked += '\\n';\n                        break;\n                    case 'r':\n                        cooked += '\\r';\n                        break;\n                    case 't':\n                        cooked += '\\t';\n                        break;\n                    case 'u':\n                    case 'x':\n                        if (source[index] === '{') {\n                            ++index;\n                            cooked += scanUnicodeCodePointEscape();\n                        } else {\n                            restore = index;\n                            unescaped = scanHexEscape(ch);\n                            if (unescaped) {\n                                cooked += unescaped;\n                            } else {\n                                index = restore;\n                                cooked += ch;\n                            }\n                        }\n                        break;\n                    case 'b':\n                        cooked += '\\b';\n                        break;\n                    case 'f':\n                        cooked += '\\f';\n                        break;\n                    case 'v':\n                        cooked += '\\v';\n                        break;\n\n                    default:\n                        if (ch === '0') {\n                            if (isDecimalDigit(source.charCodeAt(index))) {\n                                // Illegal: \\01 \\02 and so on\n                                throwError(Messages.TemplateOctalLiteral);\n                            }\n                            cooked += '\\0';\n                        } else if (isOctalDigit(ch)) {\n                            // Illegal: \\1 \\2\n                            throwError(Messages.TemplateOctalLiteral);\n                        } else {\n                            cooked += ch;\n                        }\n                        break;\n                    }\n                } else {\n                    ++lineNumber;\n                    if (ch === '\\r' && source[index] === '\\n') {\n                        ++index;\n                    }\n                    lineStart = index;\n                }\n            } else if (isLineTerminator(ch.charCodeAt(0))) {\n                ++lineNumber;\n                if (ch === '\\r' && source[index] === '\\n') {\n                    ++index;\n                }\n                lineStart = index;\n                cooked += '\\n';\n            } else {\n                cooked += ch;\n            }\n        }\n\n        if (!terminated) {\n            throwUnexpectedToken();\n        }\n\n        if (!head) {\n            state.curlyStack.pop();\n        }\n\n        return {\n            type: Token.Template,\n            value: {\n                cooked: cooked,\n                raw: source.slice(start + 1, index - rawOffset)\n            },\n            head: head,\n            tail: tail,\n            lineNumber: lineNumber,\n            lineStart: lineStart,\n            start: start,\n            end: index\n        };\n    }\n\n    function testRegExp(pattern, flags) {\n        // The BMP character to use as a replacement for astral symbols when\n        // translating an ES6 \"u\"-flagged pattern to an ES5-compatible\n        // approximation.\n        // Note: replacing with '\\uFFFF' enables false positives in unlikely\n        // scenarios. For example, `[\\u{1044f}-\\u{10440}]` is an invalid\n        // pattern that would not be detected by this substitution.\n        var astralSubstitute = '\\uFFFF',\n            tmp = pattern;\n\n        if (flags.indexOf('u') >= 0) {\n            tmp = tmp\n                // Replace every Unicode escape sequence with the equivalent\n                // BMP character or a constant ASCII code point in the case of\n                // astral symbols. (See the above note on `astralSubstitute`\n                // for more information.)\n                .replace(/\\\\u\\{([0-9a-fA-F]+)\\}|\\\\u([a-fA-F0-9]{4})/g, function ($0, $1, $2) {\n                    var codePoint = parseInt($1 || $2, 16);\n                    if (codePoint > 0x10FFFF) {\n                        throwUnexpectedToken(null, Messages.InvalidRegExp);\n                    }\n                    if (codePoint <= 0xFFFF) {\n                        return String.fromCharCode(codePoint);\n                    }\n                    return astralSubstitute;\n                })\n                // Replace each paired surrogate with a single ASCII symbol to\n                // avoid throwing on regular expressions that are only valid in\n                // combination with the \"u\" flag.\n                .replace(\n                    /[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g,\n                    astralSubstitute\n                );\n        }\n\n        // First, detect invalid regular expressions.\n        try {\n            RegExp(tmp);\n        } catch (e) {\n            throwUnexpectedToken(null, Messages.InvalidRegExp);\n        }\n\n        // Return a regular expression object for this pattern-flag pair, or\n        // `null` in case the current environment doesn't support the flags it\n        // uses.\n        try {\n            return new RegExp(pattern, flags);\n        } catch (exception) {\n            return null;\n        }\n    }\n\n    function scanRegExpBody() {\n        var ch, str, classMarker, terminated, body;\n\n        ch = source[index];\n        assert(ch === '/', 'Regular expression literal must start with a slash');\n        str = source[index++];\n\n        classMarker = false;\n        terminated = false;\n        while (index < length) {\n            ch = source[index++];\n            str += ch;\n            if (ch === '\\\\') {\n                ch = source[index++];\n                // ECMA-262 7.8.5\n                if (isLineTerminator(ch.charCodeAt(0))) {\n                    throwUnexpectedToken(null, Messages.UnterminatedRegExp);\n                }\n                str += ch;\n            } else if (isLineTerminator(ch.charCodeAt(0))) {\n                throwUnexpectedToken(null, Messages.UnterminatedRegExp);\n            } else if (classMarker) {\n                if (ch === ']') {\n                    classMarker = false;\n                }\n            } else {\n                if (ch === '/') {\n                    terminated = true;\n                    break;\n                } else if (ch === '[') {\n                    classMarker = true;\n                }\n            }\n        }\n\n        if (!terminated) {\n            throwUnexpectedToken(null, Messages.UnterminatedRegExp);\n        }\n\n        // Exclude leading and trailing slash.\n        body = str.substr(1, str.length - 2);\n        return {\n            value: body,\n            literal: str\n        };\n    }\n\n    function scanRegExpFlags() {\n        var ch, str, flags, restore;\n\n        str = '';\n        flags = '';\n        while (index < length) {\n            ch = source[index];\n            if (!isIdentifierPart(ch.charCodeAt(0))) {\n                break;\n            }\n\n            ++index;\n            if (ch === '\\\\' && index < length) {\n                ch = source[index];\n                if (ch === 'u') {\n                    ++index;\n                    restore = index;\n                    ch = scanHexEscape('u');\n                    if (ch) {\n                        flags += ch;\n                        for (str += '\\\\u'; restore < index; ++restore) {\n                            str += source[restore];\n                        }\n                    } else {\n                        index = restore;\n                        flags += 'u';\n                        str += '\\\\u';\n                    }\n                    tolerateUnexpectedToken();\n                } else {\n                    str += '\\\\';\n                    tolerateUnexpectedToken();\n                }\n            } else {\n                flags += ch;\n                str += ch;\n            }\n        }\n\n        return {\n            value: flags,\n            literal: str\n        };\n    }\n\n    function scanRegExp() {\n        scanning = true;\n        var start, body, flags, value;\n\n        lookahead = null;\n        skipComment();\n        start = index;\n\n        body = scanRegExpBody();\n        flags = scanRegExpFlags();\n        value = testRegExp(body.value, flags.value);\n        scanning = false;\n        if (extra.tokenize) {\n            return {\n                type: Token.RegularExpression,\n                value: value,\n                regex: {\n                    pattern: body.value,\n                    flags: flags.value\n                },\n                lineNumber: lineNumber,\n                lineStart: lineStart,\n                start: start,\n                end: index\n            };\n        }\n\n        return {\n            literal: body.literal + flags.literal,\n            value: value,\n            regex: {\n                pattern: body.value,\n                flags: flags.value\n            },\n            start: start,\n            end: index\n        };\n    }\n\n    function collectRegex() {\n        var pos, loc, regex, token;\n\n        skipComment();\n\n        pos = index;\n        loc = {\n            start: {\n                line: lineNumber,\n                column: index - lineStart\n            }\n        };\n\n        regex = scanRegExp();\n\n        loc.end = {\n            line: lineNumber,\n            column: index - lineStart\n        };\n\n        /* istanbul ignore next */\n        if (!extra.tokenize) {\n            // Pop the previous token, which is likely '/' or '/='\n            if (extra.tokens.length > 0) {\n                token = extra.tokens[extra.tokens.length - 1];\n                if (token.range[0] === pos && token.type === 'Punctuator') {\n                    if (token.value === '/' || token.value === '/=') {\n                        extra.tokens.pop();\n                    }\n                }\n            }\n\n            extra.tokens.push({\n                type: 'RegularExpression',\n                value: regex.literal,\n                regex: regex.regex,\n                range: [pos, index],\n                loc: loc\n            });\n        }\n\n        return regex;\n    }\n\n    function isIdentifierName(token) {\n        return token.type === Token.Identifier ||\n            token.type === Token.Keyword ||\n            token.type === Token.BooleanLiteral ||\n            token.type === Token.NullLiteral;\n    }\n\n    function advanceSlash() {\n        var prevToken,\n            checkToken;\n        // Using the following algorithm:\n        // https://github.com/mozilla/sweet.js/wiki/design\n        prevToken = extra.tokens[extra.tokens.length - 1];\n        if (!prevToken) {\n            // Nothing before that: it cannot be a division.\n            return collectRegex();\n        }\n        if (prevToken.type === 'Punctuator') {\n            if (prevToken.value === ']') {\n                return scanPunctuator();\n            }\n            if (prevToken.value === ')') {\n                checkToken = extra.tokens[extra.openParenToken - 1];\n                if (checkToken &&\n                        checkToken.type === 'Keyword' &&\n                        (checkToken.value === 'if' ||\n                         checkToken.value === 'while' ||\n                         checkToken.value === 'for' ||\n                         checkToken.value === 'with')) {\n                    return collectRegex();\n                }\n                return scanPunctuator();\n            }\n            if (prevToken.value === '}') {\n                // Dividing a function by anything makes little sense,\n                // but we have to check for that.\n                if (extra.tokens[extra.openCurlyToken - 3] &&\n                        extra.tokens[extra.openCurlyToken - 3].type === 'Keyword') {\n                    // Anonymous function.\n                    checkToken = extra.tokens[extra.openCurlyToken - 4];\n                    if (!checkToken) {\n                        return scanPunctuator();\n                    }\n                } else if (extra.tokens[extra.openCurlyToken - 4] &&\n                        extra.tokens[extra.openCurlyToken - 4].type === 'Keyword') {\n                    // Named function.\n                    checkToken = extra.tokens[extra.openCurlyToken - 5];\n                    if (!checkToken) {\n                        return collectRegex();\n                    }\n                } else {\n                    return scanPunctuator();\n                }\n                // checkToken determines whether the function is\n                // a declaration or an expression.\n                if (FnExprTokens.indexOf(checkToken.value) >= 0) {\n                    // It is an expression.\n                    return scanPunctuator();\n                }\n                // It is a declaration.\n                return collectRegex();\n            }\n            return collectRegex();\n        }\n        if (prevToken.type === 'Keyword' && prevToken.value !== 'this') {\n            return collectRegex();\n        }\n        return scanPunctuator();\n    }\n\n    function advance() {\n        var ch, token;\n\n        if (index >= length) {\n            return {\n                type: Token.EOF,\n                lineNumber: lineNumber,\n                lineStart: lineStart,\n                start: index,\n                end: index\n            };\n        }\n\n        ch = source.charCodeAt(index);\n\n        if (isIdentifierStart(ch)) {\n            token = scanIdentifier();\n            if (strict && isStrictModeReservedWord(token.value)) {\n                token.type = Token.Keyword;\n            }\n            return token;\n        }\n\n        // Very common: ( and ) and ;\n        if (ch === 0x28 || ch === 0x29 || ch === 0x3B) {\n            return scanPunctuator();\n        }\n\n        // String literal starts with single quote (U+0027) or double quote (U+0022).\n        if (ch === 0x27 || ch === 0x22) {\n            return scanStringLiteral();\n        }\n\n        // Dot (.) U+002E can also start a floating-point number, hence the need\n        // to check the next character.\n        if (ch === 0x2E) {\n            if (isDecimalDigit(source.charCodeAt(index + 1))) {\n                return scanNumericLiteral();\n            }\n            return scanPunctuator();\n        }\n\n        if (isDecimalDigit(ch)) {\n            return scanNumericLiteral();\n        }\n\n        // Slash (/) U+002F can also start a regex.\n        if (extra.tokenize && ch === 0x2F) {\n            return advanceSlash();\n        }\n\n        // Template literals start with ` (U+0060) for template head\n        // or } (U+007D) for template middle or template tail.\n        if (ch === 0x60 || (ch === 0x7D && state.curlyStack[state.curlyStack.length - 1] === '${')) {\n            return scanTemplate();\n        }\n\n        return scanPunctuator();\n    }\n\n    function collectToken() {\n        var loc, token, value, entry;\n\n        loc = {\n            start: {\n                line: lineNumber,\n                column: index - lineStart\n            }\n        };\n\n        token = advance();\n        loc.end = {\n            line: lineNumber,\n            column: index - lineStart\n        };\n\n        if (token.type !== Token.EOF) {\n            value = source.slice(token.start, token.end);\n            entry = {\n                type: TokenName[token.type],\n                value: value,\n                range: [token.start, token.end],\n                loc: loc\n            };\n            if (token.regex) {\n                entry.regex = {\n                    pattern: token.regex.pattern,\n                    flags: token.regex.flags\n                };\n            }\n            extra.tokens.push(entry);\n        }\n\n        return token;\n    }\n\n    function lex() {\n        var token;\n        scanning = true;\n\n        lastIndex = index;\n        lastLineNumber = lineNumber;\n        lastLineStart = lineStart;\n\n        skipComment();\n\n        token = lookahead;\n\n        startIndex = index;\n        startLineNumber = lineNumber;\n        startLineStart = lineStart;\n\n        lookahead = (typeof extra.tokens !== 'undefined') ? collectToken() : advance();\n        scanning = false;\n        return token;\n    }\n\n    function peek() {\n        scanning = true;\n\n        skipComment();\n\n        lastIndex = index;\n        lastLineNumber = lineNumber;\n        lastLineStart = lineStart;\n\n        startIndex = index;\n        startLineNumber = lineNumber;\n        startLineStart = lineStart;\n\n        lookahead = (typeof extra.tokens !== 'undefined') ? collectToken() : advance();\n        scanning = false;\n    }\n\n    function Position() {\n        this.line = startLineNumber;\n        this.column = startIndex - startLineStart;\n    }\n\n    function SourceLocation() {\n        this.start = new Position();\n        this.end = null;\n    }\n\n    function WrappingSourceLocation(startToken) {\n        this.start = {\n            line: startToken.lineNumber,\n            column: startToken.start - startToken.lineStart\n        };\n        this.end = null;\n    }\n\n    function Node() {\n        if (extra.range) {\n            this.range = [startIndex, 0];\n        }\n        if (extra.loc) {\n            this.loc = new SourceLocation();\n        }\n    }\n\n    function WrappingNode(startToken) {\n        if (extra.range) {\n            this.range = [startToken.start, 0];\n        }\n        if (extra.loc) {\n            this.loc = new WrappingSourceLocation(startToken);\n        }\n    }\n\n    WrappingNode.prototype = Node.prototype = {\n\n        processComment: function () {\n            var lastChild,\n                leadingComments,\n                trailingComments,\n                bottomRight = extra.bottomRightStack,\n                i,\n                comment,\n                last = bottomRight[bottomRight.length - 1];\n\n            if (this.type === Syntax.Program) {\n                if (this.body.length > 0) {\n                    return;\n                }\n            }\n\n            if (extra.trailingComments.length > 0) {\n                trailingComments = [];\n                for (i = extra.trailingComments.length - 1; i >= 0; --i) {\n                    comment = extra.trailingComments[i];\n                    if (comment.range[0] >= this.range[1]) {\n                        trailingComments.unshift(comment);\n                        extra.trailingComments.splice(i, 1);\n                    }\n                }\n                extra.trailingComments = [];\n            } else {\n                if (last && last.trailingComments && last.trailingComments[0].range[0] >= this.range[1]) {\n                    trailingComments = last.trailingComments;\n                    delete last.trailingComments;\n                }\n            }\n\n            // Eating the stack.\n            while (last && last.range[0] >= this.range[0]) {\n                lastChild = bottomRight.pop();\n                last = bottomRight[bottomRight.length - 1];\n            }\n\n            if (lastChild) {\n                if (lastChild.leadingComments) {\n                    leadingComments = [];\n                    for (i = lastChild.leadingComments.length - 1; i >= 0; --i) {\n                        comment = lastChild.leadingComments[i];\n                        if (comment.range[1] <= this.range[0]) {\n                            leadingComments.unshift(comment);\n                            lastChild.leadingComments.splice(i, 1);\n                        }\n                    }\n\n                    if (!lastChild.leadingComments.length) {\n                        lastChild.leadingComments = undefined;\n                    }\n                }\n            } else if (extra.leadingComments.length > 0) {\n                leadingComments = [];\n                for (i = extra.leadingComments.length - 1; i >= 0; --i) {\n                    comment = extra.leadingComments[i];\n                    if (comment.range[1] <= this.range[0]) {\n                        leadingComments.unshift(comment);\n                        extra.leadingComments.splice(i, 1);\n                    }\n                }\n            }\n\n\n            if (leadingComments && leadingComments.length > 0) {\n                this.leadingComments = leadingComments;\n            }\n            if (trailingComments && trailingComments.length > 0) {\n                this.trailingComments = trailingComments;\n            }\n\n            bottomRight.push(this);\n        },\n\n        finish: function () {\n            if (extra.range) {\n                this.range[1] = lastIndex;\n            }\n            if (extra.loc) {\n                this.loc.end = {\n                    line: lastLineNumber,\n                    column: lastIndex - lastLineStart\n                };\n                if (extra.source) {\n                    this.loc.source = extra.source;\n                }\n            }\n\n            if (extra.attachComment) {\n                this.processComment();\n            }\n        },\n\n        finishArrayExpression: function (elements) {\n            this.type = Syntax.ArrayExpression;\n            this.elements = elements;\n            this.finish();\n            return this;\n        },\n\n        finishArrayPattern: function (elements) {\n            this.type = Syntax.ArrayPattern;\n            this.elements = elements;\n            this.finish();\n            return this;\n        },\n\n        finishArrowFunctionExpression: function (params, defaults, body, expression) {\n            this.type = Syntax.ArrowFunctionExpression;\n            this.id = null;\n            this.params = params;\n            this.defaults = defaults;\n            this.body = body;\n            this.generator = false;\n            this.expression = expression;\n            this.finish();\n            return this;\n        },\n\n        finishAssignmentExpression: function (operator, left, right) {\n            this.type = Syntax.AssignmentExpression;\n            this.operator = operator;\n            this.left = left;\n            this.right = right;\n            this.finish();\n            return this;\n        },\n\n        finishAssignmentPattern: function (left, right) {\n            this.type = Syntax.AssignmentPattern;\n            this.left = left;\n            this.right = right;\n            this.finish();\n            return this;\n        },\n\n        finishBinaryExpression: function (operator, left, right) {\n            this.type = (operator === '||' || operator === '&&') ? Syntax.LogicalExpression : Syntax.BinaryExpression;\n            this.operator = operator;\n            this.left = left;\n            this.right = right;\n            this.finish();\n            return this;\n        },\n\n        finishBlockStatement: function (body) {\n            this.type = Syntax.BlockStatement;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishBreakStatement: function (label) {\n            this.type = Syntax.BreakStatement;\n            this.label = label;\n            this.finish();\n            return this;\n        },\n\n        finishCallExpression: function (callee, args) {\n            this.type = Syntax.CallExpression;\n            this.callee = callee;\n            this.arguments = args;\n            this.finish();\n            return this;\n        },\n\n        finishCatchClause: function (param, body) {\n            this.type = Syntax.CatchClause;\n            this.param = param;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishClassBody: function (body) {\n            this.type = Syntax.ClassBody;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishClassDeclaration: function (id, superClass, body) {\n            this.type = Syntax.ClassDeclaration;\n            this.id = id;\n            this.superClass = superClass;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishClassExpression: function (id, superClass, body) {\n            this.type = Syntax.ClassExpression;\n            this.id = id;\n            this.superClass = superClass;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishConditionalExpression: function (test, consequent, alternate) {\n            this.type = Syntax.ConditionalExpression;\n            this.test = test;\n            this.consequent = consequent;\n            this.alternate = alternate;\n            this.finish();\n            return this;\n        },\n\n        finishContinueStatement: function (label) {\n            this.type = Syntax.ContinueStatement;\n            this.label = label;\n            this.finish();\n            return this;\n        },\n\n        finishDebuggerStatement: function () {\n            this.type = Syntax.DebuggerStatement;\n            this.finish();\n            return this;\n        },\n\n        finishDoWhileStatement: function (body, test) {\n            this.type = Syntax.DoWhileStatement;\n            this.body = body;\n            this.test = test;\n            this.finish();\n            return this;\n        },\n\n        finishEmptyStatement: function () {\n            this.type = Syntax.EmptyStatement;\n            this.finish();\n            return this;\n        },\n\n        finishExpressionStatement: function (expression) {\n            this.type = Syntax.ExpressionStatement;\n            this.expression = expression;\n            this.finish();\n            return this;\n        },\n\n        finishForStatement: function (init, test, update, body) {\n            this.type = Syntax.ForStatement;\n            this.init = init;\n            this.test = test;\n            this.update = update;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishForOfStatement: function (left, right, body) {\n            this.type = Syntax.ForOfStatement;\n            this.left = left;\n            this.right = right;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishForInStatement: function (left, right, body) {\n            this.type = Syntax.ForInStatement;\n            this.left = left;\n            this.right = right;\n            this.body = body;\n            this.each = false;\n            this.finish();\n            return this;\n        },\n\n        finishFunctionDeclaration: function (id, params, defaults, body, generator) {\n            this.type = Syntax.FunctionDeclaration;\n            this.id = id;\n            this.params = params;\n            this.defaults = defaults;\n            this.body = body;\n            this.generator = generator;\n            this.expression = false;\n            this.finish();\n            return this;\n        },\n\n        finishFunctionExpression: function (id, params, defaults, body, generator) {\n            this.type = Syntax.FunctionExpression;\n            this.id = id;\n            this.params = params;\n            this.defaults = defaults;\n            this.body = body;\n            this.generator = generator;\n            this.expression = false;\n            this.finish();\n            return this;\n        },\n\n        finishIdentifier: function (name) {\n            this.type = Syntax.Identifier;\n            this.name = name;\n            this.finish();\n            return this;\n        },\n\n        finishIfStatement: function (test, consequent, alternate) {\n            this.type = Syntax.IfStatement;\n            this.test = test;\n            this.consequent = consequent;\n            this.alternate = alternate;\n            this.finish();\n            return this;\n        },\n\n        finishLabeledStatement: function (label, body) {\n            this.type = Syntax.LabeledStatement;\n            this.label = label;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishLiteral: function (token) {\n            this.type = Syntax.Literal;\n            this.value = token.value;\n            this.raw = source.slice(token.start, token.end);\n            if (token.regex) {\n                this.regex = token.regex;\n            }\n            this.finish();\n            return this;\n        },\n\n        finishMemberExpression: function (accessor, object, property) {\n            this.type = Syntax.MemberExpression;\n            this.computed = accessor === '[';\n            this.object = object;\n            this.property = property;\n            this.finish();\n            return this;\n        },\n\n        finishNewExpression: function (callee, args) {\n            this.type = Syntax.NewExpression;\n            this.callee = callee;\n            this.arguments = args;\n            this.finish();\n            return this;\n        },\n\n        finishObjectExpression: function (properties) {\n            this.type = Syntax.ObjectExpression;\n            this.properties = properties;\n            this.finish();\n            return this;\n        },\n\n        finishObjectPattern: function (properties) {\n            this.type = Syntax.ObjectPattern;\n            this.properties = properties;\n            this.finish();\n            return this;\n        },\n\n        finishPostfixExpression: function (operator, argument) {\n            this.type = Syntax.UpdateExpression;\n            this.operator = operator;\n            this.argument = argument;\n            this.prefix = false;\n            this.finish();\n            return this;\n        },\n\n        finishProgram: function (body) {\n            this.type = Syntax.Program;\n            this.body = body;\n            if (sourceType === 'module') {\n                // very restrictive for now\n                this.sourceType = sourceType;\n            }\n            this.finish();\n            return this;\n        },\n\n        finishProperty: function (kind, key, computed, value, method, shorthand) {\n            this.type = Syntax.Property;\n            this.key = key;\n            this.computed = computed;\n            this.value = value;\n            this.kind = kind;\n            this.method = method;\n            this.shorthand = shorthand;\n            this.finish();\n            return this;\n        },\n\n        finishRestElement: function (argument) {\n            this.type = Syntax.RestElement;\n            this.argument = argument;\n            this.finish();\n            return this;\n        },\n\n        finishReturnStatement: function (argument) {\n            this.type = Syntax.ReturnStatement;\n            this.argument = argument;\n            this.finish();\n            return this;\n        },\n\n        finishSequenceExpression: function (expressions) {\n            this.type = Syntax.SequenceExpression;\n            this.expressions = expressions;\n            this.finish();\n            return this;\n        },\n\n        finishSpreadElement: function (argument) {\n            this.type = Syntax.SpreadElement;\n            this.argument = argument;\n            this.finish();\n            return this;\n        },\n\n        finishSwitchCase: function (test, consequent) {\n            this.type = Syntax.SwitchCase;\n            this.test = test;\n            this.consequent = consequent;\n            this.finish();\n            return this;\n        },\n\n        finishSuper: function () {\n            this.type = Syntax.Super;\n            this.finish();\n            return this;\n        },\n\n        finishSwitchStatement: function (discriminant, cases) {\n            this.type = Syntax.SwitchStatement;\n            this.discriminant = discriminant;\n            this.cases = cases;\n            this.finish();\n            return this;\n        },\n\n        finishTaggedTemplateExpression: function (tag, quasi) {\n            this.type = Syntax.TaggedTemplateExpression;\n            this.tag = tag;\n            this.quasi = quasi;\n            this.finish();\n            return this;\n        },\n\n        finishTemplateElement: function (value, tail) {\n            this.type = Syntax.TemplateElement;\n            this.value = value;\n            this.tail = tail;\n            this.finish();\n            return this;\n        },\n\n        finishTemplateLiteral: function (quasis, expressions) {\n            this.type = Syntax.TemplateLiteral;\n            this.quasis = quasis;\n            this.expressions = expressions;\n            this.finish();\n            return this;\n        },\n\n        finishThisExpression: function () {\n            this.type = Syntax.ThisExpression;\n            this.finish();\n            return this;\n        },\n\n        finishThrowStatement: function (argument) {\n            this.type = Syntax.ThrowStatement;\n            this.argument = argument;\n            this.finish();\n            return this;\n        },\n\n        finishTryStatement: function (block, handler, finalizer) {\n            this.type = Syntax.TryStatement;\n            this.block = block;\n            this.guardedHandlers = [];\n            this.handlers = handler ? [ handler ] : [];\n            this.handler = handler;\n            this.finalizer = finalizer;\n            this.finish();\n            return this;\n        },\n\n        finishUnaryExpression: function (operator, argument) {\n            this.type = (operator === '++' || operator === '--') ? Syntax.UpdateExpression : Syntax.UnaryExpression;\n            this.operator = operator;\n            this.argument = argument;\n            this.prefix = true;\n            this.finish();\n            return this;\n        },\n\n        finishVariableDeclaration: function (declarations) {\n            this.type = Syntax.VariableDeclaration;\n            this.declarations = declarations;\n            this.kind = 'var';\n            this.finish();\n            return this;\n        },\n\n        finishLexicalDeclaration: function (declarations, kind) {\n            this.type = Syntax.VariableDeclaration;\n            this.declarations = declarations;\n            this.kind = kind;\n            this.finish();\n            return this;\n        },\n\n        finishVariableDeclarator: function (id, init) {\n            this.type = Syntax.VariableDeclarator;\n            this.id = id;\n            this.init = init;\n            this.finish();\n            return this;\n        },\n\n        finishWhileStatement: function (test, body) {\n            this.type = Syntax.WhileStatement;\n            this.test = test;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishWithStatement: function (object, body) {\n            this.type = Syntax.WithStatement;\n            this.object = object;\n            this.body = body;\n            this.finish();\n            return this;\n        },\n\n        finishExportSpecifier: function (local, exported) {\n            this.type = Syntax.ExportSpecifier;\n            this.exported = exported || local;\n            this.local = local;\n            this.finish();\n            return this;\n        },\n\n        finishImportDefaultSpecifier: function (local) {\n            this.type = Syntax.ImportDefaultSpecifier;\n            this.local = local;\n            this.finish();\n            return this;\n        },\n\n        finishImportNamespaceSpecifier: function (local) {\n            this.type = Syntax.ImportNamespaceSpecifier;\n            this.local = local;\n            this.finish();\n            return this;\n        },\n\n        finishExportNamedDeclaration: function (declaration, specifiers, src) {\n            this.type = Syntax.ExportNamedDeclaration;\n            this.declaration = declaration;\n            this.specifiers = specifiers;\n            this.source = src;\n            this.finish();\n            return this;\n        },\n\n        finishExportDefaultDeclaration: function (declaration) {\n            this.type = Syntax.ExportDefaultDeclaration;\n            this.declaration = declaration;\n            this.finish();\n            return this;\n        },\n\n        finishExportAllDeclaration: function (src) {\n            this.type = Syntax.ExportAllDeclaration;\n            this.source = src;\n            this.finish();\n            return this;\n        },\n\n        finishImportSpecifier: function (local, imported) {\n            this.type = Syntax.ImportSpecifier;\n            this.local = local || imported;\n            this.imported = imported;\n            this.finish();\n            return this;\n        },\n\n        finishImportDeclaration: function (specifiers, src) {\n            this.type = Syntax.ImportDeclaration;\n            this.specifiers = specifiers;\n            this.source = src;\n            this.finish();\n            return this;\n        },\n\n        finishYieldExpression: function (argument, delegate) {\n            this.type = Syntax.YieldExpression;\n            this.argument = argument;\n            this.delegate = delegate;\n            this.finish();\n            return this;\n        }\n    };\n\n\n    function recordError(error) {\n        var e, existing;\n\n        for (e = 0; e < extra.errors.length; e++) {\n            existing = extra.errors[e];\n            // Prevent duplicated error.\n            /* istanbul ignore next */\n            if (existing.index === error.index && existing.message === error.message) {\n                return;\n            }\n        }\n\n        extra.errors.push(error);\n    }\n\n    function createError(line, pos, description) {\n        var error = new Error('Line ' + line + ': ' + description);\n        error.index = pos;\n        error.lineNumber = line;\n        error.column = pos - (scanning ? lineStart : lastLineStart) + 1;\n        error.description = description;\n        return error;\n    }\n\n    // Throw an exception\n\n    function throwError(messageFormat) {\n        var args, msg;\n\n        args = Array.prototype.slice.call(arguments, 1);\n        msg = messageFormat.replace(/%(\\d)/g,\n            function (whole, idx) {\n                assert(idx < args.length, 'Message reference must be in range');\n                return args[idx];\n            }\n        );\n\n        throw createError(lastLineNumber, lastIndex, msg);\n    }\n\n    function tolerateError(messageFormat) {\n        var args, msg, error;\n\n        args = Array.prototype.slice.call(arguments, 1);\n        /* istanbul ignore next */\n        msg = messageFormat.replace(/%(\\d)/g,\n            function (whole, idx) {\n                assert(idx < args.length, 'Message reference must be in range');\n                return args[idx];\n            }\n        );\n\n        error = createError(lineNumber, lastIndex, msg);\n        if (extra.errors) {\n            recordError(error);\n        } else {\n            throw error;\n        }\n    }\n\n    // Throw an exception because of the token.\n\n    function unexpectedTokenError(token, message) {\n        var value, msg = message || Messages.UnexpectedToken;\n\n        if (token) {\n            if (!message) {\n                msg = (token.type === Token.EOF) ? Messages.UnexpectedEOS :\n                    (token.type === Token.Identifier) ? Messages.UnexpectedIdentifier :\n                    (token.type === Token.NumericLiteral) ? Messages.UnexpectedNumber :\n                    (token.type === Token.StringLiteral) ? Messages.UnexpectedString :\n                    (token.type === Token.Template) ? Messages.UnexpectedTemplate :\n                    Messages.UnexpectedToken;\n\n                if (token.type === Token.Keyword) {\n                    if (isFutureReservedWord(token.value)) {\n                        msg = Messages.UnexpectedReserved;\n                    } else if (strict && isStrictModeReservedWord(token.value)) {\n                        msg = Messages.StrictReservedWord;\n                    }\n                }\n            }\n\n            value = (token.type === Token.Template) ? token.value.raw : token.value;\n        } else {\n            value = 'ILLEGAL';\n        }\n\n        msg = msg.replace('%0', value);\n\n        return (token && typeof token.lineNumber === 'number') ?\n            createError(token.lineNumber, token.start, msg) :\n            createError(scanning ? lineNumber : lastLineNumber, scanning ? index : lastIndex, msg);\n    }\n\n    function throwUnexpectedToken(token, message) {\n        throw unexpectedTokenError(token, message);\n    }\n\n    function tolerateUnexpectedToken(token, message) {\n        var error = unexpectedTokenError(token, message);\n        if (extra.errors) {\n            recordError(error);\n        } else {\n            throw error;\n        }\n    }\n\n    // Expect the next token to match the specified punctuator.\n    // If not, an exception will be thrown.\n\n    function expect(value) {\n        var token = lex();\n        if (token.type !== Token.Punctuator || token.value !== value) {\n            throwUnexpectedToken(token);\n        }\n    }\n\n    /**\n     * @name expectCommaSeparator\n     * @description Quietly expect a comma when in tolerant mode, otherwise delegates\n     * to <code>expect(value)</code>\n     * @since 2.0\n     */\n    function expectCommaSeparator() {\n        var token;\n\n        if (extra.errors) {\n            token = lookahead;\n            if (token.type === Token.Punctuator && token.value === ',') {\n                lex();\n            } else if (token.type === Token.Punctuator && token.value === ';') {\n                lex();\n                tolerateUnexpectedToken(token);\n            } else {\n                tolerateUnexpectedToken(token, Messages.UnexpectedToken);\n            }\n        } else {\n            expect(',');\n        }\n    }\n\n    // Expect the next token to match the specified keyword.\n    // If not, an exception will be thrown.\n\n    function expectKeyword(keyword) {\n        var token = lex();\n        if (token.type !== Token.Keyword || token.value !== keyword) {\n            throwUnexpectedToken(token);\n        }\n    }\n\n    // Return true if the next token matches the specified punctuator.\n\n    function match(value) {\n        return lookahead.type === Token.Punctuator && lookahead.value === value;\n    }\n\n    // Return true if the next token matches the specified keyword\n\n    function matchKeyword(keyword) {\n        return lookahead.type === Token.Keyword && lookahead.value === keyword;\n    }\n\n    // Return true if the next token matches the specified contextual keyword\n    // (where an identifier is sometimes a keyword depending on the context)\n\n    function matchContextualKeyword(keyword) {\n        return lookahead.type === Token.Identifier && lookahead.value === keyword;\n    }\n\n    // Return true if the next token is an assignment operator\n\n    function matchAssign() {\n        var op;\n\n        if (lookahead.type !== Token.Punctuator) {\n            return false;\n        }\n        op = lookahead.value;\n        return op === '=' ||\n            op === '*=' ||\n            op === '/=' ||\n            op === '%=' ||\n            op === '+=' ||\n            op === '-=' ||\n            op === '<<=' ||\n            op === '>>=' ||\n            op === '>>>=' ||\n            op === '&=' ||\n            op === '^=' ||\n            op === '|=';\n    }\n\n    function consumeSemicolon() {\n        // Catch the very common case first: immediately a semicolon (U+003B).\n        if (source.charCodeAt(startIndex) === 0x3B || match(';')) {\n            lex();\n            return;\n        }\n\n        if (hasLineTerminator) {\n            return;\n        }\n\n        // FIXME(ikarienator): this is seemingly an issue in the previous location info convention.\n        lastIndex = startIndex;\n        lastLineNumber = startLineNumber;\n        lastLineStart = startLineStart;\n\n        if (lookahead.type !== Token.EOF && !match('}')) {\n            throwUnexpectedToken(lookahead);\n        }\n    }\n\n    // Cover grammar support.\n    //\n    // When an assignment expression position starts with an left parenthesis, the determination of the type\n    // of the syntax is to be deferred arbitrarily long until the end of the parentheses pair (plus a lookahead)\n    // or the first comma. This situation also defers the determination of all the expressions nested in the pair.\n    //\n    // There are three productions that can be parsed in a parentheses pair that needs to be determined\n    // after the outermost pair is closed. They are:\n    //\n    //   1. AssignmentExpression\n    //   2. BindingElements\n    //   3. AssignmentTargets\n    //\n    // In order to avoid exponential backtracking, we use two flags to denote if the production can be\n    // binding element or assignment target.\n    //\n    // The three productions have the relationship:\n    //\n    //   BindingElements ⊆ AssignmentTargets ⊆ AssignmentExpression\n    //\n    // with a single exception that CoverInitializedName when used directly in an Expression, generates\n    // an early error. Therefore, we need the third state, firstCoverInitializedNameError, to track the\n    // first usage of CoverInitializedName and report it when we reached the end of the parentheses pair.\n    //\n    // isolateCoverGrammar function runs the given parser function with a new cover grammar context, and it does not\n    // effect the current flags. This means the production the parser parses is only used as an expression. Therefore\n    // the CoverInitializedName check is conducted.\n    //\n    // inheritCoverGrammar function runs the given parse function with a new cover grammar context, and it propagates\n    // the flags outside of the parser. This means the production the parser parses is used as a part of a potential\n    // pattern. The CoverInitializedName check is deferred.\n    function isolateCoverGrammar(parser) {\n        var oldIsBindingElement = isBindingElement,\n            oldIsAssignmentTarget = isAssignmentTarget,\n            oldFirstCoverInitializedNameError = firstCoverInitializedNameError,\n            result;\n        isBindingElement = true;\n        isAssignmentTarget = true;\n        firstCoverInitializedNameError = null;\n        result = parser();\n        if (firstCoverInitializedNameError !== null) {\n            throwUnexpectedToken(firstCoverInitializedNameError);\n        }\n        isBindingElement = oldIsBindingElement;\n        isAssignmentTarget = oldIsAssignmentTarget;\n        firstCoverInitializedNameError = oldFirstCoverInitializedNameError;\n        return result;\n    }\n\n    function inheritCoverGrammar(parser) {\n        var oldIsBindingElement = isBindingElement,\n            oldIsAssignmentTarget = isAssignmentTarget,\n            oldFirstCoverInitializedNameError = firstCoverInitializedNameError,\n            result;\n        isBindingElement = true;\n        isAssignmentTarget = true;\n        firstCoverInitializedNameError = null;\n        result = parser();\n        isBindingElement = isBindingElement && oldIsBindingElement;\n        isAssignmentTarget = isAssignmentTarget && oldIsAssignmentTarget;\n        firstCoverInitializedNameError = oldFirstCoverInitializedNameError || firstCoverInitializedNameError;\n        return result;\n    }\n\n    function parseArrayPattern(params) {\n        var node = new Node(), elements = [], rest, restNode;\n        expect('[');\n\n        while (!match(']')) {\n            if (match(',')) {\n                lex();\n                elements.push(null);\n            } else {\n                if (match('...')) {\n                    restNode = new Node();\n                    lex();\n                    params.push(lookahead);\n                    rest = parseVariableIdentifier(params);\n                    elements.push(restNode.finishRestElement(rest));\n                    break;\n                } else {\n                    elements.push(parsePatternWithDefault(params));\n                }\n                if (!match(']')) {\n                    expect(',');\n                }\n            }\n\n        }\n\n        expect(']');\n\n        return node.finishArrayPattern(elements);\n    }\n\n    function parsePropertyPattern(params) {\n        var node = new Node(), key, keyToken, computed = match('['), init;\n        if (lookahead.type === Token.Identifier) {\n            keyToken = lookahead;\n            key = parseVariableIdentifier();\n            if (match('=')) {\n                params.push(keyToken);\n                lex();\n                init = parseAssignmentExpression();\n\n                return node.finishProperty(\n                    'init', key, false,\n                    new WrappingNode(keyToken).finishAssignmentPattern(key, init), false, false);\n            } else if (!match(':')) {\n                params.push(keyToken);\n                return node.finishProperty('init', key, false, key, false, true);\n            }\n        } else {\n            key = parseObjectPropertyKey(params);\n        }\n        expect(':');\n        init = parsePatternWithDefault(params);\n        return node.finishProperty('init', key, computed, init, false, false);\n    }\n\n    function parseObjectPattern(params) {\n        var node = new Node(), properties = [];\n\n        expect('{');\n\n        while (!match('}')) {\n            properties.push(parsePropertyPattern(params));\n            if (!match('}')) {\n                expect(',');\n            }\n        }\n\n        lex();\n\n        return node.finishObjectPattern(properties);\n    }\n\n    function parsePattern(params) {\n        var identifier;\n        if (lookahead.type === Token.Identifier) {\n            params.push(lookahead);\n            identifier = parseVariableIdentifier();\n            return identifier;\n        } else if (match('[')) {\n            return parseArrayPattern(params);\n        } else if (match('{')) {\n            return parseObjectPattern(params);\n        }\n        throwUnexpectedToken(lookahead);\n    }\n\n    function parsePatternWithDefault(params) {\n        var startToken = lookahead, pattern, right;\n        pattern = parsePattern(params);\n        if (match('=')) {\n            lex();\n            right = isolateCoverGrammar(parseAssignmentExpression);\n            pattern = new WrappingNode(startToken).finishAssignmentPattern(pattern, right);\n        }\n        return pattern;\n    }\n\n    // 11.1.4 Array Initialiser\n\n    function parseArrayInitialiser() {\n        var elements = [], node = new Node(), restSpread;\n\n        expect('[');\n\n        while (!match(']')) {\n            if (match(',')) {\n                lex();\n                elements.push(null);\n            } else if (match('...')) {\n                restSpread = new Node();\n                lex();\n                restSpread.finishSpreadElement(inheritCoverGrammar(parseAssignmentExpression));\n\n                if (!match(']')) {\n                    isAssignmentTarget = isBindingElement = false;\n                    expect(',');\n                }\n                elements.push(restSpread);\n            } else {\n                elements.push(inheritCoverGrammar(parseAssignmentExpression));\n\n                if (!match(']')) {\n                    expect(',');\n                }\n            }\n        }\n\n        lex();\n\n        return node.finishArrayExpression(elements);\n    }\n\n    // 11.1.5 Object Initialiser\n\n    function parsePropertyFunction(node, paramInfo, isGenerator) {\n        var previousStrict, body;\n\n        isAssignmentTarget = isBindingElement = false;\n\n        previousStrict = strict;\n        body = isolateCoverGrammar(parseFunctionSourceElements);\n\n        if (strict && paramInfo.firstRestricted) {\n            tolerateUnexpectedToken(paramInfo.firstRestricted, paramInfo.message);\n        }\n        if (strict && paramInfo.stricted) {\n            tolerateUnexpectedToken(paramInfo.stricted, paramInfo.message);\n        }\n\n        strict = previousStrict;\n        return node.finishFunctionExpression(null, paramInfo.params, paramInfo.defaults, body, isGenerator);\n    }\n\n    function parsePropertyMethodFunction() {\n        var params, method, node = new Node(),\n            previousAllowYield = state.allowYield;\n\n        state.allowYield = false;\n        params = parseParams();\n        state.allowYield = previousAllowYield;\n\n        state.allowYield = false;\n        method = parsePropertyFunction(node, params, false);\n        state.allowYield = previousAllowYield;\n\n        return method;\n    }\n\n    function parseObjectPropertyKey() {\n        var token, node = new Node(), expr;\n\n        token = lex();\n\n        // Note: This function is called only from parseObjectProperty(), where\n        // EOF and Punctuator tokens are already filtered out.\n\n        switch (token.type) {\n        case Token.StringLiteral:\n        case Token.NumericLiteral:\n            if (strict && token.octal) {\n                tolerateUnexpectedToken(token, Messages.StrictOctalLiteral);\n            }\n            return node.finishLiteral(token);\n        case Token.Identifier:\n        case Token.BooleanLiteral:\n        case Token.NullLiteral:\n        case Token.Keyword:\n            return node.finishIdentifier(token.value);\n        case Token.Punctuator:\n            if (token.value === '[') {\n                expr = isolateCoverGrammar(parseAssignmentExpression);\n                expect(']');\n                return expr;\n            }\n            break;\n        }\n        throwUnexpectedToken(token);\n    }\n\n    function lookaheadPropertyName() {\n        switch (lookahead.type) {\n        case Token.Identifier:\n        case Token.StringLiteral:\n        case Token.BooleanLiteral:\n        case Token.NullLiteral:\n        case Token.NumericLiteral:\n        case Token.Keyword:\n            return true;\n        case Token.Punctuator:\n            return lookahead.value === '[';\n        }\n        return false;\n    }\n\n    // This function is to try to parse a MethodDefinition as defined in 14.3. But in the case of object literals,\n    // it might be called at a position where there is in fact a short hand identifier pattern or a data property.\n    // This can only be determined after we consumed up to the left parentheses.\n    //\n    // In order to avoid back tracking, it returns `null` if the position is not a MethodDefinition and the caller\n    // is responsible to visit other options.\n    function tryParseMethodDefinition(token, key, computed, node) {\n        var value, options, methodNode, params,\n            previousAllowYield = state.allowYield;\n\n        if (token.type === Token.Identifier) {\n            // check for `get` and `set`;\n\n            if (token.value === 'get' && lookaheadPropertyName()) {\n                computed = match('[');\n                key = parseObjectPropertyKey();\n                methodNode = new Node();\n                expect('(');\n                expect(')');\n\n                state.allowYield = false;\n                value = parsePropertyFunction(methodNode, {\n                    params: [],\n                    defaults: [],\n                    stricted: null,\n                    firstRestricted: null,\n                    message: null\n                }, false);\n                state.allowYield = previousAllowYield;\n\n                return node.finishProperty('get', key, computed, value, false, false);\n            } else if (token.value === 'set' && lookaheadPropertyName()) {\n                computed = match('[');\n                key = parseObjectPropertyKey();\n                methodNode = new Node();\n                expect('(');\n\n                options = {\n                    params: [],\n                    defaultCount: 0,\n                    defaults: [],\n                    firstRestricted: null,\n                    paramSet: {}\n                };\n                if (match(')')) {\n                    tolerateUnexpectedToken(lookahead);\n                } else {\n                    state.allowYield = false;\n                    parseParam(options);\n                    state.allowYield = previousAllowYield;\n                    if (options.defaultCount === 0) {\n                        options.defaults = [];\n                    }\n                }\n                expect(')');\n\n                state.allowYield = false;\n                value = parsePropertyFunction(methodNode, options, false);\n                state.allowYield = previousAllowYield;\n\n                return node.finishProperty('set', key, computed, value, false, false);\n            }\n        } else if (token.type === Token.Punctuator && token.value === '*' && lookaheadPropertyName()) {\n            computed = match('[');\n            key = parseObjectPropertyKey();\n            methodNode = new Node();\n\n            state.allowYield = false;\n            params = parseParams();\n            state.allowYield = previousAllowYield;\n\n            state.allowYield = true;\n            value = parsePropertyFunction(methodNode, params, true);\n            state.allowYield = previousAllowYield;\n\n            return node.finishProperty('init', key, computed, value, true, false);\n        }\n\n        if (key && match('(')) {\n            value = parsePropertyMethodFunction();\n            return node.finishProperty('init', key, computed, value, true, false);\n        }\n\n        // Not a MethodDefinition.\n        return null;\n    }\n\n    function checkProto(key, computed, hasProto) {\n        if (computed === false && (key.type === Syntax.Identifier && key.name === '__proto__' ||\n            key.type === Syntax.Literal && key.value === '__proto__')) {\n            if (hasProto.value) {\n                tolerateError(Messages.DuplicateProtoProperty);\n            } else {\n                hasProto.value = true;\n            }\n        }\n    }\n\n    function parseObjectProperty(hasProto) {\n        var token = lookahead, node = new Node(), computed, key, maybeMethod, value;\n\n        computed = match('[');\n        if (match('*')) {\n            lex();\n        } else {\n            key = parseObjectPropertyKey();\n        }\n        maybeMethod = tryParseMethodDefinition(token, key, computed, node);\n\n        if (maybeMethod) {\n            checkProto(maybeMethod.key, maybeMethod.computed, hasProto);\n            // finished\n            return maybeMethod;\n        }\n\n        if (!key) {\n            throwUnexpectedToken(lookahead);\n        }\n\n        // init property or short hand property.\n        checkProto(key, computed, hasProto);\n\n        if (match(':')) {\n            lex();\n            value = inheritCoverGrammar(parseAssignmentExpression);\n            return node.finishProperty('init', key, computed, value, false, false);\n        }\n\n        if (token.type === Token.Identifier) {\n            if (match('=')) {\n                firstCoverInitializedNameError = lookahead;\n                lex();\n                value = isolateCoverGrammar(parseAssignmentExpression);\n                return node.finishProperty('init', key, computed,\n                    new WrappingNode(token).finishAssignmentPattern(key, value), false, true);\n            }\n            return node.finishProperty('init', key, computed, key, false, true);\n        }\n\n        throwUnexpectedToken(lookahead);\n    }\n\n    function parseObjectInitialiser() {\n        var properties = [], hasProto = {value: false}, node = new Node();\n\n        expect('{');\n\n        while (!match('}')) {\n            properties.push(parseObjectProperty(hasProto));\n\n            if (!match('}')) {\n                expectCommaSeparator();\n            }\n        }\n\n        expect('}');\n\n        return node.finishObjectExpression(properties);\n    }\n\n    function reinterpretExpressionAsPattern(expr) {\n        var i;\n        switch (expr.type) {\n        case Syntax.Identifier:\n        case Syntax.MemberExpression:\n        case Syntax.RestElement:\n        case Syntax.AssignmentPattern:\n            break;\n        case Syntax.SpreadElement:\n            expr.type = Syntax.RestElement;\n            reinterpretExpressionAsPattern(expr.argument);\n            break;\n        case Syntax.ArrayExpression:\n            expr.type = Syntax.ArrayPattern;\n            for (i = 0; i < expr.elements.length; i++) {\n                if (expr.elements[i] !== null) {\n                    reinterpretExpressionAsPattern(expr.elements[i]);\n                }\n            }\n            break;\n        case Syntax.ObjectExpression:\n            expr.type = Syntax.ObjectPattern;\n            for (i = 0; i < expr.properties.length; i++) {\n                reinterpretExpressionAsPattern(expr.properties[i].value);\n            }\n            break;\n        case Syntax.AssignmentExpression:\n            expr.type = Syntax.AssignmentPattern;\n            reinterpretExpressionAsPattern(expr.left);\n            break;\n        default:\n            // Allow other node type for tolerant parsing.\n            break;\n        }\n    }\n\n    function parseTemplateElement(option) {\n        var node, token;\n\n        if (lookahead.type !== Token.Template || (option.head && !lookahead.head)) {\n            throwUnexpectedToken();\n        }\n\n        node = new Node();\n        token = lex();\n\n        return node.finishTemplateElement({ raw: token.value.raw, cooked: token.value.cooked }, token.tail);\n    }\n\n    function parseTemplateLiteral() {\n        var quasi, quasis, expressions, node = new Node();\n\n        quasi = parseTemplateElement({ head: true });\n        quasis = [ quasi ];\n        expressions = [];\n\n        while (!quasi.tail) {\n            expressions.push(parseExpression());\n            quasi = parseTemplateElement({ head: false });\n            quasis.push(quasi);\n        }\n\n        return node.finishTemplateLiteral(quasis, expressions);\n    }\n\n    // 11.1.6 The Grouping Operator\n\n    function parseGroupExpression() {\n        var expr, expressions, startToken, i, params = [];\n\n        expect('(');\n\n        if (match(')')) {\n            lex();\n            if (!match('=>')) {\n                expect('=>');\n            }\n            return {\n                type: PlaceHolders.ArrowParameterPlaceHolder,\n                params: [],\n                rawParams: []\n            };\n        }\n\n        startToken = lookahead;\n        if (match('...')) {\n            expr = parseRestElement(params);\n            expect(')');\n            if (!match('=>')) {\n                expect('=>');\n            }\n            return {\n                type: PlaceHolders.ArrowParameterPlaceHolder,\n                params: [expr]\n            };\n        }\n\n        isBindingElement = true;\n        expr = inheritCoverGrammar(parseAssignmentExpression);\n\n        if (match(',')) {\n            isAssignmentTarget = false;\n            expressions = [expr];\n\n            while (startIndex < length) {\n                if (!match(',')) {\n                    break;\n                }\n                lex();\n\n                if (match('...')) {\n                    if (!isBindingElement) {\n                        throwUnexpectedToken(lookahead);\n                    }\n                    expressions.push(parseRestElement(params));\n                    expect(')');\n                    if (!match('=>')) {\n                        expect('=>');\n                    }\n                    isBindingElement = false;\n                    for (i = 0; i < expressions.length; i++) {\n                        reinterpretExpressionAsPattern(expressions[i]);\n                    }\n                    return {\n                        type: PlaceHolders.ArrowParameterPlaceHolder,\n                        params: expressions\n                    };\n                }\n\n                expressions.push(inheritCoverGrammar(parseAssignmentExpression));\n            }\n\n            expr = new WrappingNode(startToken).finishSequenceExpression(expressions);\n        }\n\n\n        expect(')');\n\n        if (match('=>')) {\n            if (!isBindingElement) {\n                throwUnexpectedToken(lookahead);\n            }\n\n            if (expr.type === Syntax.SequenceExpression) {\n                for (i = 0; i < expr.expressions.length; i++) {\n                    reinterpretExpressionAsPattern(expr.expressions[i]);\n                }\n            } else {\n                reinterpretExpressionAsPattern(expr);\n            }\n\n            expr = {\n                type: PlaceHolders.ArrowParameterPlaceHolder,\n                params: expr.type === Syntax.SequenceExpression ? expr.expressions : [expr]\n            };\n        }\n        isBindingElement = false;\n        return expr;\n    }\n\n\n    // 11.1 Primary Expressions\n\n    function parsePrimaryExpression() {\n        var type, token, expr, node;\n\n        if (match('(')) {\n            isBindingElement = false;\n            return inheritCoverGrammar(parseGroupExpression);\n        }\n\n        if (match('[')) {\n            return inheritCoverGrammar(parseArrayInitialiser);\n        }\n\n        if (match('{')) {\n            return inheritCoverGrammar(parseObjectInitialiser);\n        }\n\n        type = lookahead.type;\n        node = new Node();\n\n        if (type === Token.Identifier) {\n            expr = node.finishIdentifier(lex().value);\n        } else if (type === Token.StringLiteral || type === Token.NumericLiteral) {\n            isAssignmentTarget = isBindingElement = false;\n            if (strict && lookahead.octal) {\n                tolerateUnexpectedToken(lookahead, Messages.StrictOctalLiteral);\n            }\n            expr = node.finishLiteral(lex());\n        } else if (type === Token.Keyword) {\n            isAssignmentTarget = isBindingElement = false;\n            if (matchKeyword('function')) {\n                return parseFunctionExpression();\n            }\n            if (matchKeyword('this')) {\n                lex();\n                return node.finishThisExpression();\n            }\n            if (matchKeyword('class')) {\n                return parseClassExpression();\n            }\n            throwUnexpectedToken(lex());\n        } else if (type === Token.BooleanLiteral) {\n            isAssignmentTarget = isBindingElement = false;\n            token = lex();\n            token.value = (token.value === 'true');\n            expr = node.finishLiteral(token);\n        } else if (type === Token.NullLiteral) {\n            isAssignmentTarget = isBindingElement = false;\n            token = lex();\n            token.value = null;\n            expr = node.finishLiteral(token);\n        } else if (match('/') || match('/=')) {\n            isAssignmentTarget = isBindingElement = false;\n            index = startIndex;\n\n            if (typeof extra.tokens !== 'undefined') {\n                token = collectRegex();\n            } else {\n                token = scanRegExp();\n            }\n            lex();\n            expr = node.finishLiteral(token);\n        } else if (type === Token.Template) {\n            expr = parseTemplateLiteral();\n        } else {\n            throwUnexpectedToken(lex());\n        }\n\n        return expr;\n    }\n\n    // 11.2 Left-Hand-Side Expressions\n\n    function parseArguments() {\n        var args = [], expr;\n\n        expect('(');\n\n        if (!match(')')) {\n            while (startIndex < length) {\n                if (match('...')) {\n                    expr = new Node();\n                    lex();\n                    expr.finishSpreadElement(isolateCoverGrammar(parseAssignmentExpression));\n                } else {\n                    expr = isolateCoverGrammar(parseAssignmentExpression);\n                }\n                args.push(expr);\n                if (match(')')) {\n                    break;\n                }\n                expectCommaSeparator();\n            }\n        }\n\n        expect(')');\n\n        return args;\n    }\n\n    function parseNonComputedProperty() {\n        var token, node = new Node();\n\n        token = lex();\n\n        if (!isIdentifierName(token)) {\n            throwUnexpectedToken(token);\n        }\n\n        return node.finishIdentifier(token.value);\n    }\n\n    function parseNonComputedMember() {\n        expect('.');\n\n        return parseNonComputedProperty();\n    }\n\n    function parseComputedMember() {\n        var expr;\n\n        expect('[');\n\n        expr = isolateCoverGrammar(parseExpression);\n\n        expect(']');\n\n        return expr;\n    }\n\n    function parseNewExpression() {\n        var callee, args, node = new Node();\n\n        expectKeyword('new');\n        callee = isolateCoverGrammar(parseLeftHandSideExpression);\n        args = match('(') ? parseArguments() : [];\n\n        isAssignmentTarget = isBindingElement = false;\n\n        return node.finishNewExpression(callee, args);\n    }\n\n    function parseLeftHandSideExpressionAllowCall() {\n        var quasi, expr, args, property, startToken, previousAllowIn = state.allowIn;\n\n        startToken = lookahead;\n        state.allowIn = true;\n\n        if (matchKeyword('super') && state.inFunctionBody) {\n            expr = new Node();\n            lex();\n            expr = expr.finishSuper();\n            if (!match('(') && !match('.') && !match('[')) {\n                throwUnexpectedToken(lookahead);\n            }\n        } else {\n            expr = inheritCoverGrammar(matchKeyword('new') ? parseNewExpression : parsePrimaryExpression);\n        }\n\n        for (;;) {\n            if (match('.')) {\n                isBindingElement = false;\n                isAssignmentTarget = true;\n                property = parseNonComputedMember();\n                expr = new WrappingNode(startToken).finishMemberExpression('.', expr, property);\n            } else if (match('(')) {\n                isBindingElement = false;\n                isAssignmentTarget = false;\n                args = parseArguments();\n                expr = new WrappingNode(startToken).finishCallExpression(expr, args);\n            } else if (match('[')) {\n                isBindingElement = false;\n                isAssignmentTarget = true;\n                property = parseComputedMember();\n                expr = new WrappingNode(startToken).finishMemberExpression('[', expr, property);\n            } else if (lookahead.type === Token.Template && lookahead.head) {\n                quasi = parseTemplateLiteral();\n                expr = new WrappingNode(startToken).finishTaggedTemplateExpression(expr, quasi);\n            } else {\n                break;\n            }\n        }\n        state.allowIn = previousAllowIn;\n\n        return expr;\n    }\n\n    function parseLeftHandSideExpression() {\n        var quasi, expr, property, startToken;\n        assert(state.allowIn, 'callee of new expression always allow in keyword.');\n\n        startToken = lookahead;\n\n        if (matchKeyword('super') && state.inFunctionBody) {\n            expr = new Node();\n            lex();\n            expr = expr.finishSuper();\n            if (!match('[') && !match('.')) {\n                throwUnexpectedToken(lookahead);\n            }\n        } else {\n            expr = inheritCoverGrammar(matchKeyword('new') ? parseNewExpression : parsePrimaryExpression);\n        }\n\n        for (;;) {\n            if (match('[')) {\n                isBindingElement = false;\n                isAssignmentTarget = true;\n                property = parseComputedMember();\n                expr = new WrappingNode(startToken).finishMemberExpression('[', expr, property);\n            } else if (match('.')) {\n                isBindingElement = false;\n                isAssignmentTarget = true;\n                property = parseNonComputedMember();\n                expr = new WrappingNode(startToken).finishMemberExpression('.', expr, property);\n            } else if (lookahead.type === Token.Template && lookahead.head) {\n                quasi = parseTemplateLiteral();\n                expr = new WrappingNode(startToken).finishTaggedTemplateExpression(expr, quasi);\n            } else {\n                break;\n            }\n        }\n        return expr;\n    }\n\n    // 11.3 Postfix Expressions\n\n    function parsePostfixExpression() {\n        var expr, token, startToken = lookahead;\n\n        expr = inheritCoverGrammar(parseLeftHandSideExpressionAllowCall);\n\n        if (!hasLineTerminator && lookahead.type === Token.Punctuator) {\n            if (match('++') || match('--')) {\n                // 11.3.1, 11.3.2\n                if (strict && expr.type === Syntax.Identifier && isRestrictedWord(expr.name)) {\n                    tolerateError(Messages.StrictLHSPostfix);\n                }\n\n                if (!isAssignmentTarget) {\n                    tolerateError(Messages.InvalidLHSInAssignment);\n                }\n\n                isAssignmentTarget = isBindingElement = false;\n\n                token = lex();\n                expr = new WrappingNode(startToken).finishPostfixExpression(token.value, expr);\n            }\n        }\n\n        return expr;\n    }\n\n    // 11.4 Unary Operators\n\n    function parseUnaryExpression() {\n        var token, expr, startToken;\n\n        if (lookahead.type !== Token.Punctuator && lookahead.type !== Token.Keyword) {\n            expr = parsePostfixExpression();\n        } else if (match('++') || match('--')) {\n            startToken = lookahead;\n            token = lex();\n            expr = inheritCoverGrammar(parseUnaryExpression);\n            // 11.4.4, 11.4.5\n            if (strict && expr.type === Syntax.Identifier && isRestrictedWord(expr.name)) {\n                tolerateError(Messages.StrictLHSPrefix);\n            }\n\n            if (!isAssignmentTarget) {\n                tolerateError(Messages.InvalidLHSInAssignment);\n            }\n            expr = new WrappingNode(startToken).finishUnaryExpression(token.value, expr);\n            isAssignmentTarget = isBindingElement = false;\n        } else if (match('+') || match('-') || match('~') || match('!')) {\n            startToken = lookahead;\n            token = lex();\n            expr = inheritCoverGrammar(parseUnaryExpression);\n            expr = new WrappingNode(startToken).finishUnaryExpression(token.value, expr);\n            isAssignmentTarget = isBindingElement = false;\n        } else if (matchKeyword('delete') || matchKeyword('void') || matchKeyword('typeof')) {\n            startToken = lookahead;\n            token = lex();\n            expr = inheritCoverGrammar(parseUnaryExpression);\n            expr = new WrappingNode(startToken).finishUnaryExpression(token.value, expr);\n            if (strict && expr.operator === 'delete' && expr.argument.type === Syntax.Identifier) {\n                tolerateError(Messages.StrictDelete);\n            }\n            isAssignmentTarget = isBindingElement = false;\n        } else {\n            expr = parsePostfixExpression();\n        }\n\n        return expr;\n    }\n\n    function binaryPrecedence(token, allowIn) {\n        var prec = 0;\n\n        if (token.type !== Token.Punctuator && token.type !== Token.Keyword) {\n            return 0;\n        }\n\n        switch (token.value) {\n        case '||':\n            prec = 1;\n            break;\n\n        case '&&':\n            prec = 2;\n            break;\n\n        case '|':\n            prec = 3;\n            break;\n\n        case '^':\n            prec = 4;\n            break;\n\n        case '&':\n            prec = 5;\n            break;\n\n        case '==':\n        case '!=':\n        case '===':\n        case '!==':\n            prec = 6;\n            break;\n\n        case '<':\n        case '>':\n        case '<=':\n        case '>=':\n        case 'instanceof':\n            prec = 7;\n            break;\n\n        case 'in':\n            prec = allowIn ? 7 : 0;\n            break;\n\n        case '<<':\n        case '>>':\n        case '>>>':\n            prec = 8;\n            break;\n\n        case '+':\n        case '-':\n            prec = 9;\n            break;\n\n        case '*':\n        case '/':\n        case '%':\n            prec = 11;\n            break;\n\n        default:\n            break;\n        }\n\n        return prec;\n    }\n\n    // 11.5 Multiplicative Operators\n    // 11.6 Additive Operators\n    // 11.7 Bitwise Shift Operators\n    // 11.8 Relational Operators\n    // 11.9 Equality Operators\n    // 11.10 Binary Bitwise Operators\n    // 11.11 Binary Logical Operators\n\n    function parseBinaryExpression() {\n        var marker, markers, expr, token, prec, stack, right, operator, left, i;\n\n        marker = lookahead;\n        left = inheritCoverGrammar(parseUnaryExpression);\n\n        token = lookahead;\n        prec = binaryPrecedence(token, state.allowIn);\n        if (prec === 0) {\n            return left;\n        }\n        isAssignmentTarget = isBindingElement = false;\n        token.prec = prec;\n        lex();\n\n        markers = [marker, lookahead];\n        right = isolateCoverGrammar(parseUnaryExpression);\n\n        stack = [left, token, right];\n\n        while ((prec = binaryPrecedence(lookahead, state.allowIn)) > 0) {\n\n            // Reduce: make a binary expression from the three topmost entries.\n            while ((stack.length > 2) && (prec <= stack[stack.length - 2].prec)) {\n                right = stack.pop();\n                operator = stack.pop().value;\n                left = stack.pop();\n                markers.pop();\n                expr = new WrappingNode(markers[markers.length - 1]).finishBinaryExpression(operator, left, right);\n                stack.push(expr);\n            }\n\n            // Shift.\n            token = lex();\n            token.prec = prec;\n            stack.push(token);\n            markers.push(lookahead);\n            expr = isolateCoverGrammar(parseUnaryExpression);\n            stack.push(expr);\n        }\n\n        // Final reduce to clean-up the stack.\n        i = stack.length - 1;\n        expr = stack[i];\n        markers.pop();\n        while (i > 1) {\n            expr = new WrappingNode(markers.pop()).finishBinaryExpression(stack[i - 1].value, stack[i - 2], expr);\n            i -= 2;\n        }\n\n        return expr;\n    }\n\n\n    // 11.12 Conditional Operator\n\n    function parseConditionalExpression() {\n        var expr, previousAllowIn, consequent, alternate, startToken;\n\n        startToken = lookahead;\n\n        expr = inheritCoverGrammar(parseBinaryExpression);\n        if (match('?')) {\n            lex();\n            previousAllowIn = state.allowIn;\n            state.allowIn = true;\n            consequent = isolateCoverGrammar(parseAssignmentExpression);\n            state.allowIn = previousAllowIn;\n            expect(':');\n            alternate = isolateCoverGrammar(parseAssignmentExpression);\n\n            expr = new WrappingNode(startToken).finishConditionalExpression(expr, consequent, alternate);\n            isAssignmentTarget = isBindingElement = false;\n        }\n\n        return expr;\n    }\n\n    // [ES6] 14.2 Arrow Function\n\n    function parseConciseBody() {\n        if (match('{')) {\n            return parseFunctionSourceElements();\n        }\n        return isolateCoverGrammar(parseAssignmentExpression);\n    }\n\n    function checkPatternParam(options, param) {\n        var i;\n        switch (param.type) {\n        case Syntax.Identifier:\n            validateParam(options, param, param.name);\n            break;\n        case Syntax.RestElement:\n            checkPatternParam(options, param.argument);\n            break;\n        case Syntax.AssignmentPattern:\n            checkPatternParam(options, param.left);\n            break;\n        case Syntax.ArrayPattern:\n            for (i = 0; i < param.elements.length; i++) {\n                if (param.elements[i] !== null) {\n                    checkPatternParam(options, param.elements[i]);\n                }\n            }\n            break;\n        default:\n            assert(param.type === Syntax.ObjectPattern, 'Invalid type');\n            for (i = 0; i < param.properties.length; i++) {\n                checkPatternParam(options, param.properties[i].value);\n            }\n            break;\n        }\n    }\n    function reinterpretAsCoverFormalsList(expr) {\n        var i, len, param, params, defaults, defaultCount, options, token;\n\n        defaults = [];\n        defaultCount = 0;\n        params = [expr];\n\n        switch (expr.type) {\n        case Syntax.Identifier:\n            break;\n        case PlaceHolders.ArrowParameterPlaceHolder:\n            params = expr.params;\n            break;\n        default:\n            return null;\n        }\n\n        options = {\n            paramSet: {}\n        };\n\n        for (i = 0, len = params.length; i < len; i += 1) {\n            param = params[i];\n            switch (param.type) {\n            case Syntax.AssignmentPattern:\n                params[i] = param.left;\n                defaults.push(param.right);\n                ++defaultCount;\n                checkPatternParam(options, param.left);\n                break;\n            default:\n                checkPatternParam(options, param);\n                params[i] = param;\n                defaults.push(null);\n                break;\n            }\n        }\n\n        if (options.message === Messages.StrictParamDupe) {\n            token = strict ? options.stricted : options.firstRestricted;\n            throwUnexpectedToken(token, options.message);\n        }\n\n        if (defaultCount === 0) {\n            defaults = [];\n        }\n\n        return {\n            params: params,\n            defaults: defaults,\n            stricted: options.stricted,\n            firstRestricted: options.firstRestricted,\n            message: options.message\n        };\n    }\n\n    function parseArrowFunctionExpression(options, node) {\n        var previousStrict, body;\n\n        if (hasLineTerminator) {\n            tolerateUnexpectedToken(lookahead);\n        }\n        expect('=>');\n        previousStrict = strict;\n\n        body = parseConciseBody();\n\n        if (strict && options.firstRestricted) {\n            throwUnexpectedToken(options.firstRestricted, options.message);\n        }\n        if (strict && options.stricted) {\n            tolerateUnexpectedToken(options.stricted, options.message);\n        }\n\n        strict = previousStrict;\n\n        return node.finishArrowFunctionExpression(options.params, options.defaults, body, body.type !== Syntax.BlockStatement);\n    }\n\n    // [ES6] 14.4 Yield expression\n\n    function parseYieldExpression() {\n        var argument, expr, delegate;\n\n        expr = new Node();\n\n        if (!state.allowYield) {\n            tolerateUnexpectedToken(lookahead, Messages.IllegalYield);\n        }\n\n        expectKeyword('yield');\n\n        if (!hasLineTerminator) {\n            delegate = match('*');\n            if (delegate) {\n                lex();\n                argument = parseExpression();\n            } else {\n                if (!match(';') && !match('}') && lookahead.type !== Token.EOF) {\n                    argument = parseExpression();\n                }\n            }\n        }\n\n        return expr.finishYieldExpression(argument, delegate);\n    }\n\n    // 11.13 Assignment Operators\n\n    function parseAssignmentExpression() {\n        var token, expr, right, list, startToken;\n\n        startToken = lookahead;\n        token = lookahead;\n\n        if (matchKeyword('yield')) {\n            return parseYieldExpression();\n        }\n\n        expr = parseConditionalExpression();\n\n        if (expr.type === PlaceHolders.ArrowParameterPlaceHolder || match('=>')) {\n            isAssignmentTarget = isBindingElement = false;\n            list = reinterpretAsCoverFormalsList(expr);\n\n            if (list) {\n                firstCoverInitializedNameError = null;\n                return parseArrowFunctionExpression(list, new WrappingNode(startToken));\n            }\n\n            return expr;\n        }\n\n        if (matchAssign()) {\n            if (!isAssignmentTarget) {\n                tolerateError(Messages.InvalidLHSInAssignment);\n            }\n\n            // 11.13.1\n            if (strict && expr.type === Syntax.Identifier && isRestrictedWord(expr.name)) {\n                tolerateUnexpectedToken(token, Messages.StrictLHSAssignment);\n            }\n\n            if (!match('=')) {\n                isAssignmentTarget = isBindingElement = false;\n            } else {\n                reinterpretExpressionAsPattern(expr);\n            }\n\n            token = lex();\n            right = isolateCoverGrammar(parseAssignmentExpression);\n            expr = new WrappingNode(startToken).finishAssignmentExpression(token.value, expr, right);\n            firstCoverInitializedNameError = null;\n        }\n\n        return expr;\n    }\n\n    // 11.14 Comma Operator\n\n    function parseExpression() {\n        var expr, startToken = lookahead, expressions;\n\n        expr = isolateCoverGrammar(parseAssignmentExpression);\n\n        if (match(',')) {\n            expressions = [expr];\n\n            while (startIndex < length) {\n                if (!match(',')) {\n                    break;\n                }\n                lex();\n                expressions.push(isolateCoverGrammar(parseAssignmentExpression));\n            }\n\n            expr = new WrappingNode(startToken).finishSequenceExpression(expressions);\n        }\n\n        return expr;\n    }\n\n    // 12.1 Block\n\n    function parseStatementListItem() {\n        if (lookahead.type === Token.Keyword) {\n            switch (lookahead.value) {\n            case 'export':\n                if (sourceType !== 'module') {\n                    tolerateUnexpectedToken(lookahead, Messages.IllegalExportDeclaration);\n                }\n                return parseExportDeclaration();\n            case 'import':\n                if (sourceType !== 'module') {\n                    tolerateUnexpectedToken(lookahead, Messages.IllegalImportDeclaration);\n                }\n                return parseImportDeclaration();\n            case 'const':\n            case 'let':\n                return parseLexicalDeclaration({inFor: false});\n            case 'function':\n                return parseFunctionDeclaration(new Node());\n            case 'class':\n                return parseClassDeclaration();\n            }\n        }\n\n        return parseStatement();\n    }\n\n    function parseStatementList() {\n        var list = [];\n        while (startIndex < length) {\n            if (match('}')) {\n                break;\n            }\n            list.push(parseStatementListItem());\n        }\n\n        return list;\n    }\n\n    function parseBlock() {\n        var block, node = new Node();\n\n        expect('{');\n\n        block = parseStatementList();\n\n        expect('}');\n\n        return node.finishBlockStatement(block);\n    }\n\n    // 12.2 Variable Statement\n\n    function parseVariableIdentifier() {\n        var token, node = new Node();\n\n        token = lex();\n\n        if (token.type !== Token.Identifier) {\n            if (strict && token.type === Token.Keyword && isStrictModeReservedWord(token.value)) {\n                tolerateUnexpectedToken(token, Messages.StrictReservedWord);\n            } else {\n                throwUnexpectedToken(token);\n            }\n        }\n\n        return node.finishIdentifier(token.value);\n    }\n\n    function parseVariableDeclaration() {\n        var init = null, id, node = new Node(), params = [];\n\n        id = parsePattern(params);\n\n        // 12.2.1\n        if (strict && isRestrictedWord(id.name)) {\n            tolerateError(Messages.StrictVarName);\n        }\n\n        if (match('=')) {\n            lex();\n            init = isolateCoverGrammar(parseAssignmentExpression);\n        } else if (id.type !== Syntax.Identifier) {\n            expect('=');\n        }\n\n        return node.finishVariableDeclarator(id, init);\n    }\n\n    function parseVariableDeclarationList() {\n        var list = [];\n\n        do {\n            list.push(parseVariableDeclaration());\n            if (!match(',')) {\n                break;\n            }\n            lex();\n        } while (startIndex < length);\n\n        return list;\n    }\n\n    function parseVariableStatement(node) {\n        var declarations;\n\n        expectKeyword('var');\n\n        declarations = parseVariableDeclarationList();\n\n        consumeSemicolon();\n\n        return node.finishVariableDeclaration(declarations);\n    }\n\n    function parseLexicalBinding(kind, options) {\n        var init = null, id, node = new Node(), params = [];\n\n        id = parsePattern(params);\n\n        // 12.2.1\n        if (strict && id.type === Syntax.Identifier && isRestrictedWord(id.name)) {\n            tolerateError(Messages.StrictVarName);\n        }\n\n        if (kind === 'const') {\n            if (!matchKeyword('in') && !matchContextualKeyword('of')) {\n                expect('=');\n                init = isolateCoverGrammar(parseAssignmentExpression);\n            }\n        } else if ((!options.inFor && id.type !== Syntax.Identifier) || match('=')) {\n            expect('=');\n            init = isolateCoverGrammar(parseAssignmentExpression);\n        }\n\n        return node.finishVariableDeclarator(id, init);\n    }\n\n    function parseBindingList(kind, options) {\n        var list = [];\n\n        do {\n            list.push(parseLexicalBinding(kind, options));\n            if (!match(',')) {\n                break;\n            }\n            lex();\n        } while (startIndex < length);\n\n        return list;\n    }\n\n    function parseLexicalDeclaration(options) {\n        var kind, declarations, node = new Node();\n\n        kind = lex().value;\n        assert(kind === 'let' || kind === 'const', 'Lexical declaration must be either let or const');\n\n        declarations = parseBindingList(kind, options);\n\n        consumeSemicolon();\n\n        return node.finishLexicalDeclaration(declarations, kind);\n    }\n\n    function parseRestElement(params) {\n        var param, node = new Node();\n\n        lex();\n\n        if (match('{')) {\n            throwError(Messages.ObjectPatternAsRestParameter);\n        }\n\n        params.push(lookahead);\n\n        param = parseVariableIdentifier();\n\n        if (match('=')) {\n            throwError(Messages.DefaultRestParameter);\n        }\n\n        if (!match(')')) {\n            throwError(Messages.ParameterAfterRestParameter);\n        }\n\n        return node.finishRestElement(param);\n    }\n\n    // 12.3 Empty Statement\n\n    function parseEmptyStatement(node) {\n        expect(';');\n        return node.finishEmptyStatement();\n    }\n\n    // 12.4 Expression Statement\n\n    function parseExpressionStatement(node) {\n        var expr = parseExpression();\n        consumeSemicolon();\n        return node.finishExpressionStatement(expr);\n    }\n\n    // 12.5 If statement\n\n    function parseIfStatement(node) {\n        var test, consequent, alternate;\n\n        expectKeyword('if');\n\n        expect('(');\n\n        test = parseExpression();\n\n        expect(')');\n\n        consequent = parseStatement();\n\n        if (matchKeyword('else')) {\n            lex();\n            alternate = parseStatement();\n        } else {\n            alternate = null;\n        }\n\n        return node.finishIfStatement(test, consequent, alternate);\n    }\n\n    // 12.6 Iteration Statements\n\n    function parseDoWhileStatement(node) {\n        var body, test, oldInIteration;\n\n        expectKeyword('do');\n\n        oldInIteration = state.inIteration;\n        state.inIteration = true;\n\n        body = parseStatement();\n\n        state.inIteration = oldInIteration;\n\n        expectKeyword('while');\n\n        expect('(');\n\n        test = parseExpression();\n\n        expect(')');\n\n        if (match(';')) {\n            lex();\n        }\n\n        return node.finishDoWhileStatement(body, test);\n    }\n\n    function parseWhileStatement(node) {\n        var test, body, oldInIteration;\n\n        expectKeyword('while');\n\n        expect('(');\n\n        test = parseExpression();\n\n        expect(')');\n\n        oldInIteration = state.inIteration;\n        state.inIteration = true;\n\n        body = parseStatement();\n\n        state.inIteration = oldInIteration;\n\n        return node.finishWhileStatement(test, body);\n    }\n\n    function parseForStatement(node) {\n        var init, forIn, initSeq, initStartToken, test, update, left, right, kind, declarations,\n            body, oldInIteration, previousAllowIn = state.allowIn;\n\n        init = test = update = null;\n        forIn = true;\n\n        expectKeyword('for');\n\n        expect('(');\n\n        if (match(';')) {\n            lex();\n        } else {\n            if (matchKeyword('var')) {\n                init = new Node();\n                lex();\n\n                state.allowIn = false;\n                init = init.finishVariableDeclaration(parseVariableDeclarationList());\n                state.allowIn = previousAllowIn;\n\n                if (init.declarations.length === 1 && matchKeyword('in')) {\n                    lex();\n                    left = init;\n                    right = parseExpression();\n                    init = null;\n                } else if (init.declarations.length === 1 && init.declarations[0].init === null && matchContextualKeyword('of')) {\n                    lex();\n                    left = init;\n                    right = parseAssignmentExpression();\n                    init = null;\n                    forIn = false;\n                } else {\n                    expect(';');\n                }\n            } else if (matchKeyword('const') || matchKeyword('let')) {\n                init = new Node();\n                kind = lex().value;\n\n                state.allowIn = false;\n                declarations = parseBindingList(kind, {inFor: true});\n                state.allowIn = previousAllowIn;\n\n                if (declarations.length === 1 && declarations[0].init === null && matchKeyword('in')) {\n                    init = init.finishLexicalDeclaration(declarations, kind);\n                    lex();\n                    left = init;\n                    right = parseExpression();\n                    init = null;\n                } else if (declarations.length === 1 && declarations[0].init === null && matchContextualKeyword('of')) {\n                    init = init.finishLexicalDeclaration(declarations, kind);\n                    lex();\n                    left = init;\n                    right = parseAssignmentExpression();\n                    init = null;\n                    forIn = false;\n                } else {\n                    consumeSemicolon();\n                    init = init.finishLexicalDeclaration(declarations, kind);\n                }\n            } else {\n                initStartToken = lookahead;\n                state.allowIn = false;\n                init = inheritCoverGrammar(parseAssignmentExpression);\n                state.allowIn = previousAllowIn;\n\n                if (matchKeyword('in')) {\n                    if (!isAssignmentTarget) {\n                        tolerateError(Messages.InvalidLHSInForIn);\n                    }\n\n                    lex();\n                    reinterpretExpressionAsPattern(init);\n                    left = init;\n                    right = parseExpression();\n                    init = null;\n                } else if (matchContextualKeyword('of')) {\n                    if (!isAssignmentTarget) {\n                        tolerateError(Messages.InvalidLHSInForLoop);\n                    }\n\n                    lex();\n                    reinterpretExpressionAsPattern(init);\n                    left = init;\n                    right = parseAssignmentExpression();\n                    init = null;\n                    forIn = false;\n                } else {\n                    if (match(',')) {\n                        initSeq = [init];\n                        while (match(',')) {\n                            lex();\n                            initSeq.push(isolateCoverGrammar(parseAssignmentExpression));\n                        }\n                        init = new WrappingNode(initStartToken).finishSequenceExpression(initSeq);\n                    }\n                    expect(';');\n                }\n            }\n        }\n\n        if (typeof left === 'undefined') {\n\n            if (!match(';')) {\n                test = parseExpression();\n            }\n            expect(';');\n\n            if (!match(')')) {\n                update = parseExpression();\n            }\n        }\n\n        expect(')');\n\n        oldInIteration = state.inIteration;\n        state.inIteration = true;\n\n        body = isolateCoverGrammar(parseStatement);\n\n        state.inIteration = oldInIteration;\n\n        return (typeof left === 'undefined') ?\n                node.finishForStatement(init, test, update, body) :\n                forIn ? node.finishForInStatement(left, right, body) :\n                    node.finishForOfStatement(left, right, body);\n    }\n\n    // 12.7 The continue statement\n\n    function parseContinueStatement(node) {\n        var label = null, key;\n\n        expectKeyword('continue');\n\n        // Optimize the most common form: 'continue;'.\n        if (source.charCodeAt(startIndex) === 0x3B) {\n            lex();\n\n            if (!state.inIteration) {\n                throwError(Messages.IllegalContinue);\n            }\n\n            return node.finishContinueStatement(null);\n        }\n\n        if (hasLineTerminator) {\n            if (!state.inIteration) {\n                throwError(Messages.IllegalContinue);\n            }\n\n            return node.finishContinueStatement(null);\n        }\n\n        if (lookahead.type === Token.Identifier) {\n            label = parseVariableIdentifier();\n\n            key = '$' + label.name;\n            if (!Object.prototype.hasOwnProperty.call(state.labelSet, key)) {\n                throwError(Messages.UnknownLabel, label.name);\n            }\n        }\n\n        consumeSemicolon();\n\n        if (label === null && !state.inIteration) {\n            throwError(Messages.IllegalContinue);\n        }\n\n        return node.finishContinueStatement(label);\n    }\n\n    // 12.8 The break statement\n\n    function parseBreakStatement(node) {\n        var label = null, key;\n\n        expectKeyword('break');\n\n        // Catch the very common case first: immediately a semicolon (U+003B).\n        if (source.charCodeAt(lastIndex) === 0x3B) {\n            lex();\n\n            if (!(state.inIteration || state.inSwitch)) {\n                throwError(Messages.IllegalBreak);\n            }\n\n            return node.finishBreakStatement(null);\n        }\n\n        if (hasLineTerminator) {\n            if (!(state.inIteration || state.inSwitch)) {\n                throwError(Messages.IllegalBreak);\n            }\n\n            return node.finishBreakStatement(null);\n        }\n\n        if (lookahead.type === Token.Identifier) {\n            label = parseVariableIdentifier();\n\n            key = '$' + label.name;\n            if (!Object.prototype.hasOwnProperty.call(state.labelSet, key)) {\n                throwError(Messages.UnknownLabel, label.name);\n            }\n        }\n\n        consumeSemicolon();\n\n        if (label === null && !(state.inIteration || state.inSwitch)) {\n            throwError(Messages.IllegalBreak);\n        }\n\n        return node.finishBreakStatement(label);\n    }\n\n    // 12.9 The return statement\n\n    function parseReturnStatement(node) {\n        var argument = null;\n\n        expectKeyword('return');\n\n        if (!state.inFunctionBody) {\n            tolerateError(Messages.IllegalReturn);\n        }\n\n        // 'return' followed by a space and an identifier is very common.\n        if (source.charCodeAt(lastIndex) === 0x20) {\n            if (isIdentifierStart(source.charCodeAt(lastIndex + 1))) {\n                argument = parseExpression();\n                consumeSemicolon();\n                return node.finishReturnStatement(argument);\n            }\n        }\n\n        if (hasLineTerminator) {\n            // HACK\n            return node.finishReturnStatement(null);\n        }\n\n        if (!match(';')) {\n            if (!match('}') && lookahead.type !== Token.EOF) {\n                argument = parseExpression();\n            }\n        }\n\n        consumeSemicolon();\n\n        return node.finishReturnStatement(argument);\n    }\n\n    // 12.10 The with statement\n\n    function parseWithStatement(node) {\n        var object, body;\n\n        if (strict) {\n            tolerateError(Messages.StrictModeWith);\n        }\n\n        expectKeyword('with');\n\n        expect('(');\n\n        object = parseExpression();\n\n        expect(')');\n\n        body = parseStatement();\n\n        return node.finishWithStatement(object, body);\n    }\n\n    // 12.10 The swith statement\n\n    function parseSwitchCase() {\n        var test, consequent = [], statement, node = new Node();\n\n        if (matchKeyword('default')) {\n            lex();\n            test = null;\n        } else {\n            expectKeyword('case');\n            test = parseExpression();\n        }\n        expect(':');\n\n        while (startIndex < length) {\n            if (match('}') || matchKeyword('default') || matchKeyword('case')) {\n                break;\n            }\n            statement = parseStatementListItem();\n            consequent.push(statement);\n        }\n\n        return node.finishSwitchCase(test, consequent);\n    }\n\n    function parseSwitchStatement(node) {\n        var discriminant, cases, clause, oldInSwitch, defaultFound;\n\n        expectKeyword('switch');\n\n        expect('(');\n\n        discriminant = parseExpression();\n\n        expect(')');\n\n        expect('{');\n\n        cases = [];\n\n        if (match('}')) {\n            lex();\n            return node.finishSwitchStatement(discriminant, cases);\n        }\n\n        oldInSwitch = state.inSwitch;\n        state.inSwitch = true;\n        defaultFound = false;\n\n        while (startIndex < length) {\n            if (match('}')) {\n                break;\n            }\n            clause = parseSwitchCase();\n            if (clause.test === null) {\n                if (defaultFound) {\n                    throwError(Messages.MultipleDefaultsInSwitch);\n                }\n                defaultFound = true;\n            }\n            cases.push(clause);\n        }\n\n        state.inSwitch = oldInSwitch;\n\n        expect('}');\n\n        return node.finishSwitchStatement(discriminant, cases);\n    }\n\n    // 12.13 The throw statement\n\n    function parseThrowStatement(node) {\n        var argument;\n\n        expectKeyword('throw');\n\n        if (hasLineTerminator) {\n            throwError(Messages.NewlineAfterThrow);\n        }\n\n        argument = parseExpression();\n\n        consumeSemicolon();\n\n        return node.finishThrowStatement(argument);\n    }\n\n    // 12.14 The try statement\n\n    function parseCatchClause() {\n        var param, params = [], paramMap = {}, key, i, body, node = new Node();\n\n        expectKeyword('catch');\n\n        expect('(');\n        if (match(')')) {\n            throwUnexpectedToken(lookahead);\n        }\n\n        param = parsePattern(params);\n        for (i = 0; i < params.length; i++) {\n            key = '$' + params[i].value;\n            if (Object.prototype.hasOwnProperty.call(paramMap, key)) {\n                tolerateError(Messages.DuplicateBinding, params[i].value);\n            }\n            paramMap[key] = true;\n        }\n\n        // 12.14.1\n        if (strict && isRestrictedWord(param.name)) {\n            tolerateError(Messages.StrictCatchVariable);\n        }\n\n        expect(')');\n        body = parseBlock();\n        return node.finishCatchClause(param, body);\n    }\n\n    function parseTryStatement(node) {\n        var block, handler = null, finalizer = null;\n\n        expectKeyword('try');\n\n        block = parseBlock();\n\n        if (matchKeyword('catch')) {\n            handler = parseCatchClause();\n        }\n\n        if (matchKeyword('finally')) {\n            lex();\n            finalizer = parseBlock();\n        }\n\n        if (!handler && !finalizer) {\n            throwError(Messages.NoCatchOrFinally);\n        }\n\n        return node.finishTryStatement(block, handler, finalizer);\n    }\n\n    // 12.15 The debugger statement\n\n    function parseDebuggerStatement(node) {\n        expectKeyword('debugger');\n\n        consumeSemicolon();\n\n        return node.finishDebuggerStatement();\n    }\n\n    // 12 Statements\n\n    function parseStatement() {\n        var type = lookahead.type,\n            expr,\n            labeledBody,\n            key,\n            node;\n\n        if (type === Token.EOF) {\n            throwUnexpectedToken(lookahead);\n        }\n\n        if (type === Token.Punctuator && lookahead.value === '{') {\n            return parseBlock();\n        }\n        isAssignmentTarget = isBindingElement = true;\n        node = new Node();\n\n        if (type === Token.Punctuator) {\n            switch (lookahead.value) {\n            case ';':\n                return parseEmptyStatement(node);\n            case '(':\n                return parseExpressionStatement(node);\n            default:\n                break;\n            }\n        } else if (type === Token.Keyword) {\n            switch (lookahead.value) {\n            case 'break':\n                return parseBreakStatement(node);\n            case 'continue':\n                return parseContinueStatement(node);\n            case 'debugger':\n                return parseDebuggerStatement(node);\n            case 'do':\n                return parseDoWhileStatement(node);\n            case 'for':\n                return parseForStatement(node);\n            case 'function':\n                return parseFunctionDeclaration(node);\n            case 'if':\n                return parseIfStatement(node);\n            case 'return':\n                return parseReturnStatement(node);\n            case 'switch':\n                return parseSwitchStatement(node);\n            case 'throw':\n                return parseThrowStatement(node);\n            case 'try':\n                return parseTryStatement(node);\n            case 'var':\n                return parseVariableStatement(node);\n            case 'while':\n                return parseWhileStatement(node);\n            case 'with':\n                return parseWithStatement(node);\n            default:\n                break;\n            }\n        }\n\n        expr = parseExpression();\n\n        // 12.12 Labelled Statements\n        if ((expr.type === Syntax.Identifier) && match(':')) {\n            lex();\n\n            key = '$' + expr.name;\n            if (Object.prototype.hasOwnProperty.call(state.labelSet, key)) {\n                throwError(Messages.Redeclaration, 'Label', expr.name);\n            }\n\n            state.labelSet[key] = true;\n            labeledBody = parseStatement();\n            delete state.labelSet[key];\n            return node.finishLabeledStatement(expr, labeledBody);\n        }\n\n        consumeSemicolon();\n\n        return node.finishExpressionStatement(expr);\n    }\n\n    // 13 Function Definition\n\n    function parseFunctionSourceElements() {\n        var statement, body = [], token, directive, firstRestricted,\n            oldLabelSet, oldInIteration, oldInSwitch, oldInFunctionBody, oldParenthesisCount,\n            node = new Node();\n\n        expect('{');\n\n        while (startIndex < length) {\n            if (lookahead.type !== Token.StringLiteral) {\n                break;\n            }\n            token = lookahead;\n\n            statement = parseStatementListItem();\n            body.push(statement);\n            if (statement.expression.type !== Syntax.Literal) {\n                // this is not directive\n                break;\n            }\n            directive = source.slice(token.start + 1, token.end - 1);\n            if (directive === 'use strict') {\n                strict = true;\n                if (firstRestricted) {\n                    tolerateUnexpectedToken(firstRestricted, Messages.StrictOctalLiteral);\n                }\n            } else {\n                if (!firstRestricted && token.octal) {\n                    firstRestricted = token;\n                }\n            }\n        }\n\n        oldLabelSet = state.labelSet;\n        oldInIteration = state.inIteration;\n        oldInSwitch = state.inSwitch;\n        oldInFunctionBody = state.inFunctionBody;\n        oldParenthesisCount = state.parenthesizedCount;\n\n        state.labelSet = {};\n        state.inIteration = false;\n        state.inSwitch = false;\n        state.inFunctionBody = true;\n        state.parenthesizedCount = 0;\n\n        while (startIndex < length) {\n            if (match('}')) {\n                break;\n            }\n            body.push(parseStatementListItem());\n        }\n\n        expect('}');\n\n        state.labelSet = oldLabelSet;\n        state.inIteration = oldInIteration;\n        state.inSwitch = oldInSwitch;\n        state.inFunctionBody = oldInFunctionBody;\n        state.parenthesizedCount = oldParenthesisCount;\n\n        return node.finishBlockStatement(body);\n    }\n\n    function validateParam(options, param, name) {\n        var key = '$' + name;\n        if (strict) {\n            if (isRestrictedWord(name)) {\n                options.stricted = param;\n                options.message = Messages.StrictParamName;\n            }\n            if (Object.prototype.hasOwnProperty.call(options.paramSet, key)) {\n                options.stricted = param;\n                options.message = Messages.StrictParamDupe;\n            }\n        } else if (!options.firstRestricted) {\n            if (isRestrictedWord(name)) {\n                options.firstRestricted = param;\n                options.message = Messages.StrictParamName;\n            } else if (isStrictModeReservedWord(name)) {\n                options.firstRestricted = param;\n                options.message = Messages.StrictReservedWord;\n            } else if (Object.prototype.hasOwnProperty.call(options.paramSet, key)) {\n                options.stricted = param;\n                options.message = Messages.StrictParamDupe;\n            }\n        }\n        options.paramSet[key] = true;\n    }\n\n    function parseParam(options) {\n        var token, param, params = [], i, def;\n\n        token = lookahead;\n        if (token.value === '...') {\n            param = parseRestElement(params);\n            validateParam(options, param.argument, param.argument.name);\n            options.params.push(param);\n            options.defaults.push(null);\n            return false;\n        }\n\n        param = parsePatternWithDefault(params);\n        for (i = 0; i < params.length; i++) {\n            validateParam(options, params[i], params[i].value);\n        }\n\n        if (param.type === Syntax.AssignmentPattern) {\n            def = param.right;\n            param = param.left;\n            ++options.defaultCount;\n        }\n\n        options.params.push(param);\n        options.defaults.push(def);\n\n        return !match(')');\n    }\n\n    function parseParams(firstRestricted) {\n        var options;\n\n        options = {\n            params: [],\n            defaultCount: 0,\n            defaults: [],\n            firstRestricted: firstRestricted\n        };\n\n        expect('(');\n\n        if (!match(')')) {\n            options.paramSet = {};\n            while (startIndex < length) {\n                if (!parseParam(options)) {\n                    break;\n                }\n                expect(',');\n            }\n        }\n\n        expect(')');\n\n        if (options.defaultCount === 0) {\n            options.defaults = [];\n        }\n\n        return {\n            params: options.params,\n            defaults: options.defaults,\n            stricted: options.stricted,\n            firstRestricted: options.firstRestricted,\n            message: options.message\n        };\n    }\n\n    function parseFunctionDeclaration(node, identifierIsOptional) {\n        var id = null, params = [], defaults = [], body, token, stricted, tmp, firstRestricted, message, previousStrict,\n            isGenerator, previousAllowYield;\n\n        expectKeyword('function');\n\n        isGenerator = match('*');\n        if (isGenerator) {\n            lex();\n        }\n\n        if (!identifierIsOptional || !match('(')) {\n            token = lookahead;\n            id = parseVariableIdentifier();\n            if (strict) {\n                if (isRestrictedWord(token.value)) {\n                    tolerateUnexpectedToken(token, Messages.StrictFunctionName);\n                }\n            } else {\n                if (isRestrictedWord(token.value)) {\n                    firstRestricted = token;\n                    message = Messages.StrictFunctionName;\n                } else if (isStrictModeReservedWord(token.value)) {\n                    firstRestricted = token;\n                    message = Messages.StrictReservedWord;\n                }\n            }\n        }\n\n        previousAllowYield = state.allowYield;\n        state.allowYield = false;\n        tmp = parseParams(firstRestricted);\n        state.allowYield = previousAllowYield;\n\n        params = tmp.params;\n        defaults = tmp.defaults;\n        stricted = tmp.stricted;\n        firstRestricted = tmp.firstRestricted;\n        if (tmp.message) {\n            message = tmp.message;\n        }\n\n        previousAllowYield = state.allowYield;\n        previousStrict = strict;\n        state.allowYield = isGenerator;\n        body = parseFunctionSourceElements();\n        if (strict && firstRestricted) {\n            throwUnexpectedToken(firstRestricted, message);\n        }\n        if (strict && stricted) {\n            tolerateUnexpectedToken(stricted, message);\n        }\n        strict = previousStrict;\n        state.allowYield = previousAllowYield;\n\n        return node.finishFunctionDeclaration(id, params, defaults, body, isGenerator);\n    }\n\n    function parseFunctionExpression() {\n        var token, id = null, stricted, firstRestricted, message, tmp,\n            params = [], defaults = [], body, previousStrict, node = new Node(),\n            isGenerator, previousAllowYield;\n\n        expectKeyword('function');\n\n        isGenerator = match('*');\n        if (isGenerator) {\n            lex();\n        }\n\n        if (!match('(')) {\n            token = lookahead;\n            id = parseVariableIdentifier();\n            if (strict) {\n                if (isRestrictedWord(token.value)) {\n                    tolerateUnexpectedToken(token, Messages.StrictFunctionName);\n                }\n            } else {\n                if (isRestrictedWord(token.value)) {\n                    firstRestricted = token;\n                    message = Messages.StrictFunctionName;\n                } else if (isStrictModeReservedWord(token.value)) {\n                    firstRestricted = token;\n                    message = Messages.StrictReservedWord;\n                }\n            }\n        }\n\n        previousAllowYield = state.allowYield;\n        state.allowYield = false;\n        tmp = parseParams(firstRestricted);\n        state.allowYield = previousAllowYield;\n\n        params = tmp.params;\n        defaults = tmp.defaults;\n        stricted = tmp.stricted;\n        firstRestricted = tmp.firstRestricted;\n        if (tmp.message) {\n            message = tmp.message;\n        }\n\n        previousStrict = strict;\n        previousAllowYield = state.allowYield;\n        state.allowYield = isGenerator;\n        body = parseFunctionSourceElements();\n\n        if (strict && firstRestricted) {\n            throwUnexpectedToken(firstRestricted, message);\n        }\n        if (strict && stricted) {\n            tolerateUnexpectedToken(stricted, message);\n        }\n        strict = previousStrict;\n        state.allowYield = previousAllowYield;\n\n        return node.finishFunctionExpression(id, params, defaults, body, isGenerator);\n    }\n\n\n    function parseClassBody() {\n        var classBody, token, isStatic, hasConstructor = false, body, method, computed, key;\n\n        classBody = new Node();\n\n        expect('{');\n        body = [];\n        while (!match('}')) {\n            if (match(';')) {\n                lex();\n            } else {\n                method = new Node();\n                token = lookahead;\n                isStatic = false;\n                computed = match('[');\n                if (match('*')) {\n                    lex();\n                } else {\n                    key = parseObjectPropertyKey();\n                    if (key.name === 'static' && (lookaheadPropertyName() || match('*'))) {\n                        token = lookahead;\n                        isStatic = true;\n                        computed = match('[');\n                        if (match('*')) {\n                            lex();\n                        } else {\n                            key = parseObjectPropertyKey();\n                        }\n                    }\n                }\n                method = tryParseMethodDefinition(token, key, computed, method);\n                if (method) {\n                    method['static'] = isStatic;\n                    if (method.kind === 'init') {\n                        method.kind = 'method';\n                    }\n                    if (!isStatic) {\n                        if (!method.computed && (method.key.name || method.key.value.toString()) === 'constructor') {\n                            if (method.kind !== 'method' || !method.method || method.value.generator) {\n                                throwUnexpectedToken(token, Messages.ConstructorSpecialMethod);\n                            }\n                            if (hasConstructor) {\n                                throwUnexpectedToken(token, Messages.DuplicateConstructor);\n                            } else {\n                                hasConstructor = true;\n                            }\n                            method.kind = 'constructor';\n                        }\n                    } else {\n                        if (!method.computed && (method.key.name || method.key.value.toString()) === 'prototype') {\n                            throwUnexpectedToken(token, Messages.StaticPrototype);\n                        }\n                    }\n                    method.type = Syntax.MethodDefinition;\n                    delete method.method;\n                    delete method.shorthand;\n                    body.push(method);\n                } else {\n                    throwUnexpectedToken(lookahead);\n                }\n            }\n        }\n        lex();\n        return classBody.finishClassBody(body);\n    }\n\n    function parseClassDeclaration(identifierIsOptional) {\n        var id = null, superClass = null, classNode = new Node(), classBody, previousStrict = strict;\n        strict = true;\n\n        expectKeyword('class');\n\n        if (!identifierIsOptional || lookahead.type === Token.Identifier) {\n            id = parseVariableIdentifier();\n        }\n\n        if (matchKeyword('extends')) {\n            lex();\n            superClass = isolateCoverGrammar(parseLeftHandSideExpressionAllowCall);\n        }\n        classBody = parseClassBody();\n        strict = previousStrict;\n\n        return classNode.finishClassDeclaration(id, superClass, classBody);\n    }\n\n    function parseClassExpression() {\n        var id = null, superClass = null, classNode = new Node(), classBody, previousStrict = strict;\n        strict = true;\n\n        expectKeyword('class');\n\n        if (lookahead.type === Token.Identifier) {\n            id = parseVariableIdentifier();\n        }\n\n        if (matchKeyword('extends')) {\n            lex();\n            superClass = isolateCoverGrammar(parseLeftHandSideExpressionAllowCall);\n        }\n        classBody = parseClassBody();\n        strict = previousStrict;\n\n        return classNode.finishClassExpression(id, superClass, classBody);\n    }\n\n    // Modules grammar from:\n    // people.mozilla.org/~jorendorff/es6-draft.html\n\n    function parseModuleSpecifier() {\n        var node = new Node();\n\n        if (lookahead.type !== Token.StringLiteral) {\n            throwError(Messages.InvalidModuleSpecifier);\n        }\n        return node.finishLiteral(lex());\n    }\n\n    function parseExportSpecifier() {\n        var exported, local, node = new Node(), def;\n        if (matchKeyword('default')) {\n            // export {default} from 'something';\n            def = new Node();\n            lex();\n            local = def.finishIdentifier('default');\n        } else {\n            local = parseVariableIdentifier();\n        }\n        if (matchContextualKeyword('as')) {\n            lex();\n            exported = parseNonComputedProperty();\n        }\n        return node.finishExportSpecifier(local, exported);\n    }\n\n    function parseExportNamedDeclaration(node) {\n        var declaration = null,\n            isExportFromIdentifier,\n            src = null, specifiers = [];\n\n        // non-default export\n        if (lookahead.type === Token.Keyword) {\n            // covers:\n            // export var f = 1;\n            switch (lookahead.value) {\n                case 'let':\n                case 'const':\n                case 'var':\n                case 'class':\n                case 'function':\n                    declaration = parseStatementListItem();\n                    return node.finishExportNamedDeclaration(declaration, specifiers, null);\n            }\n        }\n\n        expect('{');\n        if (!match('}')) {\n            do {\n                isExportFromIdentifier = isExportFromIdentifier || matchKeyword('default');\n                specifiers.push(parseExportSpecifier());\n            } while (match(',') && lex());\n        }\n        expect('}');\n\n        if (matchContextualKeyword('from')) {\n            // covering:\n            // export {default} from 'foo';\n            // export {foo} from 'foo';\n            lex();\n            src = parseModuleSpecifier();\n            consumeSemicolon();\n        } else if (isExportFromIdentifier) {\n            // covering:\n            // export {default}; // missing fromClause\n            throwError(lookahead.value ?\n                    Messages.UnexpectedToken : Messages.MissingFromClause, lookahead.value);\n        } else {\n            // cover\n            // export {foo};\n            consumeSemicolon();\n        }\n        return node.finishExportNamedDeclaration(declaration, specifiers, src);\n    }\n\n    function parseExportDefaultDeclaration(node) {\n        var declaration = null,\n            expression = null;\n\n        // covers:\n        // export default ...\n        expectKeyword('default');\n\n        if (matchKeyword('function')) {\n            // covers:\n            // export default function foo () {}\n            // export default function () {}\n            declaration = parseFunctionDeclaration(new Node(), true);\n            return node.finishExportDefaultDeclaration(declaration);\n        }\n        if (matchKeyword('class')) {\n            declaration = parseClassDeclaration(true);\n            return node.finishExportDefaultDeclaration(declaration);\n        }\n\n        if (matchContextualKeyword('from')) {\n            throwError(Messages.UnexpectedToken, lookahead.value);\n        }\n\n        // covers:\n        // export default {};\n        // export default [];\n        // export default (1 + 2);\n        if (match('{')) {\n            expression = parseObjectInitialiser();\n        } else if (match('[')) {\n            expression = parseArrayInitialiser();\n        } else {\n            expression = parseAssignmentExpression();\n        }\n        consumeSemicolon();\n        return node.finishExportDefaultDeclaration(expression);\n    }\n\n    function parseExportAllDeclaration(node) {\n        var src;\n\n        // covers:\n        // export * from 'foo';\n        expect('*');\n        if (!matchContextualKeyword('from')) {\n            throwError(lookahead.value ?\n                    Messages.UnexpectedToken : Messages.MissingFromClause, lookahead.value);\n        }\n        lex();\n        src = parseModuleSpecifier();\n        consumeSemicolon();\n\n        return node.finishExportAllDeclaration(src);\n    }\n\n    function parseExportDeclaration() {\n        var node = new Node();\n        if (state.inFunctionBody) {\n            throwError(Messages.IllegalExportDeclaration);\n        }\n\n        expectKeyword('export');\n\n        if (matchKeyword('default')) {\n            return parseExportDefaultDeclaration(node);\n        }\n        if (match('*')) {\n            return parseExportAllDeclaration(node);\n        }\n        return parseExportNamedDeclaration(node);\n    }\n\n    function parseImportSpecifier() {\n        // import {<foo as bar>} ...;\n        var local, imported, node = new Node();\n\n        imported = parseNonComputedProperty();\n        if (matchContextualKeyword('as')) {\n            lex();\n            local = parseVariableIdentifier();\n        }\n\n        return node.finishImportSpecifier(local, imported);\n    }\n\n    function parseNamedImports() {\n        var specifiers = [];\n        // {foo, bar as bas}\n        expect('{');\n        if (!match('}')) {\n            do {\n                specifiers.push(parseImportSpecifier());\n            } while (match(',') && lex());\n        }\n        expect('}');\n        return specifiers;\n    }\n\n    function parseImportDefaultSpecifier() {\n        // import <foo> ...;\n        var local, node = new Node();\n\n        local = parseNonComputedProperty();\n\n        return node.finishImportDefaultSpecifier(local);\n    }\n\n    function parseImportNamespaceSpecifier() {\n        // import <* as foo> ...;\n        var local, node = new Node();\n\n        expect('*');\n        if (!matchContextualKeyword('as')) {\n            throwError(Messages.NoAsAfterImportNamespace);\n        }\n        lex();\n        local = parseNonComputedProperty();\n\n        return node.finishImportNamespaceSpecifier(local);\n    }\n\n    function parseImportDeclaration() {\n        var specifiers, src, node = new Node();\n\n        if (state.inFunctionBody) {\n            throwError(Messages.IllegalImportDeclaration);\n        }\n\n        expectKeyword('import');\n        specifiers = [];\n\n        if (lookahead.type === Token.StringLiteral) {\n            // covers:\n            // import 'foo';\n            src = parseModuleSpecifier();\n            consumeSemicolon();\n            return node.finishImportDeclaration(specifiers, src);\n        }\n\n        if (!matchKeyword('default') && isIdentifierName(lookahead)) {\n            // covers:\n            // import foo\n            // import foo, ...\n            specifiers.push(parseImportDefaultSpecifier());\n            if (match(',')) {\n                lex();\n            }\n        }\n        if (match('*')) {\n            // covers:\n            // import foo, * as foo\n            // import * as foo\n            specifiers.push(parseImportNamespaceSpecifier());\n        } else if (match('{')) {\n            // covers:\n            // import foo, {bar}\n            // import {bar}\n            specifiers = specifiers.concat(parseNamedImports());\n        }\n\n        if (!matchContextualKeyword('from')) {\n            throwError(lookahead.value ?\n                    Messages.UnexpectedToken : Messages.MissingFromClause, lookahead.value);\n        }\n        lex();\n        src = parseModuleSpecifier();\n        consumeSemicolon();\n\n        return node.finishImportDeclaration(specifiers, src);\n    }\n\n    // 14 Program\n\n    function parseScriptBody() {\n        var statement, body = [], token, directive, firstRestricted;\n\n        while (startIndex < length) {\n            token = lookahead;\n            if (token.type !== Token.StringLiteral) {\n                break;\n            }\n\n            statement = parseStatementListItem();\n            body.push(statement);\n            if (statement.expression.type !== Syntax.Literal) {\n                // this is not directive\n                break;\n            }\n            directive = source.slice(token.start + 1, token.end - 1);\n            if (directive === 'use strict') {\n                strict = true;\n                if (firstRestricted) {\n                    tolerateUnexpectedToken(firstRestricted, Messages.StrictOctalLiteral);\n                }\n            } else {\n                if (!firstRestricted && token.octal) {\n                    firstRestricted = token;\n                }\n            }\n        }\n\n        while (startIndex < length) {\n            statement = parseStatementListItem();\n            /* istanbul ignore if */\n            if (typeof statement === 'undefined') {\n                break;\n            }\n            body.push(statement);\n        }\n        return body;\n    }\n\n    function parseProgram() {\n        var body, node;\n\n        peek();\n        node = new Node();\n\n        body = parseScriptBody();\n        return node.finishProgram(body);\n    }\n\n    function filterTokenLocation() {\n        var i, entry, token, tokens = [];\n\n        for (i = 0; i < extra.tokens.length; ++i) {\n            entry = extra.tokens[i];\n            token = {\n                type: entry.type,\n                value: entry.value\n            };\n            if (entry.regex) {\n                token.regex = {\n                    pattern: entry.regex.pattern,\n                    flags: entry.regex.flags\n                };\n            }\n            if (extra.range) {\n                token.range = entry.range;\n            }\n            if (extra.loc) {\n                token.loc = entry.loc;\n            }\n            tokens.push(token);\n        }\n\n        extra.tokens = tokens;\n    }\n\n    function tokenize(code, options) {\n        var toString,\n            tokens;\n\n        toString = String;\n        if (typeof code !== 'string' && !(code instanceof String)) {\n            code = toString(code);\n        }\n\n        source = code;\n        index = 0;\n        lineNumber = (source.length > 0) ? 1 : 0;\n        lineStart = 0;\n        startIndex = index;\n        startLineNumber = lineNumber;\n        startLineStart = lineStart;\n        length = source.length;\n        lookahead = null;\n        state = {\n            allowIn: true,\n            allowYield: false,\n            labelSet: {},\n            inFunctionBody: false,\n            inIteration: false,\n            inSwitch: false,\n            lastCommentStart: -1,\n            curlyStack: []\n        };\n\n        extra = {};\n\n        // Options matching.\n        options = options || {};\n\n        // Of course we collect tokens here.\n        options.tokens = true;\n        extra.tokens = [];\n        extra.tokenize = true;\n        // The following two fields are necessary to compute the Regex tokens.\n        extra.openParenToken = -1;\n        extra.openCurlyToken = -1;\n\n        extra.range = (typeof options.range === 'boolean') && options.range;\n        extra.loc = (typeof options.loc === 'boolean') && options.loc;\n\n        if (typeof options.comment === 'boolean' && options.comment) {\n            extra.comments = [];\n        }\n        if (typeof options.tolerant === 'boolean' && options.tolerant) {\n            extra.errors = [];\n        }\n\n        try {\n            peek();\n            if (lookahead.type === Token.EOF) {\n                return extra.tokens;\n            }\n\n            lex();\n            while (lookahead.type !== Token.EOF) {\n                try {\n                    lex();\n                } catch (lexError) {\n                    if (extra.errors) {\n                        recordError(lexError);\n                        // We have to break on the first error\n                        // to avoid infinite loops.\n                        break;\n                    } else {\n                        throw lexError;\n                    }\n                }\n            }\n\n            filterTokenLocation();\n            tokens = extra.tokens;\n            if (typeof extra.comments !== 'undefined') {\n                tokens.comments = extra.comments;\n            }\n            if (typeof extra.errors !== 'undefined') {\n                tokens.errors = extra.errors;\n            }\n        } catch (e) {\n            throw e;\n        } finally {\n            extra = {};\n        }\n        return tokens;\n    }\n\n    function parse(code, options) {\n        var program, toString;\n\n        toString = String;\n        if (typeof code !== 'string' && !(code instanceof String)) {\n            code = toString(code);\n        }\n\n        source = code;\n        index = 0;\n        lineNumber = (source.length > 0) ? 1 : 0;\n        lineStart = 0;\n        startIndex = index;\n        startLineNumber = lineNumber;\n        startLineStart = lineStart;\n        length = source.length;\n        lookahead = null;\n        state = {\n            allowIn: true,\n            allowYield: false,\n            labelSet: {},\n            inFunctionBody: false,\n            inIteration: false,\n            inSwitch: false,\n            lastCommentStart: -1,\n            curlyStack: []\n        };\n        sourceType = 'script';\n        strict = false;\n\n        extra = {};\n        if (typeof options !== 'undefined') {\n            extra.range = (typeof options.range === 'boolean') && options.range;\n            extra.loc = (typeof options.loc === 'boolean') && options.loc;\n            extra.attachComment = (typeof options.attachComment === 'boolean') && options.attachComment;\n\n            if (extra.loc && options.source !== null && options.source !== undefined) {\n                extra.source = toString(options.source);\n            }\n\n            if (typeof options.tokens === 'boolean' && options.tokens) {\n                extra.tokens = [];\n            }\n            if (typeof options.comment === 'boolean' && options.comment) {\n                extra.comments = [];\n            }\n            if (typeof options.tolerant === 'boolean' && options.tolerant) {\n                extra.errors = [];\n            }\n            if (extra.attachComment) {\n                extra.range = true;\n                extra.comments = [];\n                extra.bottomRightStack = [];\n                extra.trailingComments = [];\n                extra.leadingComments = [];\n            }\n            if (options.sourceType === 'module') {\n                // very restrictive condition for now\n                sourceType = options.sourceType;\n                strict = true;\n            }\n        }\n\n        try {\n            program = parseProgram();\n            if (typeof extra.comments !== 'undefined') {\n                program.comments = extra.comments;\n            }\n            if (typeof extra.tokens !== 'undefined') {\n                filterTokenLocation();\n                program.tokens = extra.tokens;\n            }\n            if (typeof extra.errors !== 'undefined') {\n                program.errors = extra.errors;\n            }\n        } catch (e) {\n            throw e;\n        } finally {\n            extra = {};\n        }\n\n        return program;\n    }\n\n    // Sync with *.json manifests.\n    exports.version = '2.4.1';\n\n    exports.tokenize = tokenize;\n\n    exports.parse = parse;\n\n    // Deep copy.\n    /* istanbul ignore next */\n    exports.Syntax = (function () {\n        var name, types = {};\n\n        if (typeof Object.create === 'function') {\n            types = Object.create(null);\n        }\n\n        for (name in Syntax) {\n            if (Syntax.hasOwnProperty(name)) {\n                types[name] = Syntax[name];\n            }\n        }\n\n        if (typeof Object.freeze === 'function') {\n            Object.freeze(types);\n        }\n\n        return types;\n    }());\n\n}));\n/* vim: set sw=4 ts=4 et tw=80 : */\n","pre":true}});;jsio("import devkit.browser.launchClient");